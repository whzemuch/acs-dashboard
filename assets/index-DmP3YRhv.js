(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function a3(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var sp={exports:{}},Da={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gb;function OR(){if(gb)return Da;gb=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(i,r,s){var l=null;if(s!==void 0&&(l=""+s),r.key!==void 0&&(l=""+r.key),"key"in r){s={};for(var c in r)c!=="key"&&(s[c]=r[c])}else s=r;return r=s.ref,{$$typeof:t,type:i,key:l,ref:r!==void 0?r:null,props:s}}return Da.Fragment=e,Da.jsx=n,Da.jsxs=n,Da}var mb;function IR(){return mb||(mb=1,sp.exports=OR()),sp.exports}var Y=IR(),op={exports:{}},Ce={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _b;function NR(){if(_b)return Ce;_b=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function y(A){return A===null||typeof A!="object"?null:(A=m&&A[m]||A["@@iterator"],typeof A=="function"?A:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function E(A,U,X){this.props=A,this.context=U,this.refs=T,this.updater=X||v}E.prototype.isReactComponent={},E.prototype.setState=function(A,U){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,U,"setState")},E.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function C(){}C.prototype=E.prototype;function P(A,U,X){this.props=A,this.context=U,this.refs=T,this.updater=X||v}var M=P.prototype=new C;M.constructor=P,x(M,E.prototype),M.isPureReactComponent=!0;var I=Array.isArray,D={H:null,A:null,T:null,S:null,V:null},z=Object.prototype.hasOwnProperty;function ae(A,U,X,ee,ne,fe){return X=fe.ref,{$$typeof:t,type:A,key:U,ref:X!==void 0?X:null,props:fe}}function he(A,U){return ae(A.type,U,void 0,void 0,void 0,A.props)}function le(A){return typeof A=="object"&&A!==null&&A.$$typeof===t}function ge(A){var U={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(X){return U[X]})}var Z=/\/+/g;function ce(A,U){return typeof A=="object"&&A!==null&&A.key!=null?ge(""+A.key):U.toString(36)}function de(){}function pe(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(de,de):(A.status="pending",A.then(function(U){A.status==="pending"&&(A.status="fulfilled",A.value=U)},function(U){A.status==="pending"&&(A.status="rejected",A.reason=U)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function Ae(A,U,X,ee,ne){var fe=typeof A;(fe==="undefined"||fe==="boolean")&&(A=null);var me=!1;if(A===null)me=!0;else switch(fe){case"bigint":case"string":case"number":me=!0;break;case"object":switch(A.$$typeof){case t:case e:me=!0;break;case p:return me=A._init,Ae(me(A._payload),U,X,ee,ne)}}if(me)return ne=ne(A),me=ee===""?"."+ce(A,0):ee,I(ne)?(X="",me!=null&&(X=me.replace(Z,"$&/")+"/"),Ae(ne,U,X,"",function(je){return je})):ne!=null&&(le(ne)&&(ne=he(ne,X+(ne.key==null||A&&A.key===ne.key?"":(""+ne.key).replace(Z,"$&/")+"/")+me)),U.push(ne)),1;me=0;var Te=ee===""?".":ee+":";if(I(A))for(var ve=0;ve<A.length;ve++)ee=A[ve],fe=Te+ce(ee,ve),me+=Ae(ee,U,X,fe,ne);else if(ve=y(A),typeof ve=="function")for(A=ve.call(A),ve=0;!(ee=A.next()).done;)ee=ee.value,fe=Te+ce(ee,ve++),me+=Ae(ee,U,X,fe,ne);else if(fe==="object"){if(typeof A.then=="function")return Ae(pe(A),U,X,ee,ne);throw U=String(A),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return me}function w(A,U,X){if(A==null)return A;var ee=[],ne=0;return Ae(A,ee,"","",function(fe){return U.call(X,fe,ne++)}),ee}function k(A){if(A._status===-1){var U=A._result;U=U(),U.then(function(X){(A._status===0||A._status===-1)&&(A._status=1,A._result=X)},function(X){(A._status===0||A._status===-1)&&(A._status=2,A._result=X)}),A._status===-1&&(A._status=0,A._result=U)}if(A._status===1)return A._result.default;throw A._result}var N=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function G(){}return Ce.Children={map:w,forEach:function(A,U,X){w(A,function(){U.apply(this,arguments)},X)},count:function(A){var U=0;return w(A,function(){U++}),U},toArray:function(A){return w(A,function(U){return U})||[]},only:function(A){if(!le(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},Ce.Component=E,Ce.Fragment=n,Ce.Profiler=r,Ce.PureComponent=P,Ce.StrictMode=i,Ce.Suspense=f,Ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ce.__COMPILER_RUNTIME={__proto__:null,c:function(A){return D.H.useMemoCache(A)}},Ce.cache=function(A){return function(){return A.apply(null,arguments)}},Ce.cloneElement=function(A,U,X){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var ee=x({},A.props),ne=A.key,fe=void 0;if(U!=null)for(me in U.ref!==void 0&&(fe=void 0),U.key!==void 0&&(ne=""+U.key),U)!z.call(U,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&U.ref===void 0||(ee[me]=U[me]);var me=arguments.length-2;if(me===1)ee.children=X;else if(1<me){for(var Te=Array(me),ve=0;ve<me;ve++)Te[ve]=arguments[ve+2];ee.children=Te}return ae(A.type,ne,void 0,void 0,fe,ee)},Ce.createContext=function(A){return A={$$typeof:l,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:s,_context:A},A},Ce.createElement=function(A,U,X){var ee,ne={},fe=null;if(U!=null)for(ee in U.key!==void 0&&(fe=""+U.key),U)z.call(U,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(ne[ee]=U[ee]);var me=arguments.length-2;if(me===1)ne.children=X;else if(1<me){for(var Te=Array(me),ve=0;ve<me;ve++)Te[ve]=arguments[ve+2];ne.children=Te}if(A&&A.defaultProps)for(ee in me=A.defaultProps,me)ne[ee]===void 0&&(ne[ee]=me[ee]);return ae(A,fe,void 0,void 0,null,ne)},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(A){return{$$typeof:c,render:A}},Ce.isValidElement=le,Ce.lazy=function(A){return{$$typeof:p,_payload:{_status:-1,_result:A},_init:k}},Ce.memo=function(A,U){return{$$typeof:h,type:A,compare:U===void 0?null:U}},Ce.startTransition=function(A){var U=D.T,X={};D.T=X;try{var ee=A(),ne=D.S;ne!==null&&ne(X,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(G,N)}catch(fe){N(fe)}finally{D.T=U}},Ce.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Ce.use=function(A){return D.H.use(A)},Ce.useActionState=function(A,U,X){return D.H.useActionState(A,U,X)},Ce.useCallback=function(A,U){return D.H.useCallback(A,U)},Ce.useContext=function(A){return D.H.useContext(A)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(A,U){return D.H.useDeferredValue(A,U)},Ce.useEffect=function(A,U,X){var ee=D.H;if(typeof X=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ee.useEffect(A,U)},Ce.useId=function(){return D.H.useId()},Ce.useImperativeHandle=function(A,U,X){return D.H.useImperativeHandle(A,U,X)},Ce.useInsertionEffect=function(A,U){return D.H.useInsertionEffect(A,U)},Ce.useLayoutEffect=function(A,U){return D.H.useLayoutEffect(A,U)},Ce.useMemo=function(A,U){return D.H.useMemo(A,U)},Ce.useOptimistic=function(A,U){return D.H.useOptimistic(A,U)},Ce.useReducer=function(A,U,X){return D.H.useReducer(A,U,X)},Ce.useRef=function(A){return D.H.useRef(A)},Ce.useState=function(A){return D.H.useState(A)},Ce.useSyncExternalStore=function(A,U,X){return D.H.useSyncExternalStore(A,U,X)},Ce.useTransition=function(){return D.H.useTransition()},Ce.version="19.1.1",Ce}var yb;function om(){return yb||(yb=1,op.exports=NR()),op.exports}var L=om();const Xc=a3(L);var ap={exports:{}},La={},lp={exports:{}},cp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vb;function kR(){return vb||(vb=1,(function(t){function e(w,k){var N=w.length;w.push(k);e:for(;0<N;){var G=N-1>>>1,A=w[G];if(0<r(A,k))w[G]=k,w[N]=A,N=G;else break e}}function n(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var k=w[0],N=w.pop();if(N!==k){w[0]=N;e:for(var G=0,A=w.length,U=A>>>1;G<U;){var X=2*(G+1)-1,ee=w[X],ne=X+1,fe=w[ne];if(0>r(ee,N))ne<A&&0>r(fe,ee)?(w[G]=fe,w[ne]=N,G=ne):(w[G]=ee,w[X]=N,G=X);else if(ne<A&&0>r(fe,N))w[G]=fe,w[ne]=N,G=ne;else break e}}return k}function r(w,k){var N=w.sortIndex-k.sortIndex;return N!==0?N:w.id-k.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var f=[],h=[],p=1,m=null,y=3,v=!1,x=!1,T=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function I(w){for(var k=n(h);k!==null;){if(k.callback===null)i(h);else if(k.startTime<=w)i(h),k.sortIndex=k.expirationTime,e(f,k);else break;k=n(h)}}function D(w){if(T=!1,I(w),!x)if(n(f)!==null)x=!0,z||(z=!0,ce());else{var k=n(h);k!==null&&Ae(D,k.startTime-w)}}var z=!1,ae=-1,he=5,le=-1;function ge(){return E?!0:!(t.unstable_now()-le<he)}function Z(){if(E=!1,z){var w=t.unstable_now();le=w;var k=!0;try{e:{x=!1,T&&(T=!1,P(ae),ae=-1),v=!0;var N=y;try{t:{for(I(w),m=n(f);m!==null&&!(m.expirationTime>w&&ge());){var G=m.callback;if(typeof G=="function"){m.callback=null,y=m.priorityLevel;var A=G(m.expirationTime<=w);if(w=t.unstable_now(),typeof A=="function"){m.callback=A,I(w),k=!0;break t}m===n(f)&&i(f),I(w)}else i(f);m=n(f)}if(m!==null)k=!0;else{var U=n(h);U!==null&&Ae(D,U.startTime-w),k=!1}}break e}finally{m=null,y=N,v=!1}k=void 0}}finally{k?ce():z=!1}}}var ce;if(typeof M=="function")ce=function(){M(Z)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,pe=de.port2;de.port1.onmessage=Z,ce=function(){pe.postMessage(null)}}else ce=function(){C(Z,0)};function Ae(w,k){ae=C(function(){w(t.unstable_now())},k)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(w){w.callback=null},t.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):he=0<w?Math.floor(1e3/w):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_next=function(w){switch(y){case 1:case 2:case 3:var k=3;break;default:k=y}var N=y;y=k;try{return w()}finally{y=N}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(w,k){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var N=y;y=w;try{return k()}finally{y=N}},t.unstable_scheduleCallback=function(w,k,N){var G=t.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?G+N:G):N=G,w){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=N+A,w={id:p++,callback:k,priorityLevel:w,startTime:N,expirationTime:A,sortIndex:-1},N>G?(w.sortIndex=N,e(h,w),n(f)===null&&w===n(h)&&(T?(P(ae),ae=-1):T=!0,Ae(D,N-G))):(w.sortIndex=A,e(f,w),x||v||(x=!0,z||(z=!0,ce()))),w},t.unstable_shouldYield=ge,t.unstable_wrapCallback=function(w){var k=y;return function(){var N=y;y=k;try{return w.apply(this,arguments)}finally{y=N}}}})(cp)),cp}var bb;function DR(){return bb||(bb=1,lp.exports=kR()),lp.exports}var up={exports:{}},Nt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xb;function LR(){if(xb)return Nt;xb=1;var t=om();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(f,h,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:f,containerInfo:h,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Nt.createPortal=function(f,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(f,h,null,p)},Nt.flushSync=function(f){var h=l.T,p=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=h,i.p=p,i.d.f()}},Nt.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(f,h))},Nt.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Nt.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var p=h.as,m=c(p,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?i.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:v}):p==="script"&&i.d.X(f,{crossOrigin:m,integrity:y,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Nt.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=c(h.as,h.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(f)},Nt.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,m=c(p,h.crossOrigin);i.d.L(f,p,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Nt.preloadModule=function(f,h){if(typeof f=="string")if(h){var p=c(h.as,h.crossOrigin);i.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(f)},Nt.requestFormReset=function(f){i.d.r(f)},Nt.unstable_batchedUpdates=function(f,h){return f(h)},Nt.useFormState=function(f,h,p){return l.H.useFormState(f,h,p)},Nt.useFormStatus=function(){return l.H.useHostTransitionStatus()},Nt.version="19.1.1",Nt}var Tb;function l3(){if(Tb)return up.exports;Tb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),up.exports=LR(),up.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wb;function BR(){if(wb)return La;wb=1;var t=DR(),e=om(),n=l3();function i(o){var a="https://react.dev/errors/"+o;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+o+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function s(o){var a=o,u=o;if(o.alternate)for(;a.return;)a=a.return;else{o=a;do a=o,(a.flags&4098)!==0&&(u=a.return),o=a.return;while(o)}return a.tag===3?u:null}function l(o){if(o.tag===13){var a=o.memoizedState;if(a===null&&(o=o.alternate,o!==null&&(a=o.memoizedState)),a!==null)return a.dehydrated}return null}function c(o){if(s(o)!==o)throw Error(i(188))}function f(o){var a=o.alternate;if(!a){if(a=s(o),a===null)throw Error(i(188));return a!==o?null:o}for(var u=o,d=a;;){var g=u.return;if(g===null)break;var _=g.alternate;if(_===null){if(d=g.return,d!==null){u=d;continue}break}if(g.child===_.child){for(_=g.child;_;){if(_===u)return c(g),o;if(_===d)return c(g),a;_=_.sibling}throw Error(i(188))}if(u.return!==d.return)u=g,d=_;else{for(var b=!1,S=g.child;S;){if(S===u){b=!0,u=g,d=_;break}if(S===d){b=!0,d=g,u=_;break}S=S.sibling}if(!b){for(S=_.child;S;){if(S===u){b=!0,u=_,d=g;break}if(S===d){b=!0,d=_,u=g;break}S=S.sibling}if(!b)throw Error(i(189))}}if(u.alternate!==d)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?o:a}function h(o){var a=o.tag;if(a===5||a===26||a===27||a===6)return o;for(o=o.child;o!==null;){if(a=h(o),a!==null)return a;o=o.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),P=Symbol.for("react.consumer"),M=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),le=Symbol.for("react.activity"),ge=Symbol.for("react.memo_cache_sentinel"),Z=Symbol.iterator;function ce(o){return o===null||typeof o!="object"?null:(o=Z&&o[Z]||o["@@iterator"],typeof o=="function"?o:null)}var de=Symbol.for("react.client.reference");function pe(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===de?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case x:return"Fragment";case E:return"Profiler";case T:return"StrictMode";case D:return"Suspense";case z:return"SuspenseList";case le:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case v:return"Portal";case M:return(o.displayName||"Context")+".Provider";case P:return(o._context.displayName||"Context")+".Consumer";case I:var a=o.render;return o=o.displayName,o||(o=a.displayName||a.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case ae:return a=o.displayName||null,a!==null?a:pe(o.type)||"Memo";case he:a=o._payload,o=o._init;try{return pe(o(a))}catch{}}return null}var Ae=Array.isArray,w=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N={pending:!1,data:null,method:null,action:null},G=[],A=-1;function U(o){return{current:o}}function X(o){0>A||(o.current=G[A],G[A]=null,A--)}function ee(o,a){A++,G[A]=o.current,o.current=a}var ne=U(null),fe=U(null),me=U(null),Te=U(null);function ve(o,a){switch(ee(me,a),ee(fe,o),ee(ne,null),a.nodeType){case 9:case 11:o=(o=a.documentElement)&&(o=o.namespaceURI)?Hv(o):0;break;default:if(o=a.tagName,a=a.namespaceURI)a=Hv(a),o=$v(a,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}X(ne),ee(ne,o)}function je(){X(ne),X(fe),X(me)}function He(o){o.memoizedState!==null&&ee(Te,o);var a=ne.current,u=$v(a,o.type);a!==u&&(ee(fe,o),ee(ne,u))}function Bn(o){fe.current===o&&(X(ne),X(fe)),Te.current===o&&(X(Te),Pa._currentValue=N)}var ni=Object.prototype.hasOwnProperty,as=t.unstable_scheduleCallback,ls=t.unstable_cancelCallback,Be=t.unstable_shouldYield,Ue=t.unstable_requestPaint,Un=t.unstable_now,fA=t.unstable_getCurrentPriorityLevel,w_=t.unstable_ImmediatePriority,S_=t.unstable_UserBlockingPriority,Il=t.unstable_NormalPriority,hA=t.unstable_LowPriority,A_=t.unstable_IdlePriority,dA=t.log,pA=t.unstable_setDisableYieldValue,Uo=null,Xt=null;function Ri(o){if(typeof dA=="function"&&pA(o),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(Uo,o)}catch{}}var Yt=Math.clz32?Math.clz32:_A,gA=Math.log,mA=Math.LN2;function _A(o){return o>>>=0,o===0?32:31-(gA(o)/mA|0)|0}var Nl=256,kl=4194304;function yr(o){var a=o&42;if(a!==0)return a;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Dl(o,a,u){var d=o.pendingLanes;if(d===0)return 0;var g=0,_=o.suspendedLanes,b=o.pingedLanes;o=o.warmLanes;var S=d&134217727;return S!==0?(d=S&~_,d!==0?g=yr(d):(b&=S,b!==0?g=yr(b):u||(u=S&~o,u!==0&&(g=yr(u))))):(S=d&~_,S!==0?g=yr(S):b!==0?g=yr(b):u||(u=d&~o,u!==0&&(g=yr(u)))),g===0?0:a!==0&&a!==g&&(a&_)===0&&(_=g&-g,u=a&-a,_>=u||_===32&&(u&4194048)!==0)?a:g}function Fo(o,a){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&a)===0}function yA(o,a){switch(o){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function E_(){var o=Nl;return Nl<<=1,(Nl&4194048)===0&&(Nl=256),o}function R_(){var o=kl;return kl<<=1,(kl&62914560)===0&&(kl=4194304),o}function qf(o){for(var a=[],u=0;31>u;u++)a.push(o);return a}function zo(o,a){o.pendingLanes|=a,a!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function vA(o,a,u,d,g,_){var b=o.pendingLanes;o.pendingLanes=u,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=u,o.entangledLanes&=u,o.errorRecoveryDisabledLanes&=u,o.shellSuspendCounter=0;var S=o.entanglements,B=o.expirationTimes,Q=o.hiddenUpdates;for(u=b&~u;0<u;){var ie=31-Yt(u),oe=1<<ie;S[ie]=0,B[ie]=-1;var J=Q[ie];if(J!==null)for(Q[ie]=null,ie=0;ie<J.length;ie++){var te=J[ie];te!==null&&(te.lane&=-536870913)}u&=~oe}d!==0&&C_(o,d,0),_!==0&&g===0&&o.tag!==0&&(o.suspendedLanes|=_&~(b&~a))}function C_(o,a,u){o.pendingLanes|=a,o.suspendedLanes&=~a;var d=31-Yt(a);o.entangledLanes|=a,o.entanglements[d]=o.entanglements[d]|1073741824|u&4194090}function M_(o,a){var u=o.entangledLanes|=a;for(o=o.entanglements;u;){var d=31-Yt(u),g=1<<d;g&a|o[d]&a&&(o[d]|=a),u&=~g}}function Kf(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Zf(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function P_(){var o=k.p;return o!==0?o:(o=window.event,o===void 0?32:cb(o.type))}function bA(o,a){var u=k.p;try{return k.p=o,a()}finally{k.p=u}}var Ci=Math.random().toString(36).slice(2),Ot="__reactFiber$"+Ci,zt="__reactProps$"+Ci,cs="__reactContainer$"+Ci,Gf="__reactEvents$"+Ci,xA="__reactListeners$"+Ci,TA="__reactHandles$"+Ci,O_="__reactResources$"+Ci,Vo="__reactMarker$"+Ci;function Qf(o){delete o[Ot],delete o[zt],delete o[Gf],delete o[xA],delete o[TA]}function us(o){var a=o[Ot];if(a)return a;for(var u=o.parentNode;u;){if(a=u[cs]||u[Ot]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(o=qv(o);o!==null;){if(u=o[Ot])return u;o=qv(o)}return a}o=u,u=o.parentNode}return null}function fs(o){if(o=o[Ot]||o[cs]){var a=o.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return o}return null}function jo(o){var a=o.tag;if(a===5||a===26||a===27||a===6)return o.stateNode;throw Error(i(33))}function hs(o){var a=o[O_];return a||(a=o[O_]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Tt(o){o[Vo]=!0}var I_=new Set,N_={};function vr(o,a){ds(o,a),ds(o+"Capture",a)}function ds(o,a){for(N_[o]=a,o=0;o<a.length;o++)I_.add(a[o])}var wA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),k_={},D_={};function SA(o){return ni.call(D_,o)?!0:ni.call(k_,o)?!1:wA.test(o)?D_[o]=!0:(k_[o]=!0,!1)}function Ll(o,a,u){if(SA(a))if(u===null)o.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":o.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){o.removeAttribute(a);return}}o.setAttribute(a,""+u)}}function Bl(o,a,u){if(u===null)o.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(a);return}o.setAttribute(a,""+u)}}function ii(o,a,u,d){if(d===null)o.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(u);return}o.setAttributeNS(a,u,""+d)}}var Jf,L_;function ps(o){if(Jf===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);Jf=a&&a[1]||"",L_=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Jf+o+L_}var eh=!1;function th(o,a){if(!o||eh)return"";eh=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(te){var J=te}Reflect.construct(o,[],oe)}else{try{oe.call()}catch(te){J=te}o.call(oe.prototype)}}else{try{throw Error()}catch(te){J=te}(oe=o())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(te){if(te&&J&&typeof te.stack=="string")return[te.stack,J.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=d.DetermineComponentFrameRoot(),b=_[0],S=_[1];if(b&&S){var B=b.split(`
`),Q=S.split(`
`);for(g=d=0;d<B.length&&!B[d].includes("DetermineComponentFrameRoot");)d++;for(;g<Q.length&&!Q[g].includes("DetermineComponentFrameRoot");)g++;if(d===B.length||g===Q.length)for(d=B.length-1,g=Q.length-1;1<=d&&0<=g&&B[d]!==Q[g];)g--;for(;1<=d&&0<=g;d--,g--)if(B[d]!==Q[g]){if(d!==1||g!==1)do if(d--,g--,0>g||B[d]!==Q[g]){var ie=`
`+B[d].replace(" at new "," at ");return o.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",o.displayName)),ie}while(1<=d&&0<=g);break}}}finally{eh=!1,Error.prepareStackTrace=u}return(u=o?o.displayName||o.name:"")?ps(u):""}function AA(o){switch(o.tag){case 26:case 27:case 5:return ps(o.type);case 16:return ps("Lazy");case 13:return ps("Suspense");case 19:return ps("SuspenseList");case 0:case 15:return th(o.type,!1);case 11:return th(o.type.render,!1);case 1:return th(o.type,!0);case 31:return ps("Activity");default:return""}}function B_(o){try{var a="";do a+=AA(o),o=o.return;while(o);return a}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function an(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function U_(o){var a=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function EA(o){var a=U_(o)?"checked":"value",u=Object.getOwnPropertyDescriptor(o.constructor.prototype,a),d=""+o[a];if(!o.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,_=u.set;return Object.defineProperty(o,a,{configurable:!0,get:function(){return g.call(this)},set:function(b){d=""+b,_.call(this,b)}}),Object.defineProperty(o,a,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(b){d=""+b},stopTracking:function(){o._valueTracker=null,delete o[a]}}}}function Ul(o){o._valueTracker||(o._valueTracker=EA(o))}function F_(o){if(!o)return!1;var a=o._valueTracker;if(!a)return!0;var u=a.getValue(),d="";return o&&(d=U_(o)?o.checked?"true":"false":o.value),o=d,o!==u?(a.setValue(o),!0):!1}function Fl(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var RA=/[\n"\\]/g;function ln(o){return o.replace(RA,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function nh(o,a,u,d,g,_,b,S){o.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?o.type=b:o.removeAttribute("type"),a!=null?b==="number"?(a===0&&o.value===""||o.value!=a)&&(o.value=""+an(a)):o.value!==""+an(a)&&(o.value=""+an(a)):b!=="submit"&&b!=="reset"||o.removeAttribute("value"),a!=null?ih(o,b,an(a)):u!=null?ih(o,b,an(u)):d!=null&&o.removeAttribute("value"),g==null&&_!=null&&(o.defaultChecked=!!_),g!=null&&(o.checked=g&&typeof g!="function"&&typeof g!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?o.name=""+an(S):o.removeAttribute("name")}function z_(o,a,u,d,g,_,b,S){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(o.type=_),a!=null||u!=null){if(!(_!=="submit"&&_!=="reset"||a!=null))return;u=u!=null?""+an(u):"",a=a!=null?""+an(a):u,S||a===o.value||(o.value=a),o.defaultValue=a}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,o.checked=S?o.checked:!!d,o.defaultChecked=!!d,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(o.name=b)}function ih(o,a,u){a==="number"&&Fl(o.ownerDocument)===o||o.defaultValue===""+u||(o.defaultValue=""+u)}function gs(o,a,u,d){if(o=o.options,a){a={};for(var g=0;g<u.length;g++)a["$"+u[g]]=!0;for(u=0;u<o.length;u++)g=a.hasOwnProperty("$"+o[u].value),o[u].selected!==g&&(o[u].selected=g),g&&d&&(o[u].defaultSelected=!0)}else{for(u=""+an(u),a=null,g=0;g<o.length;g++){if(o[g].value===u){o[g].selected=!0,d&&(o[g].defaultSelected=!0);return}a!==null||o[g].disabled||(a=o[g])}a!==null&&(a.selected=!0)}}function V_(o,a,u){if(a!=null&&(a=""+an(a),a!==o.value&&(o.value=a),u==null)){o.defaultValue!==a&&(o.defaultValue=a);return}o.defaultValue=u!=null?""+an(u):""}function j_(o,a,u,d){if(a==null){if(d!=null){if(u!=null)throw Error(i(92));if(Ae(d)){if(1<d.length)throw Error(i(93));d=d[0]}u=d}u==null&&(u=""),a=u}u=an(a),o.defaultValue=u,d=o.textContent,d===u&&d!==""&&d!==null&&(o.value=d)}function ms(o,a){if(a){var u=o.firstChild;if(u&&u===o.lastChild&&u.nodeType===3){u.nodeValue=a;return}}o.textContent=a}var CA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function H_(o,a,u){var d=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?o.setProperty(a,""):a==="float"?o.cssFloat="":o[a]="":d?o.setProperty(a,u):typeof u!="number"||u===0||CA.has(a)?a==="float"?o.cssFloat=u:o[a]=(""+u).trim():o[a]=u+"px"}function $_(o,a,u){if(a!=null&&typeof a!="object")throw Error(i(62));if(o=o.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?o.setProperty(d,""):d==="float"?o.cssFloat="":o[d]="");for(var g in a)d=a[g],a.hasOwnProperty(g)&&u[g]!==d&&H_(o,g,d)}else for(var _ in a)a.hasOwnProperty(_)&&H_(o,_,a[_])}function rh(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var MA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),PA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zl(o){return PA.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var sh=null;function oh(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var _s=null,ys=null;function W_(o){var a=fs(o);if(a&&(o=a.stateNode)){var u=o[zt]||null;e:switch(o=a.stateNode,a.type){case"input":if(nh(o,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=o;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ln(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var d=u[a];if(d!==o&&d.form===o.form){var g=d[zt]||null;if(!g)throw Error(i(90));nh(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(a=0;a<u.length;a++)d=u[a],d.form===o.form&&F_(d)}break e;case"textarea":V_(o,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&gs(o,!!u.multiple,a,!1)}}}var ah=!1;function X_(o,a,u){if(ah)return o(a,u);ah=!0;try{var d=o(a);return d}finally{if(ah=!1,(_s!==null||ys!==null)&&(Ac(),_s&&(a=_s,o=ys,ys=_s=null,W_(a),o)))for(a=0;a<o.length;a++)W_(o[a])}}function Ho(o,a){var u=o.stateNode;if(u===null)return null;var d=u[zt]||null;if(d===null)return null;u=d[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(o=o.type,d=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!d;break e;default:o=!1}if(o)return null;if(u&&typeof u!="function")throw Error(i(231,a,typeof u));return u}var ri=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lh=!1;if(ri)try{var $o={};Object.defineProperty($o,"passive",{get:function(){lh=!0}}),window.addEventListener("test",$o,$o),window.removeEventListener("test",$o,$o)}catch{lh=!1}var Mi=null,ch=null,Vl=null;function Y_(){if(Vl)return Vl;var o,a=ch,u=a.length,d,g="value"in Mi?Mi.value:Mi.textContent,_=g.length;for(o=0;o<u&&a[o]===g[o];o++);var b=u-o;for(d=1;d<=b&&a[u-d]===g[_-d];d++);return Vl=g.slice(o,1<d?1-d:void 0)}function jl(o){var a=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&a===13&&(o=13)):o=a,o===10&&(o=13),32<=o||o===13?o:0}function Hl(){return!0}function q_(){return!1}function Vt(o){function a(u,d,g,_,b){this._reactName=u,this._targetInst=g,this.type=d,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var S in o)o.hasOwnProperty(S)&&(u=o[S],this[S]=u?u(_):_[S]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Hl:q_,this.isPropagationStopped=q_,this}return p(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Hl)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Hl)},persist:function(){},isPersistent:Hl}),a}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$l=Vt(br),Wo=p({},br,{view:0,detail:0}),OA=Vt(Wo),uh,fh,Xo,Wl=p({},Wo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dh,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Xo&&(Xo&&o.type==="mousemove"?(uh=o.screenX-Xo.screenX,fh=o.screenY-Xo.screenY):fh=uh=0,Xo=o),uh)},movementY:function(o){return"movementY"in o?o.movementY:fh}}),K_=Vt(Wl),IA=p({},Wl,{dataTransfer:0}),NA=Vt(IA),kA=p({},Wo,{relatedTarget:0}),hh=Vt(kA),DA=p({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),LA=Vt(DA),BA=p({},br,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),UA=Vt(BA),FA=p({},br,{data:0}),Z_=Vt(FA),zA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function HA(o){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(o):(o=jA[o])?!!a[o]:!1}function dh(){return HA}var $A=p({},Wo,{key:function(o){if(o.key){var a=zA[o.key]||o.key;if(a!=="Unidentified")return a}return o.type==="keypress"?(o=jl(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?VA[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dh,charCode:function(o){return o.type==="keypress"?jl(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?jl(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),WA=Vt($A),XA=p({},Wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),G_=Vt(XA),YA=p({},Wo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dh}),qA=Vt(YA),KA=p({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZA=Vt(KA),GA=p({},Wl,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),QA=Vt(GA),JA=p({},br,{newState:0,oldState:0}),eE=Vt(JA),tE=[9,13,27,32],ph=ri&&"CompositionEvent"in window,Yo=null;ri&&"documentMode"in document&&(Yo=document.documentMode);var nE=ri&&"TextEvent"in window&&!Yo,Q_=ri&&(!ph||Yo&&8<Yo&&11>=Yo),J_=" ",ey=!1;function ty(o,a){switch(o){case"keyup":return tE.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ny(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var vs=!1;function iE(o,a){switch(o){case"compositionend":return ny(a);case"keypress":return a.which!==32?null:(ey=!0,J_);case"textInput":return o=a.data,o===J_&&ey?null:o;default:return null}}function rE(o,a){if(vs)return o==="compositionend"||!ph&&ty(o,a)?(o=Y_(),Vl=ch=Mi=null,vs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Q_&&a.locale!=="ko"?null:a.data;default:return null}}var sE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iy(o){var a=o&&o.nodeName&&o.nodeName.toLowerCase();return a==="input"?!!sE[o.type]:a==="textarea"}function ry(o,a,u,d){_s?ys?ys.push(d):ys=[d]:_s=d,a=Oc(a,"onChange"),0<a.length&&(u=new $l("onChange","change",null,u,d),o.push({event:u,listeners:a}))}var qo=null,Ko=null;function oE(o){Uv(o,0)}function Xl(o){var a=jo(o);if(F_(a))return o}function sy(o,a){if(o==="change")return a}var oy=!1;if(ri){var gh;if(ri){var mh="oninput"in document;if(!mh){var ay=document.createElement("div");ay.setAttribute("oninput","return;"),mh=typeof ay.oninput=="function"}gh=mh}else gh=!1;oy=gh&&(!document.documentMode||9<document.documentMode)}function ly(){qo&&(qo.detachEvent("onpropertychange",cy),Ko=qo=null)}function cy(o){if(o.propertyName==="value"&&Xl(Ko)){var a=[];ry(a,Ko,o,oh(o)),X_(oE,a)}}function aE(o,a,u){o==="focusin"?(ly(),qo=a,Ko=u,qo.attachEvent("onpropertychange",cy)):o==="focusout"&&ly()}function lE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Xl(Ko)}function cE(o,a){if(o==="click")return Xl(a)}function uE(o,a){if(o==="input"||o==="change")return Xl(a)}function fE(o,a){return o===a&&(o!==0||1/o===1/a)||o!==o&&a!==a}var qt=typeof Object.is=="function"?Object.is:fE;function Zo(o,a){if(qt(o,a))return!0;if(typeof o!="object"||o===null||typeof a!="object"||a===null)return!1;var u=Object.keys(o),d=Object.keys(a);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var g=u[d];if(!ni.call(a,g)||!qt(o[g],a[g]))return!1}return!0}function uy(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function fy(o,a){var u=uy(o);o=0;for(var d;u;){if(u.nodeType===3){if(d=o+u.textContent.length,o<=a&&d>=a)return{node:u,offset:a-o};o=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=uy(u)}}function hy(o,a){return o&&a?o===a?!0:o&&o.nodeType===3?!1:a&&a.nodeType===3?hy(o,a.parentNode):"contains"in o?o.contains(a):o.compareDocumentPosition?!!(o.compareDocumentPosition(a)&16):!1:!1}function dy(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var a=Fl(o.document);a instanceof o.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)o=a.contentWindow;else break;a=Fl(o.document)}return a}function _h(o){var a=o&&o.nodeName&&o.nodeName.toLowerCase();return a&&(a==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||a==="textarea"||o.contentEditable==="true")}var hE=ri&&"documentMode"in document&&11>=document.documentMode,bs=null,yh=null,Go=null,vh=!1;function py(o,a,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;vh||bs==null||bs!==Fl(d)||(d=bs,"selectionStart"in d&&_h(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Go&&Zo(Go,d)||(Go=d,d=Oc(yh,"onSelect"),0<d.length&&(a=new $l("onSelect","select",null,a,u),o.push({event:a,listeners:d}),a.target=bs)))}function xr(o,a){var u={};return u[o.toLowerCase()]=a.toLowerCase(),u["Webkit"+o]="webkit"+a,u["Moz"+o]="moz"+a,u}var xs={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionrun:xr("Transition","TransitionRun"),transitionstart:xr("Transition","TransitionStart"),transitioncancel:xr("Transition","TransitionCancel"),transitionend:xr("Transition","TransitionEnd")},bh={},gy={};ri&&(gy=document.createElement("div").style,"AnimationEvent"in window||(delete xs.animationend.animation,delete xs.animationiteration.animation,delete xs.animationstart.animation),"TransitionEvent"in window||delete xs.transitionend.transition);function Tr(o){if(bh[o])return bh[o];if(!xs[o])return o;var a=xs[o],u;for(u in a)if(a.hasOwnProperty(u)&&u in gy)return bh[o]=a[u];return o}var my=Tr("animationend"),_y=Tr("animationiteration"),yy=Tr("animationstart"),dE=Tr("transitionrun"),pE=Tr("transitionstart"),gE=Tr("transitioncancel"),vy=Tr("transitionend"),by=new Map,xh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xh.push("scrollEnd");function wn(o,a){by.set(o,a),vr(a,[o])}var xy=new WeakMap;function cn(o,a){if(typeof o=="object"&&o!==null){var u=xy.get(o);return u!==void 0?u:(a={value:o,source:a,stack:B_(a)},xy.set(o,a),a)}return{value:o,source:a,stack:B_(a)}}var un=[],Ts=0,Th=0;function Yl(){for(var o=Ts,a=Th=Ts=0;a<o;){var u=un[a];un[a++]=null;var d=un[a];un[a++]=null;var g=un[a];un[a++]=null;var _=un[a];if(un[a++]=null,d!==null&&g!==null){var b=d.pending;b===null?g.next=g:(g.next=b.next,b.next=g),d.pending=g}_!==0&&Ty(u,g,_)}}function ql(o,a,u,d){un[Ts++]=o,un[Ts++]=a,un[Ts++]=u,un[Ts++]=d,Th|=d,o.lanes|=d,o=o.alternate,o!==null&&(o.lanes|=d)}function wh(o,a,u,d){return ql(o,a,u,d),Kl(o)}function ws(o,a){return ql(o,null,null,a),Kl(o)}function Ty(o,a,u){o.lanes|=u;var d=o.alternate;d!==null&&(d.lanes|=u);for(var g=!1,_=o.return;_!==null;)_.childLanes|=u,d=_.alternate,d!==null&&(d.childLanes|=u),_.tag===22&&(o=_.stateNode,o===null||o._visibility&1||(g=!0)),o=_,_=_.return;return o.tag===3?(_=o.stateNode,g&&a!==null&&(g=31-Yt(u),o=_.hiddenUpdates,d=o[g],d===null?o[g]=[a]:d.push(a),a.lane=u|536870912),_):null}function Kl(o){if(50<Ta)throw Ta=0,Md=null,Error(i(185));for(var a=o.return;a!==null;)o=a,a=o.return;return o.tag===3?o.stateNode:null}var Ss={};function mE(o,a,u,d){this.tag=o,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kt(o,a,u,d){return new mE(o,a,u,d)}function Sh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function si(o,a){var u=o.alternate;return u===null?(u=Kt(o.tag,a,o.key,o.mode),u.elementType=o.elementType,u.type=o.type,u.stateNode=o.stateNode,u.alternate=o,o.alternate=u):(u.pendingProps=a,u.type=o.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=o.flags&65011712,u.childLanes=o.childLanes,u.lanes=o.lanes,u.child=o.child,u.memoizedProps=o.memoizedProps,u.memoizedState=o.memoizedState,u.updateQueue=o.updateQueue,a=o.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=o.sibling,u.index=o.index,u.ref=o.ref,u.refCleanup=o.refCleanup,u}function wy(o,a){o.flags&=65011714;var u=o.alternate;return u===null?(o.childLanes=0,o.lanes=a,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,a=u.dependencies,o.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),o}function Zl(o,a,u,d,g,_){var b=0;if(d=o,typeof o=="function")Sh(o)&&(b=1);else if(typeof o=="string")b=yR(o,u,ne.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case le:return o=Kt(31,u,a,g),o.elementType=le,o.lanes=_,o;case x:return wr(u.children,g,_,a);case T:b=8,g|=24;break;case E:return o=Kt(12,u,a,g|2),o.elementType=E,o.lanes=_,o;case D:return o=Kt(13,u,a,g),o.elementType=D,o.lanes=_,o;case z:return o=Kt(19,u,a,g),o.elementType=z,o.lanes=_,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case C:case M:b=10;break e;case P:b=9;break e;case I:b=11;break e;case ae:b=14;break e;case he:b=16,d=null;break e}b=29,u=Error(i(130,o===null?"null":typeof o,"")),d=null}return a=Kt(b,u,a,g),a.elementType=o,a.type=d,a.lanes=_,a}function wr(o,a,u,d){return o=Kt(7,o,d,a),o.lanes=u,o}function Ah(o,a,u){return o=Kt(6,o,null,a),o.lanes=u,o}function Eh(o,a,u){return a=Kt(4,o.children!==null?o.children:[],o.key,a),a.lanes=u,a.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},a}var As=[],Es=0,Gl=null,Ql=0,fn=[],hn=0,Sr=null,oi=1,ai="";function Ar(o,a){As[Es++]=Ql,As[Es++]=Gl,Gl=o,Ql=a}function Sy(o,a,u){fn[hn++]=oi,fn[hn++]=ai,fn[hn++]=Sr,Sr=o;var d=oi;o=ai;var g=32-Yt(d)-1;d&=~(1<<g),u+=1;var _=32-Yt(a)+g;if(30<_){var b=g-g%5;_=(d&(1<<b)-1).toString(32),d>>=b,g-=b,oi=1<<32-Yt(a)+g|u<<g|d,ai=_+o}else oi=1<<_|u<<g|d,ai=o}function Rh(o){o.return!==null&&(Ar(o,1),Sy(o,1,0))}function Ch(o){for(;o===Gl;)Gl=As[--Es],As[Es]=null,Ql=As[--Es],As[Es]=null;for(;o===Sr;)Sr=fn[--hn],fn[hn]=null,ai=fn[--hn],fn[hn]=null,oi=fn[--hn],fn[hn]=null}var Ut=null,at=null,ze=!1,Er=null,Fn=!1,Mh=Error(i(519));function Rr(o){var a=Error(i(418,""));throw ea(cn(a,o)),Mh}function Ay(o){var a=o.stateNode,u=o.type,d=o.memoizedProps;switch(a[Ot]=o,a[zt]=d,u){case"dialog":Ie("cancel",a),Ie("close",a);break;case"iframe":case"object":case"embed":Ie("load",a);break;case"video":case"audio":for(u=0;u<Sa.length;u++)Ie(Sa[u],a);break;case"source":Ie("error",a);break;case"img":case"image":case"link":Ie("error",a),Ie("load",a);break;case"details":Ie("toggle",a);break;case"input":Ie("invalid",a),z_(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Ul(a);break;case"select":Ie("invalid",a);break;case"textarea":Ie("invalid",a),j_(a,d.value,d.defaultValue,d.children),Ul(a)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||d.suppressHydrationWarning===!0||jv(a.textContent,u)?(d.popover!=null&&(Ie("beforetoggle",a),Ie("toggle",a)),d.onScroll!=null&&Ie("scroll",a),d.onScrollEnd!=null&&Ie("scrollend",a),d.onClick!=null&&(a.onclick=Ic),a=!0):a=!1,a||Rr(o)}function Ey(o){for(Ut=o.return;Ut;)switch(Ut.tag){case 5:case 13:Fn=!1;return;case 27:case 3:Fn=!0;return;default:Ut=Ut.return}}function Qo(o){if(o!==Ut)return!1;if(!ze)return Ey(o),ze=!0,!1;var a=o.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=o.type,u=!(u!=="form"&&u!=="button")||Wd(o.type,o.memoizedProps)),u=!u),u&&at&&Rr(o),Ey(o),a===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(i(317));e:{for(o=o.nextSibling,a=0;o;){if(o.nodeType===8)if(u=o.data,u==="/$"){if(a===0){at=An(o.nextSibling);break e}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++;o=o.nextSibling}at=null}}else a===27?(a=at,Wi(o.type)?(o=Kd,Kd=null,at=o):at=a):at=Ut?An(o.stateNode.nextSibling):null;return!0}function Jo(){at=Ut=null,ze=!1}function Ry(){var o=Er;return o!==null&&($t===null?$t=o:$t.push.apply($t,o),Er=null),o}function ea(o){Er===null?Er=[o]:Er.push(o)}var Ph=U(null),Cr=null,li=null;function Pi(o,a,u){ee(Ph,a._currentValue),a._currentValue=u}function ci(o){o._currentValue=Ph.current,X(Ph)}function Oh(o,a,u){for(;o!==null;){var d=o.alternate;if((o.childLanes&a)!==a?(o.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),o===u)break;o=o.return}}function Ih(o,a,u,d){var g=o.child;for(g!==null&&(g.return=o);g!==null;){var _=g.dependencies;if(_!==null){var b=g.child;_=_.firstContext;e:for(;_!==null;){var S=_;_=g;for(var B=0;B<a.length;B++)if(S.context===a[B]){_.lanes|=u,S=_.alternate,S!==null&&(S.lanes|=u),Oh(_.return,u,o),d||(b=null);break e}_=S.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(i(341));b.lanes|=u,_=b.alternate,_!==null&&(_.lanes|=u),Oh(b,u,o),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===o){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function ta(o,a,u,d){o=null;for(var g=a,_=!1;g!==null;){if(!_){if((g.flags&524288)!==0)_=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var S=g.type;qt(g.pendingProps.value,b.value)||(o!==null?o.push(S):o=[S])}}else if(g===Te.current){if(b=g.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(o!==null?o.push(Pa):o=[Pa])}g=g.return}o!==null&&Ih(a,o,u,d),a.flags|=262144}function Jl(o){for(o=o.firstContext;o!==null;){if(!qt(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Mr(o){Cr=o,li=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function It(o){return Cy(Cr,o)}function ec(o,a){return Cr===null&&Mr(o),Cy(o,a)}function Cy(o,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},li===null){if(o===null)throw Error(i(308));li=a,o.dependencies={lanes:0,firstContext:a},o.flags|=524288}else li=li.next=a;return u}var _E=typeof AbortController<"u"?AbortController:function(){var o=[],a=this.signal={aborted:!1,addEventListener:function(u,d){o.push(d)}};this.abort=function(){a.aborted=!0,o.forEach(function(u){return u()})}},yE=t.unstable_scheduleCallback,vE=t.unstable_NormalPriority,yt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nh(){return{controller:new _E,data:new Map,refCount:0}}function na(o){o.refCount--,o.refCount===0&&yE(vE,function(){o.controller.abort()})}var ia=null,kh=0,Rs=0,Cs=null;function bE(o,a){if(ia===null){var u=ia=[];kh=0,Rs=Ld(),Cs={status:"pending",value:void 0,then:function(d){u.push(d)}}}return kh++,a.then(My,My),a}function My(){if(--kh===0&&ia!==null){Cs!==null&&(Cs.status="fulfilled");var o=ia;ia=null,Rs=0,Cs=null;for(var a=0;a<o.length;a++)(0,o[a])()}}function xE(o,a){var u=[],d={status:"pending",value:null,reason:null,then:function(g){u.push(g)}};return o.then(function(){d.status="fulfilled",d.value=a;for(var g=0;g<u.length;g++)(0,u[g])(a)},function(g){for(d.status="rejected",d.reason=g,g=0;g<u.length;g++)(0,u[g])(void 0)}),d}var Py=w.S;w.S=function(o,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&bE(o,a),Py!==null&&Py(o,a)};var Pr=U(null);function Dh(){var o=Pr.current;return o!==null?o:tt.pooledCache}function tc(o,a){a===null?ee(Pr,Pr.current):ee(Pr,a.pool)}function Oy(){var o=Dh();return o===null?null:{parent:yt._currentValue,pool:o}}var ra=Error(i(460)),Iy=Error(i(474)),nc=Error(i(542)),Lh={then:function(){}};function Ny(o){return o=o.status,o==="fulfilled"||o==="rejected"}function ic(){}function ky(o,a,u){switch(u=o[u],u===void 0?o.push(a):u!==a&&(a.then(ic,ic),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw o=a.reason,Ly(o),o;default:if(typeof a.status=="string")a.then(ic,ic);else{if(o=tt,o!==null&&100<o.shellSuspendCounter)throw Error(i(482));o=a,o.status="pending",o.then(function(d){if(a.status==="pending"){var g=a;g.status="fulfilled",g.value=d}},function(d){if(a.status==="pending"){var g=a;g.status="rejected",g.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw o=a.reason,Ly(o),o}throw sa=a,ra}}var sa=null;function Dy(){if(sa===null)throw Error(i(459));var o=sa;return sa=null,o}function Ly(o){if(o===ra||o===nc)throw Error(i(483))}var Oi=!1;function Bh(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uh(o,a){o=o.updateQueue,a.updateQueue===o&&(a.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function Ii(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Ni(o,a,u){var d=o.updateQueue;if(d===null)return null;if(d=d.shared,(We&2)!==0){var g=d.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),d.pending=a,a=Kl(o),Ty(o,null,u),a}return ql(o,d,a,u),Kl(o)}function oa(o,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var d=a.lanes;d&=o.pendingLanes,u|=d,a.lanes=u,M_(o,u)}}function Fh(o,a){var u=o.updateQueue,d=o.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var g=null,_=null;if(u=u.firstBaseUpdate,u!==null){do{var b={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};_===null?g=_=b:_=_.next=b,u=u.next}while(u!==null);_===null?g=_=a:_=_.next=a}else g=_=a;u={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:_,shared:d.shared,callbacks:d.callbacks},o.updateQueue=u;return}o=u.lastBaseUpdate,o===null?u.firstBaseUpdate=a:o.next=a,u.lastBaseUpdate=a}var zh=!1;function aa(){if(zh){var o=Cs;if(o!==null)throw o}}function la(o,a,u,d){zh=!1;var g=o.updateQueue;Oi=!1;var _=g.firstBaseUpdate,b=g.lastBaseUpdate,S=g.shared.pending;if(S!==null){g.shared.pending=null;var B=S,Q=B.next;B.next=null,b===null?_=Q:b.next=Q,b=B;var ie=o.alternate;ie!==null&&(ie=ie.updateQueue,S=ie.lastBaseUpdate,S!==b&&(S===null?ie.firstBaseUpdate=Q:S.next=Q,ie.lastBaseUpdate=B))}if(_!==null){var oe=g.baseState;b=0,ie=Q=B=null,S=_;do{var J=S.lane&-536870913,te=J!==S.lane;if(te?(De&J)===J:(d&J)===J){J!==0&&J===Rs&&(zh=!0),ie!==null&&(ie=ie.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var Ee=o,xe=S;J=a;var Ke=u;switch(xe.tag){case 1:if(Ee=xe.payload,typeof Ee=="function"){oe=Ee.call(Ke,oe,J);break e}oe=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=xe.payload,J=typeof Ee=="function"?Ee.call(Ke,oe,J):Ee,J==null)break e;oe=p({},oe,J);break e;case 2:Oi=!0}}J=S.callback,J!==null&&(o.flags|=64,te&&(o.flags|=8192),te=g.callbacks,te===null?g.callbacks=[J]:te.push(J))}else te={lane:J,tag:S.tag,payload:S.payload,callback:S.callback,next:null},ie===null?(Q=ie=te,B=oe):ie=ie.next=te,b|=J;if(S=S.next,S===null){if(S=g.shared.pending,S===null)break;te=S,S=te.next,te.next=null,g.lastBaseUpdate=te,g.shared.pending=null}}while(!0);ie===null&&(B=oe),g.baseState=B,g.firstBaseUpdate=Q,g.lastBaseUpdate=ie,_===null&&(g.shared.lanes=0),Vi|=b,o.lanes=b,o.memoizedState=oe}}function By(o,a){if(typeof o!="function")throw Error(i(191,o));o.call(a)}function Uy(o,a){var u=o.callbacks;if(u!==null)for(o.callbacks=null,o=0;o<u.length;o++)By(u[o],a)}var Ms=U(null),rc=U(0);function Fy(o,a){o=mi,ee(rc,o),ee(Ms,a),mi=o|a.baseLanes}function Vh(){ee(rc,mi),ee(Ms,Ms.current)}function jh(){mi=rc.current,X(Ms),X(rc)}var ki=0,Me=null,Ye=null,dt=null,sc=!1,Ps=!1,Or=!1,oc=0,ca=0,Os=null,TE=0;function ft(){throw Error(i(321))}function Hh(o,a){if(a===null)return!1;for(var u=0;u<a.length&&u<o.length;u++)if(!qt(o[u],a[u]))return!1;return!0}function $h(o,a,u,d,g,_){return ki=_,Me=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,w.H=o===null||o.memoizedState===null?T0:w0,Or=!1,_=u(d,g),Or=!1,Ps&&(_=Vy(a,u,d,g)),zy(o),_}function zy(o){w.H=hc;var a=Ye!==null&&Ye.next!==null;if(ki=0,dt=Ye=Me=null,sc=!1,ca=0,Os=null,a)throw Error(i(300));o===null||wt||(o=o.dependencies,o!==null&&Jl(o)&&(wt=!0))}function Vy(o,a,u,d){Me=o;var g=0;do{if(Ps&&(Os=null),ca=0,Ps=!1,25<=g)throw Error(i(301));if(g+=1,dt=Ye=null,o.updateQueue!=null){var _=o.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}w.H=ME,_=a(u,d)}while(Ps);return _}function wE(){var o=w.H,a=o.useState()[0];return a=typeof a.then=="function"?ua(a):a,o=o.useState()[0],(Ye!==null?Ye.memoizedState:null)!==o&&(Me.flags|=1024),a}function Wh(){var o=oc!==0;return oc=0,o}function Xh(o,a,u){a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~u}function Yh(o){if(sc){for(o=o.memoizedState;o!==null;){var a=o.queue;a!==null&&(a.pending=null),o=o.next}sc=!1}ki=0,dt=Ye=Me=null,Ps=!1,ca=oc=0,Os=null}function jt(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?Me.memoizedState=dt=o:dt=dt.next=o,dt}function pt(){if(Ye===null){var o=Me.alternate;o=o!==null?o.memoizedState:null}else o=Ye.next;var a=dt===null?Me.memoizedState:dt.next;if(a!==null)dt=a,Ye=o;else{if(o===null)throw Me.alternate===null?Error(i(467)):Error(i(310));Ye=o,o={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},dt===null?Me.memoizedState=dt=o:dt=dt.next=o}return dt}function qh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ua(o){var a=ca;return ca+=1,Os===null&&(Os=[]),o=ky(Os,o,a),a=Me,(dt===null?a.memoizedState:dt.next)===null&&(a=a.alternate,w.H=a===null||a.memoizedState===null?T0:w0),o}function ac(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return ua(o);if(o.$$typeof===M)return It(o)}throw Error(i(438,String(o)))}function Kh(o){var a=null,u=Me.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var d=Me.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(g){return g.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=qh(),Me.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(o),d=0;d<o;d++)u[d]=ge;return a.index++,u}function ui(o,a){return typeof a=="function"?a(o):a}function lc(o){var a=pt();return Zh(a,Ye,o)}function Zh(o,a,u){var d=o.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=u;var g=o.baseQueue,_=d.pending;if(_!==null){if(g!==null){var b=g.next;g.next=_.next,_.next=b}a.baseQueue=g=_,d.pending=null}if(_=o.baseState,g===null)o.memoizedState=_;else{a=g.next;var S=b=null,B=null,Q=a,ie=!1;do{var oe=Q.lane&-536870913;if(oe!==Q.lane?(De&oe)===oe:(ki&oe)===oe){var J=Q.revertLane;if(J===0)B!==null&&(B=B.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),oe===Rs&&(ie=!0);else if((ki&J)===J){Q=Q.next,J===Rs&&(ie=!0);continue}else oe={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},B===null?(S=B=oe,b=_):B=B.next=oe,Me.lanes|=J,Vi|=J;oe=Q.action,Or&&u(_,oe),_=Q.hasEagerState?Q.eagerState:u(_,oe)}else J={lane:oe,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},B===null?(S=B=J,b=_):B=B.next=J,Me.lanes|=oe,Vi|=oe;Q=Q.next}while(Q!==null&&Q!==a);if(B===null?b=_:B.next=S,!qt(_,o.memoizedState)&&(wt=!0,ie&&(u=Cs,u!==null)))throw u;o.memoizedState=_,o.baseState=b,o.baseQueue=B,d.lastRenderedState=_}return g===null&&(d.lanes=0),[o.memoizedState,d.dispatch]}function Gh(o){var a=pt(),u=a.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=o;var d=u.dispatch,g=u.pending,_=a.memoizedState;if(g!==null){u.pending=null;var b=g=g.next;do _=o(_,b.action),b=b.next;while(b!==g);qt(_,a.memoizedState)||(wt=!0),a.memoizedState=_,a.baseQueue===null&&(a.baseState=_),u.lastRenderedState=_}return[_,d]}function jy(o,a,u){var d=Me,g=pt(),_=ze;if(_){if(u===void 0)throw Error(i(407));u=u()}else u=a();var b=!qt((Ye||g).memoizedState,u);b&&(g.memoizedState=u,wt=!0),g=g.queue;var S=Wy.bind(null,d,g,o);if(fa(2048,8,S,[o]),g.getSnapshot!==a||b||dt!==null&&dt.memoizedState.tag&1){if(d.flags|=2048,Is(9,cc(),$y.bind(null,d,g,u,a),null),tt===null)throw Error(i(349));_||(ki&124)!==0||Hy(d,a,u)}return u}function Hy(o,a,u){o.flags|=16384,o={getSnapshot:a,value:u},a=Me.updateQueue,a===null?(a=qh(),Me.updateQueue=a,a.stores=[o]):(u=a.stores,u===null?a.stores=[o]:u.push(o))}function $y(o,a,u,d){a.value=u,a.getSnapshot=d,Xy(a)&&Yy(o)}function Wy(o,a,u){return u(function(){Xy(a)&&Yy(o)})}function Xy(o){var a=o.getSnapshot;o=o.value;try{var u=a();return!qt(o,u)}catch{return!0}}function Yy(o){var a=ws(o,2);a!==null&&en(a,o,2)}function Qh(o){var a=jt();if(typeof o=="function"){var u=o;if(o=u(),Or){Ri(!0);try{u()}finally{Ri(!1)}}}return a.memoizedState=a.baseState=o,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ui,lastRenderedState:o},a}function qy(o,a,u,d){return o.baseState=u,Zh(o,Ye,typeof d=="function"?d:ui)}function SE(o,a,u,d,g){if(fc(o))throw Error(i(485));if(o=a.action,o!==null){var _={payload:g,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){_.listeners.push(b)}};w.T!==null?u(!0):_.isTransition=!1,d(_),u=a.pending,u===null?(_.next=a.pending=_,Ky(a,_)):(_.next=u.next,a.pending=u.next=_)}}function Ky(o,a){var u=a.action,d=a.payload,g=o.state;if(a.isTransition){var _=w.T,b={};w.T=b;try{var S=u(g,d),B=w.S;B!==null&&B(b,S),Zy(o,a,S)}catch(Q){Jh(o,a,Q)}finally{w.T=_}}else try{_=u(g,d),Zy(o,a,_)}catch(Q){Jh(o,a,Q)}}function Zy(o,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){Gy(o,a,d)},function(d){return Jh(o,a,d)}):Gy(o,a,u)}function Gy(o,a,u){a.status="fulfilled",a.value=u,Qy(a),o.state=u,a=o.pending,a!==null&&(u=a.next,u===a?o.pending=null:(u=u.next,a.next=u,Ky(o,u)))}function Jh(o,a,u){var d=o.pending;if(o.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=u,Qy(a),a=a.next;while(a!==d)}o.action=null}function Qy(o){o=o.listeners;for(var a=0;a<o.length;a++)(0,o[a])()}function Jy(o,a){return a}function e0(o,a){if(ze){var u=tt.formState;if(u!==null){e:{var d=Me;if(ze){if(at){t:{for(var g=at,_=Fn;g.nodeType!==8;){if(!_){g=null;break t}if(g=An(g.nextSibling),g===null){g=null;break t}}_=g.data,g=_==="F!"||_==="F"?g:null}if(g){at=An(g.nextSibling),d=g.data==="F!";break e}}Rr(d)}d=!1}d&&(a=u[0])}}return u=jt(),u.memoizedState=u.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jy,lastRenderedState:a},u.queue=d,u=v0.bind(null,Me,d),d.dispatch=u,d=Qh(!1),_=rd.bind(null,Me,!1,d.queue),d=jt(),g={state:a,dispatch:null,action:o,pending:null},d.queue=g,u=SE.bind(null,Me,g,_,u),g.dispatch=u,d.memoizedState=o,[a,u,!1]}function t0(o){var a=pt();return n0(a,Ye,o)}function n0(o,a,u){if(a=Zh(o,a,Jy)[0],o=lc(ui)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=ua(a)}catch(b){throw b===ra?nc:b}else d=a;a=pt();var g=a.queue,_=g.dispatch;return u!==a.memoizedState&&(Me.flags|=2048,Is(9,cc(),AE.bind(null,g,u),null)),[d,_,o]}function AE(o,a){o.action=a}function i0(o){var a=pt(),u=Ye;if(u!==null)return n0(a,u,o);pt(),a=a.memoizedState,u=pt();var d=u.queue.dispatch;return u.memoizedState=o,[a,d,!1]}function Is(o,a,u,d){return o={tag:o,create:u,deps:d,inst:a,next:null},a=Me.updateQueue,a===null&&(a=qh(),Me.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=o.next=o:(d=u.next,u.next=o,o.next=d,a.lastEffect=o),o}function cc(){return{destroy:void 0,resource:void 0}}function r0(){return pt().memoizedState}function uc(o,a,u,d){var g=jt();d=d===void 0?null:d,Me.flags|=o,g.memoizedState=Is(1|a,cc(),u,d)}function fa(o,a,u,d){var g=pt();d=d===void 0?null:d;var _=g.memoizedState.inst;Ye!==null&&d!==null&&Hh(d,Ye.memoizedState.deps)?g.memoizedState=Is(a,_,u,d):(Me.flags|=o,g.memoizedState=Is(1|a,_,u,d))}function s0(o,a){uc(8390656,8,o,a)}function o0(o,a){fa(2048,8,o,a)}function a0(o,a){return fa(4,2,o,a)}function l0(o,a){return fa(4,4,o,a)}function c0(o,a){if(typeof a=="function"){o=o();var u=a(o);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return o=o(),a.current=o,function(){a.current=null}}function u0(o,a,u){u=u!=null?u.concat([o]):null,fa(4,4,c0.bind(null,a,o),u)}function ed(){}function f0(o,a){var u=pt();a=a===void 0?null:a;var d=u.memoizedState;return a!==null&&Hh(a,d[1])?d[0]:(u.memoizedState=[o,a],o)}function h0(o,a){var u=pt();a=a===void 0?null:a;var d=u.memoizedState;if(a!==null&&Hh(a,d[1]))return d[0];if(d=o(),Or){Ri(!0);try{o()}finally{Ri(!1)}}return u.memoizedState=[d,a],d}function td(o,a,u){return u===void 0||(ki&1073741824)!==0?o.memoizedState=a:(o.memoizedState=u,o=gv(),Me.lanes|=o,Vi|=o,u)}function d0(o,a,u,d){return qt(u,a)?u:Ms.current!==null?(o=td(o,u,d),qt(o,a)||(wt=!0),o):(ki&42)===0?(wt=!0,o.memoizedState=u):(o=gv(),Me.lanes|=o,Vi|=o,a)}function p0(o,a,u,d,g){var _=k.p;k.p=_!==0&&8>_?_:8;var b=w.T,S={};w.T=S,rd(o,!1,a,u);try{var B=g(),Q=w.S;if(Q!==null&&Q(S,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var ie=xE(B,d);ha(o,a,ie,Jt(o))}else ha(o,a,d,Jt(o))}catch(oe){ha(o,a,{then:function(){},status:"rejected",reason:oe},Jt())}finally{k.p=_,w.T=b}}function EE(){}function nd(o,a,u,d){if(o.tag!==5)throw Error(i(476));var g=g0(o).queue;p0(o,g,a,N,u===null?EE:function(){return m0(o),u(d)})}function g0(o){var a=o.memoizedState;if(a!==null)return a;a={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ui,lastRenderedState:N},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ui,lastRenderedState:u},next:null},o.memoizedState=a,o=o.alternate,o!==null&&(o.memoizedState=a),a}function m0(o){var a=g0(o).next.queue;ha(o,a,{},Jt())}function id(){return It(Pa)}function _0(){return pt().memoizedState}function y0(){return pt().memoizedState}function RE(o){for(var a=o.return;a!==null;){switch(a.tag){case 24:case 3:var u=Jt();o=Ii(u);var d=Ni(a,o,u);d!==null&&(en(d,a,u),oa(d,a,u)),a={cache:Nh()},o.payload=a;return}a=a.return}}function CE(o,a,u){var d=Jt();u={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},fc(o)?b0(a,u):(u=wh(o,a,u,d),u!==null&&(en(u,o,d),x0(u,a,d)))}function v0(o,a,u){var d=Jt();ha(o,a,u,d)}function ha(o,a,u,d){var g={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(fc(o))b0(a,g);else{var _=o.alternate;if(o.lanes===0&&(_===null||_.lanes===0)&&(_=a.lastRenderedReducer,_!==null))try{var b=a.lastRenderedState,S=_(b,u);if(g.hasEagerState=!0,g.eagerState=S,qt(S,b))return ql(o,a,g,0),tt===null&&Yl(),!1}catch{}finally{}if(u=wh(o,a,g,d),u!==null)return en(u,o,d),x0(u,a,d),!0}return!1}function rd(o,a,u,d){if(d={lane:2,revertLane:Ld(),action:d,hasEagerState:!1,eagerState:null,next:null},fc(o)){if(a)throw Error(i(479))}else a=wh(o,u,d,2),a!==null&&en(a,o,2)}function fc(o){var a=o.alternate;return o===Me||a!==null&&a===Me}function b0(o,a){Ps=sc=!0;var u=o.pending;u===null?a.next=a:(a.next=u.next,u.next=a),o.pending=a}function x0(o,a,u){if((u&4194048)!==0){var d=a.lanes;d&=o.pendingLanes,u|=d,a.lanes=u,M_(o,u)}}var hc={readContext:It,use:ac,useCallback:ft,useContext:ft,useEffect:ft,useImperativeHandle:ft,useLayoutEffect:ft,useInsertionEffect:ft,useMemo:ft,useReducer:ft,useRef:ft,useState:ft,useDebugValue:ft,useDeferredValue:ft,useTransition:ft,useSyncExternalStore:ft,useId:ft,useHostTransitionStatus:ft,useFormState:ft,useActionState:ft,useOptimistic:ft,useMemoCache:ft,useCacheRefresh:ft},T0={readContext:It,use:ac,useCallback:function(o,a){return jt().memoizedState=[o,a===void 0?null:a],o},useContext:It,useEffect:s0,useImperativeHandle:function(o,a,u){u=u!=null?u.concat([o]):null,uc(4194308,4,c0.bind(null,a,o),u)},useLayoutEffect:function(o,a){return uc(4194308,4,o,a)},useInsertionEffect:function(o,a){uc(4,2,o,a)},useMemo:function(o,a){var u=jt();a=a===void 0?null:a;var d=o();if(Or){Ri(!0);try{o()}finally{Ri(!1)}}return u.memoizedState=[d,a],d},useReducer:function(o,a,u){var d=jt();if(u!==void 0){var g=u(a);if(Or){Ri(!0);try{u(a)}finally{Ri(!1)}}}else g=a;return d.memoizedState=d.baseState=g,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:g},d.queue=o,o=o.dispatch=CE.bind(null,Me,o),[d.memoizedState,o]},useRef:function(o){var a=jt();return o={current:o},a.memoizedState=o},useState:function(o){o=Qh(o);var a=o.queue,u=v0.bind(null,Me,a);return a.dispatch=u,[o.memoizedState,u]},useDebugValue:ed,useDeferredValue:function(o,a){var u=jt();return td(u,o,a)},useTransition:function(){var o=Qh(!1);return o=p0.bind(null,Me,o.queue,!0,!1),jt().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,a,u){var d=Me,g=jt();if(ze){if(u===void 0)throw Error(i(407));u=u()}else{if(u=a(),tt===null)throw Error(i(349));(De&124)!==0||Hy(d,a,u)}g.memoizedState=u;var _={value:u,getSnapshot:a};return g.queue=_,s0(Wy.bind(null,d,_,o),[o]),d.flags|=2048,Is(9,cc(),$y.bind(null,d,_,u,a),null),u},useId:function(){var o=jt(),a=tt.identifierPrefix;if(ze){var u=ai,d=oi;u=(d&~(1<<32-Yt(d)-1)).toString(32)+u,a="«"+a+"R"+u,u=oc++,0<u&&(a+="H"+u.toString(32)),a+="»"}else u=TE++,a="«"+a+"r"+u.toString(32)+"»";return o.memoizedState=a},useHostTransitionStatus:id,useFormState:e0,useActionState:e0,useOptimistic:function(o){var a=jt();a.memoizedState=a.baseState=o;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=rd.bind(null,Me,!0,u),u.dispatch=a,[o,a]},useMemoCache:Kh,useCacheRefresh:function(){return jt().memoizedState=RE.bind(null,Me)}},w0={readContext:It,use:ac,useCallback:f0,useContext:It,useEffect:o0,useImperativeHandle:u0,useInsertionEffect:a0,useLayoutEffect:l0,useMemo:h0,useReducer:lc,useRef:r0,useState:function(){return lc(ui)},useDebugValue:ed,useDeferredValue:function(o,a){var u=pt();return d0(u,Ye.memoizedState,o,a)},useTransition:function(){var o=lc(ui)[0],a=pt().memoizedState;return[typeof o=="boolean"?o:ua(o),a]},useSyncExternalStore:jy,useId:_0,useHostTransitionStatus:id,useFormState:t0,useActionState:t0,useOptimistic:function(o,a){var u=pt();return qy(u,Ye,o,a)},useMemoCache:Kh,useCacheRefresh:y0},ME={readContext:It,use:ac,useCallback:f0,useContext:It,useEffect:o0,useImperativeHandle:u0,useInsertionEffect:a0,useLayoutEffect:l0,useMemo:h0,useReducer:Gh,useRef:r0,useState:function(){return Gh(ui)},useDebugValue:ed,useDeferredValue:function(o,a){var u=pt();return Ye===null?td(u,o,a):d0(u,Ye.memoizedState,o,a)},useTransition:function(){var o=Gh(ui)[0],a=pt().memoizedState;return[typeof o=="boolean"?o:ua(o),a]},useSyncExternalStore:jy,useId:_0,useHostTransitionStatus:id,useFormState:i0,useActionState:i0,useOptimistic:function(o,a){var u=pt();return Ye!==null?qy(u,Ye,o,a):(u.baseState=o,[o,u.queue.dispatch])},useMemoCache:Kh,useCacheRefresh:y0},Ns=null,da=0;function dc(o){var a=da;return da+=1,Ns===null&&(Ns=[]),ky(Ns,o,a)}function pa(o,a){a=a.props.ref,o.ref=a!==void 0?a:null}function pc(o,a){throw a.$$typeof===m?Error(i(525)):(o=Object.prototype.toString.call(a),Error(i(31,o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o)))}function S0(o){var a=o._init;return a(o._payload)}function A0(o){function a($,F){if(o){var K=$.deletions;K===null?($.deletions=[F],$.flags|=16):K.push(F)}}function u($,F){if(!o)return null;for(;F!==null;)a($,F),F=F.sibling;return null}function d($){for(var F=new Map;$!==null;)$.key!==null?F.set($.key,$):F.set($.index,$),$=$.sibling;return F}function g($,F){return $=si($,F),$.index=0,$.sibling=null,$}function _($,F,K){return $.index=K,o?(K=$.alternate,K!==null?(K=K.index,K<F?($.flags|=67108866,F):K):($.flags|=67108866,F)):($.flags|=1048576,F)}function b($){return o&&$.alternate===null&&($.flags|=67108866),$}function S($,F,K,re){return F===null||F.tag!==6?(F=Ah(K,$.mode,re),F.return=$,F):(F=g(F,K),F.return=$,F)}function B($,F,K,re){var ye=K.type;return ye===x?ie($,F,K.props.children,re,K.key):F!==null&&(F.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===he&&S0(ye)===F.type)?(F=g(F,K.props),pa(F,K),F.return=$,F):(F=Zl(K.type,K.key,K.props,null,$.mode,re),pa(F,K),F.return=$,F)}function Q($,F,K,re){return F===null||F.tag!==4||F.stateNode.containerInfo!==K.containerInfo||F.stateNode.implementation!==K.implementation?(F=Eh(K,$.mode,re),F.return=$,F):(F=g(F,K.children||[]),F.return=$,F)}function ie($,F,K,re,ye){return F===null||F.tag!==7?(F=wr(K,$.mode,re,ye),F.return=$,F):(F=g(F,K),F.return=$,F)}function oe($,F,K){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Ah(""+F,$.mode,K),F.return=$,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case y:return K=Zl(F.type,F.key,F.props,null,$.mode,K),pa(K,F),K.return=$,K;case v:return F=Eh(F,$.mode,K),F.return=$,F;case he:var re=F._init;return F=re(F._payload),oe($,F,K)}if(Ae(F)||ce(F))return F=wr(F,$.mode,K,null),F.return=$,F;if(typeof F.then=="function")return oe($,dc(F),K);if(F.$$typeof===M)return oe($,ec($,F),K);pc($,F)}return null}function J($,F,K,re){var ye=F!==null?F.key:null;if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return ye!==null?null:S($,F,""+K,re);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case y:return K.key===ye?B($,F,K,re):null;case v:return K.key===ye?Q($,F,K,re):null;case he:return ye=K._init,K=ye(K._payload),J($,F,K,re)}if(Ae(K)||ce(K))return ye!==null?null:ie($,F,K,re,null);if(typeof K.then=="function")return J($,F,dc(K),re);if(K.$$typeof===M)return J($,F,ec($,K),re);pc($,K)}return null}function te($,F,K,re,ye){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return $=$.get(K)||null,S(F,$,""+re,ye);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case y:return $=$.get(re.key===null?K:re.key)||null,B(F,$,re,ye);case v:return $=$.get(re.key===null?K:re.key)||null,Q(F,$,re,ye);case he:var Pe=re._init;return re=Pe(re._payload),te($,F,K,re,ye)}if(Ae(re)||ce(re))return $=$.get(K)||null,ie(F,$,re,ye,null);if(typeof re.then=="function")return te($,F,K,dc(re),ye);if(re.$$typeof===M)return te($,F,K,ec(F,re),ye);pc(F,re)}return null}function Ee($,F,K,re){for(var ye=null,Pe=null,be=F,we=F=0,At=null;be!==null&&we<K.length;we++){be.index>we?(At=be,be=null):At=be.sibling;var Fe=J($,be,K[we],re);if(Fe===null){be===null&&(be=At);break}o&&be&&Fe.alternate===null&&a($,be),F=_(Fe,F,we),Pe===null?ye=Fe:Pe.sibling=Fe,Pe=Fe,be=At}if(we===K.length)return u($,be),ze&&Ar($,we),ye;if(be===null){for(;we<K.length;we++)be=oe($,K[we],re),be!==null&&(F=_(be,F,we),Pe===null?ye=be:Pe.sibling=be,Pe=be);return ze&&Ar($,we),ye}for(be=d(be);we<K.length;we++)At=te(be,$,we,K[we],re),At!==null&&(o&&At.alternate!==null&&be.delete(At.key===null?we:At.key),F=_(At,F,we),Pe===null?ye=At:Pe.sibling=At,Pe=At);return o&&be.forEach(function(Zi){return a($,Zi)}),ze&&Ar($,we),ye}function xe($,F,K,re){if(K==null)throw Error(i(151));for(var ye=null,Pe=null,be=F,we=F=0,At=null,Fe=K.next();be!==null&&!Fe.done;we++,Fe=K.next()){be.index>we?(At=be,be=null):At=be.sibling;var Zi=J($,be,Fe.value,re);if(Zi===null){be===null&&(be=At);break}o&&be&&Zi.alternate===null&&a($,be),F=_(Zi,F,we),Pe===null?ye=Zi:Pe.sibling=Zi,Pe=Zi,be=At}if(Fe.done)return u($,be),ze&&Ar($,we),ye;if(be===null){for(;!Fe.done;we++,Fe=K.next())Fe=oe($,Fe.value,re),Fe!==null&&(F=_(Fe,F,we),Pe===null?ye=Fe:Pe.sibling=Fe,Pe=Fe);return ze&&Ar($,we),ye}for(be=d(be);!Fe.done;we++,Fe=K.next())Fe=te(be,$,we,Fe.value,re),Fe!==null&&(o&&Fe.alternate!==null&&be.delete(Fe.key===null?we:Fe.key),F=_(Fe,F,we),Pe===null?ye=Fe:Pe.sibling=Fe,Pe=Fe);return o&&be.forEach(function(PR){return a($,PR)}),ze&&Ar($,we),ye}function Ke($,F,K,re){if(typeof K=="object"&&K!==null&&K.type===x&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case y:e:{for(var ye=K.key;F!==null;){if(F.key===ye){if(ye=K.type,ye===x){if(F.tag===7){u($,F.sibling),re=g(F,K.props.children),re.return=$,$=re;break e}}else if(F.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===he&&S0(ye)===F.type){u($,F.sibling),re=g(F,K.props),pa(re,K),re.return=$,$=re;break e}u($,F);break}else a($,F);F=F.sibling}K.type===x?(re=wr(K.props.children,$.mode,re,K.key),re.return=$,$=re):(re=Zl(K.type,K.key,K.props,null,$.mode,re),pa(re,K),re.return=$,$=re)}return b($);case v:e:{for(ye=K.key;F!==null;){if(F.key===ye)if(F.tag===4&&F.stateNode.containerInfo===K.containerInfo&&F.stateNode.implementation===K.implementation){u($,F.sibling),re=g(F,K.children||[]),re.return=$,$=re;break e}else{u($,F);break}else a($,F);F=F.sibling}re=Eh(K,$.mode,re),re.return=$,$=re}return b($);case he:return ye=K._init,K=ye(K._payload),Ke($,F,K,re)}if(Ae(K))return Ee($,F,K,re);if(ce(K)){if(ye=ce(K),typeof ye!="function")throw Error(i(150));return K=ye.call(K),xe($,F,K,re)}if(typeof K.then=="function")return Ke($,F,dc(K),re);if(K.$$typeof===M)return Ke($,F,ec($,K),re);pc($,K)}return typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint"?(K=""+K,F!==null&&F.tag===6?(u($,F.sibling),re=g(F,K),re.return=$,$=re):(u($,F),re=Ah(K,$.mode,re),re.return=$,$=re),b($)):u($,F)}return function($,F,K,re){try{da=0;var ye=Ke($,F,K,re);return Ns=null,ye}catch(be){if(be===ra||be===nc)throw be;var Pe=Kt(29,be,null,$.mode);return Pe.lanes=re,Pe.return=$,Pe}finally{}}}var ks=A0(!0),E0=A0(!1),dn=U(null),zn=null;function Di(o){var a=o.alternate;ee(vt,vt.current&1),ee(dn,o),zn===null&&(a===null||Ms.current!==null||a.memoizedState!==null)&&(zn=o)}function R0(o){if(o.tag===22){if(ee(vt,vt.current),ee(dn,o),zn===null){var a=o.alternate;a!==null&&a.memoizedState!==null&&(zn=o)}}else Li()}function Li(){ee(vt,vt.current),ee(dn,dn.current)}function fi(o){X(dn),zn===o&&(zn=null),X(vt)}var vt=U(0);function gc(o){for(var a=o;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||qd(u)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function sd(o,a,u,d){a=o.memoizedState,u=u(d,a),u=u==null?a:p({},a,u),o.memoizedState=u,o.lanes===0&&(o.updateQueue.baseState=u)}var od={enqueueSetState:function(o,a,u){o=o._reactInternals;var d=Jt(),g=Ii(d);g.payload=a,u!=null&&(g.callback=u),a=Ni(o,g,d),a!==null&&(en(a,o,d),oa(a,o,d))},enqueueReplaceState:function(o,a,u){o=o._reactInternals;var d=Jt(),g=Ii(d);g.tag=1,g.payload=a,u!=null&&(g.callback=u),a=Ni(o,g,d),a!==null&&(en(a,o,d),oa(a,o,d))},enqueueForceUpdate:function(o,a){o=o._reactInternals;var u=Jt(),d=Ii(u);d.tag=2,a!=null&&(d.callback=a),a=Ni(o,d,u),a!==null&&(en(a,o,u),oa(a,o,u))}};function C0(o,a,u,d,g,_,b){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(d,_,b):a.prototype&&a.prototype.isPureReactComponent?!Zo(u,d)||!Zo(g,_):!0}function M0(o,a,u,d){o=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,d),a.state!==o&&od.enqueueReplaceState(a,a.state,null)}function Ir(o,a){var u=a;if("ref"in a){u={};for(var d in a)d!=="ref"&&(u[d]=a[d])}if(o=o.defaultProps){u===a&&(u=p({},u));for(var g in o)u[g]===void 0&&(u[g]=o[g])}return u}var mc=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function P0(o){mc(o)}function O0(o){console.error(o)}function I0(o){mc(o)}function _c(o,a){try{var u=o.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function N0(o,a,u){try{var d=o.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function ad(o,a,u){return u=Ii(u),u.tag=3,u.payload={element:null},u.callback=function(){_c(o,a)},u}function k0(o){return o=Ii(o),o.tag=3,o}function D0(o,a,u,d){var g=u.type.getDerivedStateFromError;if(typeof g=="function"){var _=d.value;o.payload=function(){return g(_)},o.callback=function(){N0(a,u,d)}}var b=u.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(o.callback=function(){N0(a,u,d),typeof g!="function"&&(ji===null?ji=new Set([this]):ji.add(this));var S=d.stack;this.componentDidCatch(d.value,{componentStack:S!==null?S:""})})}function PE(o,a,u,d,g){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=u.alternate,a!==null&&ta(a,u,g,!0),u=dn.current,u!==null){switch(u.tag){case 13:return zn===null?Od():u.alternate===null&&lt===0&&(lt=3),u.flags&=-257,u.flags|=65536,u.lanes=g,d===Lh?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([d]):a.add(d),Nd(o,d,g)),!1;case 22:return u.flags|=65536,d===Lh?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([d]):u.add(d)),Nd(o,d,g)),!1}throw Error(i(435,u.tag))}return Nd(o,d,g),Od(),!1}if(ze)return a=dn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=g,d!==Mh&&(o=Error(i(422),{cause:d}),ea(cn(o,u)))):(d!==Mh&&(a=Error(i(423),{cause:d}),ea(cn(a,u))),o=o.current.alternate,o.flags|=65536,g&=-g,o.lanes|=g,d=cn(d,u),g=ad(o.stateNode,d,g),Fh(o,g),lt!==4&&(lt=2)),!1;var _=Error(i(520),{cause:d});if(_=cn(_,u),xa===null?xa=[_]:xa.push(_),lt!==4&&(lt=2),a===null)return!0;d=cn(d,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,o=g&-g,u.lanes|=o,o=ad(u.stateNode,d,o),Fh(u,o),!1;case 1:if(a=u.type,_=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(ji===null||!ji.has(_))))return u.flags|=65536,g&=-g,u.lanes|=g,g=k0(g),D0(g,o,u,d),Fh(u,g),!1}u=u.return}while(u!==null);return!1}var L0=Error(i(461)),wt=!1;function Rt(o,a,u,d){a.child=o===null?E0(a,null,u,d):ks(a,o.child,u,d)}function B0(o,a,u,d,g){u=u.render;var _=a.ref;if("ref"in d){var b={};for(var S in d)S!=="ref"&&(b[S]=d[S])}else b=d;return Mr(a),d=$h(o,a,u,b,_,g),S=Wh(),o!==null&&!wt?(Xh(o,a,g),hi(o,a,g)):(ze&&S&&Rh(a),a.flags|=1,Rt(o,a,d,g),a.child)}function U0(o,a,u,d,g){if(o===null){var _=u.type;return typeof _=="function"&&!Sh(_)&&_.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=_,F0(o,a,_,d,g)):(o=Zl(u.type,null,d,a,a.mode,g),o.ref=a.ref,o.return=a,a.child=o)}if(_=o.child,!gd(o,g)){var b=_.memoizedProps;if(u=u.compare,u=u!==null?u:Zo,u(b,d)&&o.ref===a.ref)return hi(o,a,g)}return a.flags|=1,o=si(_,d),o.ref=a.ref,o.return=a,a.child=o}function F0(o,a,u,d,g){if(o!==null){var _=o.memoizedProps;if(Zo(_,d)&&o.ref===a.ref)if(wt=!1,a.pendingProps=d=_,gd(o,g))(o.flags&131072)!==0&&(wt=!0);else return a.lanes=o.lanes,hi(o,a,g)}return ld(o,a,u,d,g)}function z0(o,a,u){var d=a.pendingProps,g=d.children,_=o!==null?o.memoizedState:null;if(d.mode==="hidden"){if((a.flags&128)!==0){if(d=_!==null?_.baseLanes|u:u,o!==null){for(g=a.child=o.child,_=0;g!==null;)_=_|g.lanes|g.childLanes,g=g.sibling;a.childLanes=_&~d}else a.childLanes=0,a.child=null;return V0(o,a,d,u)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},o!==null&&tc(a,_!==null?_.cachePool:null),_!==null?Fy(a,_):Vh(),R0(a);else return a.lanes=a.childLanes=536870912,V0(o,a,_!==null?_.baseLanes|u:u,u)}else _!==null?(tc(a,_.cachePool),Fy(a,_),Li(),a.memoizedState=null):(o!==null&&tc(a,null),Vh(),Li());return Rt(o,a,g,u),a.child}function V0(o,a,u,d){var g=Dh();return g=g===null?null:{parent:yt._currentValue,pool:g},a.memoizedState={baseLanes:u,cachePool:g},o!==null&&tc(a,null),Vh(),R0(a),o!==null&&ta(o,a,d,!0),null}function yc(o,a){var u=a.ref;if(u===null)o!==null&&o.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(o===null||o.ref!==u)&&(a.flags|=4194816)}}function ld(o,a,u,d,g){return Mr(a),u=$h(o,a,u,d,void 0,g),d=Wh(),o!==null&&!wt?(Xh(o,a,g),hi(o,a,g)):(ze&&d&&Rh(a),a.flags|=1,Rt(o,a,u,g),a.child)}function j0(o,a,u,d,g,_){return Mr(a),a.updateQueue=null,u=Vy(a,d,u,g),zy(o),d=Wh(),o!==null&&!wt?(Xh(o,a,_),hi(o,a,_)):(ze&&d&&Rh(a),a.flags|=1,Rt(o,a,u,_),a.child)}function H0(o,a,u,d,g){if(Mr(a),a.stateNode===null){var _=Ss,b=u.contextType;typeof b=="object"&&b!==null&&(_=It(b)),_=new u(d,_),a.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=od,a.stateNode=_,_._reactInternals=a,_=a.stateNode,_.props=d,_.state=a.memoizedState,_.refs={},Bh(a),b=u.contextType,_.context=typeof b=="object"&&b!==null?It(b):Ss,_.state=a.memoizedState,b=u.getDerivedStateFromProps,typeof b=="function"&&(sd(a,u,b,d),_.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(b=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),b!==_.state&&od.enqueueReplaceState(_,_.state,null),la(a,d,_,g),aa(),_.state=a.memoizedState),typeof _.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(o===null){_=a.stateNode;var S=a.memoizedProps,B=Ir(u,S);_.props=B;var Q=_.context,ie=u.contextType;b=Ss,typeof ie=="object"&&ie!==null&&(b=It(ie));var oe=u.getDerivedStateFromProps;ie=typeof oe=="function"||typeof _.getSnapshotBeforeUpdate=="function",S=a.pendingProps!==S,ie||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(S||Q!==b)&&M0(a,_,d,b),Oi=!1;var J=a.memoizedState;_.state=J,la(a,d,_,g),aa(),Q=a.memoizedState,S||J!==Q||Oi?(typeof oe=="function"&&(sd(a,u,oe,d),Q=a.memoizedState),(B=Oi||C0(a,u,B,d,J,Q,b))?(ie||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(a.flags|=4194308)):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=Q),_.props=d,_.state=Q,_.context=b,d=B):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{_=a.stateNode,Uh(o,a),b=a.memoizedProps,ie=Ir(u,b),_.props=ie,oe=a.pendingProps,J=_.context,Q=u.contextType,B=Ss,typeof Q=="object"&&Q!==null&&(B=It(Q)),S=u.getDerivedStateFromProps,(Q=typeof S=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(b!==oe||J!==B)&&M0(a,_,d,B),Oi=!1,J=a.memoizedState,_.state=J,la(a,d,_,g),aa();var te=a.memoizedState;b!==oe||J!==te||Oi||o!==null&&o.dependencies!==null&&Jl(o.dependencies)?(typeof S=="function"&&(sd(a,u,S,d),te=a.memoizedState),(ie=Oi||C0(a,u,ie,d,J,te,B)||o!==null&&o.dependencies!==null&&Jl(o.dependencies))?(Q||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(d,te,B),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(d,te,B)),typeof _.componentDidUpdate=="function"&&(a.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof _.componentDidUpdate!="function"||b===o.memoizedProps&&J===o.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&J===o.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=te),_.props=d,_.state=te,_.context=B,d=ie):(typeof _.componentDidUpdate!="function"||b===o.memoizedProps&&J===o.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&J===o.memoizedState||(a.flags|=1024),d=!1)}return _=d,yc(o,a),d=(a.flags&128)!==0,_||d?(_=a.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:_.render(),a.flags|=1,o!==null&&d?(a.child=ks(a,o.child,null,g),a.child=ks(a,null,u,g)):Rt(o,a,u,g),a.memoizedState=_.state,o=a.child):o=hi(o,a,g),o}function $0(o,a,u,d){return Jo(),a.flags|=256,Rt(o,a,u,d),a.child}var cd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ud(o){return{baseLanes:o,cachePool:Oy()}}function fd(o,a,u){return o=o!==null?o.childLanes&~u:0,a&&(o|=pn),o}function W0(o,a,u){var d=a.pendingProps,g=!1,_=(a.flags&128)!==0,b;if((b=_)||(b=o!==null&&o.memoizedState===null?!1:(vt.current&2)!==0),b&&(g=!0,a.flags&=-129),b=(a.flags&32)!==0,a.flags&=-33,o===null){if(ze){if(g?Di(a):Li(),ze){var S=at,B;if(B=S){e:{for(B=S,S=Fn;B.nodeType!==8;){if(!S){S=null;break e}if(B=An(B.nextSibling),B===null){S=null;break e}}S=B}S!==null?(a.memoizedState={dehydrated:S,treeContext:Sr!==null?{id:oi,overflow:ai}:null,retryLane:536870912,hydrationErrors:null},B=Kt(18,null,null,0),B.stateNode=S,B.return=a,a.child=B,Ut=a,at=null,B=!0):B=!1}B||Rr(a)}if(S=a.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return qd(S)?a.lanes=32:a.lanes=536870912,null;fi(a)}return S=d.children,d=d.fallback,g?(Li(),g=a.mode,S=vc({mode:"hidden",children:S},g),d=wr(d,g,u,null),S.return=a,d.return=a,S.sibling=d,a.child=S,g=a.child,g.memoizedState=ud(u),g.childLanes=fd(o,b,u),a.memoizedState=cd,d):(Di(a),hd(a,S))}if(B=o.memoizedState,B!==null&&(S=B.dehydrated,S!==null)){if(_)a.flags&256?(Di(a),a.flags&=-257,a=dd(o,a,u)):a.memoizedState!==null?(Li(),a.child=o.child,a.flags|=128,a=null):(Li(),g=d.fallback,S=a.mode,d=vc({mode:"visible",children:d.children},S),g=wr(g,S,u,null),g.flags|=2,d.return=a,g.return=a,d.sibling=g,a.child=d,ks(a,o.child,null,u),d=a.child,d.memoizedState=ud(u),d.childLanes=fd(o,b,u),a.memoizedState=cd,a=g);else if(Di(a),qd(S)){if(b=S.nextSibling&&S.nextSibling.dataset,b)var Q=b.dgst;b=Q,d=Error(i(419)),d.stack="",d.digest=b,ea({value:d,source:null,stack:null}),a=dd(o,a,u)}else if(wt||ta(o,a,u,!1),b=(u&o.childLanes)!==0,wt||b){if(b=tt,b!==null&&(d=u&-u,d=(d&42)!==0?1:Kf(d),d=(d&(b.suspendedLanes|u))!==0?0:d,d!==0&&d!==B.retryLane))throw B.retryLane=d,ws(o,d),en(b,o,d),L0;S.data==="$?"||Od(),a=dd(o,a,u)}else S.data==="$?"?(a.flags|=192,a.child=o.child,a=null):(o=B.treeContext,at=An(S.nextSibling),Ut=a,ze=!0,Er=null,Fn=!1,o!==null&&(fn[hn++]=oi,fn[hn++]=ai,fn[hn++]=Sr,oi=o.id,ai=o.overflow,Sr=a),a=hd(a,d.children),a.flags|=4096);return a}return g?(Li(),g=d.fallback,S=a.mode,B=o.child,Q=B.sibling,d=si(B,{mode:"hidden",children:d.children}),d.subtreeFlags=B.subtreeFlags&65011712,Q!==null?g=si(Q,g):(g=wr(g,S,u,null),g.flags|=2),g.return=a,d.return=a,d.sibling=g,a.child=d,d=g,g=a.child,S=o.child.memoizedState,S===null?S=ud(u):(B=S.cachePool,B!==null?(Q=yt._currentValue,B=B.parent!==Q?{parent:Q,pool:Q}:B):B=Oy(),S={baseLanes:S.baseLanes|u,cachePool:B}),g.memoizedState=S,g.childLanes=fd(o,b,u),a.memoizedState=cd,d):(Di(a),u=o.child,o=u.sibling,u=si(u,{mode:"visible",children:d.children}),u.return=a,u.sibling=null,o!==null&&(b=a.deletions,b===null?(a.deletions=[o],a.flags|=16):b.push(o)),a.child=u,a.memoizedState=null,u)}function hd(o,a){return a=vc({mode:"visible",children:a},o.mode),a.return=o,o.child=a}function vc(o,a){return o=Kt(22,o,null,a),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function dd(o,a,u){return ks(a,o.child,null,u),o=hd(a,a.pendingProps.children),o.flags|=2,a.memoizedState=null,o}function X0(o,a,u){o.lanes|=a;var d=o.alternate;d!==null&&(d.lanes|=a),Oh(o.return,a,u)}function pd(o,a,u,d,g){var _=o.memoizedState;_===null?o.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:g}:(_.isBackwards=a,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=u,_.tailMode=g)}function Y0(o,a,u){var d=a.pendingProps,g=d.revealOrder,_=d.tail;if(Rt(o,a,d.children,u),d=vt.current,(d&2)!==0)d=d&1|2,a.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=a.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&X0(o,u,a);else if(o.tag===19)X0(o,u,a);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}d&=1}switch(ee(vt,d),g){case"forwards":for(u=a.child,g=null;u!==null;)o=u.alternate,o!==null&&gc(o)===null&&(g=u),u=u.sibling;u=g,u===null?(g=a.child,a.child=null):(g=u.sibling,u.sibling=null),pd(a,!1,g,u,_);break;case"backwards":for(u=null,g=a.child,a.child=null;g!==null;){if(o=g.alternate,o!==null&&gc(o)===null){a.child=g;break}o=g.sibling,g.sibling=u,u=g,g=o}pd(a,!0,u,null,_);break;case"together":pd(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function hi(o,a,u){if(o!==null&&(a.dependencies=o.dependencies),Vi|=a.lanes,(u&a.childLanes)===0)if(o!==null){if(ta(o,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(o!==null&&a.child!==o.child)throw Error(i(153));if(a.child!==null){for(o=a.child,u=si(o,o.pendingProps),a.child=u,u.return=a;o.sibling!==null;)o=o.sibling,u=u.sibling=si(o,o.pendingProps),u.return=a;u.sibling=null}return a.child}function gd(o,a){return(o.lanes&a)!==0?!0:(o=o.dependencies,!!(o!==null&&Jl(o)))}function OE(o,a,u){switch(a.tag){case 3:ve(a,a.stateNode.containerInfo),Pi(a,yt,o.memoizedState.cache),Jo();break;case 27:case 5:He(a);break;case 4:ve(a,a.stateNode.containerInfo);break;case 10:Pi(a,a.type,a.memoizedProps.value);break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Di(a),a.flags|=128,null):(u&a.child.childLanes)!==0?W0(o,a,u):(Di(a),o=hi(o,a,u),o!==null?o.sibling:null);Di(a);break;case 19:var g=(o.flags&128)!==0;if(d=(u&a.childLanes)!==0,d||(ta(o,a,u,!1),d=(u&a.childLanes)!==0),g){if(d)return Y0(o,a,u);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ee(vt,vt.current),d)break;return null;case 22:case 23:return a.lanes=0,z0(o,a,u);case 24:Pi(a,yt,o.memoizedState.cache)}return hi(o,a,u)}function q0(o,a,u){if(o!==null)if(o.memoizedProps!==a.pendingProps)wt=!0;else{if(!gd(o,u)&&(a.flags&128)===0)return wt=!1,OE(o,a,u);wt=(o.flags&131072)!==0}else wt=!1,ze&&(a.flags&1048576)!==0&&Sy(a,Ql,a.index);switch(a.lanes=0,a.tag){case 16:e:{o=a.pendingProps;var d=a.elementType,g=d._init;if(d=g(d._payload),a.type=d,typeof d=="function")Sh(d)?(o=Ir(d,o),a.tag=1,a=H0(null,a,d,o,u)):(a.tag=0,a=ld(null,a,d,o,u));else{if(d!=null){if(g=d.$$typeof,g===I){a.tag=11,a=B0(null,a,d,o,u);break e}else if(g===ae){a.tag=14,a=U0(null,a,d,o,u);break e}}throw a=pe(d)||d,Error(i(306,a,""))}}return a;case 0:return ld(o,a,a.type,a.pendingProps,u);case 1:return d=a.type,g=Ir(d,a.pendingProps),H0(o,a,d,g,u);case 3:e:{if(ve(a,a.stateNode.containerInfo),o===null)throw Error(i(387));d=a.pendingProps;var _=a.memoizedState;g=_.element,Uh(o,a),la(a,d,null,u);var b=a.memoizedState;if(d=b.cache,Pi(a,yt,d),d!==_.cache&&Ih(a,[yt],u,!0),aa(),d=b.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:b.cache},a.updateQueue.baseState=_,a.memoizedState=_,a.flags&256){a=$0(o,a,d,u);break e}else if(d!==g){g=cn(Error(i(424)),a),ea(g),a=$0(o,a,d,u);break e}else{switch(o=a.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(at=An(o.firstChild),Ut=a,ze=!0,Er=null,Fn=!0,u=E0(a,null,d,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Jo(),d===g){a=hi(o,a,u);break e}Rt(o,a,d,u)}a=a.child}return a;case 26:return yc(o,a),o===null?(u=Qv(a.type,null,a.pendingProps,null))?a.memoizedState=u:ze||(u=a.type,o=a.pendingProps,d=Nc(me.current).createElement(u),d[Ot]=a,d[zt]=o,Mt(d,u,o),Tt(d),a.stateNode=d):a.memoizedState=Qv(a.type,o.memoizedProps,a.pendingProps,o.memoizedState),null;case 27:return He(a),o===null&&ze&&(d=a.stateNode=Kv(a.type,a.pendingProps,me.current),Ut=a,Fn=!0,g=at,Wi(a.type)?(Kd=g,at=An(d.firstChild)):at=g),Rt(o,a,a.pendingProps.children,u),yc(o,a),o===null&&(a.flags|=4194304),a.child;case 5:return o===null&&ze&&((g=d=at)&&(d=sR(d,a.type,a.pendingProps,Fn),d!==null?(a.stateNode=d,Ut=a,at=An(d.firstChild),Fn=!1,g=!0):g=!1),g||Rr(a)),He(a),g=a.type,_=a.pendingProps,b=o!==null?o.memoizedProps:null,d=_.children,Wd(g,_)?d=null:b!==null&&Wd(g,b)&&(a.flags|=32),a.memoizedState!==null&&(g=$h(o,a,wE,null,null,u),Pa._currentValue=g),yc(o,a),Rt(o,a,d,u),a.child;case 6:return o===null&&ze&&((o=u=at)&&(u=oR(u,a.pendingProps,Fn),u!==null?(a.stateNode=u,Ut=a,at=null,o=!0):o=!1),o||Rr(a)),null;case 13:return W0(o,a,u);case 4:return ve(a,a.stateNode.containerInfo),d=a.pendingProps,o===null?a.child=ks(a,null,d,u):Rt(o,a,d,u),a.child;case 11:return B0(o,a,a.type,a.pendingProps,u);case 7:return Rt(o,a,a.pendingProps,u),a.child;case 8:return Rt(o,a,a.pendingProps.children,u),a.child;case 12:return Rt(o,a,a.pendingProps.children,u),a.child;case 10:return d=a.pendingProps,Pi(a,a.type,d.value),Rt(o,a,d.children,u),a.child;case 9:return g=a.type._context,d=a.pendingProps.children,Mr(a),g=It(g),d=d(g),a.flags|=1,Rt(o,a,d,u),a.child;case 14:return U0(o,a,a.type,a.pendingProps,u);case 15:return F0(o,a,a.type,a.pendingProps,u);case 19:return Y0(o,a,u);case 31:return d=a.pendingProps,u=a.mode,d={mode:d.mode,children:d.children},o===null?(u=vc(d,u),u.ref=a.ref,a.child=u,u.return=a,a=u):(u=si(o.child,d),u.ref=a.ref,a.child=u,u.return=a,a=u),a;case 22:return z0(o,a,u);case 24:return Mr(a),d=It(yt),o===null?(g=Dh(),g===null&&(g=tt,_=Nh(),g.pooledCache=_,_.refCount++,_!==null&&(g.pooledCacheLanes|=u),g=_),a.memoizedState={parent:d,cache:g},Bh(a),Pi(a,yt,g)):((o.lanes&u)!==0&&(Uh(o,a),la(a,null,null,u),aa()),g=o.memoizedState,_=a.memoizedState,g.parent!==d?(g={parent:d,cache:d},a.memoizedState=g,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=g),Pi(a,yt,d)):(d=_.cache,Pi(a,yt,d),d!==g.cache&&Ih(a,[yt],u,!0))),Rt(o,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function di(o){o.flags|=4}function K0(o,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!ib(a)){if(a=dn.current,a!==null&&((De&4194048)===De?zn!==null:(De&62914560)!==De&&(De&536870912)===0||a!==zn))throw sa=Lh,Iy;o.flags|=8192}}function bc(o,a){a!==null&&(o.flags|=4),o.flags&16384&&(a=o.tag!==22?R_():536870912,o.lanes|=a,Us|=a)}function ga(o,a){if(!ze)switch(o.tailMode){case"hidden":a=o.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?o.tail=null:u.sibling=null;break;case"collapsed":u=o.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?a||o.tail===null?o.tail=null:o.tail.sibling=null:d.sibling=null}}function st(o){var a=o.alternate!==null&&o.alternate.child===o.child,u=0,d=0;if(a)for(var g=o.child;g!==null;)u|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=o,g=g.sibling;else for(g=o.child;g!==null;)u|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=o,g=g.sibling;return o.subtreeFlags|=d,o.childLanes=u,a}function IE(o,a,u){var d=a.pendingProps;switch(Ch(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(a),null;case 1:return st(a),null;case 3:return u=a.stateNode,d=null,o!==null&&(d=o.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),ci(yt),je(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(o===null||o.child===null)&&(Qo(a)?di(a):o===null||o.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Ry())),st(a),null;case 26:return u=a.memoizedState,o===null?(di(a),u!==null?(st(a),K0(a,u)):(st(a),a.flags&=-16777217)):u?u!==o.memoizedState?(di(a),st(a),K0(a,u)):(st(a),a.flags&=-16777217):(o.memoizedProps!==d&&di(a),st(a),a.flags&=-16777217),null;case 27:Bn(a),u=me.current;var g=a.type;if(o!==null&&a.stateNode!=null)o.memoizedProps!==d&&di(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return st(a),null}o=ne.current,Qo(a)?Ay(a):(o=Kv(g,d,u),a.stateNode=o,di(a))}return st(a),null;case 5:if(Bn(a),u=a.type,o!==null&&a.stateNode!=null)o.memoizedProps!==d&&di(a);else{if(!d){if(a.stateNode===null)throw Error(i(166));return st(a),null}if(o=ne.current,Qo(a))Ay(a);else{switch(g=Nc(me.current),o){case 1:o=g.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:o=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":o=g.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":o=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":o=g.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof d.is=="string"?g.createElement("select",{is:d.is}):g.createElement("select"),d.multiple?o.multiple=!0:d.size&&(o.size=d.size);break;default:o=typeof d.is=="string"?g.createElement(u,{is:d.is}):g.createElement(u)}}o[Ot]=a,o[zt]=d;e:for(g=a.child;g!==null;){if(g.tag===5||g.tag===6)o.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===a)break e;for(;g.sibling===null;){if(g.return===null||g.return===a)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}a.stateNode=o;e:switch(Mt(o,u,d),u){case"button":case"input":case"select":case"textarea":o=!!d.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&di(a)}}return st(a),a.flags&=-16777217,null;case 6:if(o&&a.stateNode!=null)o.memoizedProps!==d&&di(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(i(166));if(o=me.current,Qo(a)){if(o=a.stateNode,u=a.memoizedProps,d=null,g=Ut,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}o[Ot]=a,o=!!(o.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||jv(o.nodeValue,u)),o||Rr(a)}else o=Nc(o).createTextNode(d),o[Ot]=a,a.stateNode=o}return st(a),null;case 13:if(d=a.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(g=Qo(a),d!==null&&d.dehydrated!==null){if(o===null){if(!g)throw Error(i(318));if(g=a.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Ot]=a}else Jo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;st(a),g=!1}else g=Ry(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=g),g=!0;if(!g)return a.flags&256?(fi(a),a):(fi(a),null)}if(fi(a),(a.flags&128)!==0)return a.lanes=u,a;if(u=d!==null,o=o!==null&&o.memoizedState!==null,u){d=a.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool);var _=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(_=d.memoizedState.cachePool.pool),_!==g&&(d.flags|=2048)}return u!==o&&u&&(a.child.flags|=8192),bc(a,a.updateQueue),st(a),null;case 4:return je(),o===null&&zd(a.stateNode.containerInfo),st(a),null;case 10:return ci(a.type),st(a),null;case 19:if(X(vt),g=a.memoizedState,g===null)return st(a),null;if(d=(a.flags&128)!==0,_=g.rendering,_===null)if(d)ga(g,!1);else{if(lt!==0||o!==null&&(o.flags&128)!==0)for(o=a.child;o!==null;){if(_=gc(o),_!==null){for(a.flags|=128,ga(g,!1),o=_.updateQueue,a.updateQueue=o,bc(a,o),a.subtreeFlags=0,o=u,u=a.child;u!==null;)wy(u,o),u=u.sibling;return ee(vt,vt.current&1|2),a.child}o=o.sibling}g.tail!==null&&Un()>wc&&(a.flags|=128,d=!0,ga(g,!1),a.lanes=4194304)}else{if(!d)if(o=gc(_),o!==null){if(a.flags|=128,d=!0,o=o.updateQueue,a.updateQueue=o,bc(a,o),ga(g,!0),g.tail===null&&g.tailMode==="hidden"&&!_.alternate&&!ze)return st(a),null}else 2*Un()-g.renderingStartTime>wc&&u!==536870912&&(a.flags|=128,d=!0,ga(g,!1),a.lanes=4194304);g.isBackwards?(_.sibling=a.child,a.child=_):(o=g.last,o!==null?o.sibling=_:a.child=_,g.last=_)}return g.tail!==null?(a=g.tail,g.rendering=a,g.tail=a.sibling,g.renderingStartTime=Un(),a.sibling=null,o=vt.current,ee(vt,d?o&1|2:o&1),a):(st(a),null);case 22:case 23:return fi(a),jh(),d=a.memoizedState!==null,o!==null?o.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(u&536870912)!==0&&(a.flags&128)===0&&(st(a),a.subtreeFlags&6&&(a.flags|=8192)):st(a),u=a.updateQueue,u!==null&&bc(a,u.retryQueue),u=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(u=o.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==u&&(a.flags|=2048),o!==null&&X(Pr),null;case 24:return u=null,o!==null&&(u=o.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ci(yt),st(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function NE(o,a){switch(Ch(a),a.tag){case 1:return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 3:return ci(yt),je(),o=a.flags,(o&65536)!==0&&(o&128)===0?(a.flags=o&-65537|128,a):null;case 26:case 27:case 5:return Bn(a),null;case 13:if(fi(a),o=a.memoizedState,o!==null&&o.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Jo()}return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 19:return X(vt),null;case 4:return je(),null;case 10:return ci(a.type),null;case 22:case 23:return fi(a),jh(),o!==null&&X(Pr),o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 24:return ci(yt),null;case 25:return null;default:return null}}function Z0(o,a){switch(Ch(a),a.tag){case 3:ci(yt),je();break;case 26:case 27:case 5:Bn(a);break;case 4:je();break;case 13:fi(a);break;case 19:X(vt);break;case 10:ci(a.type);break;case 22:case 23:fi(a),jh(),o!==null&&X(Pr);break;case 24:ci(yt)}}function ma(o,a){try{var u=a.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var g=d.next;u=g;do{if((u.tag&o)===o){d=void 0;var _=u.create,b=u.inst;d=_(),b.destroy=d}u=u.next}while(u!==g)}}catch(S){Je(a,a.return,S)}}function Bi(o,a,u){try{var d=a.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var _=g.next;d=_;do{if((d.tag&o)===o){var b=d.inst,S=b.destroy;if(S!==void 0){b.destroy=void 0,g=a;var B=u,Q=S;try{Q()}catch(ie){Je(g,B,ie)}}}d=d.next}while(d!==_)}}catch(ie){Je(a,a.return,ie)}}function G0(o){var a=o.updateQueue;if(a!==null){var u=o.stateNode;try{Uy(a,u)}catch(d){Je(o,o.return,d)}}}function Q0(o,a,u){u.props=Ir(o.type,o.memoizedProps),u.state=o.memoizedState;try{u.componentWillUnmount()}catch(d){Je(o,a,d)}}function _a(o,a){try{var u=o.ref;if(u!==null){switch(o.tag){case 26:case 27:case 5:var d=o.stateNode;break;case 30:d=o.stateNode;break;default:d=o.stateNode}typeof u=="function"?o.refCleanup=u(d):u.current=d}}catch(g){Je(o,a,g)}}function Vn(o,a){var u=o.ref,d=o.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(g){Je(o,a,g)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(g){Je(o,a,g)}else u.current=null}function J0(o){var a=o.type,u=o.memoizedProps,d=o.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break e;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(g){Je(o,o.return,g)}}function md(o,a,u){try{var d=o.stateNode;eR(d,o.type,u,a),d[zt]=a}catch(g){Je(o,o.return,g)}}function ev(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Wi(o.type)||o.tag===4}function _d(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||ev(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Wi(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function yd(o,a,u){var d=o.tag;if(d===5||d===6)o=o.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(o,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(o),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=Ic));else if(d!==4&&(d===27&&Wi(o.type)&&(u=o.stateNode,a=null),o=o.child,o!==null))for(yd(o,a,u),o=o.sibling;o!==null;)yd(o,a,u),o=o.sibling}function xc(o,a,u){var d=o.tag;if(d===5||d===6)o=o.stateNode,a?u.insertBefore(o,a):u.appendChild(o);else if(d!==4&&(d===27&&Wi(o.type)&&(u=o.stateNode),o=o.child,o!==null))for(xc(o,a,u),o=o.sibling;o!==null;)xc(o,a,u),o=o.sibling}function tv(o){var a=o.stateNode,u=o.memoizedProps;try{for(var d=o.type,g=a.attributes;g.length;)a.removeAttributeNode(g[0]);Mt(a,d,u),a[Ot]=o,a[zt]=u}catch(_){Je(o,o.return,_)}}var pi=!1,ht=!1,vd=!1,nv=typeof WeakSet=="function"?WeakSet:Set,St=null;function kE(o,a){if(o=o.containerInfo,Hd=Fc,o=dy(o),_h(o)){if("selectionStart"in o)var u={start:o.selectionStart,end:o.selectionEnd};else e:{u=(u=o.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var g=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{u.nodeType,_.nodeType}catch{u=null;break e}var b=0,S=-1,B=-1,Q=0,ie=0,oe=o,J=null;t:for(;;){for(var te;oe!==u||g!==0&&oe.nodeType!==3||(S=b+g),oe!==_||d!==0&&oe.nodeType!==3||(B=b+d),oe.nodeType===3&&(b+=oe.nodeValue.length),(te=oe.firstChild)!==null;)J=oe,oe=te;for(;;){if(oe===o)break t;if(J===u&&++Q===g&&(S=b),J===_&&++ie===d&&(B=b),(te=oe.nextSibling)!==null)break;oe=J,J=oe.parentNode}oe=te}u=S===-1||B===-1?null:{start:S,end:B}}else u=null}u=u||{start:0,end:0}}else u=null;for($d={focusedElem:o,selectionRange:u},Fc=!1,St=a;St!==null;)if(a=St,o=a.child,(a.subtreeFlags&1024)!==0&&o!==null)o.return=a,St=o;else for(;St!==null;){switch(a=St,_=a.alternate,o=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&_!==null){o=void 0,u=a,g=_.memoizedProps,_=_.memoizedState,d=u.stateNode;try{var Ee=Ir(u.type,g,u.elementType===u.type);o=d.getSnapshotBeforeUpdate(Ee,_),d.__reactInternalSnapshotBeforeUpdate=o}catch(xe){Je(u,u.return,xe)}}break;case 3:if((o&1024)!==0){if(o=a.stateNode.containerInfo,u=o.nodeType,u===9)Yd(o);else if(u===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Yd(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(i(163))}if(o=a.sibling,o!==null){o.return=a.return,St=o;break}St=a.return}}function iv(o,a,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:Ui(o,u),d&4&&ma(5,u);break;case 1:if(Ui(o,u),d&4)if(o=u.stateNode,a===null)try{o.componentDidMount()}catch(b){Je(u,u.return,b)}else{var g=Ir(u.type,a.memoizedProps);a=a.memoizedState;try{o.componentDidUpdate(g,a,o.__reactInternalSnapshotBeforeUpdate)}catch(b){Je(u,u.return,b)}}d&64&&G0(u),d&512&&_a(u,u.return);break;case 3:if(Ui(o,u),d&64&&(o=u.updateQueue,o!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{Uy(o,a)}catch(b){Je(u,u.return,b)}}break;case 27:a===null&&d&4&&tv(u);case 26:case 5:Ui(o,u),a===null&&d&4&&J0(u),d&512&&_a(u,u.return);break;case 12:Ui(o,u);break;case 13:Ui(o,u),d&4&&ov(o,u),d&64&&(o=u.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(u=HE.bind(null,u),aR(o,u))));break;case 22:if(d=u.memoizedState!==null||pi,!d){a=a!==null&&a.memoizedState!==null||ht,g=pi;var _=ht;pi=d,(ht=a)&&!_?Fi(o,u,(u.subtreeFlags&8772)!==0):Ui(o,u),pi=g,ht=_}break;case 30:break;default:Ui(o,u)}}function rv(o){var a=o.alternate;a!==null&&(o.alternate=null,rv(a)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(a=o.stateNode,a!==null&&Qf(a)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var nt=null,Ht=!1;function gi(o,a,u){for(u=u.child;u!==null;)sv(o,a,u),u=u.sibling}function sv(o,a,u){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(Uo,u)}catch{}switch(u.tag){case 26:ht||Vn(u,a),gi(o,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ht||Vn(u,a);var d=nt,g=Ht;Wi(u.type)&&(nt=u.stateNode,Ht=!1),gi(o,a,u),Ea(u.stateNode),nt=d,Ht=g;break;case 5:ht||Vn(u,a);case 6:if(d=nt,g=Ht,nt=null,gi(o,a,u),nt=d,Ht=g,nt!==null)if(Ht)try{(nt.nodeType===9?nt.body:nt.nodeName==="HTML"?nt.ownerDocument.body:nt).removeChild(u.stateNode)}catch(_){Je(u,a,_)}else try{nt.removeChild(u.stateNode)}catch(_){Je(u,a,_)}break;case 18:nt!==null&&(Ht?(o=nt,Yv(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,u.stateNode),ka(o)):Yv(nt,u.stateNode));break;case 4:d=nt,g=Ht,nt=u.stateNode.containerInfo,Ht=!0,gi(o,a,u),nt=d,Ht=g;break;case 0:case 11:case 14:case 15:ht||Bi(2,u,a),ht||Bi(4,u,a),gi(o,a,u);break;case 1:ht||(Vn(u,a),d=u.stateNode,typeof d.componentWillUnmount=="function"&&Q0(u,a,d)),gi(o,a,u);break;case 21:gi(o,a,u);break;case 22:ht=(d=ht)||u.memoizedState!==null,gi(o,a,u),ht=d;break;default:gi(o,a,u)}}function ov(o,a){if(a.memoizedState===null&&(o=a.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{ka(o)}catch(u){Je(a,a.return,u)}}function DE(o){switch(o.tag){case 13:case 19:var a=o.stateNode;return a===null&&(a=o.stateNode=new nv),a;case 22:return o=o.stateNode,a=o._retryCache,a===null&&(a=o._retryCache=new nv),a;default:throw Error(i(435,o.tag))}}function bd(o,a){var u=DE(o);a.forEach(function(d){var g=$E.bind(null,o,d);u.has(d)||(u.add(d),d.then(g,g))})}function Zt(o,a){var u=a.deletions;if(u!==null)for(var d=0;d<u.length;d++){var g=u[d],_=o,b=a,S=b;e:for(;S!==null;){switch(S.tag){case 27:if(Wi(S.type)){nt=S.stateNode,Ht=!1;break e}break;case 5:nt=S.stateNode,Ht=!1;break e;case 3:case 4:nt=S.stateNode.containerInfo,Ht=!0;break e}S=S.return}if(nt===null)throw Error(i(160));sv(_,b,g),nt=null,Ht=!1,_=g.alternate,_!==null&&(_.return=null),g.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)av(a,o),a=a.sibling}var Sn=null;function av(o,a){var u=o.alternate,d=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Zt(a,o),Gt(o),d&4&&(Bi(3,o,o.return),ma(3,o),Bi(5,o,o.return));break;case 1:Zt(a,o),Gt(o),d&512&&(ht||u===null||Vn(u,u.return)),d&64&&pi&&(o=o.updateQueue,o!==null&&(d=o.callbacks,d!==null&&(u=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var g=Sn;if(Zt(a,o),Gt(o),d&512&&(ht||u===null||Vn(u,u.return)),d&4){var _=u!==null?u.memoizedState:null;if(d=o.memoizedState,u===null)if(d===null)if(o.stateNode===null){e:{d=o.type,u=o.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":_=g.getElementsByTagName("title")[0],(!_||_[Vo]||_[Ot]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=g.createElement(d),g.head.insertBefore(_,g.querySelector("head > title"))),Mt(_,d,u),_[Ot]=o,Tt(_),d=_;break e;case"link":var b=tb("link","href",g).get(d+(u.href||""));if(b){for(var S=0;S<b.length;S++)if(_=b[S],_.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&_.getAttribute("rel")===(u.rel==null?null:u.rel)&&_.getAttribute("title")===(u.title==null?null:u.title)&&_.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){b.splice(S,1);break t}}_=g.createElement(d),Mt(_,d,u),g.head.appendChild(_);break;case"meta":if(b=tb("meta","content",g).get(d+(u.content||""))){for(S=0;S<b.length;S++)if(_=b[S],_.getAttribute("content")===(u.content==null?null:""+u.content)&&_.getAttribute("name")===(u.name==null?null:u.name)&&_.getAttribute("property")===(u.property==null?null:u.property)&&_.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&_.getAttribute("charset")===(u.charSet==null?null:u.charSet)){b.splice(S,1);break t}}_=g.createElement(d),Mt(_,d,u),g.head.appendChild(_);break;default:throw Error(i(468,d))}_[Ot]=o,Tt(_),d=_}o.stateNode=d}else nb(g,o.type,o.stateNode);else o.stateNode=eb(g,d,o.memoizedProps);else _!==d?(_===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):_.count--,d===null?nb(g,o.type,o.stateNode):eb(g,d,o.memoizedProps)):d===null&&o.stateNode!==null&&md(o,o.memoizedProps,u.memoizedProps)}break;case 27:Zt(a,o),Gt(o),d&512&&(ht||u===null||Vn(u,u.return)),u!==null&&d&4&&md(o,o.memoizedProps,u.memoizedProps);break;case 5:if(Zt(a,o),Gt(o),d&512&&(ht||u===null||Vn(u,u.return)),o.flags&32){g=o.stateNode;try{ms(g,"")}catch(te){Je(o,o.return,te)}}d&4&&o.stateNode!=null&&(g=o.memoizedProps,md(o,g,u!==null?u.memoizedProps:g)),d&1024&&(vd=!0);break;case 6:if(Zt(a,o),Gt(o),d&4){if(o.stateNode===null)throw Error(i(162));d=o.memoizedProps,u=o.stateNode;try{u.nodeValue=d}catch(te){Je(o,o.return,te)}}break;case 3:if(Lc=null,g=Sn,Sn=kc(a.containerInfo),Zt(a,o),Sn=g,Gt(o),d&4&&u!==null&&u.memoizedState.isDehydrated)try{ka(a.containerInfo)}catch(te){Je(o,o.return,te)}vd&&(vd=!1,lv(o));break;case 4:d=Sn,Sn=kc(o.stateNode.containerInfo),Zt(a,o),Gt(o),Sn=d;break;case 12:Zt(a,o),Gt(o);break;case 13:Zt(a,o),Gt(o),o.child.flags&8192&&o.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Ed=Un()),d&4&&(d=o.updateQueue,d!==null&&(o.updateQueue=null,bd(o,d)));break;case 22:g=o.memoizedState!==null;var B=u!==null&&u.memoizedState!==null,Q=pi,ie=ht;if(pi=Q||g,ht=ie||B,Zt(a,o),ht=ie,pi=Q,Gt(o),d&8192)e:for(a=o.stateNode,a._visibility=g?a._visibility&-2:a._visibility|1,g&&(u===null||B||pi||ht||Nr(o)),u=null,a=o;;){if(a.tag===5||a.tag===26){if(u===null){B=u=a;try{if(_=B.stateNode,g)b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{S=B.stateNode;var oe=B.memoizedProps.style,J=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;S.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(te){Je(B,B.return,te)}}}else if(a.tag===6){if(u===null){B=a;try{B.stateNode.nodeValue=g?"":B.memoizedProps}catch(te){Je(B,B.return,te)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===o)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=o.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,bd(o,u))));break;case 19:Zt(a,o),Gt(o),d&4&&(d=o.updateQueue,d!==null&&(o.updateQueue=null,bd(o,d)));break;case 30:break;case 21:break;default:Zt(a,o),Gt(o)}}function Gt(o){var a=o.flags;if(a&2){try{for(var u,d=o.return;d!==null;){if(ev(d)){u=d;break}d=d.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var g=u.stateNode,_=_d(o);xc(o,_,g);break;case 5:var b=u.stateNode;u.flags&32&&(ms(b,""),u.flags&=-33);var S=_d(o);xc(o,S,b);break;case 3:case 4:var B=u.stateNode.containerInfo,Q=_d(o);yd(o,Q,B);break;default:throw Error(i(161))}}catch(ie){Je(o,o.return,ie)}o.flags&=-3}a&4096&&(o.flags&=-4097)}function lv(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var a=o;lv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),o=o.sibling}}function Ui(o,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)iv(o,a.alternate,a),a=a.sibling}function Nr(o){for(o=o.child;o!==null;){var a=o;switch(a.tag){case 0:case 11:case 14:case 15:Bi(4,a,a.return),Nr(a);break;case 1:Vn(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&Q0(a,a.return,u),Nr(a);break;case 27:Ea(a.stateNode);case 26:case 5:Vn(a,a.return),Nr(a);break;case 22:a.memoizedState===null&&Nr(a);break;case 30:Nr(a);break;default:Nr(a)}o=o.sibling}}function Fi(o,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,g=o,_=a,b=_.flags;switch(_.tag){case 0:case 11:case 15:Fi(g,_,u),ma(4,_);break;case 1:if(Fi(g,_,u),d=_,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Q){Je(d,d.return,Q)}if(d=_,g=d.updateQueue,g!==null){var S=d.stateNode;try{var B=g.shared.hiddenCallbacks;if(B!==null)for(g.shared.hiddenCallbacks=null,g=0;g<B.length;g++)By(B[g],S)}catch(Q){Je(d,d.return,Q)}}u&&b&64&&G0(_),_a(_,_.return);break;case 27:tv(_);case 26:case 5:Fi(g,_,u),u&&d===null&&b&4&&J0(_),_a(_,_.return);break;case 12:Fi(g,_,u);break;case 13:Fi(g,_,u),u&&b&4&&ov(g,_);break;case 22:_.memoizedState===null&&Fi(g,_,u),_a(_,_.return);break;case 30:break;default:Fi(g,_,u)}a=a.sibling}}function xd(o,a){var u=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(u=o.memoizedState.cachePool.pool),o=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),o!==u&&(o!=null&&o.refCount++,u!=null&&na(u))}function Td(o,a){o=null,a.alternate!==null&&(o=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==o&&(a.refCount++,o!=null&&na(o))}function jn(o,a,u,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)cv(o,a,u,d),a=a.sibling}function cv(o,a,u,d){var g=a.flags;switch(a.tag){case 0:case 11:case 15:jn(o,a,u,d),g&2048&&ma(9,a);break;case 1:jn(o,a,u,d);break;case 3:jn(o,a,u,d),g&2048&&(o=null,a.alternate!==null&&(o=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==o&&(a.refCount++,o!=null&&na(o)));break;case 12:if(g&2048){jn(o,a,u,d),o=a.stateNode;try{var _=a.memoizedProps,b=_.id,S=_.onPostCommit;typeof S=="function"&&S(b,a.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(B){Je(a,a.return,B)}}else jn(o,a,u,d);break;case 13:jn(o,a,u,d);break;case 23:break;case 22:_=a.stateNode,b=a.alternate,a.memoizedState!==null?_._visibility&2?jn(o,a,u,d):ya(o,a):_._visibility&2?jn(o,a,u,d):(_._visibility|=2,Ds(o,a,u,d,(a.subtreeFlags&10256)!==0)),g&2048&&xd(b,a);break;case 24:jn(o,a,u,d),g&2048&&Td(a.alternate,a);break;default:jn(o,a,u,d)}}function Ds(o,a,u,d,g){for(g=g&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var _=o,b=a,S=u,B=d,Q=b.flags;switch(b.tag){case 0:case 11:case 15:Ds(_,b,S,B,g),ma(8,b);break;case 23:break;case 22:var ie=b.stateNode;b.memoizedState!==null?ie._visibility&2?Ds(_,b,S,B,g):ya(_,b):(ie._visibility|=2,Ds(_,b,S,B,g)),g&&Q&2048&&xd(b.alternate,b);break;case 24:Ds(_,b,S,B,g),g&&Q&2048&&Td(b.alternate,b);break;default:Ds(_,b,S,B,g)}a=a.sibling}}function ya(o,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=o,d=a,g=d.flags;switch(d.tag){case 22:ya(u,d),g&2048&&xd(d.alternate,d);break;case 24:ya(u,d),g&2048&&Td(d.alternate,d);break;default:ya(u,d)}a=a.sibling}}var va=8192;function Ls(o){if(o.subtreeFlags&va)for(o=o.child;o!==null;)uv(o),o=o.sibling}function uv(o){switch(o.tag){case 26:Ls(o),o.flags&va&&o.memoizedState!==null&&bR(Sn,o.memoizedState,o.memoizedProps);break;case 5:Ls(o);break;case 3:case 4:var a=Sn;Sn=kc(o.stateNode.containerInfo),Ls(o),Sn=a;break;case 22:o.memoizedState===null&&(a=o.alternate,a!==null&&a.memoizedState!==null?(a=va,va=16777216,Ls(o),va=a):Ls(o));break;default:Ls(o)}}function fv(o){var a=o.alternate;if(a!==null&&(o=a.child,o!==null)){a.child=null;do a=o.sibling,o.sibling=null,o=a;while(o!==null)}}function ba(o){var a=o.deletions;if((o.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];St=d,dv(d,o)}fv(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)hv(o),o=o.sibling}function hv(o){switch(o.tag){case 0:case 11:case 15:ba(o),o.flags&2048&&Bi(9,o,o.return);break;case 3:ba(o);break;case 12:ba(o);break;case 22:var a=o.stateNode;o.memoizedState!==null&&a._visibility&2&&(o.return===null||o.return.tag!==13)?(a._visibility&=-3,Tc(o)):ba(o);break;default:ba(o)}}function Tc(o){var a=o.deletions;if((o.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];St=d,dv(d,o)}fv(o)}for(o=o.child;o!==null;){switch(a=o,a.tag){case 0:case 11:case 15:Bi(8,a,a.return),Tc(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,Tc(a));break;default:Tc(a)}o=o.sibling}}function dv(o,a){for(;St!==null;){var u=St;switch(u.tag){case 0:case 11:case 15:Bi(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:na(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,St=d;else e:for(u=o;St!==null;){d=St;var g=d.sibling,_=d.return;if(rv(d),d===u){St=null;break e}if(g!==null){g.return=_,St=g;break e}St=_}}}var LE={getCacheForType:function(o){var a=It(yt),u=a.data.get(o);return u===void 0&&(u=o(),a.data.set(o,u)),u}},BE=typeof WeakMap=="function"?WeakMap:Map,We=0,tt=null,Oe=null,De=0,Xe=0,Qt=null,zi=!1,Bs=!1,wd=!1,mi=0,lt=0,Vi=0,kr=0,Sd=0,pn=0,Us=0,xa=null,$t=null,Ad=!1,Ed=0,wc=1/0,Sc=null,ji=null,Ct=0,Hi=null,Fs=null,zs=0,Rd=0,Cd=null,pv=null,Ta=0,Md=null;function Jt(){if((We&2)!==0&&De!==0)return De&-De;if(w.T!==null){var o=Rs;return o!==0?o:Ld()}return P_()}function gv(){pn===0&&(pn=(De&536870912)===0||ze?E_():536870912);var o=dn.current;return o!==null&&(o.flags|=32),pn}function en(o,a,u){(o===tt&&(Xe===2||Xe===9)||o.cancelPendingCommit!==null)&&(Vs(o,0),$i(o,De,pn,!1)),zo(o,u),((We&2)===0||o!==tt)&&(o===tt&&((We&2)===0&&(kr|=u),lt===4&&$i(o,De,pn,!1)),Hn(o))}function mv(o,a,u){if((We&6)!==0)throw Error(i(327));var d=!u&&(a&124)===0&&(a&o.expiredLanes)===0||Fo(o,a),g=d?zE(o,a):Id(o,a,!0),_=d;do{if(g===0){Bs&&!d&&$i(o,a,0,!1);break}else{if(u=o.current.alternate,_&&!UE(u)){g=Id(o,a,!1),_=!1;continue}if(g===2){if(_=a,o.errorRecoveryDisabledLanes&_)var b=0;else b=o.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){a=b;e:{var S=o;g=xa;var B=S.current.memoizedState.isDehydrated;if(B&&(Vs(S,b).flags|=256),b=Id(S,b,!1),b!==2){if(wd&&!B){S.errorRecoveryDisabledLanes|=_,kr|=_,g=4;break e}_=$t,$t=g,_!==null&&($t===null?$t=_:$t.push.apply($t,_))}g=b}if(_=!1,g!==2)continue}}if(g===1){Vs(o,0),$i(o,a,0,!0);break}e:{switch(d=o,_=g,_){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:$i(d,a,pn,!zi);break e;case 2:$t=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(g=Ed+300-Un(),10<g)){if($i(d,a,pn,!zi),Dl(d,0,!0)!==0)break e;d.timeoutHandle=Wv(_v.bind(null,d,u,$t,Sc,Ad,a,pn,kr,Us,zi,_,2,-0,0),g);break e}_v(d,u,$t,Sc,Ad,a,pn,kr,Us,zi,_,0,-0,0)}}break}while(!0);Hn(o)}function _v(o,a,u,d,g,_,b,S,B,Q,ie,oe,J,te){if(o.timeoutHandle=-1,oe=a.subtreeFlags,(oe&8192||(oe&16785408)===16785408)&&(Ma={stylesheets:null,count:0,unsuspend:vR},uv(a),oe=xR(),oe!==null)){o.cancelPendingCommit=oe(Sv.bind(null,o,a,_,u,d,g,b,S,B,ie,1,J,te)),$i(o,_,b,!Q);return}Sv(o,a,_,u,d,g,b,S,B)}function UE(o){for(var a=o;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var g=u[d],_=g.getSnapshot;g=g.value;try{if(!qt(_(),g))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function $i(o,a,u,d){a&=~Sd,a&=~kr,o.suspendedLanes|=a,o.pingedLanes&=~a,d&&(o.warmLanes|=a),d=o.expirationTimes;for(var g=a;0<g;){var _=31-Yt(g),b=1<<_;d[_]=-1,g&=~b}u!==0&&C_(o,u,a)}function Ac(){return(We&6)===0?(wa(0),!1):!0}function Pd(){if(Oe!==null){if(Xe===0)var o=Oe.return;else o=Oe,li=Cr=null,Yh(o),Ns=null,da=0,o=Oe;for(;o!==null;)Z0(o.alternate,o),o=o.return;Oe=null}}function Vs(o,a){var u=o.timeoutHandle;u!==-1&&(o.timeoutHandle=-1,nR(u)),u=o.cancelPendingCommit,u!==null&&(o.cancelPendingCommit=null,u()),Pd(),tt=o,Oe=u=si(o.current,null),De=a,Xe=0,Qt=null,zi=!1,Bs=Fo(o,a),wd=!1,Us=pn=Sd=kr=Vi=lt=0,$t=xa=null,Ad=!1,(a&8)!==0&&(a|=a&32);var d=o.entangledLanes;if(d!==0)for(o=o.entanglements,d&=a;0<d;){var g=31-Yt(d),_=1<<g;a|=o[g],d&=~_}return mi=a,Yl(),u}function yv(o,a){Me=null,w.H=hc,a===ra||a===nc?(a=Dy(),Xe=3):a===Iy?(a=Dy(),Xe=4):Xe=a===L0?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Qt=a,Oe===null&&(lt=1,_c(o,cn(a,o.current)))}function vv(){var o=w.H;return w.H=hc,o===null?hc:o}function bv(){var o=w.A;return w.A=LE,o}function Od(){lt=4,zi||(De&4194048)!==De&&dn.current!==null||(Bs=!0),(Vi&134217727)===0&&(kr&134217727)===0||tt===null||$i(tt,De,pn,!1)}function Id(o,a,u){var d=We;We|=2;var g=vv(),_=bv();(tt!==o||De!==a)&&(Sc=null,Vs(o,a)),a=!1;var b=lt;e:do try{if(Xe!==0&&Oe!==null){var S=Oe,B=Qt;switch(Xe){case 8:Pd(),b=6;break e;case 3:case 2:case 9:case 6:dn.current===null&&(a=!0);var Q=Xe;if(Xe=0,Qt=null,js(o,S,B,Q),u&&Bs){b=0;break e}break;default:Q=Xe,Xe=0,Qt=null,js(o,S,B,Q)}}FE(),b=lt;break}catch(ie){yv(o,ie)}while(!0);return a&&o.shellSuspendCounter++,li=Cr=null,We=d,w.H=g,w.A=_,Oe===null&&(tt=null,De=0,Yl()),b}function FE(){for(;Oe!==null;)xv(Oe)}function zE(o,a){var u=We;We|=2;var d=vv(),g=bv();tt!==o||De!==a?(Sc=null,wc=Un()+500,Vs(o,a)):Bs=Fo(o,a);e:do try{if(Xe!==0&&Oe!==null){a=Oe;var _=Qt;t:switch(Xe){case 1:Xe=0,Qt=null,js(o,a,_,1);break;case 2:case 9:if(Ny(_)){Xe=0,Qt=null,Tv(a);break}a=function(){Xe!==2&&Xe!==9||tt!==o||(Xe=7),Hn(o)},_.then(a,a);break e;case 3:Xe=7;break e;case 4:Xe=5;break e;case 7:Ny(_)?(Xe=0,Qt=null,Tv(a)):(Xe=0,Qt=null,js(o,a,_,7));break;case 5:var b=null;switch(Oe.tag){case 26:b=Oe.memoizedState;case 5:case 27:var S=Oe;if(!b||ib(b)){Xe=0,Qt=null;var B=S.sibling;if(B!==null)Oe=B;else{var Q=S.return;Q!==null?(Oe=Q,Ec(Q)):Oe=null}break t}}Xe=0,Qt=null,js(o,a,_,5);break;case 6:Xe=0,Qt=null,js(o,a,_,6);break;case 8:Pd(),lt=6;break e;default:throw Error(i(462))}}VE();break}catch(ie){yv(o,ie)}while(!0);return li=Cr=null,w.H=d,w.A=g,We=u,Oe!==null?0:(tt=null,De=0,Yl(),lt)}function VE(){for(;Oe!==null&&!Be();)xv(Oe)}function xv(o){var a=q0(o.alternate,o,mi);o.memoizedProps=o.pendingProps,a===null?Ec(o):Oe=a}function Tv(o){var a=o,u=a.alternate;switch(a.tag){case 15:case 0:a=j0(u,a,a.pendingProps,a.type,void 0,De);break;case 11:a=j0(u,a,a.pendingProps,a.type.render,a.ref,De);break;case 5:Yh(a);default:Z0(u,a),a=Oe=wy(a,mi),a=q0(u,a,mi)}o.memoizedProps=o.pendingProps,a===null?Ec(o):Oe=a}function js(o,a,u,d){li=Cr=null,Yh(a),Ns=null,da=0;var g=a.return;try{if(PE(o,g,a,u,De)){lt=1,_c(o,cn(u,o.current)),Oe=null;return}}catch(_){if(g!==null)throw Oe=g,_;lt=1,_c(o,cn(u,o.current)),Oe=null;return}a.flags&32768?(ze||d===1?o=!0:Bs||(De&536870912)!==0?o=!1:(zi=o=!0,(d===2||d===9||d===3||d===6)&&(d=dn.current,d!==null&&d.tag===13&&(d.flags|=16384))),wv(a,o)):Ec(a)}function Ec(o){var a=o;do{if((a.flags&32768)!==0){wv(a,zi);return}o=a.return;var u=IE(a.alternate,a,mi);if(u!==null){Oe=u;return}if(a=a.sibling,a!==null){Oe=a;return}Oe=a=o}while(a!==null);lt===0&&(lt=5)}function wv(o,a){do{var u=NE(o.alternate,o);if(u!==null){u.flags&=32767,Oe=u;return}if(u=o.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(o=o.sibling,o!==null)){Oe=o;return}Oe=o=u}while(o!==null);lt=6,Oe=null}function Sv(o,a,u,d,g,_,b,S,B){o.cancelPendingCommit=null;do Rc();while(Ct!==0);if((We&6)!==0)throw Error(i(327));if(a!==null){if(a===o.current)throw Error(i(177));if(_=a.lanes|a.childLanes,_|=Th,vA(o,u,_,b,S,B),o===tt&&(Oe=tt=null,De=0),Fs=a,Hi=o,zs=u,Rd=_,Cd=g,pv=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,WE(Il,function(){return Mv(),null})):(o.callbackNode=null,o.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=w.T,w.T=null,g=k.p,k.p=2,b=We,We|=4;try{kE(o,a,u)}finally{We=b,k.p=g,w.T=d}}Ct=1,Av(),Ev(),Rv()}}function Av(){if(Ct===1){Ct=0;var o=Hi,a=Fs,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=w.T,w.T=null;var d=k.p;k.p=2;var g=We;We|=4;try{av(a,o);var _=$d,b=dy(o.containerInfo),S=_.focusedElem,B=_.selectionRange;if(b!==S&&S&&S.ownerDocument&&hy(S.ownerDocument.documentElement,S)){if(B!==null&&_h(S)){var Q=B.start,ie=B.end;if(ie===void 0&&(ie=Q),"selectionStart"in S)S.selectionStart=Q,S.selectionEnd=Math.min(ie,S.value.length);else{var oe=S.ownerDocument||document,J=oe&&oe.defaultView||window;if(J.getSelection){var te=J.getSelection(),Ee=S.textContent.length,xe=Math.min(B.start,Ee),Ke=B.end===void 0?xe:Math.min(B.end,Ee);!te.extend&&xe>Ke&&(b=Ke,Ke=xe,xe=b);var $=fy(S,xe),F=fy(S,Ke);if($&&F&&(te.rangeCount!==1||te.anchorNode!==$.node||te.anchorOffset!==$.offset||te.focusNode!==F.node||te.focusOffset!==F.offset)){var K=oe.createRange();K.setStart($.node,$.offset),te.removeAllRanges(),xe>Ke?(te.addRange(K),te.extend(F.node,F.offset)):(K.setEnd(F.node,F.offset),te.addRange(K))}}}}for(oe=[],te=S;te=te.parentNode;)te.nodeType===1&&oe.push({element:te,left:te.scrollLeft,top:te.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<oe.length;S++){var re=oe[S];re.element.scrollLeft=re.left,re.element.scrollTop=re.top}}Fc=!!Hd,$d=Hd=null}finally{We=g,k.p=d,w.T=u}}o.current=a,Ct=2}}function Ev(){if(Ct===2){Ct=0;var o=Hi,a=Fs,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=w.T,w.T=null;var d=k.p;k.p=2;var g=We;We|=4;try{iv(o,a.alternate,a)}finally{We=g,k.p=d,w.T=u}}Ct=3}}function Rv(){if(Ct===4||Ct===3){Ct=0,Ue();var o=Hi,a=Fs,u=zs,d=pv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Ct=5:(Ct=0,Fs=Hi=null,Cv(o,o.pendingLanes));var g=o.pendingLanes;if(g===0&&(ji=null),Zf(u),a=a.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(Uo,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=w.T,g=k.p,k.p=2,w.T=null;try{for(var _=o.onRecoverableError,b=0;b<d.length;b++){var S=d[b];_(S.value,{componentStack:S.stack})}}finally{w.T=a,k.p=g}}(zs&3)!==0&&Rc(),Hn(o),g=o.pendingLanes,(u&4194090)!==0&&(g&42)!==0?o===Md?Ta++:(Ta=0,Md=o):Ta=0,wa(0)}}function Cv(o,a){(o.pooledCacheLanes&=a)===0&&(a=o.pooledCache,a!=null&&(o.pooledCache=null,na(a)))}function Rc(o){return Av(),Ev(),Rv(),Mv()}function Mv(){if(Ct!==5)return!1;var o=Hi,a=Rd;Rd=0;var u=Zf(zs),d=w.T,g=k.p;try{k.p=32>u?32:u,w.T=null,u=Cd,Cd=null;var _=Hi,b=zs;if(Ct=0,Fs=Hi=null,zs=0,(We&6)!==0)throw Error(i(331));var S=We;if(We|=4,hv(_.current),cv(_,_.current,b,u),We=S,wa(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(Uo,_)}catch{}return!0}finally{k.p=g,w.T=d,Cv(o,a)}}function Pv(o,a,u){a=cn(u,a),a=ad(o.stateNode,a,2),o=Ni(o,a,2),o!==null&&(zo(o,2),Hn(o))}function Je(o,a,u){if(o.tag===3)Pv(o,o,u);else for(;a!==null;){if(a.tag===3){Pv(a,o,u);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(ji===null||!ji.has(d))){o=cn(u,o),u=k0(2),d=Ni(a,u,2),d!==null&&(D0(u,d,a,o),zo(d,2),Hn(d));break}}a=a.return}}function Nd(o,a,u){var d=o.pingCache;if(d===null){d=o.pingCache=new BE;var g=new Set;d.set(a,g)}else g=d.get(a),g===void 0&&(g=new Set,d.set(a,g));g.has(u)||(wd=!0,g.add(u),o=jE.bind(null,o,a,u),a.then(o,o))}function jE(o,a,u){var d=o.pingCache;d!==null&&d.delete(a),o.pingedLanes|=o.suspendedLanes&u,o.warmLanes&=~u,tt===o&&(De&u)===u&&(lt===4||lt===3&&(De&62914560)===De&&300>Un()-Ed?(We&2)===0&&Vs(o,0):Sd|=u,Us===De&&(Us=0)),Hn(o)}function Ov(o,a){a===0&&(a=R_()),o=ws(o,a),o!==null&&(zo(o,a),Hn(o))}function HE(o){var a=o.memoizedState,u=0;a!==null&&(u=a.retryLane),Ov(o,u)}function $E(o,a){var u=0;switch(o.tag){case 13:var d=o.stateNode,g=o.memoizedState;g!==null&&(u=g.retryLane);break;case 19:d=o.stateNode;break;case 22:d=o.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(a),Ov(o,u)}function WE(o,a){return as(o,a)}var Cc=null,Hs=null,kd=!1,Mc=!1,Dd=!1,Dr=0;function Hn(o){o!==Hs&&o.next===null&&(Hs===null?Cc=Hs=o:Hs=Hs.next=o),Mc=!0,kd||(kd=!0,YE())}function wa(o,a){if(!Dd&&Mc){Dd=!0;do for(var u=!1,d=Cc;d!==null;){if(o!==0){var g=d.pendingLanes;if(g===0)var _=0;else{var b=d.suspendedLanes,S=d.pingedLanes;_=(1<<31-Yt(42|o)+1)-1,_&=g&~(b&~S),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(u=!0,Dv(d,_))}else _=De,_=Dl(d,d===tt?_:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(_&3)===0||Fo(d,_)||(u=!0,Dv(d,_));d=d.next}while(u);Dd=!1}}function XE(){Iv()}function Iv(){Mc=kd=!1;var o=0;Dr!==0&&(tR()&&(o=Dr),Dr=0);for(var a=Un(),u=null,d=Cc;d!==null;){var g=d.next,_=Nv(d,a);_===0?(d.next=null,u===null?Cc=g:u.next=g,g===null&&(Hs=u)):(u=d,(o!==0||(_&3)!==0)&&(Mc=!0)),d=g}wa(o)}function Nv(o,a){for(var u=o.suspendedLanes,d=o.pingedLanes,g=o.expirationTimes,_=o.pendingLanes&-62914561;0<_;){var b=31-Yt(_),S=1<<b,B=g[b];B===-1?((S&u)===0||(S&d)!==0)&&(g[b]=yA(S,a)):B<=a&&(o.expiredLanes|=S),_&=~S}if(a=tt,u=De,u=Dl(o,o===a?u:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),d=o.callbackNode,u===0||o===a&&(Xe===2||Xe===9)||o.cancelPendingCommit!==null)return d!==null&&d!==null&&ls(d),o.callbackNode=null,o.callbackPriority=0;if((u&3)===0||Fo(o,u)){if(a=u&-u,a===o.callbackPriority)return a;switch(d!==null&&ls(d),Zf(u)){case 2:case 8:u=S_;break;case 32:u=Il;break;case 268435456:u=A_;break;default:u=Il}return d=kv.bind(null,o),u=as(u,d),o.callbackPriority=a,o.callbackNode=u,a}return d!==null&&d!==null&&ls(d),o.callbackPriority=2,o.callbackNode=null,2}function kv(o,a){if(Ct!==0&&Ct!==5)return o.callbackNode=null,o.callbackPriority=0,null;var u=o.callbackNode;if(Rc()&&o.callbackNode!==u)return null;var d=De;return d=Dl(o,o===tt?d:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),d===0?null:(mv(o,d,a),Nv(o,Un()),o.callbackNode!=null&&o.callbackNode===u?kv.bind(null,o):null)}function Dv(o,a){if(Rc())return null;mv(o,a,!0)}function YE(){iR(function(){(We&6)!==0?as(w_,XE):Iv()})}function Ld(){return Dr===0&&(Dr=E_()),Dr}function Lv(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:zl(""+o)}function Bv(o,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,o.id&&u.setAttribute("form",o.id),a.parentNode.insertBefore(u,a),o=new FormData(o),u.parentNode.removeChild(u),o}function qE(o,a,u,d,g){if(a==="submit"&&u&&u.stateNode===g){var _=Lv((g[zt]||null).action),b=d.submitter;b&&(a=(a=b[zt]||null)?Lv(a.formAction):b.getAttribute("formAction"),a!==null&&(_=a,b=null));var S=new $l("action","action",null,d,g);o.push({event:S,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Dr!==0){var B=b?Bv(g,b):new FormData(g);nd(u,{pending:!0,data:B,method:g.method,action:_},null,B)}}else typeof _=="function"&&(S.preventDefault(),B=b?Bv(g,b):new FormData(g),nd(u,{pending:!0,data:B,method:g.method,action:_},_,B))},currentTarget:g}]})}}for(var Bd=0;Bd<xh.length;Bd++){var Ud=xh[Bd],KE=Ud.toLowerCase(),ZE=Ud[0].toUpperCase()+Ud.slice(1);wn(KE,"on"+ZE)}wn(my,"onAnimationEnd"),wn(_y,"onAnimationIteration"),wn(yy,"onAnimationStart"),wn("dblclick","onDoubleClick"),wn("focusin","onFocus"),wn("focusout","onBlur"),wn(dE,"onTransitionRun"),wn(pE,"onTransitionStart"),wn(gE,"onTransitionCancel"),wn(vy,"onTransitionEnd"),ds("onMouseEnter",["mouseout","mouseover"]),ds("onMouseLeave",["mouseout","mouseover"]),ds("onPointerEnter",["pointerout","pointerover"]),ds("onPointerLeave",["pointerout","pointerover"]),vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vr("onBeforeInput",["compositionend","keypress","textInput","paste"]),vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Sa));function Uv(o,a){a=(a&4)!==0;for(var u=0;u<o.length;u++){var d=o[u],g=d.event;d=d.listeners;e:{var _=void 0;if(a)for(var b=d.length-1;0<=b;b--){var S=d[b],B=S.instance,Q=S.currentTarget;if(S=S.listener,B!==_&&g.isPropagationStopped())break e;_=S,g.currentTarget=Q;try{_(g)}catch(ie){mc(ie)}g.currentTarget=null,_=B}else for(b=0;b<d.length;b++){if(S=d[b],B=S.instance,Q=S.currentTarget,S=S.listener,B!==_&&g.isPropagationStopped())break e;_=S,g.currentTarget=Q;try{_(g)}catch(ie){mc(ie)}g.currentTarget=null,_=B}}}}function Ie(o,a){var u=a[Gf];u===void 0&&(u=a[Gf]=new Set);var d=o+"__bubble";u.has(d)||(Fv(a,o,2,!1),u.add(d))}function Fd(o,a,u){var d=0;a&&(d|=4),Fv(u,o,d,a)}var Pc="_reactListening"+Math.random().toString(36).slice(2);function zd(o){if(!o[Pc]){o[Pc]=!0,I_.forEach(function(u){u!=="selectionchange"&&(GE.has(u)||Fd(u,!1,o),Fd(u,!0,o))});var a=o.nodeType===9?o:o.ownerDocument;a===null||a[Pc]||(a[Pc]=!0,Fd("selectionchange",!1,a))}}function Fv(o,a,u,d){switch(cb(a)){case 2:var g=SR;break;case 8:g=AR;break;default:g=ep}u=g.bind(null,a,u,o),g=void 0,!lh||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),d?g!==void 0?o.addEventListener(a,u,{capture:!0,passive:g}):o.addEventListener(a,u,!0):g!==void 0?o.addEventListener(a,u,{passive:g}):o.addEventListener(a,u,!1)}function Vd(o,a,u,d,g){var _=d;if((a&1)===0&&(a&2)===0&&d!==null)e:for(;;){if(d===null)return;var b=d.tag;if(b===3||b===4){var S=d.stateNode.containerInfo;if(S===g)break;if(b===4)for(b=d.return;b!==null;){var B=b.tag;if((B===3||B===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;S!==null;){if(b=us(S),b===null)return;if(B=b.tag,B===5||B===6||B===26||B===27){d=_=b;continue e}S=S.parentNode}}d=d.return}X_(function(){var Q=_,ie=oh(u),oe=[];e:{var J=by.get(o);if(J!==void 0){var te=$l,Ee=o;switch(o){case"keypress":if(jl(u)===0)break e;case"keydown":case"keyup":te=WA;break;case"focusin":Ee="focus",te=hh;break;case"focusout":Ee="blur",te=hh;break;case"beforeblur":case"afterblur":te=hh;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=K_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=NA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=qA;break;case my:case _y:case yy:te=LA;break;case vy:te=ZA;break;case"scroll":case"scrollend":te=OA;break;case"wheel":te=QA;break;case"copy":case"cut":case"paste":te=UA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=G_;break;case"toggle":case"beforetoggle":te=eE}var xe=(a&4)!==0,Ke=!xe&&(o==="scroll"||o==="scrollend"),$=xe?J!==null?J+"Capture":null:J;xe=[];for(var F=Q,K;F!==null;){var re=F;if(K=re.stateNode,re=re.tag,re!==5&&re!==26&&re!==27||K===null||$===null||(re=Ho(F,$),re!=null&&xe.push(Aa(F,re,K))),Ke)break;F=F.return}0<xe.length&&(J=new te(J,Ee,null,u,ie),oe.push({event:J,listeners:xe}))}}if((a&7)===0){e:{if(J=o==="mouseover"||o==="pointerover",te=o==="mouseout"||o==="pointerout",J&&u!==sh&&(Ee=u.relatedTarget||u.fromElement)&&(us(Ee)||Ee[cs]))break e;if((te||J)&&(J=ie.window===ie?ie:(J=ie.ownerDocument)?J.defaultView||J.parentWindow:window,te?(Ee=u.relatedTarget||u.toElement,te=Q,Ee=Ee?us(Ee):null,Ee!==null&&(Ke=s(Ee),xe=Ee.tag,Ee!==Ke||xe!==5&&xe!==27&&xe!==6)&&(Ee=null)):(te=null,Ee=Q),te!==Ee)){if(xe=K_,re="onMouseLeave",$="onMouseEnter",F="mouse",(o==="pointerout"||o==="pointerover")&&(xe=G_,re="onPointerLeave",$="onPointerEnter",F="pointer"),Ke=te==null?J:jo(te),K=Ee==null?J:jo(Ee),J=new xe(re,F+"leave",te,u,ie),J.target=Ke,J.relatedTarget=K,re=null,us(ie)===Q&&(xe=new xe($,F+"enter",Ee,u,ie),xe.target=K,xe.relatedTarget=Ke,re=xe),Ke=re,te&&Ee)t:{for(xe=te,$=Ee,F=0,K=xe;K;K=$s(K))F++;for(K=0,re=$;re;re=$s(re))K++;for(;0<F-K;)xe=$s(xe),F--;for(;0<K-F;)$=$s($),K--;for(;F--;){if(xe===$||$!==null&&xe===$.alternate)break t;xe=$s(xe),$=$s($)}xe=null}else xe=null;te!==null&&zv(oe,J,te,xe,!1),Ee!==null&&Ke!==null&&zv(oe,Ke,Ee,xe,!0)}}e:{if(J=Q?jo(Q):window,te=J.nodeName&&J.nodeName.toLowerCase(),te==="select"||te==="input"&&J.type==="file")var ye=sy;else if(iy(J))if(oy)ye=uE;else{ye=lE;var Pe=aE}else te=J.nodeName,!te||te.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?Q&&rh(Q.elementType)&&(ye=sy):ye=cE;if(ye&&(ye=ye(o,Q))){ry(oe,ye,u,ie);break e}Pe&&Pe(o,J,Q),o==="focusout"&&Q&&J.type==="number"&&Q.memoizedProps.value!=null&&ih(J,"number",J.value)}switch(Pe=Q?jo(Q):window,o){case"focusin":(iy(Pe)||Pe.contentEditable==="true")&&(bs=Pe,yh=Q,Go=null);break;case"focusout":Go=yh=bs=null;break;case"mousedown":vh=!0;break;case"contextmenu":case"mouseup":case"dragend":vh=!1,py(oe,u,ie);break;case"selectionchange":if(hE)break;case"keydown":case"keyup":py(oe,u,ie)}var be;if(ph)e:{switch(o){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else vs?ty(o,u)&&(we="onCompositionEnd"):o==="keydown"&&u.keyCode===229&&(we="onCompositionStart");we&&(Q_&&u.locale!=="ko"&&(vs||we!=="onCompositionStart"?we==="onCompositionEnd"&&vs&&(be=Y_()):(Mi=ie,ch="value"in Mi?Mi.value:Mi.textContent,vs=!0)),Pe=Oc(Q,we),0<Pe.length&&(we=new Z_(we,o,null,u,ie),oe.push({event:we,listeners:Pe}),be?we.data=be:(be=ny(u),be!==null&&(we.data=be)))),(be=nE?iE(o,u):rE(o,u))&&(we=Oc(Q,"onBeforeInput"),0<we.length&&(Pe=new Z_("onBeforeInput","beforeinput",null,u,ie),oe.push({event:Pe,listeners:we}),Pe.data=be)),qE(oe,o,Q,u,ie)}Uv(oe,a)})}function Aa(o,a,u){return{instance:o,listener:a,currentTarget:u}}function Oc(o,a){for(var u=a+"Capture",d=[];o!==null;){var g=o,_=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||_===null||(g=Ho(o,u),g!=null&&d.unshift(Aa(o,g,_)),g=Ho(o,a),g!=null&&d.push(Aa(o,g,_))),o.tag===3)return d;o=o.return}return[]}function $s(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function zv(o,a,u,d,g){for(var _=a._reactName,b=[];u!==null&&u!==d;){var S=u,B=S.alternate,Q=S.stateNode;if(S=S.tag,B!==null&&B===d)break;S!==5&&S!==26&&S!==27||Q===null||(B=Q,g?(Q=Ho(u,_),Q!=null&&b.unshift(Aa(u,Q,B))):g||(Q=Ho(u,_),Q!=null&&b.push(Aa(u,Q,B)))),u=u.return}b.length!==0&&o.push({event:a,listeners:b})}var QE=/\r\n?/g,JE=/\u0000|\uFFFD/g;function Vv(o){return(typeof o=="string"?o:""+o).replace(QE,`
`).replace(JE,"")}function jv(o,a){return a=Vv(a),Vv(o)===a}function Ic(){}function qe(o,a,u,d,g,_){switch(u){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||ms(o,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&ms(o,""+d);break;case"className":Bl(o,"class",d);break;case"tabIndex":Bl(o,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Bl(o,u,d);break;case"style":$_(o,d,_);break;case"data":if(a!=="object"){Bl(o,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||u!=="href")){o.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){o.removeAttribute(u);break}d=zl(""+d),o.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){o.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(u==="formAction"?(a!=="input"&&qe(o,a,"name",g.name,g,null),qe(o,a,"formEncType",g.formEncType,g,null),qe(o,a,"formMethod",g.formMethod,g,null),qe(o,a,"formTarget",g.formTarget,g,null)):(qe(o,a,"encType",g.encType,g,null),qe(o,a,"method",g.method,g,null),qe(o,a,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){o.removeAttribute(u);break}d=zl(""+d),o.setAttribute(u,d);break;case"onClick":d!=null&&(o.onclick=Ic);break;case"onScroll":d!=null&&Ie("scroll",o);break;case"onScrollEnd":d!=null&&Ie("scrollend",o);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(g.children!=null)throw Error(i(60));o.innerHTML=u}}break;case"multiple":o.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":o.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){o.removeAttribute("xlink:href");break}u=zl(""+d),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?o.setAttribute(u,""+d):o.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?o.setAttribute(u,""):o.removeAttribute(u);break;case"capture":case"download":d===!0?o.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?o.setAttribute(u,d):o.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?o.setAttribute(u,d):o.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?o.removeAttribute(u):o.setAttribute(u,d);break;case"popover":Ie("beforetoggle",o),Ie("toggle",o),Ll(o,"popover",d);break;case"xlinkActuate":ii(o,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":ii(o,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":ii(o,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":ii(o,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":ii(o,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":ii(o,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":ii(o,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":ii(o,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":ii(o,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Ll(o,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=MA.get(u)||u,Ll(o,u,d))}}function jd(o,a,u,d,g,_){switch(u){case"style":$_(o,d,_);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(g.children!=null)throw Error(i(60));o.innerHTML=u}}break;case"children":typeof d=="string"?ms(o,d):(typeof d=="number"||typeof d=="bigint")&&ms(o,""+d);break;case"onScroll":d!=null&&Ie("scroll",o);break;case"onScrollEnd":d!=null&&Ie("scrollend",o);break;case"onClick":d!=null&&(o.onclick=Ic);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!N_.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(g=u.endsWith("Capture"),a=u.slice(2,g?u.length-7:void 0),_=o[zt]||null,_=_!=null?_[u]:null,typeof _=="function"&&o.removeEventListener(a,_,g),typeof d=="function")){typeof _!="function"&&_!==null&&(u in o?o[u]=null:o.hasAttribute(u)&&o.removeAttribute(u)),o.addEventListener(a,d,g);break e}u in o?o[u]=d:d===!0?o.setAttribute(u,""):Ll(o,u,d)}}}function Mt(o,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",o),Ie("load",o);var d=!1,g=!1,_;for(_ in u)if(u.hasOwnProperty(_)){var b=u[_];if(b!=null)switch(_){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(o,a,_,b,u,null)}}g&&qe(o,a,"srcSet",u.srcSet,u,null),d&&qe(o,a,"src",u.src,u,null);return;case"input":Ie("invalid",o);var S=_=b=g=null,B=null,Q=null;for(d in u)if(u.hasOwnProperty(d)){var ie=u[d];if(ie!=null)switch(d){case"name":g=ie;break;case"type":b=ie;break;case"checked":B=ie;break;case"defaultChecked":Q=ie;break;case"value":_=ie;break;case"defaultValue":S=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,a));break;default:qe(o,a,d,ie,u,null)}}z_(o,_,S,B,Q,b,g,!1),Ul(o);return;case"select":Ie("invalid",o),d=b=_=null;for(g in u)if(u.hasOwnProperty(g)&&(S=u[g],S!=null))switch(g){case"value":_=S;break;case"defaultValue":b=S;break;case"multiple":d=S;default:qe(o,a,g,S,u,null)}a=_,u=b,o.multiple=!!d,a!=null?gs(o,!!d,a,!1):u!=null&&gs(o,!!d,u,!0);return;case"textarea":Ie("invalid",o),_=g=d=null;for(b in u)if(u.hasOwnProperty(b)&&(S=u[b],S!=null))switch(b){case"value":d=S;break;case"defaultValue":g=S;break;case"children":_=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(i(91));break;default:qe(o,a,b,S,u,null)}j_(o,d,g,_),Ul(o);return;case"option":for(B in u)if(u.hasOwnProperty(B)&&(d=u[B],d!=null))switch(B){case"selected":o.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:qe(o,a,B,d,u,null)}return;case"dialog":Ie("beforetoggle",o),Ie("toggle",o),Ie("cancel",o),Ie("close",o);break;case"iframe":case"object":Ie("load",o);break;case"video":case"audio":for(d=0;d<Sa.length;d++)Ie(Sa[d],o);break;case"image":Ie("error",o),Ie("load",o);break;case"details":Ie("toggle",o);break;case"embed":case"source":case"link":Ie("error",o),Ie("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in u)if(u.hasOwnProperty(Q)&&(d=u[Q],d!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(o,a,Q,d,u,null)}return;default:if(rh(a)){for(ie in u)u.hasOwnProperty(ie)&&(d=u[ie],d!==void 0&&jd(o,a,ie,d,u,void 0));return}}for(S in u)u.hasOwnProperty(S)&&(d=u[S],d!=null&&qe(o,a,S,d,u,null))}function eR(o,a,u,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,_=null,b=null,S=null,B=null,Q=null,ie=null;for(te in u){var oe=u[te];if(u.hasOwnProperty(te)&&oe!=null)switch(te){case"checked":break;case"value":break;case"defaultValue":B=oe;default:d.hasOwnProperty(te)||qe(o,a,te,null,d,oe)}}for(var J in d){var te=d[J];if(oe=u[J],d.hasOwnProperty(J)&&(te!=null||oe!=null))switch(J){case"type":_=te;break;case"name":g=te;break;case"checked":Q=te;break;case"defaultChecked":ie=te;break;case"value":b=te;break;case"defaultValue":S=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(137,a));break;default:te!==oe&&qe(o,a,J,te,d,oe)}}nh(o,b,S,B,Q,ie,_,g);return;case"select":te=b=S=J=null;for(_ in u)if(B=u[_],u.hasOwnProperty(_)&&B!=null)switch(_){case"value":break;case"multiple":te=B;default:d.hasOwnProperty(_)||qe(o,a,_,null,d,B)}for(g in d)if(_=d[g],B=u[g],d.hasOwnProperty(g)&&(_!=null||B!=null))switch(g){case"value":J=_;break;case"defaultValue":S=_;break;case"multiple":b=_;default:_!==B&&qe(o,a,g,_,d,B)}a=S,u=b,d=te,J!=null?gs(o,!!u,J,!1):!!d!=!!u&&(a!=null?gs(o,!!u,a,!0):gs(o,!!u,u?[]:"",!1));return;case"textarea":te=J=null;for(S in u)if(g=u[S],u.hasOwnProperty(S)&&g!=null&&!d.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:qe(o,a,S,null,d,g)}for(b in d)if(g=d[b],_=u[b],d.hasOwnProperty(b)&&(g!=null||_!=null))switch(b){case"value":J=g;break;case"defaultValue":te=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==_&&qe(o,a,b,g,d,_)}V_(o,J,te);return;case"option":for(var Ee in u)if(J=u[Ee],u.hasOwnProperty(Ee)&&J!=null&&!d.hasOwnProperty(Ee))switch(Ee){case"selected":o.selected=!1;break;default:qe(o,a,Ee,null,d,J)}for(B in d)if(J=d[B],te=u[B],d.hasOwnProperty(B)&&J!==te&&(J!=null||te!=null))switch(B){case"selected":o.selected=J&&typeof J!="function"&&typeof J!="symbol";break;default:qe(o,a,B,J,d,te)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xe in u)J=u[xe],u.hasOwnProperty(xe)&&J!=null&&!d.hasOwnProperty(xe)&&qe(o,a,xe,null,d,J);for(Q in d)if(J=d[Q],te=u[Q],d.hasOwnProperty(Q)&&J!==te&&(J!=null||te!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,a));break;default:qe(o,a,Q,J,d,te)}return;default:if(rh(a)){for(var Ke in u)J=u[Ke],u.hasOwnProperty(Ke)&&J!==void 0&&!d.hasOwnProperty(Ke)&&jd(o,a,Ke,void 0,d,J);for(ie in d)J=d[ie],te=u[ie],!d.hasOwnProperty(ie)||J===te||J===void 0&&te===void 0||jd(o,a,ie,J,d,te);return}}for(var $ in u)J=u[$],u.hasOwnProperty($)&&J!=null&&!d.hasOwnProperty($)&&qe(o,a,$,null,d,J);for(oe in d)J=d[oe],te=u[oe],!d.hasOwnProperty(oe)||J===te||J==null&&te==null||qe(o,a,oe,J,d,te)}var Hd=null,$d=null;function Nc(o){return o.nodeType===9?o:o.ownerDocument}function Hv(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $v(o,a){if(o===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&a==="foreignObject"?0:o}function Wd(o,a){return o==="textarea"||o==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Xd=null;function tR(){var o=window.event;return o&&o.type==="popstate"?o===Xd?!1:(Xd=o,!0):(Xd=null,!1)}var Wv=typeof setTimeout=="function"?setTimeout:void 0,nR=typeof clearTimeout=="function"?clearTimeout:void 0,Xv=typeof Promise=="function"?Promise:void 0,iR=typeof queueMicrotask=="function"?queueMicrotask:typeof Xv<"u"?function(o){return Xv.resolve(null).then(o).catch(rR)}:Wv;function rR(o){setTimeout(function(){throw o})}function Wi(o){return o==="head"}function Yv(o,a){var u=a,d=0,g=0;do{var _=u.nextSibling;if(o.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(0<d&&8>d){u=d;var b=o.ownerDocument;if(u&1&&Ea(b.documentElement),u&2&&Ea(b.body),u&4)for(u=b.head,Ea(u),b=u.firstChild;b;){var S=b.nextSibling,B=b.nodeName;b[Vo]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&b.rel.toLowerCase()==="stylesheet"||u.removeChild(b),b=S}}if(g===0){o.removeChild(_),ka(a);return}g--}else u==="$"||u==="$?"||u==="$!"?g++:d=u.charCodeAt(0)-48;else d=0;u=_}while(u);ka(a)}function Yd(o){var a=o.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Yd(u),Qf(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}o.removeChild(u)}}function sR(o,a,u,d){for(;o.nodeType===1;){var g=u;if(o.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(d){if(!o[Vo])switch(a){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(_=o.getAttribute("rel"),_==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(_!==g.rel||o.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||o.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||o.getAttribute("title")!==(g.title==null?null:g.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(_=o.getAttribute("src"),(_!==(g.src==null?null:g.src)||o.getAttribute("type")!==(g.type==null?null:g.type)||o.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&_&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(a==="input"&&o.type==="hidden"){var _=g.name==null?null:""+g.name;if(g.type==="hidden"&&o.getAttribute("name")===_)return o}else return o;if(o=An(o.nextSibling),o===null)break}return null}function oR(o,a,u){if(a==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!u||(o=An(o.nextSibling),o===null))return null;return o}function qd(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function aR(o,a){var u=o.ownerDocument;if(o.data!=="$?"||u.readyState==="complete")a();else{var d=function(){a(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),o._reactRetry=d}}function An(o){for(;o!=null;o=o.nextSibling){var a=o.nodeType;if(a===1||a===3)break;if(a===8){if(a=o.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return o}var Kd=null;function qv(o){o=o.previousSibling;for(var a=0;o;){if(o.nodeType===8){var u=o.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return o;a--}else u==="/$"&&a++}o=o.previousSibling}return null}function Kv(o,a,u){switch(a=Nc(u),o){case"html":if(o=a.documentElement,!o)throw Error(i(452));return o;case"head":if(o=a.head,!o)throw Error(i(453));return o;case"body":if(o=a.body,!o)throw Error(i(454));return o;default:throw Error(i(451))}}function Ea(o){for(var a=o.attributes;a.length;)o.removeAttributeNode(a[0]);Qf(o)}var gn=new Map,Zv=new Set;function kc(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var _i=k.d;k.d={f:lR,r:cR,D:uR,C:fR,L:hR,m:dR,X:gR,S:pR,M:mR};function lR(){var o=_i.f(),a=Ac();return o||a}function cR(o){var a=fs(o);a!==null&&a.tag===5&&a.type==="form"?m0(a):_i.r(o)}var Ws=typeof document>"u"?null:document;function Gv(o,a,u){var d=Ws;if(d&&typeof a=="string"&&a){var g=ln(a);g='link[rel="'+o+'"][href="'+g+'"]',typeof u=="string"&&(g+='[crossorigin="'+u+'"]'),Zv.has(g)||(Zv.add(g),o={rel:o,crossOrigin:u,href:a},d.querySelector(g)===null&&(a=d.createElement("link"),Mt(a,"link",o),Tt(a),d.head.appendChild(a)))}}function uR(o){_i.D(o),Gv("dns-prefetch",o,null)}function fR(o,a){_i.C(o,a),Gv("preconnect",o,a)}function hR(o,a,u){_i.L(o,a,u);var d=Ws;if(d&&o&&a){var g='link[rel="preload"][as="'+ln(a)+'"]';a==="image"&&u&&u.imageSrcSet?(g+='[imagesrcset="'+ln(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(g+='[imagesizes="'+ln(u.imageSizes)+'"]')):g+='[href="'+ln(o)+'"]';var _=g;switch(a){case"style":_=Xs(o);break;case"script":_=Ys(o)}gn.has(_)||(o=p({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:o,as:a},u),gn.set(_,o),d.querySelector(g)!==null||a==="style"&&d.querySelector(Ra(_))||a==="script"&&d.querySelector(Ca(_))||(a=d.createElement("link"),Mt(a,"link",o),Tt(a),d.head.appendChild(a)))}}function dR(o,a){_i.m(o,a);var u=Ws;if(u&&o){var d=a&&typeof a.as=="string"?a.as:"script",g='link[rel="modulepreload"][as="'+ln(d)+'"][href="'+ln(o)+'"]',_=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=Ys(o)}if(!gn.has(_)&&(o=p({rel:"modulepreload",href:o},a),gn.set(_,o),u.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Ca(_)))return}d=u.createElement("link"),Mt(d,"link",o),Tt(d),u.head.appendChild(d)}}}function pR(o,a,u){_i.S(o,a,u);var d=Ws;if(d&&o){var g=hs(d).hoistableStyles,_=Xs(o);a=a||"default";var b=g.get(_);if(!b){var S={loading:0,preload:null};if(b=d.querySelector(Ra(_)))S.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":a},u),(u=gn.get(_))&&Zd(o,u);var B=b=d.createElement("link");Tt(B),Mt(B,"link",o),B._p=new Promise(function(Q,ie){B.onload=Q,B.onerror=ie}),B.addEventListener("load",function(){S.loading|=1}),B.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Dc(b,a,d)}b={type:"stylesheet",instance:b,count:1,state:S},g.set(_,b)}}}function gR(o,a){_i.X(o,a);var u=Ws;if(u&&o){var d=hs(u).hoistableScripts,g=Ys(o),_=d.get(g);_||(_=u.querySelector(Ca(g)),_||(o=p({src:o,async:!0},a),(a=gn.get(g))&&Gd(o,a),_=u.createElement("script"),Tt(_),Mt(_,"link",o),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(g,_))}}function mR(o,a){_i.M(o,a);var u=Ws;if(u&&o){var d=hs(u).hoistableScripts,g=Ys(o),_=d.get(g);_||(_=u.querySelector(Ca(g)),_||(o=p({src:o,async:!0,type:"module"},a),(a=gn.get(g))&&Gd(o,a),_=u.createElement("script"),Tt(_),Mt(_,"link",o),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(g,_))}}function Qv(o,a,u,d){var g=(g=me.current)?kc(g):null;if(!g)throw Error(i(446));switch(o){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=Xs(u.href),u=hs(g).hoistableStyles,d=u.get(a),d||(d={type:"style",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){o=Xs(u.href);var _=hs(g).hoistableStyles,b=_.get(o);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(o,b),(_=g.querySelector(Ra(o)))&&!_._p&&(b.instance=_,b.state.loading=5),gn.has(o)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},gn.set(o,u),_||_R(g,o,u,b.state))),a&&d===null)throw Error(i(528,""));return b}if(a&&d!==null)throw Error(i(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ys(u),u=hs(g).hoistableScripts,d=u.get(a),d||(d={type:"script",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,o))}}function Xs(o){return'href="'+ln(o)+'"'}function Ra(o){return'link[rel="stylesheet"]['+o+"]"}function Jv(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function _R(o,a,u,d){o.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=o.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),Mt(a,"link",u),Tt(a),o.head.appendChild(a))}function Ys(o){return'[src="'+ln(o)+'"]'}function Ca(o){return"script[async]"+o}function eb(o,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var d=o.querySelector('style[data-href~="'+ln(u.href)+'"]');if(d)return a.instance=d,Tt(d),d;var g=p({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(o.ownerDocument||o).createElement("style"),Tt(d),Mt(d,"style",g),Dc(d,u.precedence,o),a.instance=d;case"stylesheet":g=Xs(u.href);var _=o.querySelector(Ra(g));if(_)return a.state.loading|=4,a.instance=_,Tt(_),_;d=Jv(u),(g=gn.get(g))&&Zd(d,g),_=(o.ownerDocument||o).createElement("link"),Tt(_);var b=_;return b._p=new Promise(function(S,B){b.onload=S,b.onerror=B}),Mt(_,"link",d),a.state.loading|=4,Dc(_,u.precedence,o),a.instance=_;case"script":return _=Ys(u.src),(g=o.querySelector(Ca(_)))?(a.instance=g,Tt(g),g):(d=u,(g=gn.get(_))&&(d=p({},u),Gd(d,g)),o=o.ownerDocument||o,g=o.createElement("script"),Tt(g),Mt(g,"link",d),o.head.appendChild(g),a.instance=g);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,Dc(d,u.precedence,o));return a.instance}function Dc(o,a,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,_=g,b=0;b<d.length;b++){var S=d[b];if(S.dataset.precedence===a)_=S;else if(_!==g)break}_?_.parentNode.insertBefore(o,_.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(o,a.firstChild))}function Zd(o,a){o.crossOrigin==null&&(o.crossOrigin=a.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=a.referrerPolicy),o.title==null&&(o.title=a.title)}function Gd(o,a){o.crossOrigin==null&&(o.crossOrigin=a.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=a.referrerPolicy),o.integrity==null&&(o.integrity=a.integrity)}var Lc=null;function tb(o,a,u){if(Lc===null){var d=new Map,g=Lc=new Map;g.set(u,d)}else g=Lc,d=g.get(u),d||(d=new Map,g.set(u,d));if(d.has(o))return d;for(d.set(o,null),u=u.getElementsByTagName(o),g=0;g<u.length;g++){var _=u[g];if(!(_[Vo]||_[Ot]||o==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var b=_.getAttribute(a)||"";b=o+b;var S=d.get(b);S?S.push(_):d.set(b,[_])}}return d}function nb(o,a,u){o=o.ownerDocument||o,o.head.insertBefore(u,a==="title"?o.querySelector("head > title"):null)}function yR(o,a,u){if(u===1||a.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return o=a.disabled,typeof a.precedence=="string"&&o==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function ib(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var Ma=null;function vR(){}function bR(o,a,u){if(Ma===null)throw Error(i(475));var d=Ma;if(a.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var g=Xs(u.href),_=o.querySelector(Ra(g));if(_){o=_._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(d.count++,d=Bc.bind(d),o.then(d,d)),a.state.loading|=4,a.instance=_,Tt(_);return}_=o.ownerDocument||o,u=Jv(u),(g=gn.get(g))&&Zd(u,g),_=_.createElement("link"),Tt(_);var b=_;b._p=new Promise(function(S,B){b.onload=S,b.onerror=B}),Mt(_,"link",u),a.instance=_}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(a,o),(o=a.state.preload)&&(a.state.loading&3)===0&&(d.count++,a=Bc.bind(d),o.addEventListener("load",a),o.addEventListener("error",a))}}function xR(){if(Ma===null)throw Error(i(475));var o=Ma;return o.stylesheets&&o.count===0&&Qd(o,o.stylesheets),0<o.count?function(a){var u=setTimeout(function(){if(o.stylesheets&&Qd(o,o.stylesheets),o.unsuspend){var d=o.unsuspend;o.unsuspend=null,d()}},6e4);return o.unsuspend=a,function(){o.unsuspend=null,clearTimeout(u)}}:null}function Bc(){if(this.count--,this.count===0){if(this.stylesheets)Qd(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var Uc=null;function Qd(o,a){o.stylesheets=null,o.unsuspend!==null&&(o.count++,Uc=new Map,a.forEach(TR,o),Uc=null,Bc.call(o))}function TR(o,a){if(!(a.state.loading&4)){var u=Uc.get(o);if(u)var d=u.get(null);else{u=new Map,Uc.set(o,u);for(var g=o.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<g.length;_++){var b=g[_];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(u.set(b.dataset.precedence,b),d=b)}d&&u.set(null,d)}g=a.instance,b=g.getAttribute("data-precedence"),_=u.get(b)||d,_===d&&u.set(null,g),u.set(b,g),this.count++,d=Bc.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),_?_.parentNode.insertBefore(g,_.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(g,o.firstChild)),a.state.loading|=4}}var Pa={$$typeof:M,Provider:null,Consumer:null,_currentValue:N,_currentValue2:N,_threadCount:0};function wR(o,a,u,d,g,_,b,S){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=qf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qf(0),this.hiddenUpdates=qf(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=_,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function rb(o,a,u,d,g,_,b,S,B,Q,ie,oe){return o=new wR(o,a,u,b,S,B,Q,oe),a=1,_===!0&&(a|=24),_=Kt(3,null,null,a),o.current=_,_.stateNode=o,a=Nh(),a.refCount++,o.pooledCache=a,a.refCount++,_.memoizedState={element:d,isDehydrated:u,cache:a},Bh(_),o}function sb(o){return o?(o=Ss,o):Ss}function ob(o,a,u,d,g,_){g=sb(g),d.context===null?d.context=g:d.pendingContext=g,d=Ii(a),d.payload={element:u},_=_===void 0?null:_,_!==null&&(d.callback=_),u=Ni(o,d,a),u!==null&&(en(u,o,a),oa(u,o,a))}function ab(o,a){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var u=o.retryLane;o.retryLane=u!==0&&u<a?u:a}}function Jd(o,a){ab(o,a),(o=o.alternate)&&ab(o,a)}function lb(o){if(o.tag===13){var a=ws(o,67108864);a!==null&&en(a,o,67108864),Jd(o,67108864)}}var Fc=!0;function SR(o,a,u,d){var g=w.T;w.T=null;var _=k.p;try{k.p=2,ep(o,a,u,d)}finally{k.p=_,w.T=g}}function AR(o,a,u,d){var g=w.T;w.T=null;var _=k.p;try{k.p=8,ep(o,a,u,d)}finally{k.p=_,w.T=g}}function ep(o,a,u,d){if(Fc){var g=tp(d);if(g===null)Vd(o,a,d,zc,u),ub(o,d);else if(RR(g,o,a,u,d))d.stopPropagation();else if(ub(o,d),a&4&&-1<ER.indexOf(o)){for(;g!==null;){var _=fs(g);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var b=yr(_.pendingLanes);if(b!==0){var S=_;for(S.pendingLanes|=2,S.entangledLanes|=2;b;){var B=1<<31-Yt(b);S.entanglements[1]|=B,b&=~B}Hn(_),(We&6)===0&&(wc=Un()+500,wa(0))}}break;case 13:S=ws(_,2),S!==null&&en(S,_,2),Ac(),Jd(_,2)}if(_=tp(d),_===null&&Vd(o,a,d,zc,u),_===g)break;g=_}g!==null&&d.stopPropagation()}else Vd(o,a,d,null,u)}}function tp(o){return o=oh(o),np(o)}var zc=null;function np(o){if(zc=null,o=us(o),o!==null){var a=s(o);if(a===null)o=null;else{var u=a.tag;if(u===13){if(o=l(a),o!==null)return o;o=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;o=null}else a!==o&&(o=null)}}return zc=o,null}function cb(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fA()){case w_:return 2;case S_:return 8;case Il:case hA:return 32;case A_:return 268435456;default:return 32}default:return 32}}var ip=!1,Xi=null,Yi=null,qi=null,Oa=new Map,Ia=new Map,Ki=[],ER="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ub(o,a){switch(o){case"focusin":case"focusout":Xi=null;break;case"dragenter":case"dragleave":Yi=null;break;case"mouseover":case"mouseout":qi=null;break;case"pointerover":case"pointerout":Oa.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ia.delete(a.pointerId)}}function Na(o,a,u,d,g,_){return o===null||o.nativeEvent!==_?(o={blockedOn:a,domEventName:u,eventSystemFlags:d,nativeEvent:_,targetContainers:[g]},a!==null&&(a=fs(a),a!==null&&lb(a)),o):(o.eventSystemFlags|=d,a=o.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),o)}function RR(o,a,u,d,g){switch(a){case"focusin":return Xi=Na(Xi,o,a,u,d,g),!0;case"dragenter":return Yi=Na(Yi,o,a,u,d,g),!0;case"mouseover":return qi=Na(qi,o,a,u,d,g),!0;case"pointerover":var _=g.pointerId;return Oa.set(_,Na(Oa.get(_)||null,o,a,u,d,g)),!0;case"gotpointercapture":return _=g.pointerId,Ia.set(_,Na(Ia.get(_)||null,o,a,u,d,g)),!0}return!1}function fb(o){var a=us(o.target);if(a!==null){var u=s(a);if(u!==null){if(a=u.tag,a===13){if(a=l(u),a!==null){o.blockedOn=a,bA(o.priority,function(){if(u.tag===13){var d=Jt();d=Kf(d);var g=ws(u,d);g!==null&&en(g,u,d),Jd(u,d)}});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){o.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Vc(o){if(o.blockedOn!==null)return!1;for(var a=o.targetContainers;0<a.length;){var u=tp(o.nativeEvent);if(u===null){u=o.nativeEvent;var d=new u.constructor(u.type,u);sh=d,u.target.dispatchEvent(d),sh=null}else return a=fs(u),a!==null&&lb(a),o.blockedOn=u,!1;a.shift()}return!0}function hb(o,a,u){Vc(o)&&u.delete(a)}function CR(){ip=!1,Xi!==null&&Vc(Xi)&&(Xi=null),Yi!==null&&Vc(Yi)&&(Yi=null),qi!==null&&Vc(qi)&&(qi=null),Oa.forEach(hb),Ia.forEach(hb)}function jc(o,a){o.blockedOn===a&&(o.blockedOn=null,ip||(ip=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,CR)))}var Hc=null;function db(o){Hc!==o&&(Hc=o,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Hc===o&&(Hc=null);for(var a=0;a<o.length;a+=3){var u=o[a],d=o[a+1],g=o[a+2];if(typeof d!="function"){if(np(d||u)===null)continue;break}var _=fs(u);_!==null&&(o.splice(a,3),a-=3,nd(_,{pending:!0,data:g,method:u.method,action:d},d,g))}}))}function ka(o){function a(B){return jc(B,o)}Xi!==null&&jc(Xi,o),Yi!==null&&jc(Yi,o),qi!==null&&jc(qi,o),Oa.forEach(a),Ia.forEach(a);for(var u=0;u<Ki.length;u++){var d=Ki[u];d.blockedOn===o&&(d.blockedOn=null)}for(;0<Ki.length&&(u=Ki[0],u.blockedOn===null);)fb(u),u.blockedOn===null&&Ki.shift();if(u=(o.ownerDocument||o).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var g=u[d],_=u[d+1],b=g[zt]||null;if(typeof _=="function")b||db(u);else if(b){var S=null;if(_&&_.hasAttribute("formAction")){if(g=_,b=_[zt]||null)S=b.formAction;else if(np(g)!==null)continue}else S=b.action;typeof S=="function"?u[d+1]=S:(u.splice(d,3),d-=3),db(u)}}}function rp(o){this._internalRoot=o}$c.prototype.render=rp.prototype.render=function(o){var a=this._internalRoot;if(a===null)throw Error(i(409));var u=a.current,d=Jt();ob(u,d,o,a,null,null)},$c.prototype.unmount=rp.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var a=o.containerInfo;ob(o.current,2,null,o,null,null),Ac(),a[cs]=null}};function $c(o){this._internalRoot=o}$c.prototype.unstable_scheduleHydration=function(o){if(o){var a=P_();o={blockedOn:null,target:o,priority:a};for(var u=0;u<Ki.length&&a!==0&&a<Ki[u].priority;u++);Ki.splice(u,0,o),u===0&&fb(o)}};var pb=e.version;if(pb!=="19.1.1")throw Error(i(527,pb,"19.1.1"));k.findDOMNode=function(o){var a=o._reactInternals;if(a===void 0)throw typeof o.render=="function"?Error(i(188)):(o=Object.keys(o).join(","),Error(i(268,o)));return o=f(a),o=o!==null?h(o):null,o=o===null?null:o.stateNode,o};var MR={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:w,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wc.isDisabled&&Wc.supportsFiber)try{Uo=Wc.inject(MR),Xt=Wc}catch{}}return La.createRoot=function(o,a){if(!r(o))throw Error(i(299));var u=!1,d="",g=P0,_=O0,b=I0,S=null;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(S=a.unstable_transitionCallbacks)),a=rb(o,1,!1,null,null,u,d,g,_,b,S,null),o[cs]=a.current,zd(o),new rp(a)},La.hydrateRoot=function(o,a,u){if(!r(o))throw Error(i(299));var d=!1,g="",_=P0,b=O0,S=I0,B=null,Q=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(_=u.onUncaughtError),u.onCaughtError!==void 0&&(b=u.onCaughtError),u.onRecoverableError!==void 0&&(S=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(B=u.unstable_transitionCallbacks),u.formState!==void 0&&(Q=u.formState)),a=rb(o,1,!0,a,u??null,d,g,_,b,S,B,Q),a.context=sb(null),u=a.current,d=Jt(),d=Kf(d),g=Ii(d),g.callback=null,Ni(u,g,d),u=d,a.current.lanes=u,zo(a,u),Hn(a),o[cs]=a.current,zd(o),new $c(a)},La.version="19.1.1",La}var Sb;function UR(){if(Sb)return ap.exports;Sb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),ap.exports=BR(),ap.exports}var FR=UR();/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ab="popstate";function zR(t={}){function e(i,r){let{pathname:s,search:l,hash:c}=i.location;return lg("",{pathname:s,search:l,hash:c},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:cl(r)}return jR(e,n,null,t)}function it(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Nn(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function VR(){return Math.random().toString(36).substring(2,10)}function Eb(t,e){return{usr:t.state,key:t.key,idx:e}}function lg(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Io(e):e,state:n,key:e&&e.key||i||VR()}}function cl({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Io(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function jR(t,e,n,i={}){let{window:r=document.defaultView,v5Compat:s=!1}=i,l=r.history,c="POP",f=null,h=p();h==null&&(h=0,l.replaceState({...l.state,idx:h},""));function p(){return(l.state||{idx:null}).idx}function m(){c="POP";let E=p(),C=E==null?null:E-h;h=E,f&&f({action:c,location:T.location,delta:C})}function y(E,C){c="PUSH";let P=lg(T.location,E,C);h=p()+1;let M=Eb(P,h),I=T.createHref(P);try{l.pushState(M,"",I)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;r.location.assign(I)}s&&f&&f({action:c,location:T.location,delta:1})}function v(E,C){c="REPLACE";let P=lg(T.location,E,C);h=p();let M=Eb(P,h),I=T.createHref(P);l.replaceState(M,"",I),s&&f&&f({action:c,location:T.location,delta:0})}function x(E){return HR(E)}let T={get action(){return c},get location(){return t(r,l)},listen(E){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(Ab,m),f=E,()=>{r.removeEventListener(Ab,m),f=null}},createHref(E){return e(r,E)},createURL:x,encodeLocation(E){let C=x(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:y,replace:v,go(E){return l.go(E)}};return T}function HR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),it(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:cl(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function c3(t,e,n="/"){return $R(t,e,n,!1)}function $R(t,e,n,i){let r=typeof e=="string"?Io(e):e,s=Si(r.pathname||"/",n);if(s==null)return null;let l=u3(t);WR(l);let c=null;for(let f=0;c==null&&f<l.length;++f){let h=nC(s);c=eC(l[f],h,i)}return c}function u3(t,e=[],n=[],i="",r=!1){let s=(l,c,f=r,h)=>{let p={relativePath:h===void 0?l.path||"":h,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&f)return;it(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let m=wi([i,p.relativePath]),y=n.concat(p);l.children&&l.children.length>0&&(it(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),u3(l.children,e,y,m,f)),!(l.path==null&&!l.index)&&e.push({path:m,score:QR(m,l.index),routesMeta:y})};return t.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))s(l,c);else for(let f of f3(l.path))s(l,c,!0,f)}),e}function f3(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let l=f3(i.join("/")),c=[];return c.push(...l.map(f=>f===""?s:[s,f].join("/"))),r&&c.push(...l),c.map(f=>t.startsWith("/")&&f===""?"/":f)}function WR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:JR(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var XR=/^:[\w-]+$/,YR=3,qR=2,KR=1,ZR=10,GR=-2,Rb=t=>t==="*";function QR(t,e){let n=t.split("/"),i=n.length;return n.some(Rb)&&(i+=GR),e&&(i+=qR),n.filter(r=>!Rb(r)).reduce((r,s)=>r+(XR.test(s)?YR:s===""?KR:ZR),i)}function JR(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function eC(t,e,n=!1){let{routesMeta:i}=t,r={},s="/",l=[];for(let c=0;c<i.length;++c){let f=i[c],h=c===i.length-1,p=s==="/"?e:e.slice(s.length)||"/",m=Bu({path:f.relativePath,caseSensitive:f.caseSensitive,end:h},p),y=f.route;if(!m&&h&&n&&!i[i.length-1].route.index&&(m=Bu({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},p)),!m)return null;Object.assign(r,m.params),l.push({params:r,pathname:wi([s,m.pathname]),pathnameBase:oC(wi([s,m.pathnameBase])),route:y}),m.pathnameBase!=="/"&&(s=wi([s,m.pathnameBase]))}return l}function Bu(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=tC(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],l=s.replace(/(.)\/+$/,"$1"),c=r.slice(1);return{params:i.reduce((h,{paramName:p,isOptional:m},y)=>{if(p==="*"){let x=c[y]||"";l=s.slice(0,s.length-x.length).replace(/(.)\/+$/,"$1")}const v=c[y];return m&&!v?h[p]=void 0:h[p]=(v||"").replace(/%2F/g,"/"),h},{}),pathname:s,pathnameBase:l,pattern:t}}function tC(t,e=!1,n=!0){Nn(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,f)=>(i.push({paramName:c,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function nC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Nn(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Si(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function iC(t,e="/"){let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Io(t):t;return{pathname:n?n.startsWith("/")?n:rC(n,e):e,search:aC(i),hash:lC(r)}}function rC(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function fp(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sC(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function am(t){let e=sC(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function lm(t,e,n,i=!1){let r;typeof t=="string"?r=Io(t):(r={...t},it(!r.pathname||!r.pathname.includes("?"),fp("?","pathname","search",r)),it(!r.pathname||!r.pathname.includes("#"),fp("#","pathname","hash",r)),it(!r.search||!r.search.includes("#"),fp("#","search","hash",r)));let s=t===""||r.pathname==="",l=s?"/":r.pathname,c;if(l==null)c=n;else{let m=e.length-1;if(!i&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),m-=1;r.pathname=y.join("/")}c=m>=0?e[m]:"/"}let f=iC(r,c),h=l&&l!=="/"&&l.endsWith("/"),p=(s||l===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(h||p)&&(f.pathname+="/"),f}var wi=t=>t.join("/").replace(/\/\/+/g,"/"),oC=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),aC=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,lC=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function cC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var h3=["POST","PUT","PATCH","DELETE"];new Set(h3);var uC=["GET",...h3];new Set(uC);var No=L.createContext(null);No.displayName="DataRouter";var Sf=L.createContext(null);Sf.displayName="DataRouterState";L.createContext(!1);var d3=L.createContext({isTransitioning:!1});d3.displayName="ViewTransition";var fC=L.createContext(new Map);fC.displayName="Fetchers";var hC=L.createContext(null);hC.displayName="Await";var kn=L.createContext(null);kn.displayName="Navigation";var bl=L.createContext(null);bl.displayName="Location";var Jn=L.createContext({outlet:null,matches:[],isDataRoute:!1});Jn.displayName="Route";var cm=L.createContext(null);cm.displayName="RouteError";function dC(t,{relative:e}={}){it(ko(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=L.useContext(kn),{hash:r,pathname:s,search:l}=xl(t,{relative:e}),c=s;return n!=="/"&&(c=s==="/"?n:wi([n,s])),i.createHref({pathname:c,search:l,hash:r})}function ko(){return L.useContext(bl)!=null}function _r(){return it(ko(),"useLocation() may be used only in the context of a <Router> component."),L.useContext(bl).location}var p3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function g3(t){L.useContext(kn).static||L.useLayoutEffect(t)}function m3(){let{isDataRoute:t}=L.useContext(Jn);return t?EC():pC()}function pC(){it(ko(),"useNavigate() may be used only in the context of a <Router> component.");let t=L.useContext(No),{basename:e,navigator:n}=L.useContext(kn),{matches:i}=L.useContext(Jn),{pathname:r}=_r(),s=JSON.stringify(am(i)),l=L.useRef(!1);return g3(()=>{l.current=!0}),L.useCallback((f,h={})=>{if(Nn(l.current,p3),!l.current)return;if(typeof f=="number"){n.go(f);return}let p=lm(f,JSON.parse(s),r,h.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:wi([e,p.pathname])),(h.replace?n.replace:n.push)(p,h.state,h)},[e,n,s,r,t])}L.createContext(null);function xl(t,{relative:e}={}){let{matches:n}=L.useContext(Jn),{pathname:i}=_r(),r=JSON.stringify(am(n));return L.useMemo(()=>lm(t,JSON.parse(r),i,e==="path"),[t,r,i,e])}function gC(t,e){return _3(t,e)}function _3(t,e,n,i,r){it(ko(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=L.useContext(kn),{matches:l}=L.useContext(Jn),c=l[l.length-1],f=c?c.params:{},h=c?c.pathname:"/",p=c?c.pathnameBase:"/",m=c&&c.route;{let P=m&&m.path||"";y3(h,!m||P.endsWith("*")||P.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${P}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${P}"> to <Route path="${P==="/"?"*":`${P}/*`}">.`)}let y=_r(),v;if(e){let P=typeof e=="string"?Io(e):e;it(p==="/"||P.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${P.pathname}" was given in the \`location\` prop.`),v=P}else v=y;let x=v.pathname||"/",T=x;if(p!=="/"){let P=p.replace(/^\//,"").split("/");T="/"+x.replace(/^\//,"").split("/").slice(P.length).join("/")}let E=c3(t,{pathname:T});Nn(m||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Nn(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=bC(E&&E.map(P=>Object.assign({},P,{params:Object.assign({},f,P.params),pathname:wi([p,s.encodeLocation?s.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?p:wi([p,s.encodeLocation?s.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),l,n,i,r);return e&&C?L.createElement(bl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},C):C}function mC(){let t=AC(),e=cC(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},s={padding:"2px 4px",backgroundColor:i},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=L.createElement(L.Fragment,null,L.createElement("p",null,"💿 Hey developer 👋"),L.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",L.createElement("code",{style:s},"ErrorBoundary")," or"," ",L.createElement("code",{style:s},"errorElement")," prop on your route.")),L.createElement(L.Fragment,null,L.createElement("h2",null,"Unexpected Application Error!"),L.createElement("h3",{style:{fontStyle:"italic"}},e),n?L.createElement("pre",{style:r},n):null,l)}var _C=L.createElement(mC,null),yC=class extends L.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.unstable_onError?this.props.unstable_onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?L.createElement(Jn.Provider,{value:this.props.routeContext},L.createElement(cm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vC({routeContext:t,match:e,children:n}){let i=L.useContext(No);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),L.createElement(Jn.Provider,{value:t},n)}function bC(t,e=[],n=null,i=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,l=n?.errors;if(l!=null){let h=s.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);it(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let c=!1,f=-1;if(n)for(let h=0;h<s.length;h++){let p=s[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(f=h),p.route.id){let{loaderData:m,errors:y}=n,v=p.route.loader&&!m.hasOwnProperty(p.route.id)&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){c=!0,f>=0?s=s.slice(0,f+1):s=[s[0]];break}}}return s.reduceRight((h,p,m)=>{let y,v=!1,x=null,T=null;n&&(y=l&&p.route.id?l[p.route.id]:void 0,x=p.route.errorElement||_C,c&&(f<0&&m===0?(y3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,T=null):f===m&&(v=!0,T=p.route.hydrateFallbackElement||null)));let E=e.concat(s.slice(0,m+1)),C=()=>{let P;return y?P=x:v?P=T:p.route.Component?P=L.createElement(p.route.Component,null):p.route.element?P=p.route.element:P=h,L.createElement(vC,{match:p,routeContext:{outlet:h,matches:E,isDataRoute:n!=null},children:P})};return n&&(p.route.ErrorBoundary||p.route.errorElement||m===0)?L.createElement(yC,{location:n.location,revalidation:n.revalidation,component:x,error:y,children:C(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:i}):C()},null)}function um(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xC(t){let e=L.useContext(No);return it(e,um(t)),e}function TC(t){let e=L.useContext(Sf);return it(e,um(t)),e}function wC(t){let e=L.useContext(Jn);return it(e,um(t)),e}function fm(t){let e=wC(t),n=e.matches[e.matches.length-1];return it(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function SC(){return fm("useRouteId")}function AC(){let t=L.useContext(cm),e=TC("useRouteError"),n=fm("useRouteError");return t!==void 0?t:e.errors?.[n]}function EC(){let{router:t}=xC("useNavigate"),e=fm("useNavigate"),n=L.useRef(!1);return g3(()=>{n.current=!0}),L.useCallback(async(r,s={})=>{Nn(n.current,p3),n.current&&(typeof r=="number"?t.navigate(r):await t.navigate(r,{fromRouteId:e,...s}))},[t,e])}var Cb={};function y3(t,e,n){!e&&!Cb[t]&&(Cb[t]=!0,Nn(!1,n))}L.memo(RC);function RC({routes:t,future:e,state:n,unstable_onError:i}){return _3(t,void 0,n,i,e)}function CC({to:t,replace:e,state:n,relative:i}){it(ko(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=L.useContext(kn);Nn(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=L.useContext(Jn),{pathname:l}=_r(),c=m3(),f=lm(t,am(s),l,i==="path"),h=JSON.stringify(f);return L.useEffect(()=>{c(JSON.parse(h),{replace:e,state:n,relative:i})},[c,h,i,e,n]),null}function Ur(t){it(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function MC({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:r,static:s=!1}){it(!ko(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=t.replace(/^\/*/,"/"),c=L.useMemo(()=>({basename:l,navigator:r,static:s,future:{}}),[l,r,s]);typeof n=="string"&&(n=Io(n));let{pathname:f="/",search:h="",hash:p="",state:m=null,key:y="default"}=n,v=L.useMemo(()=>{let x=Si(f,l);return x==null?null:{location:{pathname:x,search:h,hash:p,state:m,key:y},navigationType:i}},[l,f,h,p,m,y,i]);return Nn(v!=null,`<Router basename="${l}"> is not able to match the URL "${f}${h}${p}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:L.createElement(kn.Provider,{value:c},L.createElement(bl.Provider,{children:e,value:v}))}function PC({children:t,location:e}){return gC(cg(t),e)}function cg(t,e=[]){let n=[];return L.Children.forEach(t,(i,r)=>{if(!L.isValidElement(i))return;let s=[...e,r];if(i.type===L.Fragment){n.push.apply(n,cg(i.props.children,s));return}it(i.type===Ur,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),it(!i.props.index||!i.props.children,"An index route cannot have child routes.");let l={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(l.children=cg(i.props.children,s)),n.push(l)}),n}var yu="get",vu="application/x-www-form-urlencoded";function Af(t){return t!=null&&typeof t.tagName=="string"}function OC(t){return Af(t)&&t.tagName.toLowerCase()==="button"}function IC(t){return Af(t)&&t.tagName.toLowerCase()==="form"}function NC(t){return Af(t)&&t.tagName.toLowerCase()==="input"}function kC(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function DC(t,e){return t.button===0&&(!e||e==="_self")&&!kC(t)}var Yc=null;function LC(){if(Yc===null)try{new FormData(document.createElement("form"),0),Yc=!1}catch{Yc=!0}return Yc}var BC=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function hp(t){return t!=null&&!BC.has(t)?(Nn(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${vu}"`),null):t}function UC(t,e){let n,i,r,s,l;if(IC(t)){let c=t.getAttribute("action");i=c?Si(c,e):null,n=t.getAttribute("method")||yu,r=hp(t.getAttribute("enctype"))||vu,s=new FormData(t)}else if(OC(t)||NC(t)&&(t.type==="submit"||t.type==="image")){let c=t.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||c.getAttribute("action");if(i=f?Si(f,e):null,n=t.getAttribute("formmethod")||c.getAttribute("method")||yu,r=hp(t.getAttribute("formenctype"))||hp(c.getAttribute("enctype"))||vu,s=new FormData(c,t),!LC()){let{name:h,type:p,value:m}=t;if(p==="image"){let y=h?`${h}.`:"";s.append(`${y}x`,"0"),s.append(`${y}y`,"0")}else h&&s.append(h,m)}}else{if(Af(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=yu,i=null,r=vu,l=t}return s&&r==="text/plain"&&(l=s,s=void 0),{action:i,method:n.toLowerCase(),encType:r,formData:s,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function hm(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function FC(t,e,n){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${n}`:e&&Si(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function zC(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function VC(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function jC(t,e,n){let i=await Promise.all(t.map(async r=>{let s=e.routes[r.route.id];if(s){let l=await zC(s,n);return l.links?l.links():[]}return[]}));return XC(i.flat(1).filter(VC).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Mb(t,e,n,i,r,s){let l=(f,h)=>n[h]?f.route.id!==n[h].route.id:!0,c=(f,h)=>n[h].pathname!==f.pathname||n[h].route.path?.endsWith("*")&&n[h].params["*"]!==f.params["*"];return s==="assets"?e.filter((f,h)=>l(f,h)||c(f,h)):s==="data"?e.filter((f,h)=>{let p=i.routes[f.route.id];if(!p||!p.hasLoader)return!1;if(l(f,h)||c(f,h))return!0;if(f.route.shouldRevalidate){let m=f.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function HC(t,e,{includeHydrateFallback:n}={}){return $C(t.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function $C(t){return[...new Set(t)]}function WC(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function XC(t,e){let n=new Set;return new Set(e),t.reduce((i,r)=>{let s=JSON.stringify(WC(r));return n.has(s)||(n.add(s),i.push({key:s,link:r})),i},[])}function v3(){let t=L.useContext(No);return hm(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function YC(){let t=L.useContext(Sf);return hm(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var dm=L.createContext(void 0);dm.displayName="FrameworkContext";function b3(){let t=L.useContext(dm);return hm(t,"You must render this element inside a <HydratedRouter> element"),t}function qC(t,e){let n=L.useContext(dm),[i,r]=L.useState(!1),[s,l]=L.useState(!1),{onFocus:c,onBlur:f,onMouseEnter:h,onMouseLeave:p,onTouchStart:m}=e,y=L.useRef(null);L.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let T=C=>{C.forEach(P=>{l(P.isIntersecting)})},E=new IntersectionObserver(T,{threshold:.5});return y.current&&E.observe(y.current),()=>{E.disconnect()}}},[t]),L.useEffect(()=>{if(i){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[i]);let v=()=>{r(!0)},x=()=>{r(!1),l(!1)};return n?t!=="intent"?[s,y,{}]:[s,y,{onFocus:Ba(c,v),onBlur:Ba(f,x),onMouseEnter:Ba(h,v),onMouseLeave:Ba(p,x),onTouchStart:Ba(m,v)}]:[!1,y,{}]}function Ba(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function KC({page:t,...e}){let{router:n}=v3(),i=L.useMemo(()=>c3(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?L.createElement(GC,{page:t,matches:i,...e}):null}function ZC(t){let{manifest:e,routeModules:n}=b3(),[i,r]=L.useState([]);return L.useEffect(()=>{let s=!1;return jC(t,e,n).then(l=>{s||r(l)}),()=>{s=!0}},[t,e,n]),i}function GC({page:t,matches:e,...n}){let i=_r(),{manifest:r,routeModules:s}=b3(),{basename:l}=v3(),{loaderData:c,matches:f}=YC(),h=L.useMemo(()=>Mb(t,e,f,r,i,"data"),[t,e,f,r,i]),p=L.useMemo(()=>Mb(t,e,f,r,i,"assets"),[t,e,f,r,i]),m=L.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let x=new Set,T=!1;if(e.forEach(C=>{let P=r.routes[C.route.id];!P||!P.hasLoader||(!h.some(M=>M.route.id===C.route.id)&&C.route.id in c&&s[C.route.id]?.shouldRevalidate||P.hasClientLoader?T=!0:x.add(C.route.id))}),x.size===0)return[];let E=FC(t,l,"data");return T&&x.size>0&&E.searchParams.set("_routes",e.filter(C=>x.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[l,c,i,r,h,e,t,s]),y=L.useMemo(()=>HC(p,r),[p,r]),v=ZC(p);return L.createElement(L.Fragment,null,m.map(x=>L.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...n})),y.map(x=>L.createElement("link",{key:x,rel:"modulepreload",href:x,...n})),v.map(({key:x,link:T})=>L.createElement("link",{key:x,nonce:n.nonce,...T})))}function QC(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var x3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{x3&&(window.__reactRouterVersion="7.8.2")}catch{}function JC({basename:t,children:e,window:n}){let i=L.useRef();i.current==null&&(i.current=zR({window:n,v5Compat:!0}));let r=i.current,[s,l]=L.useState({action:r.action,location:r.location}),c=L.useCallback(f=>{L.startTransition(()=>l(f))},[l]);return L.useLayoutEffect(()=>r.listen(c),[r,c]),L.createElement(MC,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:r})}var T3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,w3=L.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:r,reloadDocument:s,replace:l,state:c,target:f,to:h,preventScrollReset:p,viewTransition:m,...y},v){let{basename:x}=L.useContext(kn),T=typeof h=="string"&&T3.test(h),E,C=!1;if(typeof h=="string"&&T&&(E=h,x3))try{let le=new URL(window.location.href),ge=h.startsWith("//")?new URL(le.protocol+h):new URL(h),Z=Si(ge.pathname,x);ge.origin===le.origin&&Z!=null?h=Z+ge.search+ge.hash:C=!0}catch{Nn(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let P=dC(h,{relative:r}),[M,I,D]=qC(i,y),z=iM(h,{replace:l,state:c,target:f,preventScrollReset:p,relative:r,viewTransition:m});function ae(le){e&&e(le),le.defaultPrevented||z(le)}let he=L.createElement("a",{...y,...D,href:E||P,onClick:C||s?e:ae,ref:QC(v,I),target:f,"data-discover":!T&&n==="render"?"true":void 0});return M&&!T?L.createElement(L.Fragment,null,he,L.createElement(KC,{page:P})):he});w3.displayName="Link";var eM=L.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:r=!1,style:s,to:l,viewTransition:c,children:f,...h},p){let m=xl(l,{relative:h.relative}),y=_r(),v=L.useContext(Sf),{navigator:x,basename:T}=L.useContext(kn),E=v!=null&&lM(m)&&c===!0,C=x.encodeLocation?x.encodeLocation(m).pathname:m.pathname,P=y.pathname,M=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;n||(P=P.toLowerCase(),M=M?M.toLowerCase():null,C=C.toLowerCase()),M&&T&&(M=Si(M,T)||M);const I=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let D=P===C||!r&&P.startsWith(C)&&P.charAt(I)==="/",z=M!=null&&(M===C||!r&&M.startsWith(C)&&M.charAt(C.length)==="/"),ae={isActive:D,isPending:z,isTransitioning:E},he=D?e:void 0,le;typeof i=="function"?le=i(ae):le=[i,D?"active":null,z?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let ge=typeof s=="function"?s(ae):s;return L.createElement(w3,{...h,"aria-current":he,className:le,ref:p,style:ge,to:l,viewTransition:c},typeof f=="function"?f(ae):f)});eM.displayName="NavLink";var tM=L.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:r,state:s,method:l=yu,action:c,onSubmit:f,relative:h,preventScrollReset:p,viewTransition:m,...y},v)=>{let x=oM(),T=aM(c,{relative:h}),E=l.toLowerCase()==="get"?"get":"post",C=typeof c=="string"&&T3.test(c),P=M=>{if(f&&f(M),M.defaultPrevented)return;M.preventDefault();let I=M.nativeEvent.submitter,D=I?.getAttribute("formmethod")||l;x(I||M.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:r,state:s,relative:h,preventScrollReset:p,viewTransition:m})};return L.createElement("form",{ref:v,method:E,action:T,onSubmit:i?f:P,...y,"data-discover":!C&&t==="render"?"true":void 0})});tM.displayName="Form";function nM(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function S3(t){let e=L.useContext(No);return it(e,nM(t)),e}function iM(t,{target:e,replace:n,state:i,preventScrollReset:r,relative:s,viewTransition:l}={}){let c=m3(),f=_r(),h=xl(t,{relative:s});return L.useCallback(p=>{if(DC(p,e)){p.preventDefault();let m=n!==void 0?n:cl(f)===cl(h);c(t,{replace:m,state:i,preventScrollReset:r,relative:s,viewTransition:l})}},[f,c,h,n,i,e,t,r,s,l])}var rM=0,sM=()=>`__${String(++rM)}__`;function oM(){let{router:t}=S3("useSubmit"),{basename:e}=L.useContext(kn),n=SC();return L.useCallback(async(i,r={})=>{let{action:s,method:l,encType:c,formData:f,body:h}=UC(i,e);if(r.navigate===!1){let p=r.fetcherKey||sM();await t.fetch(p,n,r.action||s,{preventScrollReset:r.preventScrollReset,formData:f,body:h,formMethod:r.method||l,formEncType:r.encType||c,flushSync:r.flushSync})}else await t.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:f,body:h,formMethod:r.method||l,formEncType:r.encType||c,replace:r.replace,state:r.state,fromRouteId:n,flushSync:r.flushSync,viewTransition:r.viewTransition})},[t,e,n])}function aM(t,{relative:e}={}){let{basename:n}=L.useContext(kn),i=L.useContext(Jn);it(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),s={...xl(t||".",{relative:e})},l=_r();if(t==null){s.search=l.search;let c=new URLSearchParams(s.search),f=c.getAll("index");if(f.some(p=>p==="")){c.delete("index"),f.filter(m=>m).forEach(m=>c.append("index",m));let p=c.toString();s.search=p?`?${p}`:""}}return(!t||t===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:wi([n,s.pathname])),cl(s)}function lM(t,{relative:e}={}){let n=L.useContext(d3);it(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=S3("useViewTransitionState"),r=xl(t,{relative:e});if(!n.isTransitioning)return!1;let s=Si(n.currentLocation.pathname,i)||n.currentLocation.pathname,l=Si(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Bu(r.pathname,l)!=null||Bu(r.pathname,s)!=null}var A3=l3();function Uu(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const pm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Pb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Pb&&parseFloat(Pb[1]);const Ob=globalThis,Ib=globalThis.process||{},cM=globalThis.navigator||{};function E3(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function is(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||E3()}function uM(t){return is()?E3()?"Electron":(cM.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const R3="4.1.0";function fM(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class hM{constructor(e,n,i="sessionStorage"){this.storage=fM(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function dM(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function pM(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Fu;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Fu||(Fu={}));const gM=10;function Nb(t){return typeof t!="string"?t:(t=t.toUpperCase(),Fu[t]||Fu.WHITE)}function mM(t,e,n){return!is&&typeof t=="string"&&(e&&(t=`\x1B[${Nb(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Nb(n)+gM}m${t}\x1B[49m`)),t}function _M(t,e=["constructor"]){const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const s of i){const l=r[s];typeof l=="function"&&(e.find(c=>s===c)||(r[s]=l.bind(t)))}}function gm(t,e){if(!t)throw new Error("Assertion failed")}function qs(){let t;if(is()&&Ob.performance)t=Ob?.performance?.now?.();else if("hrtime"in Ib){const e=Ib?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Ks={debug:is()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},yM={enabled:!0,level:0};function Zs(){}const kb={},Db={once:!0};class Tl{constructor({id:e}={id:""}){this.VERSION=R3,this._startTs=qs(),this._deltaTs=qs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new hM(`__probe-${this.id}__`,yM),this.timeStamp(`${this.id} started`),_M(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((qs()-this._startTs).toPrecision(10))}getDelta(){return Number((qs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ks.warn,arguments,Db)}error(e){return this._getLogFunction(0,e,Ks.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Ks.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ks.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Ks.debug||Ks.info,arguments,Db)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Zs,i&&[i],{tag:bM(n)}):Zs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Zs)}group(e,n,i={collapsed:!1}){const r=Lb({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n,i={}){return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Zs)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=C3(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=Lb({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,gm(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=qs();const l=s.tag||s.message;if(s.once&&l)if(!kb[l])kb[l]=qs();else return Zs;return n=vM(this.id,s.message,s),i.bind(console,n,...s.args)}return Zs}}Tl.VERSION=R3;function C3(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return gm(Number.isFinite(e)&&e>=0),e}function Lb(t){const{logLevel:e,message:n}=t;t.logLevel=C3(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return gm(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function vM(t,e,n){if(typeof e=="string"){const i=n.time?pM(dM(n.total)):"";e=n.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=mM(e,n.color,n.background)}return e}function bM(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const dp="4.3.3",xM=dp[0]>="0"&&dp[0]<="9"?`v${dp}`:"";function TM(){const t=new Tl({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=xM,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const wM=TM();function SM(t,e){return M3(t||{},e)}function M3(t,e,n=0){if(n>3)return e;const i={...t};for(const[r,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[r]=M3(i[r]||{},e[r],n+1):i[r]=e[r];return i}const AM="latest";function EM(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const RM=EM();function pr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Wr=typeof process!="object"||String(process)!=="[object process]"||process.browser,CM=typeof window<"u"&&typeof window.orientation<"u",Bb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Bb&&parseFloat(Bb[1]);class MM{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,n){this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){pr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){pr(this.isRunning),this.isRunning=!1,this._reject(e)}}class pp{terminate(){}}const gp=new Map;function PM(t){pr(t.source&&!t.url||!t.source&&t.url);let e=gp.get(t.source||t.url);return e||(t.url&&(e=OM(t.url),gp.set(t.url,e)),t.source&&(e=P3(t.source),gp.set(t.source,e))),pr(e),e}function OM(t){if(!t.startsWith("http"))return t;const e=IM(t);return P3(e)}function P3(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function IM(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function O3(t,e=!0,n){const i=n||new Set;if(t){if(Ub(t))i.add(t);else if(Ub(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)O3(t[r],e,i)}}return n===void 0?Array.from(i):[]}function Ub(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const mp=()=>{};class ug{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Wr||typeof pp<"u"&&!Wr}constructor(e){const{name:n,source:i,url:r}=e;pr(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=mp,this.onError=s=>console.log(s),this.worker=Wr?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=mp,this.onError=mp,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||O3(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=PM({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new pp(i,{eval:!1})}else if(this.source)e=new pp(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class NM{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return ug.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,l)=>r.done(l),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new MM(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Wr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ug({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return CM?this.maxMobileConcurrency:this.maxConcurrency}}const kM={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class rr{props;workerPools=new Map;static _workerFarm;static isSupported(){return ug.isSupported()}static getWorkerFarm(e={}){return rr._workerFarm=rr._workerFarm||new rr({}),rr._workerFarm.setProps(e),rr._workerFarm}constructor(e){this.props={...kM},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new NM({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function DM(t,e={}){const n=e[t.id]||{},i=Wr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(Wr?r=`modules/${t.module}/dist/${i}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let s=t.version;s==="latest"&&(s=AM);const l=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${l}/dist/${i}`}return pr(r),r}function LM(t,e=RM){pr(t,"no worker provided");const n=t.version;return!(!e||!n)}function BM(t,e){return!rr.isSupported()||!Wr&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function UM(t,e,n,i,r){const s=t.id,l=DM(t,n),f=rr.getWorkerFarm(n).getWorkerPool({name:s,url:l});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const h=await f.startJob("process-on-worker",FM.bind(null,r));return h.postMessage("process",{input:e,options:n,context:i}),await(await h.result).result}async function FM(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:l}=i;try{const c=await t(s,l);e.postMessage("done",{id:r,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:r,error:f})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function zM(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function VM(...t){return jM(t)}function jM(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,l)=>s+l.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function HM(t){const e=[];for await(const n of t)e.push(n);return VM(...e)}function Fb(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class zb{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Fb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Fb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ef{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof zb?r=e:r=new zb(n,i),this.stats[n]=r),r}}let $M="";const Vb={};function WM(t){for(const e in Vb)if(t.startsWith(e)){const n=Vb[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${$M}${t}`),t}function XM(t){return t&&typeof t=="object"&&t.isBuffer}function I3(t){if(XM(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function N3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function YM(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const qM=t=>typeof t=="boolean",tl=t=>typeof t=="function",wl=t=>t!==null&&typeof t=="object",jb=t=>wl(t)&&t.constructor==={}.constructor,KM=t=>!!t&&typeof t[Symbol.iterator]=="function",ZM=t=>t&&typeof t[Symbol.asyncIterator]=="function",rs=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ss=t=>typeof Blob<"u"&&t instanceof Blob,GM=t=>t&&typeof t=="object"&&t.isBuffer,QM=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||wl(t)&&tl(t.tee)&&tl(t.cancel)&&tl(t.getReader),JM=t=>wl(t)&&tl(t.read)&&tl(t.pipe)&&qM(t.readable),k3=t=>QM(t)||JM(t);class eP extends Error{constructor(e,n){super(e),this.reason=n.reason,this.url=n.url,this.response=n.response}reason;url;response}const tP=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,nP=/^([-\w.]+\/[-\w.+]+)/;function Hb(t,e){return t.toLowerCase()===e.toLowerCase()}function iP(t){const e=nP.exec(t);return e?e[1]:t}function $b(t){const e=tP.exec(t);return e?e[1]:""}const D3=/\?.*/;function rP(t){const e=t.match(D3);return e&&e[0]}function mm(t){return t.replace(D3,"")}function sP(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Rf(t){return rs(t)?t.url:ss(t)?t.name||"":typeof t=="string"?t:""}function _m(t){if(rs(t)){const e=t,n=e.headers.get("content-type")||"",i=mm(e.url);return iP(n)||$b(i)}return ss(t)?t.type||"":typeof t=="string"?$b(t):""}function oP(t){return rs(t)?t.headers["content-length"]||-1:ss(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function L3(t){if(rs(t))return t;const e={},n=oP(t);n>=0&&(e["content-length"]=String(n));const i=Rf(t),r=_m(t);r&&(e["content-type"]=r);const s=await cP(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const l=new Response(t,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function aP(t){if(!t.ok)throw await lP(t)}async function lP(t){const e=sP(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&r?.includes("application/json")?await t.json():await t.text()}catch{}return new eP(n,i)}async function cP(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>i(s?.target?.result),r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${uP(n)}`}return null}function uP(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}function fP(t){return!hP(t)&&!dP(t)}function hP(t){return t.startsWith("http:")||t.startsWith("https:")}function dP(t){return t.startsWith("data:")}async function Wb(t,e){if(typeof t=="string"){const n=WM(t);return fP(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await L3(t)}const Xb=new Tl({id:"loaders.gl"});class pP{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class gP{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const B3={fetch:null,mimeType:void 0,nothrow:!1,log:new gP,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:pm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},mP={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function U3(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function F3(){const t=U3();return t.globalOptions=t.globalOptions||{...B3},t.globalOptions}function _P(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],yP(t,n),bP(e,t,i)}function yP(t,e){Yb(t,null,B3,mP,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Yb(i,n.id,r,s,e)}}function Yb(t,e,n,i,r){const s=e||"Top level",l=e?`${e}.`:"";for(const c in t){const f=!e&&wl(t[c]),h=c==="baseUri"&&!e,p=c==="workerUrl"&&e;if(!(c in n)&&!h&&!p){if(c in i)Xb.warn(`${s} loader option '${l}${c}' no longer supported, use '${i[c]}'`)();else if(!f){const m=vP(c,r);Xb.warn(`${s} loader option '${l}${c}' not recognized. ${m}`)()}}}}function vP(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return`Did you mean '${r.id}.${s}'?`;const l=s.toLowerCase();(n.startsWith(l)||l.startsWith(n))&&(i=i||`Did you mean '${r.id}.${s}'?`)}return i}function bP(t,e,n){const r={...t.options||{}};return xP(r,n),r.log===null&&(r.log=new pP),qb(r,F3()),qb(r,e),r}function qb(t,e){for(const n in e)if(n in e){const i=e[n];jb(i)&&jb(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function xP(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function ym(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function vm(t){Uu(t,"null loader"),Uu(ym(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const z3=()=>{const t=U3();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function TP(t){const e=z3();t=Array.isArray(t)?t:[t];for(const n of t){const i=vm(n);e.find(r=>i===r)||e.unshift(i)}}function wP(){return z3()}const SP=/\.([^.]+)$/;async function AP(t,e=[],n,i){if(!V3(t))return null;let r=Kb(t,e,{...n,nothrow:!0},i);if(r)return r;if(ss(t)&&(t=await t.slice(0,10).arrayBuffer(),r=Kb(t,e,n,i)),!r&&!n?.nothrow)throw new Error(j3(t));return r}function Kb(t,e=[],n,i){if(!V3(t))return null;if(e&&!Array.isArray(e))return vm(e);let r=[];e&&(r=r.concat(e)),n?.ignoreRegisteredLoaders||r.push(...wP()),RP(r);const s=EP(t,r,n,i);if(!s&&!n?.nothrow)throw new Error(j3(t));return s}function EP(t,e,n,i){const r=Rf(t),s=_m(t),l=mm(r)||i?.url;let c=null,f="";return n?.mimeType&&(c=_p(e,n?.mimeType),f=`match forced by supplied MIME type ${n?.mimeType}`),c=c||CP(e,l),f=f||(c?`matched url ${l}`:""),c=c||_p(e,s),f=f||(c?`matched MIME type ${s}`:""),c=c||PP(e,t),f=f||(c?`matched initial data ${H3(t)}`:""),n?.fallbackMimeType&&(c=c||_p(e,n?.fallbackMimeType),f=f||(c?`matched fallback MIME type ${s}`:"")),f&&wM.log(1,`selectLoader selected ${c?.name}: ${f}.`),c}function V3(t){return!(t instanceof Response&&t.status===204)}function j3(t){const e=Rf(t),n=_m(t);let i="No valid loader found (";i+=e?`${N3(e)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=t?H3(t):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function RP(t){for(const e of t)vm(e)}function CP(t,e){const n=e&&SP.exec(e),i=n&&n[1];return i?MP(t,i):null}function MP(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function _p(t,e){for(const n of t)if(n.mimeTypes?.some(i=>Hb(e,i))||Hb(e,`application/x.${n.id}`))return n;return null}function PP(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(OP(e,n))return n}else if(ArrayBuffer.isView(e)){if(Zb(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Zb(e,0,n))return n;return null}function OP(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Zb(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>IP(t,e,n,r))}function IP(t,e,n,i){if(i instanceof ArrayBuffer)return zM(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const r=fg(t,e,i.length);return i===r;default:return!1}}function H3(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?fg(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?fg(t,0,e):""}function fg(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const NP=256*1024;function*kP(t,e){const n=e?.chunkSize||NP;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),l=t.slice(i,i+s);i+=s,yield r.encode(l)}}const DP=256*1024;function*LP(t,e={}){const{chunkSize:n=DP}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),l=new Uint8Array(t,i,r);new Uint8Array(s).set(l),i+=r,yield s}}const BP=1024*1024;async function*UP(t,e){const n=e?.chunkSize||BP;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function Gb(t,e){return pm?FP(t,e):zP(t)}async function*FP(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e?._streamReadAhead&&(i=n.read());const{done:s,value:l}=await r;if(s)return;yield I3(l)}}catch{n.releaseLock()}}async function*zP(t,e){for await(const n of t)yield I3(n)}function VP(t,e){if(typeof t=="string")return kP(t,e);if(t instanceof ArrayBuffer)return LP(t,e);if(ss(t))return UP(t,e);if(k3(t))return Gb(t,e);if(rs(t))return Gb(t.body,e);throw new Error("makeIterator")}const $3="Cannot convert supplied data type";function jP(t,e,n){if(e.text&&typeof t=="string")return t;if(GM(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error($3)}async function HP(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return jP(t,e);if(ss(t)&&(t=await L3(t)),rs(t)){const r=t;return await aP(r),e.binary?await r.arrayBuffer():await r.text()}if(k3(t)&&(t=VP(t,n)),KM(t)||ZM(t))return HM(t);throw new Error($3)}function W3(t,e){const n=F3(),i=t||n;return typeof i.fetch=="function"?i.fetch:wl(i.fetch)?r=>Wb(r,i.fetch):e?.fetch?e?.fetch:Wb}function $P(t,e,n){if(n)return n;const i={fetch:W3(e,t),...t};if(i.url){const r=mm(i.url);i.baseUrl=r,i.queryString=rP(i.url),i.filename=N3(r),i.baseUrl=YM(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function WP(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:void 0}async function zu(t,e,n,i){e&&!Array.isArray(e)&&!ym(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=Rf(t),l=WP(e,i),c=await AP(t,l,n);return c?(n=_P(n,c,l,r),i=$P({url:r,_parse:zu,loaders:l},n,i||null),await XP(c,t,n,i)):null}async function XP(t,e,n,i){if(LM(t),n=SM(t.options,n),rs(e)){const s=e,{ok:l,redirected:c,status:f,statusText:h,type:p,url:m}=s,y=Object.fromEntries(s.headers.entries());i.response={headers:y,ok:l,redirected:c,status:f,statusText:h,type:p,url:m}}e=await HP(e,t,n);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,n,i);if(BM(t,n))return await UM(t,e,n,i,zu);if(r.parseText&&typeof e=="string")return await r.parseText(e,n,i);if(r.parse)return await r.parse(e,n,i);throw pr(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Vu(t,e,n,i){let r,s;!Array.isArray(e)&&!ym(e)?(r=[],s=e):(r=e,s=n);const l=W3(s);let c=t;return typeof t=="string"&&(c=await l(t)),ss(t)&&(c=await l(t)),Array.isArray(r)?await zu(c,r,s):await zu(c,r,s)}const YP="4.3.3",qP=globalThis.loaders?.parseImageNode,hg=typeof Image<"u",dg=typeof ImageBitmap<"u",KP=!!qP,pg=pm?!0:KP;function ZP(t){switch(t){case"auto":return dg||hg||pg;case"imagebitmap":return dg;case"image":return hg;case"data":return pg;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function GP(){if(dg)return"imagebitmap";if(hg)return"image";if(pg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function QP(t){const e=eO(t);if(!e)throw new Error("Not an image");return e}function JP(t){switch(QP(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function eO(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const tO=/^data:image\/svg\+xml/,nO=/\.svg((\?|#).*)?$/;function bm(t){return t&&(tO.test(t)||nO.test(t))}function iO(t,e){if(bm(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return X3(t,e)}function X3(t,e){if(bm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Y3(t,e,n){const i=iO(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await rO(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function rO(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>{const l=s instanceof Error?s.message:"error";r(new Error(l))}}catch(s){r(s)}})}const sO={};let Qb=!0;async function oO(t,e,n){let i;bm(n)?i=await Y3(t,e,n):i=X3(t,n);const r=e&&e.imagebitmap;return await aO(i,r)}async function aO(t,e=null){if((lO(e)||!Qb)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Qb=!1}return await createImageBitmap(t)}function lO(t){for(const e in t||sO)return!1;return!0}function cO(t){return!dO(t,"ftyp",4)||(t[8]&96)===0?null:uO(t)}function uO(t){switch(fO(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function fO(t,e,n){return String.fromCharCode(...t.slice(e,n))}function hO(t){return[...t].map(e=>e.charCodeAt(0))}function dO(t,e,n=0){const i=hO(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const Yn=!1,nl=!0;function q3(t){const e=Sl(t);return gO(e)||yO(e)||mO(e)||_O(e)||pO(e)}function pO(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=cO(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function gO(t){const e=Sl(t);return e.byteLength>=24&&e.getUint32(0,Yn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yn),height:e.getUint32(20,Yn)}:null}function mO(t){const e=Sl(t);return e.byteLength>=10&&e.getUint32(0,Yn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,nl),height:e.getUint16(8,nl)}:null}function _O(t){const e=Sl(t);return e.byteLength>=14&&e.getUint16(0,Yn)===16973&&e.getUint32(2,nl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,nl),height:e.getUint32(22,nl)}:null}function yO(t){const e=Sl(t);if(!(e.byteLength>=3&&e.getUint16(0,Yn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=vO();let s=2;for(;s+9<e.byteLength;){const l=e.getUint16(s,Yn);if(r.has(l))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Yn),width:e.getUint16(s+7,Yn)};if(!i.has(l))return null;s+=2,s+=e.getUint16(s,Yn)}return null}function vO(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Sl(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function bO(t,e){const{mimeType:n}=q3(t)||{},i=globalThis.loaders?.parseImageNode;return Uu(i),await i(t,n)}async function xO(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},l=TO(r);let c;switch(l){case"imagebitmap":c=await oO(t,e,s);break;case"image":c=await Y3(t,e,s);break;case"data":c=await bO(t);break;default:Uu(!1)}return r==="data"&&(c=JP(c)),c}function TO(t){switch(t){case"auto":case"data":return GP();default:return ZP(t),t}}const wO=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],SO=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],AO={image:{type:"auto",decode:!0}},EO={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:YP,mimeTypes:SO,extensions:wO,parse:xO,tests:[t=>!!q3(new DataView(t))],options:AO},Ne=new Tl({id:"deck"});let gg={};function RO(t){gg=t}function Bt(t,e,n,i){Ne.level>0&&gg[t]&&gg[t].call(null,e,n,i)}function CO(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const MO={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:CO,parseTextSync:JSON.parse};function PO(){const t="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Ne.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Ne,_registerLoggers:RO},TP([MO,[EO,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const OO=PO();function xm(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const yp={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function IO(t){const e={};for(const[n,i]of Object.entries(t))e[n]=NO(i);return e}function NO(t){let e=Jb(t);if(e!=="object")return{value:t,...yp[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...yp[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Jb(t.value),{...t,...yp[e],type:e}):{type:"object",value:null};throw new Error("props")}function Jb(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const kO=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,DO=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,LO={vertex:kO,fragment:DO},ex=/void\s+main\s*\([^)]*\)\s*\{\n?/,tx=/}\n?[^{}]*$/,vp=[],bu="__LUMA_INJECT_DECLARATIONS__";function BO(t){const e={vertex:{},fragment:{}};for(const n in t){let i=t[n];const r=UO(n);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function UO(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function ju(t,e,n,i=!1){const r=e==="vertex";for(const s in n){const l=n[s];l.sort((f,h)=>f.order-h.order),vp.length=l.length;for(let f=0,h=l.length;f<h;++f)vp[f]=l[f].injection;const c=`${vp.join(`
`)}
`;switch(s){case"vs:#decl":r&&(t=t.replace(bu,c));break;case"vs:#main-start":r&&(t=t.replace(ex,f=>f+c));break;case"vs:#main-end":r&&(t=t.replace(tx,f=>c+f));break;case"fs:#decl":r||(t=t.replace(bu,c));break;case"fs:#main-start":r||(t=t.replace(ex,f=>f+c));break;case"fs:#main-end":r||(t=t.replace(tx,f=>c+f));break;default:t=t.replace(s,f=>f+c)}}return t=t.replace(bu,""),i&&(t=t.replace(/\}\s*$/,s=>s+LO[e])),t}function Hu(t){t.map(e=>FO(e))}function FO(t){if(t.instance)return;Hu(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:i={}}=t,r={normalizedInjections:BO(i),parsedDeprecations:zO(n)};e&&(r.propValidators=IO(e)),t.instance=r;let s={};e&&(s=Object.entries(e).reduce((l,[c,f])=>{const h=f?.value;return h&&(l[c]=h),l},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function K3(t,e,n){t.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function zO(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function Tm(t){Hu(t);const e={},n={};Z3({modules:t,level:0,moduleMap:e,moduleDepth:n});const i=Object.keys(n).sort((r,s)=>n[s]-n[r]).map(r=>e[r]);return Hu(i),i}function Z3(t){const{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&Z3({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function VO(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function jO(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=nx(t,HO),t;case"fragment":return t=nx(t,$O),t;default:throw new Error(e)}}const G3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],HO=[...G3,[mg("attribute"),"in $1"],[mg("varying"),"out $1"]],$O=[...G3,[mg("varying"),"in $1"]];function nx(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function mg(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Q3(t,e){let n="";for(const i in t){const r=t[i];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[i]){const s=e[i];s.sort((l,c)=>l.order-c.order);for(const l of s)n+=`  ${l.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function J3(t){const e={vertex:{},fragment:{}};for(const n of t){let i,r;typeof n!="string"?(i=n,r=i.hook):(i={},r=n),r=r.trim();const[s,l]=r.split(":"),c=r.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(s){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(s)}}return e}function WO(t,e){return{name:XO(t,e),language:"glsl",version:YO(t)}}function XO(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function YO(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const ew=`

${bu}
`,qO=`precision highp float;
`;function KO(t){const e=Tm(t.modules||[]);return{source:GO(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:tw(e)}}function ZO(t){const{vs:e,fs:n}=t,i=Tm(t.modules||[]);return{vs:ix(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:ix(t.platformInfo,{...t,source:n,stage:"fragment",modules:i}),getUniforms:tw(i)}}function GO(t,e){const{source:n,stage:i,modules:r,hookFunctions:s=[],inject:l={},log:c}=e;xm(typeof n=="string","shader source must be a string");const f=n;let h="";const p=J3(s),m={},y={},v={};for(const T in l){const E=typeof l[T]=="string"?{injection:l[T],order:0}:l[T],C=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(C){const P=C[2],M=C[3];P?M==="decl"?y[T]=[E]:v[T]=[E]:m[T]=[E]}else v[T]=[E]}const x=r;for(const T of x){c&&K3(T,f,c);const E=nw(T,"wgsl");h+=E;const C=T.injections?.[i]||{};for(const P in C){const M=/^(v|f)s:#([\w-]+)$/.exec(P);if(M){const D=M[2]==="decl"?y:v;D[P]=D[P]||[],D[P].push(C[P])}else m[P]=m[P]||[],m[P].push(C[P])}}return h+=ew,h=ju(h,i,y),h+=Q3(p[i],m),h+=f,h=ju(h,i,v),h}function ix(t,e){const{id:n,source:i,stage:r,language:s="glsl",modules:l,defines:c={},hookFunctions:f=[],inject:h={},prologue:p=!0,log:m}=e;xm(typeof i=="string","shader source must be a string");const y=s==="glsl"?WO(i).version:-1,v=t.shaderLanguageVersion,x=y===100?"#version 100":"#version 300 es",E=i.split(`
`).slice(1).join(`
`),C={};l.forEach(ae=>{Object.assign(C,ae.defines)}),Object.assign(C,c);let P="";switch(s){case"wgsl":break;case"glsl":P=p?`${x}

// ----- PROLOGUE -------------------------
${QO({id:n,source:i,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${VO(t)}
${r==="fragment"?qO:""}

// ----- APPLICATION DEFINES -------------------------

${JO(C)}

`:`${x}
`;break}const M=J3(f),I={},D={},z={};for(const ae in h){const he=typeof h[ae]=="string"?{injection:h[ae],order:0}:h[ae],le=/^(v|f)s:(#)?([\w-]+)$/.exec(ae);if(le){const ge=le[2],Z=le[3];ge?Z==="decl"?D[ae]=[he]:z[ae]=[he]:I[ae]=[he]}else z[ae]=[he]}for(const ae of l){m&&K3(ae,E,m);const he=nw(ae,r);P+=he;const le=ae.instance?.normalizedInjections[r]||{};for(const ge in le){const Z=/^(v|f)s:#([\w-]+)$/.exec(ge);if(Z){const de=Z[2]==="decl"?D:z;de[ge]=de[ge]||[],de[ge].push(le[ge])}else I[ge]=I[ge]||[],I[ge].push(le[ge])}}return P+="// ----- MAIN SHADER SOURCE -------------------------",P+=ew,P=ju(P,r,D),P+=Q3(M[r],I),P+=E,P=ju(P,r,z),s==="glsl"&&y!==v&&(P=jO(P,r)),P.trim()}function tw(t){return function(n){const i={};for(const r of t){const s=r.getUniforms?.(n,i);Object.assign(i,s)}return i}}function QO(t){const{id:e,source:n,stage:i}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function JO(t={}){let e="";for(const n in t){const i=t[n];(i||Number.isFinite(i))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function nw(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:xm(!1)}if(!t.name)throw new Error("Shader module must have a name");const i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${i}
`),r+=`${n}
`,r}const eI=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,tI=/^\s*\#\s*endif\s*$/;function nI(t,e){const n=t.split(`
`),i=[];let r=!0,s=null;for(const l of n){const c=l.match(eI),f=l.match(tI);c?(s=c[1],r=!!e?.defines?.[s]):f?r=!0:r&&i.push(l)}return i.join(`
`)}class jr{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return jr.defaultShaderAssembler=jr.defaultShaderAssembler||new jr,jr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),i=this._hookFunctions,{source:r,getUniforms:s}=KO({...e,source:e.source,modules:n,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?nI(r):r,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),i=this._hookFunctions;return{...ZO({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:i}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,l=this._defaultModules.length;s<l;++s){const c=this._defaultModules[s],f=c.name;n[r++]=c,i[f]=!0}for(let s=0,l=e.length;s<l;++s){const c=e[s],f=c.name;i[f]||(n[r++]=c,i[f]=!0)}return n.length=r,Hu(n),n}}const iI=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,rI=`#version 300 es
${iI}`;function sI(t){const{input:e,inputChannels:n,output:i}={};if(!e)return rI;if(!n)throw new Error("inputChannels");const r=oI(n),s=aI(e,n);return`#version 300 es
in ${r} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function oI(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function aI(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class lI{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ef({id:e})),this.stats.get(e)}}const iw=new lI,ue=new Tl({id:"luma.gl"}),bp={};function Cf(t="id"){bp[t]=bp[t]||1;const e=bp[t]++;return`${t}-${e}`}let Qe=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,n,i){if(!e)throw new Error("no device");this._device=e,this.props=cI(n,i);const r=this.props.id!=="undefined"?this.props.id:Cf(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}};function cI(t,e){const n={...e};for(const i in t)t[i]!==void 0&&(n[i]=t[i]);return n}class et extends Qe{static defaultProps={...Qe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,n){const i={...n};(n.usage||0)&et.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,et.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,n){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,n,i){const r=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:i,et.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(s):n===0&&i===r.byteLength?this.debugData=r.slice(0,s):this.debugData=r.slice(n,n+s)}}function rw(t){const e=rx[t],n=uI(e),i=t.includes("norm"),r=!i&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:rx[t],byteLength:n,integer:r,signed:s,normalized:i}}function uI(t){return fI[t]}const rx={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},fI={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},kt="texture-compression-bc",Ze="texture-compression-astc",$n="texture-compression-etc2",hI="texture-compression-etc1-webgl",qc="texture-compression-pvrtc-webgl",xp="texture-compression-atc-webgl",Kc="float32-renderable-webgl",Tp="float16-renderable-webgl",dI="rgb9e5ufloat-renderable-webgl",wp="snorm8-renderable-webgl",Ua="norm16-renderable-webgl",Sp="snorm16-renderable-webgl",Zc="float32-filterable",sx="float16-filterable-webgl";function sw(t){const e=pI[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const pI={r8unorm:{},r8snorm:{render:wp},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:wp},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Tp,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ua},"r16snorm-webgl":{f:Sp},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:wp},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Tp,filter:sx},"rg16unorm-webgl":{render:Ua},"rg16snorm-webgl":{render:Sp},r32uint:{},r32sint:{},r32float:{render:Kc,filter:Zc},rgb9e5ufloat:{channels:"rgb",packed:!0,render:dI},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Kc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ua},"rgb16snorm-webgl":{f:Ua},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Zc},rgba16uint:{},rgba16sint:{},rgba16float:{render:Tp,filter:sx},"rgba16unorm-webgl":{render:Ua},"rgba16snorm-webgl":{render:Sp},"rgb32float-webgl":{render:Kc,filter:Zc},rgba32uint:{},rgba32sint:{},rgba32float:{render:Kc,filter:Zc},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:kt},"bc1-rgb-unorm-srgb-webgl":{f:kt},"bc1-rgba-unorm":{f:kt},"bc1-rgba-unorm-srgb":{f:kt},"bc2-rgba-unorm":{f:kt},"bc2-rgba-unorm-srgb":{f:kt},"bc3-rgba-unorm":{f:kt},"bc3-rgba-unorm-srgb":{f:kt},"bc4-r-unorm":{f:kt},"bc4-r-snorm":{f:kt},"bc5-rg-unorm":{f:kt},"bc5-rg-snorm":{f:kt},"bc6h-rgb-ufloat":{f:kt},"bc6h-rgb-float":{f:kt},"bc7-rgba-unorm":{f:kt},"bc7-rgba-unorm-srgb":{f:kt},"etc2-rgb8unorm":{f:$n},"etc2-rgb8unorm-srgb":{f:$n},"etc2-rgb8a1unorm":{f:$n},"etc2-rgb8a1unorm-srgb":{f:$n},"etc2-rgba8unorm":{f:$n},"etc2-rgba8unorm-srgb":{f:$n},"eac-r11unorm":{f:$n},"eac-r11snorm":{f:$n},"eac-rg11unorm":{f:$n},"eac-rg11snorm":{f:$n},"astc-4x4-unorm":{f:Ze},"astc-4x4-unorm-srgb":{f:Ze},"astc-5x4-unorm":{f:Ze},"astc-5x4-unorm-srgb":{f:Ze},"astc-5x5-unorm":{f:Ze},"astc-5x5-unorm-srgb":{f:Ze},"astc-6x5-unorm":{f:Ze},"astc-6x5-unorm-srgb":{f:Ze},"astc-6x6-unorm":{f:Ze},"astc-6x6-unorm-srgb":{f:Ze},"astc-8x5-unorm":{f:Ze},"astc-8x5-unorm-srgb":{f:Ze},"astc-8x6-unorm":{f:Ze},"astc-8x6-unorm-srgb":{f:Ze},"astc-8x8-unorm":{f:Ze},"astc-8x8-unorm-srgb":{f:Ze},"astc-10x5-unorm":{f:Ze},"astc-10x5-unorm-srgb":{f:Ze},"astc-10x6-unorm":{f:Ze},"astc-10x6-unorm-srgb":{f:Ze},"astc-10x8-unorm":{f:Ze},"astc-10x8-unorm-srgb":{f:Ze},"astc-10x10-unorm":{f:Ze},"astc-10x10-unorm-srgb":{f:Ze},"astc-12x10-unorm":{f:Ze},"astc-12x10-unorm-srgb":{f:Ze},"astc-12x12-unorm":{f:Ze},"astc-12x12-unorm-srgb":{f:Ze},"pvrtc-rgb4unorm-webgl":{f:qc},"pvrtc-rgba4unorm-webgl":{f:qc},"pvrtc-rbg2unorm-webgl":{f:qc},"pvrtc-rgba2unorm-webgl":{f:qc},"etc1-rbg-unorm-webgl":{f:hI},"atc-rgb-unorm-webgl":{f:xp},"atc-rgba-unorm-webgl":{f:xp},"atc-rgbai-unorm-webgl":{f:xp}},gI=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],mI=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function ow(t){return gI.some(e=>t.startsWith(e))}function wm(t){let e=_I(t);if(ow(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=yI(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const n=mI.exec(t);if(n){const[,i,r,s,l,c]=n,f=`${s}${r}`,h=rw(f),p=h.byteLength*8,m=i.length,y=[p,m>=2?p:0,m>=3?p:0,m>=4?p:0];e={format:t,attachment:e.attachment,dataType:h.dataType,components:m,channels:i,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:y,bytesPerPixel:h.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function _I(t){const e=sw(t),n=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:n,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function yI(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,i,r]=n;return{blockWidth:Number(i),blockHeight:Number(r)}}return null}function vI(t){const e=sw(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=wm(t),r=t.startsWith("depth")||t.startsWith("stencil"),s=i?.signed,l=i?.integer,c=i?.webgl;return n.render&&=!s,n.filter&&=!r&&!s&&!l&&!c,n}class bI{}class xI{features;disabledFeatures;constructor(e=[],n){this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class fr{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ue.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ue.get("debug")||void 0,debugShaders:ue.get("debug-shaders")||void 0,debugFramebuffers:!!ue.get("debug-framebuffers"),debugWebGL:!!ue.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...fr.defaultProps,...e},this.id=this.props.id||Cf(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=iw;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const n=vI(e),i=l=>(typeof l=="string"?this.features.has(l):l)??!0,r=i(n.create),s={format:e,create:r,render:r&&i(n.render),filter:r&&i(n.filter),blend:r&&i(n.blend),store:r&&i(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return ow(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&et.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":ue.warn("indices buffer content must be of integer type")()),n}}const TI=is()&&typeof document<"u",wI=()=>TI&&document.readyState==="complete",SI="set luma.log.level=1 (or higher) to trace rendering",ox="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class ro{static defaultProps={...fr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=AI().then(()=>{ue.probe(2,"DOM is loaded")()});stats=iw;log=ue;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ue.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ue.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ue.error("This version of luma.gl has already been initialized")()}ue.log(1,`${this.VERSION} - ${SI}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){const n=this.getAdapterMap(e);return n.get("webgpu")?.isSupported?.()?"webgpu":n.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(ro.defaultProps,e)}async createDevice(e={}){e={...ro.defaultProps,...e},e.waitForPageLoad&&await ro.pageLoaded;const n=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const l=await(this.getAdapterMap(e.adapters)||n).get(i)?.create?.(e);if(l)return l;throw new Error(ox)}async attachDevice(e){const n=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await ro.pageLoaded,e.handle===null&&(i="unknown");const s=await n.get(i)?.attach?.(null);if(s)return s;throw new Error(ox)}enforceWebGL2(e=!0,n=[]){const r=this.getAdapterMap(n).get("webgl");r||ue.warn("enforceWebGL2: webgl adapter not found")(),r?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const i of e)n.set(i.type,i);return n}registerDevices(e){ue.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const i=n.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}}const _g=new ro;function AI(){return wI()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class EI{}class Sm{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Sm.defaultProps,...e},e=this.props,!is()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=CI(e.canvas):this.canvas=e.canvas;else{const n=MI(e),i=RI(e?.container||null);i.insertBefore(n,i.firstChild),this.canvas=n,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const i of n)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const i=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return PI(e,i,r,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let i="width"in n?n.width:this.htmlCanvas.clientWidth,r="height"in n?n.height:this.htmlCanvas.clientHeight;(!i||!r)&&(ue.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let l=e;const c=Math.floor(i*l),f=Math.floor(r*l);if(this.htmlCanvas.width=c,this.htmlCanvas.height=f,this.device.gl){const[p,m]=this.getDrawingBufferSize();(p!==c||m!==f)&&(l=Math.min(p/i,m/r),this.htmlCanvas.width=Math.floor(i*l),this.htmlCanvas.height=Math.floor(r*l),ue.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function RI(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function CI(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function MI(t){const{width:e,height:n}=t,i=document.createElement("canvas");return i.id=Cf("lumagl-auto-created-canvas"),i.width=e||1,i.height=n||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}function PI(t,e,n,i,r){const s=t,l=ax(s[0],e,n);let c=lx(s[1],e,i,r),f=ax(s[0]+1,e,n);const h=f===n-1?f:f-1;f=lx(s[1]+1,e,i,r);let p;return r?(f=f===0?f:f+1,p=c,c=f):p=f===i-1?f:f-1,{x:l,y:c,width:Math.max(h-l+1,1),height:Math.max(p-c+1,1)}}function ax(t,e,n){return Math.min(Math.round(t*e),n-1)}function lx(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}class Ge extends Qe{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...Qe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,n){if(n=Ge.normalizeProps(e,n),super(e,n,Ge.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Ge.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Ge.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const n=e?.data;return ArrayBuffer.isView(n)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Ge.getTextureDataSize(e[0]);if(Ge.isExternalImage(e))return Ge.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,n){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:n.width,height:n.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,n){return Math.floor(Math.log2(Math.max(e,n)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,n){const i={...n},r=e?.props?._resourceDefaults?.texture||{};Object.assign(i,r);const{width:s,height:l}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}}class Mf extends Qe{static defaultProps={...Qe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Mf.defaultProps)}}function OI(t,e,n){let i="";const r=e.split(/\r?\n/),s=t.slice().sort((l,c)=>l.lineNum-c.lineNum);switch(n?.showSourceCode||"no"){case"all":let l=0;for(let c=1;c<=r.length;c++)for(i+=aw(r[c-1],c,n);s.length>l&&s[l].lineNum===c;){const f=s[l++];i+=cx(f,r,f.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const c of t)i+=cx(c,r,c.lineNum,{inlineSource:n?.showSourceCode!=="no"});return i}}function cx(t,e,n,i){if(i?.inlineSource){const s=II(e,n),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${l}${t.type.toUpperCase()}: ${t.message}

`}const r=t.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function II(t,e,n){let i="";for(let r=e-2;r<=e;r++){const s=t[r-1];s!==void 0&&(i+=aw(s,e,n))}return i}function aw(t,e,n){const i=n?.html?kI(t):t;return`${NI(String(e),4)}: ${i}${n?.html?"<br/>":`
`}`}function NI(t,e){let n="";for(let i=t.length;i<e;++i)n+=" ";return n+t}function kI(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Pf extends Qe{static defaultProps={...Qe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,n){n={...n,debugShaders:n.debugShaders||e.props.debugShaders||"errors"},super(e,{id:DI(n),...n},Pf.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();e==="warnings"&&n?.length===0||this._displayShaderLog(n)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const n=lw(this.source),i=`${this.stage} ${n}`;let r=OI(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),l.onclick=()=>{const f=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(f)}}}function DI(t){return lw(t.source)||t.id||Cf(`unnamed ${t.stage}-shader`)}function lw(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}class ul extends Qe{static defaultProps={...Qe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=ul.normalizeProps(e,n),super(e,n,ul.defaultProps)}static normalizeProps(e,n){const i=e?.props?._resourceDefaults?.sampler||{};return{...n,...i}}}class Of extends Qe{static defaultProps={...Qe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,n={}){super(e,n,Of.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const n=this.colorAttachments.map(r=>r.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(e){let n=!e;if(e){const[i,r]=Array.isArray(e)?e:[e.width,e.height];n=n||r!==this.height||i!==this.width,this.width=i,this.height=r}n&&(ue.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const r=this.createColorTexture(n,i);return this.attachResource(r),r.view}return n instanceof Ge?n.view:n});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const n=this.createDepthStencilTexture(e);this.attachResource(n),this.depthStencilAttachment=n.view}else e instanceof Ge?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:Ge.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ge.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const r=this.colorAttachments[i].texture.clone({width:e,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}}class _o extends Qe{static defaultProps={...Qe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,n){super(e,n,_o.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Vr extends Qe{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...Qe.defaultProps,framebuffer:null,parameters:void 0,clearColor:Vr.defaultClearColor,clearColors:void 0,clearDepth:Vr.defaultClearDepth,clearStencil:Vr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=Vr.normalizeProps(e,n),super(e,n,Vr.defaultProps)}static normalizeProps(e,n){return{...e.props._resourceDefaults?.renderPass,...n}}}class $u extends Qe{static defaultProps={...Qe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,n){super(e,n,$u.defaultProps),this.shaderLayout=n.shaderLayout}}class Am extends Qe{static defaultProps={...Qe.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Am.defaultProps)}}class Em extends Qe{static defaultProps={...Qe.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Em.defaultProps)}}function LI(t){const[e,n]=UI[t],i=e==="i32"||e==="u32",r=e!=="u32",s=FI[e]*n,l=BI(e,n);return{dataType:e,components:n,defaultVertexFormat:l,byteLength:s,integer:i,signed:r}}function BI(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const UI={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},FI={f32:4,f16:2,i32:4,u32:4};function cw(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,i]=t.split("x"),r=n,s=i?parseInt(i):1,l=rw(r),c={type:r,components:s,byteLength:l.byteLength*s,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(c.webglOnly=!0),c}function uw(t,e){const n={};for(const i of t.attributes){const r=VI(t,e,i.name);r&&(n[i.name]=r)}return n}function zI(t,e,n=16){const i=uw(t,e),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}function VI(t,e,n){const i=jI(t,n),r=HI(e,n);if(!i)return null;const s=LI(i.type),l=r?.vertexFormat||s.defaultVertexFormat,c=cw(l);return{attributeName:r?.attributeName||i.name,bufferName:r?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:l,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:s.integer,stepMode:r?.stepMode||i.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function jI(t,e){const n=t.attributes.find(i=>i.name===e);return n||ue.warn(`shader layout attribute "${e}" not present in shader`),n||null}function HI(t,e){$I(t);let n=WI(t,e);return n||(n=XI(t,e),n)?n:(ue.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function $I(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&ue.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function WI(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function XI(t,e){for(const n of t){let i=n.byteStride;if(typeof n.byteStride!="number")for(const s of n.attributes||[]){const l=cw(s.format);i+=l.byteLength}const r=n.attributes?.find(s=>s.attribute===e);if(r)return{attributeName:r.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:i}}return null}class Rm extends Qe{static defaultProps={...Qe.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,n){super(e,n,Rm.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:r}=n.renderPipeline||{};if(!i||!r)throw new Error("VertexArray");this.attributeInfos=zI(i,r,this.maxVertexAttributes)}setConstantWebGL(e,n){this.device.reportError(new Error("constant attributes not supported"))}}class Cm extends Qe{static defaultProps={...Qe.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Cm.defaultProps)}}class Mm extends Qe{static defaultProps={...Qe.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Mm.defaultProps)}}const YI={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function qI(t){return YI[t]}function KI(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Gc;function fw(t){return(!Gc||Gc.byteLength<t)&&(Gc=new ArrayBuffer(t)),Gc}function ZI(t,e){const n=fw(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function GI(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wu(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":GI(t)}const ux=1024;class QI{layout={};byteLength;constructor(e){let n=0;for(const[r,s]of Object.entries(e)){const l=qI(s),{type:c,components:f}=l;n=KI(n,f);const h=n;n+=f,this.layout[r]={type:c,size:f,offset:h}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,ux)}getData(e){const n=Math.max(this.byteLength,ux),i=fw(n),r={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[s,l]of Object.entries(e)){const c=this.layout[s];if(!c){ue.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:f,size:h,offset:p}=c,m=r[f];if(h===1){if(typeof l!="number"&&typeof l!="boolean"){ue.warn(`Supplied value for single component uniform ${s} is not a number: ${l}`)();continue}m[p]=Number(l)}else{if(!Wu(l)){ue.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${l}`)();continue}m.set(l,p)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function JI(t,e,n=16){if(t!==e)return!1;const i=t,r=e;if(!Wu(i))return!1;if(Wu(r)&&i.length===r.length){for(let s=0;s<i.length;++s)if(r[s]!==i[s])return!1}return!0}function e4(t){return Wu(t)?t.slice():t}class t4{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const n=e?.shaderLayout.bindings?.find(r=>r.type==="uniform"&&r.name===e?.name);if(!n)throw new Error(e?.name);const i=n;for(const r of i.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[n,i]of Object.entries(e))this._setUniform(n,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){JI(this.uniforms[e],n)||(this.uniforms[e]=e4(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class n4{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[n,i]of Object.entries(e)){const r=n,s=new QI(i.uniformTypes||{});this.uniformBufferLayouts.set(r,s);const l=new t4({name:n});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(r,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,i]of Object.entries(e))this.uniformBlocks.get(n)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const n=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(n)}createUniformBuffer(e,n,i){i&&this.setUniforms(i);const r=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:r}),l=this.getUniformBufferData(n);return s.write(l),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const i=this.getUniformBufferByteLength(n),r=e.createBuffer({usage:et.UNIFORM|et.COPY_DST,byteLength:i});this.uniformBuffers.set(n,r)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(n);e||=i}return e&&ue.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),r=!1;if(i&&n?.needsRedraw){r||=n.needsRedraw;const s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(s);const l=this.uniformBlocks.get(e)?.getAllUniforms();ue.log(4,`Writing to uniform buffer ${String(e)}`,s,l)()}return r}}function hw(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function dw(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function i4(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let r=hw(t);if(r==="uint8"&&n&&i===1)return"unorm8-webgl";if(r==="uint8"&&n&&i===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if(r==="uint16"||r==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return i===1?r:`${r}x${i}`}class Ap{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,n){const i=[...e];for(const r of n){const s=i.findIndex(l=>l.name===r.name);s<0?i.push(r):i[s]=r}return i}getBufferIndex(e){const n=this.bufferLayouts.findIndex(i=>i.name===e);return n===-1&&ue.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function r4(t,e){const n=Object.fromEntries(t.attributes.map(r=>[r.name,r.location])),i=e.slice();return i.sort((r,s)=>{const l=r.attributes?r.attributes.map(p=>p.attribute):[r.name],c=s.attributes?s.attributes.map(p=>p.attribute):[s.name],f=Math.min(...l.map(p=>n[p])),h=Math.min(...c.map(p=>n[p]));return f-h}),i}class _n{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class fx{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class or extends _n{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class hr extends _n{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class yg extends _n{constructor(e,n,i){super(e,i),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Gr extends _n{constructor(e,n,i,r){super(e,i),this.format=n,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var ir;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ir||(ir={}));class Qc{constructor(e,n,i,r,s,l,c){this.name=e,this.type=n,this.group=i,this.binding=r,this.attributes=s,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class s4{constructor(e,n){this.name=e,this.type=n}}class o4{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r,this.interpolation=null}}class hx{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r}}class a4{constructor(e,n,i,r){this.name=e,this.type=n,this.attributes=i,this.id=r}}class l4{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i}}class c4{constructor(e,n=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=i}}class u4{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function f4(t){var e=(32768&t)>>15,n=(31744&t)>>10,i=1023&t;return n==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):n==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const pw=new Float32Array(1),h4=new Int32Array(pw.buffer),Dt=new Uint16Array(1);function d4(t){pw[0]=t;const e=h4[0],n=e>>31&1;let i=e>>23&255,r=8388607&e;if(i===255)return Dt[0]=n<<15|31744|(r!==0?512:0),Dt[0];if(i===0){if(r===0)return Dt[0]=n<<15,Dt[0];r|=8388608;let s=113;for(;!(8388608&r);)r<<=1,s--;return i=127-s,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),Dt[0]=n<<15|i<<10|r>>13,Dt[0]):(Dt[0]=n<<15,Dt[0])}return i=i-127+15,i>=31?(Dt[0]=n<<15|31744,Dt[0]):i<=0?i<-10?(Dt[0]=n<<15,Dt[0]):(r=(8388608|r)>>1-i,Dt[0]=n<<15|r>>13,Dt[0]):(r>>=13,Dt[0]=n<<15|i<<10|r,Dt[0])}const Pm=new Uint32Array(1),gw=new Float32Array(Pm.buffer,0,1);function dx(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return Pm[0]=e,gw[0]}function p4(t,e,n,i,r,s,l,c,f){const h=i*(l>>=r)*(s>>=r)+n*l+e*c;switch(f){case"r8unorm":return[Ve(t,h,"8unorm",1)[0]];case"r8snorm":return[Ve(t,h,"8snorm",1)[0]];case"r8uint":return[Ve(t,h,"8uint",1)[0]];case"r8sint":return[Ve(t,h,"8sint",1)[0]];case"rg8unorm":{const p=Ve(t,h,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=Ve(t,h,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=Ve(t,h,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=Ve(t,h,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=Ve(t,h,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=Ve(t,h,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=Ve(t,h,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=Ve(t,h,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=Ve(t,h,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[Ve(t,h,"16uint",1)[0]];case"r16sint":return[Ve(t,h,"16sint",1)[0]];case"r16float":return[Ve(t,h,"16float",1)[0]];case"rg16uint":{const p=Ve(t,h,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=Ve(t,h,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=Ve(t,h,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=Ve(t,h,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=Ve(t,h,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=Ve(t,h,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[Ve(t,h,"32uint",1)[0]];case"r32sint":return[Ve(t,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ve(t,h,"32float",1)[0]];case"rg32uint":{const p=Ve(t,h,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=Ve(t,h,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=Ve(t,h,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=Ve(t,h,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=Ve(t,h,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=Ve(t,h,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(t.buffer,h,1)[0],m=(4192256&p)>>11,y=(4290772992&p)>>22;return[dx(2047&p),dx(m),(function(v){const x=112+(v>>5&31)<<23|(31&v)<<18;return Pm[0]=x,gw[0]})(y),1]}}return null}function Ve(t,e,n,i){const r=[0,0,0,0];for(let s=0;s<i;++s)switch(n){case"8unorm":r[s]=t[e]/255,e++;break;case"8snorm":r[s]=t[e]/255*2-1,e++;break;case"8uint":r[s]=t[e],e++;break;case"8sint":r[s]=t[e]-127,e++;break;case"16uint":r[s]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":r[s]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":r[s]=f4(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":r[s]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":r[s]=new Float32Array(t.buffer,e,1)[0],e+=4}return r}function $e(t,e,n,i,r){for(let s=0;s<i;++s)switch(n){case"8unorm":t[e]=255*r[s],e++;break;case"8snorm":t[e]=.5*(r[s]+1)*255,e++;break;case"8uint":t[e]=r[s],e++;break;case"8sint":t[e]=r[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=r[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=r[s],e+=2;break;case"16float":{const l=d4(r[s]);new Uint16Array(t.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=r[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=r[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=r[s],e+=4}return r}const Ep={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Tn{constructor(){this.id=Tn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(Xu.instance);for(const i of e)i instanceof Array?this.searchBlock(i,n):i.search(n);n(Yu.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Tn._id=0;class Xu extends Tn{}Xu.instance=new Xu;class Yu extends Tn{}Yu.instance=new Yu;const mw=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class rt extends Tn{constructor(){super()}}class fl extends rt{constructor(e,n,i,r,s,l){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=i,this.body=r,this.startLine=s,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class g4 extends rt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class _w extends rt{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class vg extends rt{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class yw extends rt{constructor(e,n,i,r){super(),this.init=e,this.condition=n,this.increment=i,this.body=r}get astNodeType(){return"for"}search(e){var n,i,r;(n=this.init)===null||n===void 0||n.search(e),(i=this.condition)===null||i===void 0||i.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class Ti extends rt{constructor(e,n,i,r,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Om extends rt{constructor(e,n,i){super(),this.attributes=null,this.name=e,this.type=n,this.value=i}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class il extends rt{constructor(e,n,i,r,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class xu extends rt{constructor(e,n,i,r,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var so,$a,q,j;(t=>{t.increment="++",t.decrement="--"})(so||(so={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(so||(so={}));class vw extends rt{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})($a||($a={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})($a||($a={}));class bw extends rt{constructor(e,n,i){super(),this.operator=e,this.variable=n,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Im extends rt{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return mw.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class xw extends rt{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}search(e){var n;this.searchBlock(this.body,e),(n=this.continuing)===null||n===void 0||n.search(e)}}class Tw extends rt{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class ww extends rt{constructor(e,n,i,r){super(),this.condition=e,this.body=n,this.elseif=i,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Sw extends rt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class m4 extends rt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class _4 extends rt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Aw extends rt{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class Nm extends rt{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class y4 extends rt{constructor(){super()}get astNodeType(){return"discard"}}class Ew extends rt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let Rw=class extends rt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}};class se extends rt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let i=1;i<e.length;++i){const r=se._priority.get(n.name);se._priority.get(e[i].name)<r&&(n=e[i])}return n.name==="x32"?se.i32:n}getTypeName(){return this.name}}se.x32=new se("x32"),se.f32=new se("f32"),se.i32=new se("i32"),se.u32=new se("u32"),se.f16=new se("f16"),se.bool=new se("bool"),se.void=new se("void"),se._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class px extends se{constructor(e){super(e)}}class bi extends se{constructor(e,n,i,r){super(e),this.members=n,this.startLine=i,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class W extends se{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}W.vec2f=new W("vec2",se.f32,null),W.vec3f=new W("vec3",se.f32,null),W.vec4f=new W("vec4",se.f32,null),W.vec2i=new W("vec2",se.i32,null),W.vec3i=new W("vec3",se.i32,null),W.vec4i=new W("vec4",se.i32,null),W.vec2u=new W("vec2",se.u32,null),W.vec3u=new W("vec3",se.u32,null),W.vec4u=new W("vec4",se.u32,null),W.vec2h=new W("vec2",se.f16,null),W.vec3h=new W("vec3",se.f16,null),W.vec4h=new W("vec4",se.f16,null),W.vec2b=new W("vec2",se.bool,null),W.vec3b=new W("vec3",se.bool,null),W.vec4b=new W("vec4",se.bool,null),W.mat2x2f=new W("mat2x2",se.f32,null),W.mat2x3f=new W("mat2x3",se.f32,null),W.mat2x4f=new W("mat2x4",se.f32,null),W.mat3x2f=new W("mat3x2",se.f32,null),W.mat3x3f=new W("mat3x3",se.f32,null),W.mat3x4f=new W("mat3x4",se.f32,null),W.mat4x2f=new W("mat4x2",se.f32,null),W.mat4x3f=new W("mat4x3",se.f32,null),W.mat4x4f=new W("mat4x4",se.f32,null),W.mat2x2h=new W("mat2x2",se.f16,null),W.mat2x3h=new W("mat2x3",se.f16,null),W.mat2x4h=new W("mat2x4",se.f16,null),W.mat3x2h=new W("mat3x2",se.f16,null),W.mat3x3h=new W("mat3x3",se.f16,null),W.mat3x4h=new W("mat3x4",se.f16,null),W.mat4x2h=new W("mat4x2",se.f16,null),W.mat4x3h=new W("mat4x3",se.f16,null),W.mat4x4h=new W("mat4x4",se.f16,null),W.mat2x2i=new W("mat2x2",se.i32,null),W.mat2x3i=new W("mat2x3",se.i32,null),W.mat2x4i=new W("mat2x4",se.i32,null),W.mat3x2i=new W("mat3x2",se.i32,null),W.mat3x3i=new W("mat3x3",se.i32,null),W.mat3x4i=new W("mat3x4",se.i32,null),W.mat4x2i=new W("mat4x2",se.i32,null),W.mat4x3i=new W("mat4x3",se.i32,null),W.mat4x4i=new W("mat4x4",se.i32,null),W.mat2x2u=new W("mat2x2",se.u32,null),W.mat2x3u=new W("mat2x3",se.u32,null),W.mat2x4u=new W("mat2x4",se.u32,null),W.mat3x2u=new W("mat3x2",se.u32,null),W.mat3x3u=new W("mat3x3",se.u32,null),W.mat3x4u=new W("mat3x4",se.u32,null),W.mat4x2u=new W("mat4x2",se.u32,null),W.mat4x3u=new W("mat4x3",se.u32,null),W.mat4x4u=new W("mat4x4",se.u32,null);class Tu extends se{constructor(e,n,i,r){super(e),this.storage=n,this.type=i,this.access=r}get astNodeType(){return"pointer"}}class rl extends se{constructor(e,n,i,r){super(e),this.attributes=n,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Wa extends se{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"sampler"}}class Dn extends Tn{constructor(){super(),this.postfix=null}}class Qr extends Dn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Xn extends Dn{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class km extends Dn{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return mw.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class sn extends Dn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class Cw extends Dn{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class bt extends Dn{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof V}get isVector(){return this.value instanceof O||this.value instanceof Se}get scalarValue(){return this.value instanceof V?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof O||this.value instanceof Se?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Mw extends Dn{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class yo extends Dn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Pw extends Dn{constructor(){super()}}class mt extends Pw{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Rn extends Pw{constructor(e,n,i){super(),this.operator=e,this.left=n,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?se.f32:e.name==="u32"||n.name==="u32"?se.u32:se.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Ow extends Tn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class wu extends Dn{constructor(){super()}get astNodeType(){return"default"}}class Iw extends Ow{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Nw extends Ow{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class gx extends Tn{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"argument"}}class v4 extends Tn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class mx extends Tn{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"member"}}class kw extends Tn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class xn{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=xn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,i,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}xn._id=0;class bg extends xn{constructor(){super(new _n("void",null),null)}toString(){return"void"}}bg.void=new bg;class Gs extends xn{constructor(e){super(new yg("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,i,r){this.reference.setDataValue(e,n,i,r)}getSubData(e,n,i){return n?this.reference.getSubData(e,n,i):this}toString(){return`&${this.reference.toString()}`}}class V extends xn{constructor(e,n,i=null){super(n,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new V(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new V(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new V(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,i,r){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(n instanceof V))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,i){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function b4(t,e,n){const i=e.length;return i===2?n==="f32"?new O(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new O(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new O(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new O(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):i===3?n==="f32"?new O(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new O(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new O(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new O(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):i===4?n==="f32"?new O(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new O(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new O(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new O(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class O extends xn{constructor(e,n,i=null){if(super(n,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(e):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(e):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(e):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(e):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(e):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new O(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new O(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new O(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,i,r){i instanceof Qr?console.error("TODO: Set vector postfix"):n instanceof O?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,i){if(n===null)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof Gr)r=this.typeInfo.format||r;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?r=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?r=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?r=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?r=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof yo){const l=n.index;let c=-1;if(l instanceof bt){if(!(l.value instanceof V))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const f=e.evalExpression(l,i);if(!(f instanceof V))return console.error("GetSubData: Unknown index type",l),null;c=f.value}if(c<0||c>=s.data.length)return console.error("GetSubData: Index out of range",c),null;if(s.data instanceof Float32Array){const f=new Float32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new V(f,r)}if(s.data instanceof Int32Array){const f=new Int32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new V(f,r)}if(s.data instanceof Uint32Array){const f=new Uint32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new V(f,r)}throw"GetSubData: Invalid data type"}if(!(n instanceof Qr))return console.error("GetSubData: Unknown postfix",n),null;{const l=n.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new V(h,r,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new V(h,r,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new V(h,r,this)}}const c=[];for(const f of l)f==="x"||f==="r"?c.push(this.data[0]):f==="y"||f==="g"?c.push(this.data[1]):f==="z"||f==="b"?c.push(this.data[2]):f==="w"||f==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);s=b4(e,c,r.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Se extends xn{constructor(e,n,i=null){super(n,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Se(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,i,r){i instanceof Qr?console.error("TODO: Set matrix postfix"):n instanceof Se?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,i){if(n===null)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Gr)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(n instanceof yo){const s=n.index;let l=-1;if(s instanceof bt){if(!(s.value instanceof V))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;l=s.value.value}else{const h=e.evalExpression(s,i);if(!(h instanceof V))return console.error("GetDataValue: Unknown index type",s),null;l=h.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=r.endsWith("h")?"h":"f";let f;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${c}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${c}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;f=new O(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${c}`))}return n.postfix?f.getSubData(e,n.postfix,i):f}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class ut extends xn{constructor(e,n,i=0,r=null){super(n,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new ut(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,i,r){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,l=this.typeInfo;for(;i;){if(i instanceof yo)if(l instanceof hr){const c=i.index;if(c instanceof bt){if(!(c.value instanceof V))return void console.error(`SetDataValue: Invalid index type ${c.value}`);s+=c.value.value*l.stride}else{const f=e.evalExpression(c,r);if(!(f instanceof V))return void console.error("SetDataValue: Unknown index type",c);s+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof Qr))return void console.error("SetDataValue: Unknown postfix type",i);{const c=i.value;if(l instanceof or){let f=!1;for(const h of l.members)if(h.name===c){s+=h.offset,l=h.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof _n){const f=l.getTypeName();let h=0;if(c==="x"||c==="r")h=0;else if(c==="y"||c==="g")h=1;else if(c==="z"||c==="b")h=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);h=3}if(!(n instanceof V))return void console.error("SetDataValue: Invalid value",n);const p=n.value;return f==="vec2f"?void(new Float32Array(this.buffer,s,2)[h]=p):f==="vec3f"?void(new Float32Array(this.buffer,s,3)[h]=p):f==="vec4f"?void(new Float32Array(this.buffer,s,4)[h]=p):f==="vec2i"?void(new Int32Array(this.buffer,s,2)[h]=p):f==="vec3i"?void(new Int32Array(this.buffer,s,3)[h]=p):f==="vec4i"?void(new Int32Array(this.buffer,s,4)[h]=p):f==="vec2u"?void(new Uint32Array(this.buffer,s,2)[h]=p):f==="vec3u"?void(new Uint32Array(this.buffer,s,3)[h]=p):f==="vec4u"?void(new Uint32Array(this.buffer,s,4)[h]=p):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}i=i.postfix}this.setData(e,n,l,s,r)}setData(e,n,i,r,s){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const c=new Float32Array(this.buffer,r,2);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1]):(c[0]=n[0],c[1]=n[1]))}if(l==="vec3f"||l==="vec3h"){const c=new Float32Array(this.buffer,r,3);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2]):(c[0]=n[0],c[1]=n[1],c[2]=n[2]))}if(l==="vec4f"||l==="vec4h"){const c=new Float32Array(this.buffer,r,4);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]))}if(l==="vec2i"){const c=new Int32Array(this.buffer,r,2);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1]):(c[0]=n[0],c[1]=n[1]))}if(l==="vec3i"){const c=new Int32Array(this.buffer,r,3);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2]):(c[0]=n[0],c[1]=n[1],c[2]=n[2]))}if(l==="vec4i"){const c=new Int32Array(this.buffer,r,4);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]))}if(l==="vec2u"){const c=new Uint32Array(this.buffer,r,2);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1]):(c[0]=n[0],c[1]=n[1]))}if(l==="vec3u"){const c=new Uint32Array(this.buffer,r,3);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2]):(c[0]=n[0],c[1]=n[1],c[2]=n[2]))}if(l==="vec4u"){const c=new Uint32Array(this.buffer,r,4);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]))}if(l==="vec2b"){const c=new Uint32Array(this.buffer,r,2);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1]):(c[0]=n[0],c[1]=n[1]))}if(l==="vec3b"){const c=new Uint32Array(this.buffer,r,3);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2]):(c[0]=n[0],c[1]=n[1],c[2]=n[2]))}if(l==="vec4b"){const c=new Uint32Array(this.buffer,r,4);return void(n instanceof O?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const c=new Float32Array(this.buffer,r,4);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const c=new Float32Array(this.buffer,r,6);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const c=new Float32Array(this.buffer,r,8);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const c=new Float32Array(this.buffer,r,6);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const c=new Float32Array(this.buffer,r,9);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7],c[8]=n.data[8]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const c=new Float32Array(this.buffer,r,12);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7],c[8]=n.data[8],c[9]=n.data[9],c[10]=n.data[10],c[11]=n.data[11]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const c=new Float32Array(this.buffer,r,8);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const c=new Float32Array(this.buffer,r,12);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7],c[8]=n.data[8],c[9]=n.data[9],c[10]=n.data[10],c[11]=n.data[11]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const c=new Float32Array(this.buffer,r,16);return void(n instanceof Se?(c[0]=n.data[0],c[1]=n.data[1],c[2]=n.data[2],c[3]=n.data[3],c[4]=n.data[4],c[5]=n.data[5],c[6]=n.data[6],c[7]=n.data[7],c[8]=n.data[8],c[9]=n.data[9],c[10]=n.data[10],c[11]=n.data[11],c[12]=n.data[12],c[13]=n.data[13],c[14]=n.data[14],c[15]=n.data[15]):(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]))}if(n instanceof ut){if(i===n.typeInfo)return void new Uint8Array(this.buffer,r,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",l,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else n instanceof V&&(new Int32Array(this.buffer,r,1)[0]=n.value);else n instanceof V&&(new Uint32Array(this.buffer,r,1)[0]=n.value);else n instanceof V&&(new Int32Array(this.buffer,r,1)[0]=n.value);else n instanceof V&&(new Float32Array(this.buffer,r,1)[0]=n.value)}getSubData(e,n,i){var r,s,l;if(n===null)return this;let c=this.offset,f=this.typeInfo;for(;n;){if(n instanceof yo){const p=n.index,m=p instanceof Dn?e.evalExpression(p,i):p;let y=0;if(m instanceof V?y=m.value:typeof m=="number"?y=m:console.error("GetDataValue: Invalid index type",p),f instanceof hr)c+=y*f.stride,f=f.format;else{const v=f.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(c+=16*y,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(n instanceof Qr))return console.error("GetDataValue: Unknown postfix type",n),null;{const p=n.value;if(f instanceof or){let m=!1;for(const y of f.members)if(y.name===p){c+=y.offset,f=y.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${p} not found`),null}else if(f instanceof _n){const m=f.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(p.length>0&&p.length<5){let y="f";const v=[];for(let x=0;x<p.length;++x){const T=p[x].toLowerCase();let E=0;if(T==="x"||T==="r")E=0;else if(T==="y"||T==="g")E=1;else if(T==="z"||T==="b")E=2;else{if(T!=="w"&&T!=="a")return console.error(`Unknown member ${p}`),null;E=3}if(p.length===1){if(m.endsWith("f"))return this.buffer.byteLength<c+4*E+4?(console.log("Insufficient buffer data"),null):new V(new Float32Array(this.buffer,c+4*E,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new V(new Float32Array(this.buffer,c+4*E,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new V(new Int32Array(this.buffer,c+4*E,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new V(new Int32Array(this.buffer,c+4*E,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new V(new Uint32Array(this.buffer,c+4*E,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")v.push(new Float32Array(this.buffer,c,2)[E]);else if(m==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const C=new Float32Array(this.buffer,c,3);v.push(C[E])}else if(m==="vec4f")v.push(new Float32Array(this.buffer,c,4)[E]);else if(m==="vec2i")y="i",v.push(new Int32Array(this.buffer,c,2)[E]);else if(m==="vec3i")y="i",v.push(new Int32Array(this.buffer,c,3)[E]);else if(m==="vec4i")y="i",v.push(new Int32Array(this.buffer,c,4)[E]);else if(m==="vec2u"){y="u";const C=new Uint32Array(this.buffer,c,2);v.push(C[E])}else m==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,c,3)[E])):m==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,c,4)[E]))}return v.length===2?f=e.getTypeInfo(`vec2${y}`):v.length===3?f=e.getTypeInfo(`vec3${y}`):v.length===4?f=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new O(v,f,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}n=n.postfix}const h=f.getTypeName();return h==="f32"?new V(new Float32Array(this.buffer,c,1),f,this):h==="i32"?new V(new Int32Array(this.buffer,c,1),f,this):h==="u32"?new V(new Uint32Array(this.buffer,c,1),f,this):h==="vec2f"?new O(new Float32Array(this.buffer,c,2),f,this):h==="vec3f"?new O(new Float32Array(this.buffer,c,3),f,this):h==="vec4f"?new O(new Float32Array(this.buffer,c,4),f,this):h==="vec2i"?new O(new Int32Array(this.buffer,c,2),f,this):h==="vec3i"?new O(new Int32Array(this.buffer,c,3),f,this):h==="vec4i"?new O(new Int32Array(this.buffer,c,4),f,this):h==="vec2u"?new O(new Uint32Array(this.buffer,c,2),f,this):h==="vec3u"?new O(new Uint32Array(this.buffer,c,3),f,this):h==="vec4u"?new O(new Uint32Array(this.buffer,c,4),f,this):f instanceof Gr&&f.name==="atomic"?((r=f.format)===null||r===void 0?void 0:r.name)==="u32"?new V(new Uint32Array(this.buffer,c,1)[0],f.format,this):((s=f.format)===null||s===void 0?void 0:s.name)==="i32"?new V(new Int32Array(this.buffer,c,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new ut(this.buffer,f,c,this)}toString(){let e="";if(this.typeInfo instanceof hr)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let i=1;i<n.length;++i)e+=`, ${n[i]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let i=1;i<n.length/2;++i)e+=`, [${n[2*i]}, ${n[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let i=4;i<n.length;i+=4)e+=`, [${n[i]}, ${n[i+1]}, ${n[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let i=4;i<n.length;i+=4)e+=`, [${n[i]}, ${n[i+1]}, ${n[i+2]}, ${n[i+3]}]`}else e="[...]";else this.typeInfo instanceof or?e+="{...}":e="[...]";return e}}class xi extends xn{constructor(e,n,i,r){super(n,null),this.data=e,this.descriptor=i,this.view=r}clone(){return new xi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.width)!==null&&n!==void 0?n:0}get height(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(n=i.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<n.length;++i)n[i]=Math.max(1,n[i]>>e);return n}get texelByteSize(){const e=this.format,n=Ep[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Ep[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Ep[e],i=this.width;if(!e||i<=0||!n)return-1;const r=this.height,s=this.depthOrArrayLayers,l=this.dimension;return i/n.blockWidth*(l==="1d"?1:r/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,i=0,r=0){const s=this.texelByteSize,l=this.bytesPerRow,c=this.height,f=this.data[r];return p4(new Uint8Array(f),e,n,i,r,c,l,s,this.format)}setPixel(e,n,i,r,s){const l=this.texelByteSize,c=this.bytesPerRow,f=this.height,h=this.data[r];(function(p,m,y,v,x,T,E,C,P,M){const I=v*(E>>=x)*(T>>=x)+y*E+m*C;switch(P){case"r8unorm":return void $e(p,I,"8unorm",1,M);case"r8snorm":return void $e(p,I,"8snorm",1,M);case"r8uint":return void $e(p,I,"8uint",1,M);case"r8sint":return void $e(p,I,"8sint",1,M);case"rg8unorm":return void $e(p,I,"8unorm",2,M);case"rg8snorm":return void $e(p,I,"8snorm",2,M);case"rg8uint":return void $e(p,I,"8uint",2,M);case"rg8sint":return void $e(p,I,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void $e(p,I,"8unorm",4,M);case"rgba8snorm":return void $e(p,I,"8snorm",4,M);case"rgba8uint":return void $e(p,I,"8uint",4,M);case"rgba8sint":return void $e(p,I,"8sint",4,M);case"r16uint":return void $e(p,I,"16uint",1,M);case"r16sint":return void $e(p,I,"16sint",1,M);case"r16float":return void $e(p,I,"16float",1,M);case"rg16uint":return void $e(p,I,"16uint",2,M);case"rg16sint":return void $e(p,I,"16sint",2,M);case"rg16float":return void $e(p,I,"16float",2,M);case"rgba16uint":return void $e(p,I,"16uint",4,M);case"rgba16sint":return void $e(p,I,"16sint",4,M);case"rgba16float":return void $e(p,I,"16float",4,M);case"r32uint":return void $e(p,I,"32uint",1,M);case"r32sint":return void $e(p,I,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void $e(p,I,"32float",1,M);case"rg32uint":return void $e(p,I,"32uint",2,M);case"rg32sint":return void $e(p,I,"32sint",2,M);case"rg32float":return void $e(p,I,"32float",2,M);case"rgba32uint":return void $e(p,I,"32uint",4,M);case"rgba32sint":return void $e(p,I,"32sint",4,M);case"rgba32float":return void $e(p,I,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,n,i,r,f,c,l,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(j||(j={}));class H{constructor(e,n,i){this.name=e,this.type=n,this.rule=i}toString(){return this.name}}class R{}q=R,R.none=new H("",j.reserved,""),R.eof=new H("EOF",j.token,""),R.reserved={asm:new H("asm",j.reserved,"asm"),bf16:new H("bf16",j.reserved,"bf16"),do:new H("do",j.reserved,"do"),enum:new H("enum",j.reserved,"enum"),f16:new H("f16",j.reserved,"f16"),f64:new H("f64",j.reserved,"f64"),handle:new H("handle",j.reserved,"handle"),i8:new H("i8",j.reserved,"i8"),i16:new H("i16",j.reserved,"i16"),i64:new H("i64",j.reserved,"i64"),mat:new H("mat",j.reserved,"mat"),premerge:new H("premerge",j.reserved,"premerge"),regardless:new H("regardless",j.reserved,"regardless"),typedef:new H("typedef",j.reserved,"typedef"),u8:new H("u8",j.reserved,"u8"),u16:new H("u16",j.reserved,"u16"),u64:new H("u64",j.reserved,"u64"),unless:new H("unless",j.reserved,"unless"),using:new H("using",j.reserved,"using"),vec:new H("vec",j.reserved,"vec"),void:new H("void",j.reserved,"void")},R.keywords={array:new H("array",j.keyword,"array"),atomic:new H("atomic",j.keyword,"atomic"),bool:new H("bool",j.keyword,"bool"),f32:new H("f32",j.keyword,"f32"),i32:new H("i32",j.keyword,"i32"),mat2x2:new H("mat2x2",j.keyword,"mat2x2"),mat2x3:new H("mat2x3",j.keyword,"mat2x3"),mat2x4:new H("mat2x4",j.keyword,"mat2x4"),mat3x2:new H("mat3x2",j.keyword,"mat3x2"),mat3x3:new H("mat3x3",j.keyword,"mat3x3"),mat3x4:new H("mat3x4",j.keyword,"mat3x4"),mat4x2:new H("mat4x2",j.keyword,"mat4x2"),mat4x3:new H("mat4x3",j.keyword,"mat4x3"),mat4x4:new H("mat4x4",j.keyword,"mat4x4"),ptr:new H("ptr",j.keyword,"ptr"),sampler:new H("sampler",j.keyword,"sampler"),sampler_comparison:new H("sampler_comparison",j.keyword,"sampler_comparison"),struct:new H("struct",j.keyword,"struct"),texture_1d:new H("texture_1d",j.keyword,"texture_1d"),texture_2d:new H("texture_2d",j.keyword,"texture_2d"),texture_2d_array:new H("texture_2d_array",j.keyword,"texture_2d_array"),texture_3d:new H("texture_3d",j.keyword,"texture_3d"),texture_cube:new H("texture_cube",j.keyword,"texture_cube"),texture_cube_array:new H("texture_cube_array",j.keyword,"texture_cube_array"),texture_multisampled_2d:new H("texture_multisampled_2d",j.keyword,"texture_multisampled_2d"),texture_storage_1d:new H("texture_storage_1d",j.keyword,"texture_storage_1d"),texture_storage_2d:new H("texture_storage_2d",j.keyword,"texture_storage_2d"),texture_storage_2d_array:new H("texture_storage_2d_array",j.keyword,"texture_storage_2d_array"),texture_storage_3d:new H("texture_storage_3d",j.keyword,"texture_storage_3d"),texture_depth_2d:new H("texture_depth_2d",j.keyword,"texture_depth_2d"),texture_depth_2d_array:new H("texture_depth_2d_array",j.keyword,"texture_depth_2d_array"),texture_depth_cube:new H("texture_depth_cube",j.keyword,"texture_depth_cube"),texture_depth_cube_array:new H("texture_depth_cube_array",j.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new H("texture_depth_multisampled_2d",j.keyword,"texture_depth_multisampled_2d"),texture_external:new H("texture_external",j.keyword,"texture_external"),u32:new H("u32",j.keyword,"u32"),vec2:new H("vec2",j.keyword,"vec2"),vec3:new H("vec3",j.keyword,"vec3"),vec4:new H("vec4",j.keyword,"vec4"),bitcast:new H("bitcast",j.keyword,"bitcast"),block:new H("block",j.keyword,"block"),break:new H("break",j.keyword,"break"),case:new H("case",j.keyword,"case"),continue:new H("continue",j.keyword,"continue"),continuing:new H("continuing",j.keyword,"continuing"),default:new H("default",j.keyword,"default"),diagnostic:new H("diagnostic",j.keyword,"diagnostic"),discard:new H("discard",j.keyword,"discard"),else:new H("else",j.keyword,"else"),enable:new H("enable",j.keyword,"enable"),fallthrough:new H("fallthrough",j.keyword,"fallthrough"),false:new H("false",j.keyword,"false"),fn:new H("fn",j.keyword,"fn"),for:new H("for",j.keyword,"for"),function:new H("function",j.keyword,"function"),if:new H("if",j.keyword,"if"),let:new H("let",j.keyword,"let"),const:new H("const",j.keyword,"const"),loop:new H("loop",j.keyword,"loop"),while:new H("while",j.keyword,"while"),private:new H("private",j.keyword,"private"),read:new H("read",j.keyword,"read"),read_write:new H("read_write",j.keyword,"read_write"),return:new H("return",j.keyword,"return"),requires:new H("requires",j.keyword,"requires"),storage:new H("storage",j.keyword,"storage"),switch:new H("switch",j.keyword,"switch"),true:new H("true",j.keyword,"true"),alias:new H("alias",j.keyword,"alias"),type:new H("type",j.keyword,"type"),uniform:new H("uniform",j.keyword,"uniform"),var:new H("var",j.keyword,"var"),override:new H("override",j.keyword,"override"),workgroup:new H("workgroup",j.keyword,"workgroup"),write:new H("write",j.keyword,"write"),r8unorm:new H("r8unorm",j.keyword,"r8unorm"),r8snorm:new H("r8snorm",j.keyword,"r8snorm"),r8uint:new H("r8uint",j.keyword,"r8uint"),r8sint:new H("r8sint",j.keyword,"r8sint"),r16uint:new H("r16uint",j.keyword,"r16uint"),r16sint:new H("r16sint",j.keyword,"r16sint"),r16float:new H("r16float",j.keyword,"r16float"),rg8unorm:new H("rg8unorm",j.keyword,"rg8unorm"),rg8snorm:new H("rg8snorm",j.keyword,"rg8snorm"),rg8uint:new H("rg8uint",j.keyword,"rg8uint"),rg8sint:new H("rg8sint",j.keyword,"rg8sint"),r32uint:new H("r32uint",j.keyword,"r32uint"),r32sint:new H("r32sint",j.keyword,"r32sint"),r32float:new H("r32float",j.keyword,"r32float"),rg16uint:new H("rg16uint",j.keyword,"rg16uint"),rg16sint:new H("rg16sint",j.keyword,"rg16sint"),rg16float:new H("rg16float",j.keyword,"rg16float"),rgba8unorm:new H("rgba8unorm",j.keyword,"rgba8unorm"),rgba8unorm_srgb:new H("rgba8unorm_srgb",j.keyword,"rgba8unorm_srgb"),rgba8snorm:new H("rgba8snorm",j.keyword,"rgba8snorm"),rgba8uint:new H("rgba8uint",j.keyword,"rgba8uint"),rgba8sint:new H("rgba8sint",j.keyword,"rgba8sint"),bgra8unorm:new H("bgra8unorm",j.keyword,"bgra8unorm"),bgra8unorm_srgb:new H("bgra8unorm_srgb",j.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new H("rgb10a2unorm",j.keyword,"rgb10a2unorm"),rg11b10float:new H("rg11b10float",j.keyword,"rg11b10float"),rg32uint:new H("rg32uint",j.keyword,"rg32uint"),rg32sint:new H("rg32sint",j.keyword,"rg32sint"),rg32float:new H("rg32float",j.keyword,"rg32float"),rgba16uint:new H("rgba16uint",j.keyword,"rgba16uint"),rgba16sint:new H("rgba16sint",j.keyword,"rgba16sint"),rgba16float:new H("rgba16float",j.keyword,"rgba16float"),rgba32uint:new H("rgba32uint",j.keyword,"rgba32uint"),rgba32sint:new H("rgba32sint",j.keyword,"rgba32sint"),rgba32float:new H("rgba32float",j.keyword,"rgba32float"),static_assert:new H("static_assert",j.keyword,"static_assert")},R.tokens={decimal_float_literal:new H("decimal_float_literal",j.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new H("hex_float_literal",j.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new H("int_literal",j.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new H("uint_literal",j.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new H("name",j.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new H("ident",j.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new H("and",j.token,"&"),and_and:new H("and_and",j.token,"&&"),arrow:new H("arrow ",j.token,"->"),attr:new H("attr",j.token,"@"),forward_slash:new H("forward_slash",j.token,"/"),bang:new H("bang",j.token,"!"),bracket_left:new H("bracket_left",j.token,"["),bracket_right:new H("bracket_right",j.token,"]"),brace_left:new H("brace_left",j.token,"{"),brace_right:new H("brace_right",j.token,"}"),colon:new H("colon",j.token,":"),comma:new H("comma",j.token,","),equal:new H("equal",j.token,"="),equal_equal:new H("equal_equal",j.token,"=="),not_equal:new H("not_equal",j.token,"!="),greater_than:new H("greater_than",j.token,">"),greater_than_equal:new H("greater_than_equal",j.token,">="),shift_right:new H("shift_right",j.token,">>"),less_than:new H("less_than",j.token,"<"),less_than_equal:new H("less_than_equal",j.token,"<="),shift_left:new H("shift_left",j.token,"<<"),modulo:new H("modulo",j.token,"%"),minus:new H("minus",j.token,"-"),minus_minus:new H("minus_minus",j.token,"--"),period:new H("period",j.token,"."),plus:new H("plus",j.token,"+"),plus_plus:new H("plus_plus",j.token,"++"),or:new H("or",j.token,"|"),or_or:new H("or_or",j.token,"||"),paren_left:new H("paren_left",j.token,"("),paren_right:new H("paren_right",j.token,")"),semicolon:new H("semicolon",j.token,";"),star:new H("star",j.token,"*"),tilde:new H("tilde",j.token,"~"),underscore:new H("underscore",j.token,"_"),xor:new H("xor",j.token,"^"),plus_equal:new H("plus_equal",j.token,"+="),minus_equal:new H("minus_equal",j.token,"-="),times_equal:new H("times_equal",j.token,"*="),division_equal:new H("division_equal",j.token,"/="),modulo_equal:new H("modulo_equal",j.token,"%="),and_equal:new H("and_equal",j.token,"&="),or_equal:new H("or_equal",j.token,"|="),xor_equal:new H("xor_equal",j.token,"^="),shift_right_equal:new H("shift_right_equal",j.token,">>="),shift_left_equal:new H("shift_left_equal",j.token,"<<=")},R.simpleTokens={"@":q.tokens.attr,"{":q.tokens.brace_left,"}":q.tokens.brace_right,":":q.tokens.colon,",":q.tokens.comma,"(":q.tokens.paren_left,")":q.tokens.paren_right,";":q.tokens.semicolon},R.literalTokens={"&":q.tokens.and,"&&":q.tokens.and_and,"->":q.tokens.arrow,"/":q.tokens.forward_slash,"!":q.tokens.bang,"[":q.tokens.bracket_left,"]":q.tokens.bracket_right,"=":q.tokens.equal,"==":q.tokens.equal_equal,"!=":q.tokens.not_equal,">":q.tokens.greater_than,">=":q.tokens.greater_than_equal,">>":q.tokens.shift_right,"<":q.tokens.less_than,"<=":q.tokens.less_than_equal,"<<":q.tokens.shift_left,"%":q.tokens.modulo,"-":q.tokens.minus,"--":q.tokens.minus_minus,".":q.tokens.period,"+":q.tokens.plus,"++":q.tokens.plus_plus,"|":q.tokens.or,"||":q.tokens.or_or,"*":q.tokens.star,"~":q.tokens.tilde,_:q.tokens.underscore,"^":q.tokens.xor,"+=":q.tokens.plus_equal,"-=":q.tokens.minus_equal,"*=":q.tokens.times_equal,"/=":q.tokens.division_equal,"%=":q.tokens.modulo_equal,"&=":q.tokens.and_equal,"|=":q.tokens.or_equal,"^=":q.tokens.xor_equal,">>=":q.tokens.shift_right_equal,"<<=":q.tokens.shift_left_equal},R.regexTokens={decimal_float_literal:q.tokens.decimal_float_literal,hex_float_literal:q.tokens.hex_float_literal,int_literal:q.tokens.int_literal,uint_literal:q.tokens.uint_literal,ident:q.tokens.ident},R.storage_class=[q.keywords.function,q.keywords.private,q.keywords.workgroup,q.keywords.uniform,q.keywords.storage],R.access_mode=[q.keywords.read,q.keywords.write,q.keywords.read_write],R.sampler_type=[q.keywords.sampler,q.keywords.sampler_comparison],R.sampled_texture_type=[q.keywords.texture_1d,q.keywords.texture_2d,q.keywords.texture_2d_array,q.keywords.texture_3d,q.keywords.texture_cube,q.keywords.texture_cube_array],R.multisampled_texture_type=[q.keywords.texture_multisampled_2d],R.storage_texture_type=[q.keywords.texture_storage_1d,q.keywords.texture_storage_2d,q.keywords.texture_storage_2d_array,q.keywords.texture_storage_3d],R.depth_texture_type=[q.keywords.texture_depth_2d,q.keywords.texture_depth_2d_array,q.keywords.texture_depth_cube,q.keywords.texture_depth_cube_array,q.keywords.texture_depth_multisampled_2d],R.texture_external_type=[q.keywords.texture_external],R.any_texture_type=[...q.sampled_texture_type,...q.multisampled_texture_type,...q.storage_texture_type,...q.depth_texture_type,...q.texture_external_type],R.texel_format=[q.keywords.r8unorm,q.keywords.r8snorm,q.keywords.r8uint,q.keywords.r8sint,q.keywords.r16uint,q.keywords.r16sint,q.keywords.r16float,q.keywords.rg8unorm,q.keywords.rg8snorm,q.keywords.rg8uint,q.keywords.rg8sint,q.keywords.r32uint,q.keywords.r32sint,q.keywords.r32float,q.keywords.rg16uint,q.keywords.rg16sint,q.keywords.rg16float,q.keywords.rgba8unorm,q.keywords.rgba8unorm_srgb,q.keywords.rgba8snorm,q.keywords.rgba8uint,q.keywords.rgba8sint,q.keywords.bgra8unorm,q.keywords.bgra8unorm_srgb,q.keywords.rgb10a2unorm,q.keywords.rg11b10float,q.keywords.rg32uint,q.keywords.rg32sint,q.keywords.rg32float,q.keywords.rgba16uint,q.keywords.rgba16sint,q.keywords.rgba16float,q.keywords.rgba32uint,q.keywords.rgba32sint,q.keywords.rgba32float],R.const_literal=[q.tokens.int_literal,q.tokens.uint_literal,q.tokens.decimal_float_literal,q.tokens.hex_float_literal,q.keywords.true,q.keywords.false],R.literal_or_ident=[q.tokens.ident,q.tokens.int_literal,q.tokens.uint_literal,q.tokens.decimal_float_literal,q.tokens.hex_float_literal,q.tokens.name],R.element_count_expression=[q.tokens.int_literal,q.tokens.uint_literal,q.tokens.ident],R.template_types=[q.keywords.vec2,q.keywords.vec3,q.keywords.vec4,q.keywords.mat2x2,q.keywords.mat2x3,q.keywords.mat2x4,q.keywords.mat3x2,q.keywords.mat3x3,q.keywords.mat3x4,q.keywords.mat4x2,q.keywords.mat4x3,q.keywords.mat4x4,q.keywords.atomic,q.keywords.bitcast,...q.any_texture_type],R.attribute_name=[q.tokens.ident,q.keywords.block,q.keywords.diagnostic],R.assignment_operators=[q.tokens.equal,q.tokens.plus_equal,q.tokens.minus_equal,q.tokens.times_equal,q.tokens.division_equal,q.tokens.modulo_equal,q.tokens.and_equal,q.tokens.or_equal,q.tokens.xor_equal,q.tokens.shift_right_equal,q.tokens.shift_left_equal],R.increment_operators=[q.tokens.plus_plus,q.tokens.minus_minus];class _x{constructor(e,n,i,r,s){this.type=e,this.lexeme=n,this.line=i,this.start=r,this.end=s}toString(){return this.lexeme}isTemplateType(){return R.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==R.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class x4{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new _x(R.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const n=R.simpleTokens[e];if(n)return this._addToken(n),!0;let i=R.none;const r=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(r){const l=R.keywords[e];if(l)return this._addToken(l),!0}if(r||s)return this._addToken(R.tokens.ident),!0;for(;;){let l=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(R.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(R.tokens.minus_minus),!0;const f=this._tokens.length-1;if((R.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==R.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,h=this._tokens.length-1;for(let p=0;p<5&&h>=0&&R.assignment_operators.indexOf(this._tokens[h].type)===-1;++p,--h)if(this._tokens[h].type===R.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===R.none){let f=e,h=0;const p=2;for(let m=0;m<p;++m)if(f+=this._peekAhead(m),l=this._findType(f),l!==R.none){h=m;break}if(l===R.none)return i!==R.none&&(this._current--,this._addToken(i),!0);e=f,this._current+=h+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==R.none&&(this._addToken(i),!0)}_findType(e){for(const i in R.regexTokens){const r=R.regexTokens[i];if(this._match(e,r.rule))return r}return R.literalTokens[e]||R.none}_match(e,n){const i=n.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new _x(e,n,this._line,this._start,this._current))}}function _e(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}const qu=new Float32Array(1),T4=new Uint32Array(qu.buffer),w4=new Uint32Array(qu.buffer),Ku=new Int32Array(1),S4=new Float32Array(Ku.buffer),A4=new Uint32Array(Ku.buffer),Zu=new Uint32Array(1),E4=new Float32Array(Zu.buffer),R4=new Int32Array(Zu.buffer);function yx(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return qu[0]=t,T4[0];if(n==="u32")return qu[0]=t,w4[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return Ku[0]=t,S4[0];if(n==="u32")return Ku[0]=t,A4[0]}else if(e==="u32"){if(n==="f32")return Zu[0]=t,E4[0];if(n==="i32"||n==="x32")return Zu[0]=t,R4[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class C4{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Jc{constructor(e,n){this.align=e,this.size=n}}class qn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new u4,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof fl&&this._functions.set(n.name,new C4(n));for(const n of e)if(n instanceof bi){const i=this.getTypeInfo(n,null);i instanceof or&&this.structs.push(i)}for(const n of e)if(n instanceof Nm)this.aliases.push(this._getAliasInfo(n));else{if(n instanceof Om){const i=n,r=this._getAttributeNum(i.attributes,"id",0),s=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new a4(i.name,s,i.attributes,r));continue}if(this._isUniformVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Qc(i.name,l,r,s,i.attributes,ir.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c);continue}if(this._isStorageVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Qc(i.name,l,r,s,i.attributes,c?ir.StorageTexture:ir.Storage,i.access);f.access||(f.access="read"),this.storage.push(f);continue}if(this._isTextureVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Qc(i.name,l,r,s,i.attributes,c?ir.StorageTexture:ir.Texture,i.access);f.access||(f.access="read"),c?this.storage.push(f):this.textures.push(f);continue}if(this._isSamplerVar(n)){const i=n,r=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Qc(i.name,l,r,s,i.attributes,ir.Sampler,i.access);this.samplers.push(c);continue}}for(const n of e)if(n instanceof fl){const i=this._getAttribute(n,"vertex"),r=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),l=i||r||s,c=new c4(n.name,l?.name,n.attributes);c.attributes=n.attributes,c.startLine=n.startLine,c.endLine=n.endLine,this.functions.push(c),this._functions.get(n.name).info=c,l&&(this._functions.get(n.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(n,!!l),c.inputs=this._getInputs(n.args),c.outputs=this._getOutputs(n.returnType),this.entry[l.name].push(c)),c.arguments=n.args.map(f=>new l4(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),c.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null;continue}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(i=>{var r,s,l;if(i instanceof kw){if(i.value)if(_e(i.value))for(const c of i.value)for(const f of this.overrides)c===f.name&&((r=n.info)===null||r===void 0||r.overrides.push(f));else for(const c of this.overrides)i.value===c.name&&((s=n.info)===null||s===void 0||s.overrides.push(c))}else if(i instanceof sn)for(const c of this.overrides)i.name===c.name&&((l=n.info)===null||l===void 0||l.overrides.push(c))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getFunctionInfo(e){for(const n of this.functions)if(n.name==e)return n;return null}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var i;for(const r of e.calls){const s=(i=this._functions.get(r.name))===null||i===void 0?void 0:i.info;s&&n.add(s)}}findResource(e,n,i){if(i){for(const r of this.entry.compute)if(r.name===i){for(const s of r.resources)if(s.group==e&&s.binding==n)return s}for(const r of this.entry.vertex)if(r.name===i){for(const s of r.resources)if(s.group==e&&s.binding==n)return s}for(const r of this.entry.fragment)if(r.name===i){for(const s of r.resources)if(s.group==e&&s.binding==n)return s}}for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const i=[],r=this,s=[];return e.search(l=>{if(l instanceof Xu)s.push({});else if(l instanceof Yu)s.pop();else if(l instanceof Ti){const c=l;n&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(l instanceof Xn){const c=l;n&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof il){const c=l;n&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(l instanceof sn){const c=l;if(s.length>0&&s[s.length-1][c.name])return;const f=r._findResource(c.name);f&&i.push(f)}else if(l instanceof km){const c=l,f=r._functions.get(c.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,n)),i.push(...f.resources))}else if(l instanceof Im){const c=l,f=r._functions.get(c.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,n)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function n(i,r){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),r>=e[i].length&&(e[i].length=r+1)}for(const i of this.uniforms)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)n(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)n(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof bi)this._getStructOutputs(e,n);else{const i=this._getOutputInfo(e);i!==null&&n.push(i)}return n}_getStructOutputs(e,n){for(const i of e.members)if(i.type instanceof bi)this._getStructOutputs(i.type,n);else{const r=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(r!==null){const s=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(r.value),c=new hx(i.name,s,r.name,l);n.push(c)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this.getTypeInfo(e,e.attributes),r=this._parseInt(n.value);return new hx("",i,n.name,r)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const i of e)if(i.type instanceof bi)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}return n}_getStructInputs(e,n){for(const i of e.members)if(i.type instanceof bi)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),l=new o4(e.name,r,n.name,s);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new s4(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Tu){const r=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new yg(e.name,r,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof rl){const r=e,s=r.format?this.getTypeInfo(r.format,r.attributes):null,l=new hr(r.name,n);return l.format=s,l.count=r.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof bi){const r=e,s=new or(r.name,n);s.startLine=r.startLine,s.endLine=r.endLine;for(const l of r.members){const c=this.getTypeInfo(l.type,l.attributes);s.members.push(new fx(l.name,c,l.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Wa){const r=e,s=r.format instanceof se,l=r.format?s?this.getTypeInfo(r.format,null):new _n(r.format,null):null,c=new Gr(r.name,l,n,r.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof W){const r=e,s=r.format?this.getTypeInfo(r.format,null):null,l=new Gr(r.name,s,n,r.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new _n(e.name,n);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var n,i,r;const s=this._getTypeSize(e);if(e.size=(n=s?.size)!==null&&n!==void 0?n:0,e instanceof hr&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(r=l?.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(e.format)}e instanceof yg&&this._updateTypeInfo(e.format),e instanceof or&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let i=0,r=0,s=0,l=0;for(let c=0,f=e.members.length;c<f;++c){const h=e.members[c],p=this._getTypeSize(h);if(!p)continue;(n=this._getAlias(h.type.name))!==null&&n!==void 0||h.type;const m=p.align,y=p.size;i=this._roundUp(m,i+r),r=y,s=i,l=Math.max(l,m),h.offset=i,h.size=y,this._updateTypeInfo(h.type)}e.size=this._roundUp(l,s+r),e.align=l}_getTypeSize(e){var n,i;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof fx&&(e=e.type),e instanceof _n){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=qn._typeInfo[e.name];if(l!==void 0){const c=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Jc(Math.max(s,l.align/c),Math.max(r,l.size/c))}}{const l=qn._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const c=e.name[e.name.length-1]==="h"?2:1;return new Jc(Math.max(s,l.align/c),Math.max(r,l.size/c))}}if(e instanceof hr){let l=e,c=8,f=8;const h=this._getTypeSize(l.format);return h!==null&&(f=h.size,c=h.align),f=l.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,f)),r&&(f=r),new Jc(Math.max(s,c),Math.max(r,f))}if(e instanceof or){let l=0,c=0,f=0,h=0,p=0;for(const m of e.members){const y=this._getTypeSize(m.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+h),h=y.size,p=f)}return c=this._roundUp(l,p+h),new Jc(Math.max(s,l),Math.max(r,c))}return null}_isUniformVar(e){return e instanceof Ti&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ti&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ti&&e.type!==null&&qn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ti&&e.type!==null&&qn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const i=e;if(!i||!i.attributes)return null;const r=i.attributes;for(let s of r)if(s.name==n)return s;return null}_getAttributeNum(e,n,i){if(e===null)return i;for(let r of e)if(r.name==n){let s=r!==null&&r.value!==null?r.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,n){return Math.ceil(n/e)*e}}qn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},qn._textureTypes=R.any_texture_type.map(t=>t.name),qn._samplerTypes=R.sampler_type.map(t=>t.name);let Dm=0;class Lm{constructor(e,n,i){this.id=Dm++,this.name=e,this.value=n,this.node=i}clone(){return new Lm(this.name,this.value,this.node)}}class Bm{constructor(e){this.id=Dm++,this.name=e.name,this.node=e}clone(){return new Bm(this.node)}}class Um{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Dm++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,i){this.variables.set(e,new Lm(e,n,i??null))}setVariable(e,n,i){const r=this.getVariable(e);r!==null?r.value=n:this.createVariable(e,n,i)}getVariableValue(e){var n;const i=this.getVariable(e);return(n=i?.value)!==null&&n!==void 0?n:null}clone(){return new Um(this)}}class M4{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class P4{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const i=this.exec.evalExpression(e.args[0],n);let r=!0;if(i instanceof O)return i.data.forEach(s=>{s||(r=!1)}),new V(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O){const r=i.data.some(s=>s);return new V(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const i=this.exec.evalExpression(e.args[2],n);if(!(i instanceof V))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.evalExpression(i,n);if(r instanceof ut&&r.typeInfo.size===0){const s=r.typeInfo,l=r.buffer.byteLength/s.stride;return new V(l,this.getTypeInfo("u32"))}return new V(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.abs(s)),i.typeInfo);const r=i;return new V(Math.abs(r.value),r.typeInfo)}Acos(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.acos(s)),i.typeInfo);const r=i;return new V(Math.acos(r.value),i.typeInfo)}Acosh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.acosh(s)),i.typeInfo);const r=i;return new V(Math.acosh(r.value),i.typeInfo)}Asin(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.asin(s)),i.typeInfo);const r=i;return new V(Math.asin(r.value),i.typeInfo)}Asinh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.asinh(s)),i.typeInfo);const r=i;return new V(Math.asinh(r.value),i.typeInfo)}Atan(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.atan(s)),i.typeInfo);const r=i;return new V(Math.atan(r.value),i.typeInfo)}Atanh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.atanh(s)),i.typeInfo);const r=i;return new V(Math.atanh(r.value),i.typeInfo)}Atan2(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O)return new O(i.data.map((c,f)=>Math.atan2(c,r.data[f])),i.typeInfo);const s=i,l=r;return new V(Math.atan2(s.value,l.value),i.typeInfo)}Ceil(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.ceil(s)),i.typeInfo);const r=i;return new V(Math.ceil(r.value),i.typeInfo)}_clamp(e,n,i){return Math.min(Math.max(e,n),i)}Clamp(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i instanceof O&&r instanceof O&&s instanceof O)return new O(i.data.map((h,p)=>this._clamp(h,r.data[p],s.data[p])),i.typeInfo);const l=i,c=r,f=s;return new V(this._clamp(l.value,c.value,f.value),i.typeInfo)}Cos(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.cos(s)),i.typeInfo);const r=i;return new V(Math.cos(r.value),i.typeInfo)}Cosh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.cosh(s)),i.typeInfo);const r=i;return new V(Math.cos(r.value),i.typeInfo)}CountLeadingZeros(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.clz32(s)),i.typeInfo);const r=i;return new V(Math.clz32(r.value),i.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>this._countOneBits(s)),i.typeInfo);const r=i;return new V(this._countOneBits(r.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>this._countTrailingZeros(s)),i.typeInfo);const r=i;return new V(this._countTrailingZeros(r.value),i.typeInfo)}Cross(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O){if(i.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=i.data,l=r.data;return new O([s[1]*l[2]-l[1]*s[2],s[2]*l[0]-l[2]*s[0],s[0]*l[1]-l[0]*s[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const i=this.exec.evalExpression(e.args[0],n),r=180/Math.PI;return i instanceof O?new O(i.data.map(s=>s*r),i.typeInfo):new V(i.value*r,this.getTypeInfo("f32"))}Determinant(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof Se){const r=i.data,s=i.typeInfo.getTypeName(),l=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new V(r[0]*r[3]-r[1]*r[2],l);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new V(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),l);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new V(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),l);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O){let c=0;for(let f=0;f<i.data.length;++f)c+=(i.data[f]-r.data[f])*(i.data[f]-r.data[f]);return new V(Math.sqrt(c),this.getTypeInfo("f32"))}const s=i,l=r;return new V(Math.abs(s.value-l.value),i.typeInfo)}_dot(e,n){let i=0;for(let r=0;r<e.length;++r)i+=n[r]*e[r];return i}Dot(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);return i instanceof O&&r instanceof O?new V(this._dot(i.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.exp(s)),i.typeInfo);const r=i;return new V(Math.exp(r.value),i.typeInfo)}Exp2(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.pow(2,s)),i.typeInfo);const r=i;return new V(Math.pow(2,r.value),i.typeInfo)}ExtractBits(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=r.value,c=s.value;if(i instanceof O)return new O(i.data.map(h=>h>>l&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=i.value;return new V(f>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i instanceof O&&r instanceof O&&s instanceof O){const l=this._dot(r.data,s.data);return new O(l<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>this._firstLeadingBit(s)),i.typeInfo);const r=i;return new V(this._firstLeadingBit(r.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>this._firstTrailingBit(s)),i.typeInfo);const r=i;return new V(this._firstTrailingBit(r.value),i.typeInfo)}Floor(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.floor(s)),i.typeInfo);const r=i;return new V(Math.floor(r.value),i.typeInfo)}Fma(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i instanceof O&&r instanceof O&&s instanceof O)return i.data.length!==r.data.length||i.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new O(i.data.map((h,p)=>h*r.data[p]+s.data[p]),i.typeInfo);const l=i,c=r,f=s;return new V(l.value*c.value+f.value,l.typeInfo)}Fract(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>s-Math.floor(s)),i.typeInfo);const r=i;return new V(r.value-Math.floor(r.value),i.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),l=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const c=s.value,f=(1<<l.value)-1<<c,h=~f;if(i instanceof O&&r instanceof O)return new O(i.data.map((y,v)=>y&h|r.data[v]<<c&f),i.typeInfo);const p=i.value,m=r.value;return new V(p&h|m<<c&f,i.typeInfo)}InverseSqrt(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>1/Math.sqrt(s)),i.typeInfo);const r=i;return new V(1/Math.sqrt(r.value),i.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O){let s=0;return i.data.forEach(l=>{s+=l*l}),new V(Math.sqrt(s),this.getTypeInfo("f32"))}const r=i;return new V(Math.abs(r.value),i.typeInfo)}Log(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.log(s)),i.typeInfo);const r=i;return new V(Math.log(r.value),i.typeInfo)}Log2(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.log2(s)),i.typeInfo);const r=i;return new V(Math.log2(r.value),i.typeInfo)}Max(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O)return new O(i.data.map((c,f)=>Math.max(c,r.data[f])),i.typeInfo);const s=i,l=r;return new V(Math.max(s.value,l.value),i.typeInfo)}Min(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O)return new O(i.data.map((c,f)=>Math.min(c,r.data[f])),i.typeInfo);const s=i,l=r;return new V(Math.min(s.value,l.value),i.typeInfo)}Mix(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i instanceof O&&r instanceof O&&s instanceof O)return new O(i.data.map((f,h)=>i.data[h]*(1-s.data[h])+r.data[h]*s.data[h]),i.typeInfo);const l=r,c=s;return new V(i.value*(1-c.value)+l.value*c.value,i.typeInfo)}Modf(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O)return new O(i.data.map((l,c)=>l%r.data[c]),i.typeInfo);const s=r;return new V(i.value%s.value,i.typeInfo)}Normalize(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O){const r=this.Length(e,n).value;return new O(i.data.map(s=>s/r),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O)return new O(i.data.map((c,f)=>Math.pow(c,r.data[f])),i.typeInfo);const s=i,l=r;return new V(Math.pow(s.value,l.value),i.typeInfo)}QuantizeToF16(e,n){const i=this.exec.evalExpression(e.args[0],n);return i instanceof O?new O(i.data.map(r=>r),i.typeInfo):new V(i.value,i.typeInfo)}Radians(e,n){const i=this.exec.evalExpression(e.args[0],n);return i instanceof O?new O(i.data.map(r=>r*Math.PI/180),i.typeInfo):new V(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(i instanceof O&&r instanceof O){const s=this._dot(i.data,r.data);return new O(i.data.map((l,c)=>l-2*s*r.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i instanceof O&&r instanceof O&&s instanceof V){const l=this._dot(r.data,i.data);return new O(i.data.map((c,f)=>{const h=1-s.value*s.value*(1-l*l);if(h<0)return 0;const p=Math.sqrt(h);return s.value*c-(s.value*l+p)*r.data[f]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.round(s)),i.typeInfo);const r=i;return new V(Math.round(r.value),i.typeInfo)}Saturate(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.min(Math.max(s,0),1)),i.typeInfo);const r=i;return new V(Math.min(Math.max(r.value,0),1),i.typeInfo)}Sign(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.sign(s)),i.typeInfo);const r=i;return new V(Math.sign(r.value),i.typeInfo)}Sin(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.sin(s)),i.typeInfo);const r=i;return new V(Math.sin(r.value),i.typeInfo)}Sinh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.sinh(s)),i.typeInfo);const r=i;return new V(Math.sinh(r.value),i.typeInfo)}_smoothstep(e,n,i){const r=Math.min(Math.max((i-e)/(n-e),0),1);return r*r*(3-2*r)}SmoothStep(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof O&&i instanceof O&&r instanceof O)return new O(s.data.map((h,p)=>this._smoothstep(i.data[p],r.data[p],h)),s.typeInfo);const l=i,c=r,f=s;return new V(this._smoothstep(l.value,c.value,f.value),s.typeInfo)}Sqrt(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.sqrt(s)),i.typeInfo);const r=i;return new V(Math.sqrt(r.value),i.typeInfo)}Step(e,n){const i=this.exec.evalExpression(e.args[0],n),r=this.exec.evalExpression(e.args[1],n);if(r instanceof O&&i instanceof O)return new O(r.data.map((l,c)=>l<i.data[c]?0:1),r.typeInfo);const s=i;return new V(r.value<s.value?0:1,s.typeInfo)}Tan(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.tan(s)),i.typeInfo);const r=i;return new V(Math.tan(r.value),i.typeInfo)}Tanh(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.tanh(s)),i.typeInfo);const r=i;return new V(Math.tanh(r.value),i.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const i=this.exec.evalExpression(e.args[0],n);if(!(i instanceof Se))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const s=i.data;return new Se([s[0],s[2],s[1],s[3]],r)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const s=i.data;return new Se([s[0],s[3],s[6],s[1],s[4],s[7]],r)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const s=i.data;return new Se([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],r)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const s=i.data;return new Se([s[0],s[3],s[1],s[4],s[2],s[5]],r)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const s=i.data;return new Se([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],r)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const s=i.data;return new Se([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],r)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const s=i.data;return new Se([s[0],s[4],s[1],s[5],s[2],s[6]],r)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const s=i.data;return new Se([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],r)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const s=i.data;return new Se([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],r)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,n){const i=this.exec.evalExpression(e.args[0],n);if(i instanceof O)return new O(i.data.map(s=>Math.trunc(s)),i.typeInfo);const r=i;return new V(Math.trunc(r.value),i.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const i=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(i instanceof sn){const s=i.name,l=n.getVariableValue(s);if(l instanceof xi){if(r<0||r>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const c=l.getMipLevelSize(r),f=l.dimension;return f==="1d"?new V(c[0],this.getTypeInfo("u32")):f==="3d"?new O(c,this.getTypeInfo("vec3u")):f==="2d"?new O(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const i=e.args[0],r=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(r instanceof O)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof sn){const l=i.name,c=n.getVariableValue(l);if(c instanceof xi){const f=Math.floor(r.data[0]),h=Math.floor(r.data[1]);if(f<0||f>=c.width||h<0||h>=c.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=c.getPixel(f,h,0,s);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new O(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const i=e.args[0];if(i instanceof sn){const r=i.name,s=n.getVariableValue(r);return s instanceof xi?new V(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const i=e.args[0];if(i instanceof sn){const r=i.name,s=n.getVariableValue(r);return s instanceof xi?new V(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const i=e.args[0];if(i instanceof sn){const r=i.name,s=n.getVariableValue(r);return s instanceof xi?new V(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const i=e.args[0],r=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof O)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof sn){const c=i.name,f=n.getVariableValue(c);if(f instanceof xi){const h=f.getMipLevelSize(0),p=Math.floor(r.data[0]),m=Math.floor(r.data[1]);return p<0||p>=h[0]||m<0||m>=h[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(f.setPixel(p,m,0,s,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n);return n.getVariable(r).value.getSubData(this.exec,i.postfix,n)}AtomicStore(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n);return f instanceof V&&c instanceof V&&(f.value=c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),null}AtomicAdd(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value+=c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicSub(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value-=c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicMax(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=Math.max(f.value,c.value)),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicMin(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=Math.min(f.value,c.value)),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicAnd(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=f.value&c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicOr(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=f.value|c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicXor(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=f.value^c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicExchange(e,n){let i=e.args[0];i instanceof mt&&(i=i.right);const r=this.exec.getVariableName(i,n),s=n.getVariable(r);let l=e.args[1];const c=this.exec.evalExpression(l,n),f=s.value.getSubData(this.exec,i.postfix,n),h=new V(f.value,f.typeInfo);return f instanceof V&&c instanceof V&&(f.value=c.value),s.value instanceof ut&&s.value.setDataValue(this.exec,f,i.postfix,n),h}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const Rp={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Ft={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Lt extends M4{constructor(e,n){var i;super(),this.ast=e??[],this.reflection=new qn,this.reflection.updateAST(this.ast),this.context=(i=n?.clone())!==null&&i!==void 0?i:new Um,this.builtins=new P4(this),this.typeInfo={bool:this.getTypeInfo(se.bool),i32:this.getTypeInfo(se.i32),u32:this.getTypeInfo(se.u32),f32:this.getTypeInfo(se.f32),f16:this.getTypeInfo(se.f16),vec2f:this.getTypeInfo(W.vec2f),vec2u:this.getTypeInfo(W.vec2u),vec2i:this.getTypeInfo(W.vec2i),vec2h:this.getTypeInfo(W.vec2h),vec3f:this.getTypeInfo(W.vec3f),vec3u:this.getTypeInfo(W.vec3u),vec3i:this.getTypeInfo(W.vec3i),vec3h:this.getTypeInfo(W.vec3h),vec4f:this.getTypeInfo(W.vec4f),vec4u:this.getTypeInfo(W.vec4u),vec4i:this.getTypeInfo(W.vec4i),vec4h:this.getTypeInfo(W.vec4h),mat2x2f:this.getTypeInfo(W.mat2x2f),mat2x3f:this.getTypeInfo(W.mat2x3f),mat2x4f:this.getTypeInfo(W.mat2x4f),mat3x2f:this.getTypeInfo(W.mat3x2f),mat3x3f:this.getTypeInfo(W.mat3x3f),mat3x4f:this.getTypeInfo(W.mat3x4f),mat4x2f:this.getTypeInfo(W.mat4x2f),mat4x3f:this.getTypeInfo(W.mat4x3f),mat4x4f:this.getTypeInfo(W.mat4x4f)}}getVariableValue(e){var n,i;const r=(i=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&i!==void 0?i:null;if(r===null)return null;if(r instanceof V)return r.value;if(r instanceof O||r instanceof Se)return Array.from(r.data);if(r instanceof ut&&r.typeInfo instanceof hr){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,i,r){const s=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,s),this._execStatements(this.ast,s);const l=s.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const c=n[0],f=n[1],h=n[2],p=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new O(n,p));const m=this.reflection.getFunctionInfo(e);m===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const v in i[y]){const x=i[y][v];s.variables.forEach(T=>{var E;const C=T.node;if(C?.attributes){let P=null,M=null;for(const I of C.attributes)I.name==="binding"?P=I.value:I.name==="group"&&(M=I.value);if(v==P&&y==M){let I=!1;for(const D of m.resources)if(D.name===T.name&&D.group===parseInt(y)&&D.binding===parseInt(v)){I=!0;break}if(I)if(x.texture!==void 0&&x.descriptor!==void 0){const D=new xi(x.texture,this.getTypeInfo(C.type),x.descriptor,(E=x.texture.view)!==null&&E!==void 0?E:null);T.value=D}else x.uniform!==void 0?T.value=new ut(x.uniform,this.getTypeInfo(C.type)):T.value=new ut(x,this.getTypeInfo(C.type))}}})}for(let y=0;y<h;++y)for(let v=0;v<f;++v)for(let x=0;x<c;++x)s.setVariable("@workgroup_id",new O([x,v,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[x,v,y],s)}execStatement(e,n){if(e instanceof Sw)return this.evalExpression(e.value,n);if(e instanceof Ew){if(e.condition){const i=this.evalExpression(e.condition,n);if(!(i instanceof V))throw new Error("Invalid break-if condition");if(!i.value)return null}return Lt._breakObj}if(e instanceof Rw)return Lt._continueObj;if(e instanceof il)this._let(e,n);else if(e instanceof Ti)this._var(e,n);else if(e instanceof xu)this._const(e,n);else if(e instanceof fl)this._function(e,n);else{if(e instanceof ww)return this._if(e,n);if(e instanceof Tw)return this._switch(e,n);if(e instanceof yw)return this._for(e,n);if(e instanceof _w)return this._while(e,n);if(e instanceof xw)return this._loop(e,n);if(e instanceof vg){const i=n.clone();return i.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof bw)this._assign(e,n);else if(e instanceof vw)this._increment(e,n);else{if(e instanceof bi)return null;if(e instanceof Om){const i=e.name;n.getVariable(i)===null&&n.setVariable(i,new V(0,this.getTypeInfo("u32")))}else if(e instanceof Im)this._call(e,n);else{if(e instanceof Aw||e instanceof Nm)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Rn?this._evalBinaryOp(e,n):e instanceof bt?this._evalLiteral(e,n):e instanceof sn?this._evalVariable(e,n):e instanceof km?this._evalCall(e,n):e instanceof Xn?this._evalCreate(e,n):e instanceof Cw?this._evalConst(e,n):e instanceof Mw?this._evalBitcast(e,n):e instanceof mt?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof se){const r=this.reflection.getTypeInfo(e);if(r!==null)return r}let i=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,n){for(const i in e){const r=e[i],s=this.reflection.getOverrideInfo(i);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(i,new V(r,s.type)):s.type.name==="bool"?n.setVariable(i,new V(r?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(i,new O(r,s.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,i){const r=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const m=i.getVariableValue(p.value[0]);r[0]=m instanceof V?m.value:parseInt(p.value[0])}if(p.value.length>1){const m=i.getVariableValue(p.value[1]);r[1]=m instanceof V?m.value:parseInt(p.value[1])}if(p.value.length>2){const m=i.getVariableValue(p.value[2]);r[2]=m instanceof V?m.value:parseInt(p.value[2])}}const s=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new O(r,s));const c=r[0],f=r[1],h=r[2];for(let p=0,m=0;p<h;++p)for(let y=0;y<f;++y)for(let v=0;v<c;++v,++m){const x=[v,y,p],T=[v+n[0]*r[0],y+n[1]*r[1],p+n[2]*r[2]];i.setVariable("@local_invocation_id",new O(x,s)),i.setVariable("@global_invocation_id",new O(T,s)),i.setVariable("@local_invocation_index",new V(m,l)),this._dispatchExec(e,i)}}_dispatchExec(e,n){for(const i of e.node.args)for(const r of i.attributes)if(r.name==="builtin"){const s=`@${r.value}`,l=n.getVariable(s);l!==void 0&&n.variables.set(i.name,l)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof mt;)e=e.right;return e instanceof sn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const i of e){if(i instanceof Array){const s=n.clone(),l=this._execStatements(i,s);if(l)return l;continue}const r=this.execStatement(i,n);if(r)return r}return null}_call(e,n){const i=n.clone();i.currentFunctionName=e.name;const r=n.getFunction(e.name);if(r){for(let s=0;s<r.node.args.length;++s){const l=r.node.args[s],c=this.evalExpression(e.args[s],i);i.setVariable(l.name,c,l)}this._execStatements(r.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const i=this.getVariableName(e.variable,n),r=n.getVariable(i);r?e.operator==="++"?r.value instanceof V?r.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?r.value instanceof V?r.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof sn){const i=this.getVariableName(e,n),r=n.getVariable(i);return r===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,n)}if(e instanceof mt){if(e.operator==="*"){const i=this._getVariableData(e.right,n);return i instanceof Gs?i.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,n);return new Gs(i)}}return null}_assign(e,n){let i=null,r="<var>",s=null;if(e.variable instanceof mt){const f=this._getVariableData(e.variable,n),h=this.evalExpression(e.value,n),p=e.operator;if(p==="="){if(f instanceof V||f instanceof O||f instanceof Se){if(h instanceof V||h instanceof O||h instanceof Se&&f.data.length===h.data.length)return void f.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof ut&&h instanceof ut&&f.buffer.byteLength-f.offset>=h.buffer.byteLength-h.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return f instanceof V||f instanceof O||f instanceof Se?h instanceof V||h instanceof O||h instanceof Se?void f.data.set(h.data.map((m,y)=>f.data[y]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(f instanceof V||f instanceof O||f instanceof Se)&&(h instanceof V||h instanceof O||h instanceof Se)?void f.data.set(h.data.map((m,y)=>f.data[y]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof mt){if(e.variable.operator==="*"){r=this.getVariableName(e.variable.right,n);const f=n.getVariable(r);if(!(f&&f.value instanceof Gs))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);i=f.value.reference;let h=e.variable.postfix;if(!h){let p=e.variable.right;for(;p instanceof mt;){if(p.postfix){h=p.postfix;break}p=p.right}}h&&(i=i.getSubData(this,h,n))}}else{s=e.variable.postfix,r=this.getVariableName(e.variable,n);const f=n.getVariable(r);if(f===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);i=f.value}if(i instanceof Gs&&(i=i.reference),i===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);const l=this.evalExpression(e.value,n),c=e.operator;if(c!=="="){const f=i.getSubData(this,s,n);if(f instanceof O&&l instanceof V){const h=f.data,p=l.value;if(c==="+=")for(let m=0;m<h.length;++m)h[m]+=p;else if(c==="-=")for(let m=0;m<h.length;++m)h[m]-=p;else if(c==="*=")for(let m=0;m<h.length;++m)h[m]*=p;else if(c==="/=")for(let m=0;m<h.length;++m)h[m]/=p;else if(c==="%=")for(let m=0;m<h.length;++m)h[m]%=p;else if(c==="&=")for(let m=0;m<h.length;++m)h[m]&=p;else if(c==="|=")for(let m=0;m<h.length;++m)h[m]|=p;else if(c==="^=")for(let m=0;m<h.length;++m)h[m]^=p;else if(c==="<<=")for(let m=0;m<h.length;++m)h[m]<<=p;else if(c===">>=")for(let m=0;m<h.length;++m)h[m]>>=p;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(f instanceof O&&l instanceof O){const h=f.data,p=l.data;if(h.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let m=0;m<h.length;++m)h[m]+=p[m];else if(c==="-=")for(let m=0;m<h.length;++m)h[m]-=p[m];else if(c==="*=")for(let m=0;m<h.length;++m)h[m]*=p[m];else if(c==="/=")for(let m=0;m<h.length;++m)h[m]/=p[m];else if(c==="%=")for(let m=0;m<h.length;++m)h[m]%=p[m];else if(c==="&=")for(let m=0;m<h.length;++m)h[m]&=p[m];else if(c==="|=")for(let m=0;m<h.length;++m)h[m]|=p[m];else if(c==="^=")for(let m=0;m<h.length;++m)h[m]^=p[m];else if(c==="<<=")for(let m=0;m<h.length;++m)h[m]<<=p[m];else if(c===">>=")for(let m=0;m<h.length;++m)h[m]>>=p[m];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(f instanceof V&&l instanceof V))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?f.value+=l.value:c==="-="?f.value-=l.value:c==="*="?f.value*=l.value:c==="/="?f.value/=l.value:c==="%="?f.value%=l.value:c==="&="?f.value&=l.value:c==="|="?f.value|=l.value:c==="^="?f.value^=l.value:c==="<<="?f.value<<=l.value:c===">>="?f.value>>=l.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}return void(i instanceof ut&&i.setDataValue(this,f,s,n))}if(i instanceof ut)i.setDataValue(this,l,s,n);else if(s){if(!(i instanceof O||i instanceof Se))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(s instanceof yo){const f=this.evalExpression(s.index,n).value;if(i instanceof O){if(!(l instanceof V))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[f]=l.value}else{if(!(i instanceof Se))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const h=this.evalExpression(s.index,n).value;if(h<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(l instanceof O))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(h<2&&l.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*h]=l.data[0],i.data[2*h+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(h<2&&l.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*h]=l.data[0],i.data[3*h+1]=l.data[1],i.data[3*h+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(h<2&&l.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*h]=l.data[0],i.data[4*h+1]=l.data[1],i.data[4*h+2]=l.data[2],i.data[4*h+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(h<3&&l.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*h]=l.data[0],i.data[2*h+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(h<3&&l.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*h]=l.data[0],i.data[3*h+1]=l.data[1],i.data[3*h+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(h<3&&l.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*h]=l.data[0],i.data[4*h+1]=l.data[1],i.data[4*h+2]=l.data[2],i.data[4*h+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(h<4&&l.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*h]=l.data[0],i.data[2*h+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(h<4&&l.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*h]=l.data[0],i.data[3*h+1]=l.data[1],i.data[3*h+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(h<4&&l.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*h]=l.data[0],i.data[4*h+1]=l.data[1],i.data[4*h+2]=l.data[2],i.data[4*h+3]=l.data[3]}}}}}else if(s instanceof Qr){const f=s.value;if(!(i instanceof O))return void console.error(`Invalid assignment to ${f}. Variable ${r} is not a vector. Line ${e.line}`);if(l instanceof V){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);if(f==="x")i.data[0]=l.value;else if(f==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);i.data[1]=l.value}else if(f==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);i.data[2]=l.value}else if(f==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof O))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);for(let h=0;h<f.length;++h){const p=f[h];if(p==="x"||p==="r")i.data[0]=l.data[h];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${r}. Line ${e.line}`);i.data[1]=l.data[h]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${r}. Line ${e.line}`);i.data[2]=l.data[h]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${r}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${r}. Line ${e.line}`);i.data[3]=l.data[h]}}}}}else i instanceof V&&l instanceof V?i.value=l.value:i instanceof O&&l instanceof O||i instanceof Se&&l instanceof Se?i.data.set(l.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`)}_function(e,n){const i=new Bm(e);n.functions.set(e.name,i)}_const(e,n){let i=null;e.value!==null&&(i=this.evalExpression(e.value,n)),n.createVariable(e.name,i,e)}_let(e,n){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,n),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof mt||(i=i.clone())}else{const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const s=new Xn(e.type,[]);i=this._evalCreate(s,n)}}n.createVariable(e.name,i,e)}_var(e,n){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,n),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof mt||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||e.type instanceof rl||e.type instanceof bi||e.type instanceof W){const s=new Xn(e.type,[]);i=this._evalCreate(s,n)}}n.createVariable(e.name,i,e)}_switch(e,n){n=n.clone();const i=this.evalExpression(e.condition,n);if(!(i instanceof V))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const s of e.cases)if(s instanceof Iw)for(const l of s.selectors){if(l instanceof wu){r=s;continue}const c=this.evalExpression(l,n);if(!(c instanceof V))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(s.body,n)}else s instanceof Nw&&(r=s);return r?this._execStatements(r.body,n):null}_if(e,n){n=n.clone();const i=this.evalExpression(e.condition,n);if(!(i instanceof V))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,n);for(const r of e.elseif){const s=this.evalExpression(r.condition,n);if(!(s instanceof V))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(r.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof V?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const i=this._execStatements(e.body,n);if(i===Lt._breakObj)break;if(i!==null&&i!==Lt._continueObj)return i;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const i=this._execStatements(e.body,n);if(i===Lt._breakObj)break;if(i===Lt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===Lt._breakObj)break}else if(i!==null)return i}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const i=this._execStatements(e.body,n);if(i===Lt._breakObj)break;if(i!==Lt._continueObj&&i!==null)return i}return null}_evalBitcast(e,n){const i=this.evalExpression(e.value,n),r=e.type;if(i instanceof V){const s=yx(i.value,i.typeInfo.name,r.name);return new V(s,this.getTypeInfo(r))}if(i instanceof O){const s=i.typeInfo.getTypeName();let l="";if(s.endsWith("f"))l="f32";else if(s.endsWith("i"))l="i32";else if(s.endsWith("u"))l="u32";else if(s.endsWith("b"))l="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;l="f16"}const c=r.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const h=(function(p,m,y){if(m===y)return p;const v=new Array(p.length);for(let x=0;x<p.length;x++)v[x]=yx(p[x],m,y);return v})(Array.from(i.data),l,f);return new O(h,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var i;if(e instanceof Xn){if(e.type===null)return bg.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const r=e instanceof Xn?e.type.name:e.name,s=e instanceof Xn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(s.size===0)return null;const l=new ut(new ArrayBuffer(s.size),s,0);if(s instanceof or){if(e.args)for(let c=0;c<e.args.length;++c){const f=s.members[c],h=e.args[c],p=this.evalExpression(h,n);l.setData(this,p,f.type,f.offset,n)}}else if(s instanceof hr){let c=0;if(e.args)for(let f=0;f<e.args.length;++f){const h=e.args[f],p=this.evalExpression(h,n);s.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=p.typeInfo),l.setData(this,p,s.format,c,n),c+=s.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof Xn?l.getSubData(this,e.postfix,n):l}_evalLiteral(e,n){const i=this.getTypeInfo(e.type),r=i.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new V(e.scalarValue,i):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(e,n):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const i=n.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let i=1;i<e.length;++i){const r=Lt._priority.get(n.name);Lt._priority.get(e[i].name)<r&&(n=e[i])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const i=this.evalExpression(e.right,n);if(e.operator==="&")return new Gs(i);if(e.operator==="*")return i instanceof Gs?i.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=i instanceof V?i.value:i instanceof O?Array.from(i.data):null;switch(e.operator){case"+":{if(_e(r)){const c=r.map((f,h)=>+f);return new O(c,i.typeInfo)}const s=r,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new V(+s,l)}case"-":{if(_e(r)){const c=r.map((f,h)=>-f);return new O(c,i.typeInfo)}const s=r,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new V(-s,l)}case"!":{if(_e(r)){const c=r.map((f,h)=>f?0:1);return new O(c,i.typeInfo)}const s=r,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new V(s?0:1,l)}case"~":{if(_e(r)){const c=r.map((f,h)=>~f);return new O(c,i.typeInfo)}const s=r,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new V(~s,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const i=this.evalExpression(e.left,n),r=this.evalExpression(e.right,n),s=i instanceof V?i.value:i instanceof O||i instanceof Se?Array.from(i.data):null,l=r instanceof V?r.value:r instanceof O||r instanceof Se?Array.from(r.data):null;switch(e.operator){case"+":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v+m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y+p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p+y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c+f,h)}case"-":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v-m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y-p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p-y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c-f,h)}case"*":{if(_e(s)&&_e(l)){const p=s,m=l;if(i instanceof Se&&r instanceof Se){const y=(function(E,C,P,M){if(Ft[C.name]===void 0||Ft[M.name]===void 0)return null;const I=Ft[C.name][0],D=Ft[C.name][1],z=Ft[M.name][0];if(I!==Ft[M.name][1])return null;const ae=new Array(z*D);for(let he=0;he<D;he++)for(let le=0;le<z;le++){let ge=0;for(let Z=0;Z<I;Z++)ge+=E[Z*D+he]*P[le*I+Z];ae[he*z+le]=ge}return ae})(p,i.typeInfo,m,r.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=Ft[r.typeInfo.name][0],x=Ft[i.typeInfo.name][1],T=this.getTypeInfo(`mat${v}x${x}f`);return new Se(y,T)}if(i instanceof Se&&r instanceof O){const y=(function(v,x,T,E){if(Ft[x.name]===void 0||Rp[E.name]===void 0)return null;const C=Ft[x.name][0],P=Ft[x.name][1];if(C!==T.length)return null;const M=new Array(P);for(let I=0;I<P;I++){let D=0;for(let z=0;z<C;z++)D+=v[z*P+I]*T[z];M[I]=D}return M})(p,i.typeInfo,m,r.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,r.typeInfo)}if(i instanceof O&&r instanceof Se){const y=(function(v,x,T,E){if(Rp[x.name]===void 0||Ft[E.name]===void 0)return null;const C=Ft[E.name][0],P=Ft[E.name][1];if(P!==v.length)return null;const M=[];for(let I=0;I<C;I++){let D=0;for(let z=0;z<P;z++)D+=v[z]*T[z*C+I];M[I]=D}return M})(p,i.typeInfo,m,r.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new O(y,i.typeInfo)}{if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v*m[x]);return new O(y,i.typeInfo)}}if(_e(s)){const p=l,m=s.map((y,v)=>y*p);return i instanceof Se?new Se(m,i.typeInfo):new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p*y);return r instanceof Se?new Se(m,r.typeInfo):new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c*f,h)}case"%":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v%m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y%p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p%y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c%f,h)}case"/":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v/m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y/p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p/y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c/f,h)}case"&":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v&m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y&p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p&y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c&f,h)}case"|":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v|m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y|p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p|y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c|f,h)}case"^":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v^m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y^p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p^y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c^f,h)}case"<<":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v<<m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y<<p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p<<y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c<<f,h)}case">>":{if(_e(s)&&_e(l)){const p=s,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v>>m[x]);return new O(y,i.typeInfo)}if(_e(s)){const p=l,m=s.map((y,v)=>y>>p);return new O(m,i.typeInfo)}if(_e(l)){const p=s,m=l.map((y,v)=>p>>y);return new O(m,r.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]);return new V(c>>f,h)}case">":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p>f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h>c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c>h?1:0);return new O(f,r.typeInfo)}return new V(s>l?1:0,this.getTypeInfo("bool"));case"<":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p<f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h<c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c<h?1:0);return new O(f,r.typeInfo)}return new V(s<l?1:0,this.getTypeInfo("bool"));case"==":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p===f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h==c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c==h?1:0);return new O(f,r.typeInfo)}return new V(s===l?1:0,this.getTypeInfo("bool"));case"!=":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p!==f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h!==c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c!==h?1:0);return new O(f,r.typeInfo)}return new V(s!==l?1:0,this.getTypeInfo("bool"));case">=":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p>=f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h>=c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c>=h?1:0);return new O(f,r.typeInfo)}return new V(s>=l?1:0,this.getTypeInfo("bool"));case"<=":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p<=f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h<=c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c<=h?1:0);return new O(f,r.typeInfo)}return new V(s<=l?1:0,this.getTypeInfo("bool"));case"&&":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p&&f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h&&c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c&&h?1:0);return new O(f,r.typeInfo)}return new V(s&&l?1:0,this.getTypeInfo("bool"));case"||":if(_e(s)&&_e(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,m)=>p||f[m]?1:0);return new O(h,i.typeInfo)}if(_e(s)){const c=l,f=s.map((h,p)=>h||c?1:0);return new O(f,i.typeInfo)}if(_e(l)){const c=s,f=l.map((h,p)=>c||h?1:0);return new O(f,r.typeInfo)}return new V(s||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=n.clone();i.currentFunctionName=e.name;const r=n.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<r.node.args.length;++s){const l=r.node.args[s],c=this.evalExpression(e.args[s],i);i.createVariable(l.name,c,l)}return this._execStatements(r.node.body,i)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothstep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const i=n.getFunction(e.name);if(i){const r=n.clone();for(let s=0;s<i.node.args.length;++s){const l=i.node.args[s],c=this.evalExpression(e.args[s],r);r.setVariable(l.name,c,l)}return this._execStatements(i.node.body,r)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new V(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],n);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const i=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=Rp[r];if(s===void 0)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const l=[];if(e instanceof bt)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,n);if(f instanceof O){const h=f.data;for(let p=0;p<h.length;++p){let m=h[p];l.push(m)}}else if(f instanceof V){let h=f.value;l.push(h)}}if(e.type instanceof W&&e.type.format===null&&(e.type.format=W.f32),l.length===0){const c=new Array(s).fill(0);return new O(c,i).getSubData(this,e.postfix,n)}if(l.length===1)for(;l.length<s;)l.push(l[0]);return l.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new O(l.length>s?l.slice(0,s):l,i).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const i=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=Ft[r];if(s===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const l=[];if(e instanceof bt)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,n);f instanceof O?l.push(...f.data):f instanceof V?l.push(f.value):f instanceof Se&&l.push(...f.data)}if(i instanceof Gr&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(s[2]).fill(0);return new Se(c,i).getSubData(this,e.postfix,n)}return l.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Se(l,i).getSubData(this,e.postfix,n)}}Lt._breakObj=new xn(new _n("BREAK",null),null),Lt._continueObj=new xn(new _n("CONTINUE",null),null),Lt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class O4{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class I4{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new O4,this._exec=new Lt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;n.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const r=i.arrayType,s=i.countNode;if(s instanceof sn){const l=s.name,c=this._context.constants.get(l);if(c)try{const f=c.constEvaluate(this._exec);r.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of n)i.search(r=>{r instanceof mx||r instanceof Tu?r.type=this._forwardType(r.type):r instanceof rl?r.format=this._forwardType(r.format):r instanceof Ti||r instanceof il||r instanceof xu?r.type=this._forwardType(r.type):r instanceof fl?r.returnType=this._forwardType(r.returnType):r instanceof gx&&(r.type=this._forwardType(r.type))});return n}_forwardType(e){if(e instanceof px){const n=this._getType(e.name);if(n)return n}else e instanceof Tu?e.type=this._forwardType(e.type):e instanceof rl&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new x4(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==R.eof}_match(e){if(e instanceof H)return!!this._check(e)&&(this._advance(),!0);for(let n=0,i=e.length;n<i;++n){const r=e[n];if(this._check(r))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const i=n.type;let r=!1;for(const s of e){if(i===s)return!0;s===R.tokens.name&&(r=!0)}if(r){const s=R.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===R.tokens.name){const i=R.tokens.name.rule.exec(n.lexeme);return i&&i.index==0&&i[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(R.tokens.semicolon)&&!this._isAtEnd(););if(this._match(R.keywords.alias)){const n=this._type_alias();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(R.keywords.diagnostic)){const n=this._diagnostic();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(R.keywords.requires)){const n=this._requires_directive();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(R.keywords.enable)){const n=this._enable_directive();return this._consume(R.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(R.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(R.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(R.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(R.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(R.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(R.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(R.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(R.keywords.fn))return null;const e=this._currentLine,n=this._consume(R.tokens.ident,"Expected function name.").toString();this._consume(R.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(R.tokens.paren_right))do{if(this._check(R.tokens.paren_right))break;const c=this._attribute(),f=this._consume(R.tokens.name,"Expected argument name.").toString();this._consume(R.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=h,i.push(this._updateNode(new gx(f,p,c))))}while(this._match(R.tokens.comma));this._consume(R.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(R.tokens.arrow)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}const s=this._compound_statement(),l=this._currentLine;return this._updateNode(new fl(n,i,r,s,e,l),e)}_compound_statement(){const e=[];for(this._consume(R.tokens.brace_left,"Expected '{' for block.");!this._check(R.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(R.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(R.tokens.semicolon)&&!this._isAtEnd(););if(this._check(R.tokens.attr)&&this._attribute(),this._check(R.keywords.if))return this._if_statement();if(this._check(R.keywords.switch))return this._switch_statement();if(this._check(R.keywords.loop))return this._loop_statement();if(this._check(R.keywords.for))return this._for_statement();if(this._check(R.keywords.while))return this._while_statement();if(this._check(R.keywords.continuing))return this._continuing_statement();if(this._check(R.keywords.static_assert))return this._static_assert_statement();if(this._check(R.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(R.keywords.return))e=this._return_statement();else if(this._check([R.keywords.var,R.keywords.let,R.keywords.const]))e=this._variable_statement();else if(this._match(R.keywords.discard))e=this._updateNode(new y4);else if(this._match(R.keywords.break)){const n=this._updateNode(new Ew);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];n.loopId=i.id}e=n,this._check(R.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(R.keywords.continue)){const n=this._updateNode(new Rw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const i=this._currentLoop[this._currentLoop.length-1];n.loopId=i.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(R.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(R.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new g4(n),e)}_while_statement(){if(!this._match(R.keywords.while))return null;const e=this._updateNode(new _w(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(R.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(R.keywords.continuing))return null;const n=this._currentLine,i=this._compound_statement();return this._updateNode(new vg(i,e),n)}_for_statement(){if(!this._match(R.keywords.for))return null;this._consume(R.tokens.paren_left,"Expected '('.");const e=this._updateNode(new yw(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(R.tokens.semicolon)?null:this._for_init(),this._consume(R.tokens.semicolon,"Expected ';'."),e.condition=this._check(R.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(R.tokens.semicolon,"Expected ';'."),e.increment=this._check(R.tokens.paren_right)?null:this._for_increment(),this._consume(R.tokens.paren_right,"Expected ')'."),this._check(R.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(R.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(R.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new Ti(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(R.keywords.let)){const e=this._currentLine,n=this._consume(R.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(R.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(R.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new il(n,i,null,null,r),e)}if(this._match(R.keywords.const)){const e=this._currentLine,n=this._consume(R.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(R.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(R.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return i===null&&r instanceof bt&&(i=r.type),this._updateNode(new xu(n,i,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(R.increment_operators))return this._current=e,null;const i=this._consume(R.increment_operators,"Expected increment operator");return this._updateNode(new vw(i.type===R.tokens.plus_plus?so.increment:so.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(R.tokens.brace_right))return null;let i=this._match(R.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(R.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new bw($a.parse(r.lexeme),e,s),n)}_func_call_statement(){if(!this._check(R.tokens.ident))return null;const e=this._currentLine,n=this._current,i=this._consume(R.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=n,null):this._updateNode(new Im(i.lexeme,r),e)}_loop_statement(){if(!this._match(R.keywords.loop))return null;this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new xw([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.body.push(i);else e.body.push(n);if(n instanceof vg){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(R.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(R.keywords.switch))return null;const e=this._updateNode(new Tw(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(R.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([R.keywords.default,R.keywords.case]);){if(this._match(R.keywords.case)){const i=this._case_selectors();for(const s of i)if(s instanceof wu){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(R.tokens.colon),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(R.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Iw(i,r)))}if(this._match(R.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(R.tokens.colon),this._check(R.tokens.attr)&&this._attribute(),this._consume(R.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(R.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Nw(i)))}}return e}_case_selectors(){const e=[];for(this._match(R.keywords.default)?e.push(this._updateNode(new wu)):e.push(this._shift_expression());this._match(R.tokens.comma);)this._match(R.keywords.default)?e.push(this._updateNode(new wu)):e.push(this._shift_expression());return e}_case_body(){if(this._match(R.keywords.fallthrough))return this._consume(R.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(R.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(R.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(R.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(R.keywords.else)&&(this._check(R.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new ww(n,i,r,s),e)}_match_elseif(){return this._tokens[this._current].type===R.keywords.else&&this._tokens[this._current+1].type===R.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new v4(n,i))),this._match_elseif()&&(this._check(R.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(R.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Sw(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(R.tokens.or_or);)e=this._updateNode(new Rn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(R.tokens.and_and);)e=this._updateNode(new Rn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(R.tokens.or);)e=this._updateNode(new Rn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(R.tokens.xor);)e=this._updateNode(new Rn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(R.tokens.and);)e=this._updateNode(new Rn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([R.tokens.equal_equal,R.tokens.not_equal])?this._updateNode(new Rn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([R.tokens.less_than,R.tokens.greater_than,R.tokens.less_than_equal,R.tokens.greater_than_equal]);)e=this._updateNode(new Rn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([R.tokens.shift_left,R.tokens.shift_right]);)e=this._updateNode(new Rn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([R.tokens.plus,R.tokens.minus]);)e=this._updateNode(new Rn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([R.tokens.star,R.tokens.forward_slash,R.tokens.modulo]);)e=this._updateNode(new Rn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([R.tokens.minus,R.tokens.bang,R.tokens.tilde,R.tokens.star,R.tokens.and])?this._updateNode(new mt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(R.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(R.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new yo(e)),i=this._postfix_expression();return i&&(n.postfix=i),n}if(this._match(R.tokens.period)){const e=this._consume(R.tokens.name,"Expected member name."),n=this._postfix_expression(),i=this._updateNode(new Qr(e.lexeme));return n&&(i.postfix=n),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return se.void;case"bool":return se.bool;case"i32":return se.i32;case"u32":return se.u32;case"f32":return se.f32;case"f16":return se.f16;case"vec2f":return W.vec2f;case"vec3f":return W.vec3f;case"vec4f":return W.vec4f;case"vec2i":return W.vec2i;case"vec3i":return W.vec3i;case"vec4i":return W.vec4i;case"vec2u":return W.vec2u;case"vec3u":return W.vec3u;case"vec4u":return W.vec4u;case"vec2h":return W.vec2h;case"vec3h":return W.vec3h;case"vec4h":return W.vec4h;case"mat2x2f":return W.mat2x2f;case"mat2x3f":return W.mat2x3f;case"mat2x4f":return W.mat2x4f;case"mat3x2f":return W.mat3x2f;case"mat3x3f":return W.mat3x3f;case"mat3x4f":return W.mat3x4f;case"mat4x2f":return W.mat4x2f;case"mat4x3f":return W.mat4x3f;case"mat4x4f":return W.mat4x4f;case"mat2x2h":return W.mat2x2h;case"mat2x3h":return W.mat2x3h;case"mat2x4h":return W.mat2x4h;case"mat3x2h":return W.mat3x2h;case"mat3x3h":return W.mat3x3h;case"mat3x4h":return W.mat3x4h;case"mat4x2h":return W.mat4x2h;case"mat4x3h":return W.mat4x3h;case"mat4x4h":return W.mat4x4h;case"mat2x2i":return W.mat2x2i;case"mat2x3i":return W.mat2x3i;case"mat2x4i":return W.mat2x4i;case"mat3x2i":return W.mat3x2i;case"mat3x3i":return W.mat3x3i;case"mat3x4i":return W.mat3x4i;case"mat4x2i":return W.mat4x2i;case"mat4x3i":return W.mat4x3i;case"mat4x4i":return W.mat4x4i;case"mat2x2u":return W.mat2x2u;case"mat2x3u":return W.mat2x3u;case"mat2x4u":return W.mat2x4u;case"mat3x2u":return W.mat3x2u;case"mat3x3u":return W.mat3x3u;case"mat3x4u":return W.mat3x4u;case"mat4x2u":return W.mat4x2u;case"mat4x3u":return W.mat4x3u;case"mat4x4u":return W.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(R.tokens.ident)){const i=this._previous().toString();if(this._check(R.tokens.paren_left)){const r=this._argument_expression_list(),s=this._getType(i);return s!==null?this._updateNode(new Xn(s,r)):this._updateNode(new km(i,r))}if(this._context.constants.has(i)){const r=this._context.constants.get(i);return this._updateNode(new Cw(i,r.value))}return this._updateNode(new sn(i))}if(this._match(R.tokens.int_literal)){const i=this._previous().toString();let r=i.endsWith("i")||i.endsWith("i")?se.i32:i.endsWith("u")||i.endsWith("U")?se.u32:se.x32;const s=parseInt(i);return this._validateTypeRange(s,r),this._updateNode(new bt(new V(s,this._exec.getTypeInfo(r)),r))}if(this._match(R.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,se.u32),this._updateNode(new bt(new V(i,this._exec.getTypeInfo(se.u32)),se.u32))}if(this._match([R.tokens.decimal_float_literal,R.tokens.hex_float_literal])){let i=this._previous().toString(),r=i.endsWith("h");r&&(i=i.substring(0,i.length-1));const s=parseFloat(i);this._validateTypeRange(s,r?se.f16:se.f32);const l=r?se.f16:se.f32;return this._updateNode(new bt(new V(s,this._exec.getTypeInfo(l)),l))}if(this._match([R.keywords.true,R.keywords.false])){let i=this._previous().toString()===R.keywords.true.rule;return this._updateNode(new bt(new V(i?1:0,this._exec.getTypeInfo(se.bool)),se.bool))}if(this._check(R.tokens.paren_left))return this._paren_expression();if(this._match(R.keywords.bitcast)){this._consume(R.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(R.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new Mw(i,r))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new Xn(e,n))}_argument_expression_list(){if(!this._match(R.tokens.paren_left))return null;const e=[];do{if(this._check(R.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(R.tokens.comma));return this._consume(R.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(R.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(R.tokens.paren_right),e}_paren_expression(){this._consume(R.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(R.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(R.keywords.struct))return null;const e=this._currentLine,n=this._consume(R.tokens.ident,"Expected name for struct.").toString();this._consume(R.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(R.tokens.brace_right);){const l=this._attribute(),c=this._consume(R.tokens.name,"Expected variable name.").toString();this._consume(R.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=f),this._check(R.tokens.brace_right)?this._match(R.tokens.comma):this._consume(R.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new mx(c,h,l)))}this._consume(R.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=this._updateNode(new bi(n,i,e,r),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(R.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof bt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof bt&&(e.type=e.value.type.name==="x32"?se.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(R.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(R.keywords.const))return null;const n=this._consume(R.tokens.name,"Expected variable name"),i=this._currentLine;let r=null;if(this._match(R.tokens.colon)){const f=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=f)}let s=null;this._consume(R.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[se.f32],h=l.constEvaluate(this._exec,f);h instanceof V&&this._validateTypeRange(h.value,f[0]),f[0]instanceof W&&f[0].format===null&&h.typeInfo instanceof Gr&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?f[0].format=se.f16:h.typeInfo.format.name==="f32"?f[0].format=se.f32:h.typeInfo.format.name==="i32"?f[0].format=se.i32:h.typeInfo.format.name==="u32"?f[0].format=se.u32:h.typeInfo.format.name==="bool"?f[0].format=se.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),s=this._updateNode(new bt(h,f[0])),this._exec.context.setVariable(n.toString(),h)}catch{s=l}if(r!==null&&s instanceof bt){if(s.type.name!=="x32"&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else r===null&&s instanceof bt&&(r=(e=s?.type)!==null&&e!==void 0?e:se.f32,r===se.x32&&(r=se.i32));const c=this._updateNode(new xu(n.toString(),r,"","",s),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(R.keywords.let))return null;const e=this._currentLine,n=this._consume(R.tokens.name,"Expected variable name");let i=null;if(this._match(R.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let r=null;if(this._match(R.tokens.equal)&&(r=this._const_expression()),i!==null&&r instanceof bt){if(r.type.name!=="x32"&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i}else i===null&&r instanceof bt&&(i=r.type.name==="x32"?se.i32:r.type);return r instanceof bt&&r.isScalar&&this._validateTypeRange(r.scalarValue,i),this._updateNode(new il(n.toString(),i,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(R.keywords.var))return null;const e=this._currentLine;let n="",i="";this._match(R.tokens.less_than)&&(n=this._consume(R.storage_class,"Expected storage_class.").toString(),this._match(R.tokens.comma)&&(i=this._consume(R.access_mode,"Expected access_mode.").toString()),this._consume(R.tokens.greater_than,"Expected '>'."));const r=this._consume(R.tokens.name,"Expected variable name");let s=null;if(this._match(R.tokens.colon)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}return this._updateNode(new Ti(r.toString(),s,n,i,null),e)}_override_decl(){if(!this._match(R.keywords.override))return null;const e=this._consume(R.tokens.name,"Expected variable name");let n=null;if(this._match(R.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}return this._updateNode(new Om(e.toString(),n,null))}_diagnostic(){this._consume(R.tokens.paren_left,"Expected '('");const e=this._consume(R.tokens.ident,"Expected severity control name.");this._consume(R.tokens.comma,"Expected ','");let n=this._consume(R.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(R.tokens.period)&&(n+=`.${this._consume(R.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(R.tokens.paren_right,"Expected ')'"),this._updateNode(new Aw(e.toString(),n))}_enable_directive(){const e=this._consume(R.tokens.ident,"identity expected.");return this._updateNode(new m4(e.toString()))}_requires_directive(){const e=[this._consume(R.tokens.ident,"identity expected.").toString()];for(;this._match(R.tokens.comma);){const n=this._consume(R.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new _4(e))}_type_alias(){const e=this._consume(R.tokens.ident,"identity expected.");this._consume(R.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const i=this._updateNode(new Nm(e.toString(),n));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([R.tokens.ident,...R.texel_format,R.keywords.bool,R.keywords.f32,R.keywords.i32,R.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const r=this._updateNode(new px(i));return this._forwardTypeCount++,r}return this._updateNode(new se(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(R.template_types)){let i=this._advance().toString(),r=null,s=null;return this._match(R.tokens.less_than)&&(r=this._type_decl(),s=null,this._match(R.tokens.comma)&&(s=this._consume(R.access_mode,"Expected access_mode for pointer").toString()),this._consume(R.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new W(i,r,s))}if(this._match(R.keywords.ptr)){let i=this._previous().toString();this._consume(R.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(R.storage_class,"Expected storage_class for pointer");this._consume(R.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let l=null;return this._match(R.tokens.comma)&&(l=this._consume(R.access_mode,"Expected access_mode for pointer").toString()),this._consume(R.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Tu(i,r.toString(),s,l))}const n=this._attribute();if(this._match(R.keywords.array)){let i=null,r=-1;const s=this._previous();let l=null;if(this._match(R.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(R.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(R.tokens.greater_than,"Expected '>' for array."),r=f?parseInt(f):0}const c=this._updateNode(new rl(s.toString(),n,i,r));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(R.sampler_type))return this._updateNode(new Wa(this._previous().toString(),null,null));if(this._match(R.depth_texture_type))return this._updateNode(new Wa(this._previous().toString(),null,null));if(this._match(R.sampled_texture_type)||this._match(R.multisampled_texture_type)){const e=this._previous();this._consume(R.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(R.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Wa(e.toString(),n,null))}if(this._match(R.storage_texture_type)){const e=this._previous();this._consume(R.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(R.texel_format,"Invalid texel format.").toString();this._consume(R.tokens.comma,"Expected ',' after texel format.");const i=this._consume(R.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(R.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Wa(e.toString(),n,i))}return null}_attribute(){let e=[];for(;this._match(R.tokens.attr);){const n=this._consume(R.attribute_name,"Expected attribute name"),i=this._updateNode(new kw(n.toString(),null));if(this._match(R.tokens.paren_left)){if(i.value=this._consume(R.literal_or_ident,"Expected attribute value").toString(),this._check(R.tokens.comma)){this._advance();do{const r=this._consume(R.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(r)}while(this._match(R.tokens.comma))}this._consume(R.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class N4 extends qn{constructor(e){super(),e&&this.update(e)}update(e){const n=new I4().parse(e);this.updateAST(n)}}function k4(t){const e={attributes:[],bindings:[]};let n;try{n=D4(t)}catch(s){return ue.error(s.message)(),e}for(const s of n.uniforms){const l=[];for(const c of s.type?.members||[])l.push({name:c.name,type:vx(c.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:l})}for(const s of n.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of n.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const i=n.entry.vertex[0],r=i?.inputs.length||0;for(let s=0;s<r;s++){const l=i.inputs[s];if(l.locationType==="location"){const c=vx(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:c})}}return e}function vx(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function D4(t){try{return new N4(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&e?.message&&(n+=`: ${e.message} `),typeof e=="object"&&e?.token&&(n+=e.token.line||""),new Error(n,{cause:e})}}const L4={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...L4}};const yn=globalThis.mathgl.config;function B4(t,{precision:e=yn.precision}={}){return t=U4(t),`${parseFloat(t.toPrecision(e))}`}function vo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ar(t,e,n){return z4(t,i=>Math.max(e,Math.min(n,i)))}function hl(t,e,n){return vo(t)?t.map((i,r)=>hl(i,e[r],n)):n*e+(1-n)*t}function dl(t,e,n){const i=yn.EPSILON;try{if(t===e)return!0;if(vo(t)&&vo(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!dl(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=yn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{yn.EPSILON=i}}function U4(t){return Math.round(t/yn.EPSILON)*yn.EPSILON}function F4(t){return t.clone?t.clone():new Array(t.length)}function z4(t,e,n){if(vo(t)){const i=t;n=n||F4(i);for(let r=0;r<n.length&&r<i.length;++r){const s=typeof t=="number"?t:t[r];n[r]=e(s,r,n)}return n}return e(t)}class Dw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:vo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(yn)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+B4(this[i],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!dl(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r],l=typeof n=="number"?n:n[r];this[r]=s+i*(l-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(yn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function V4(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function rn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Cp(t,e,n=""){if(yn.debug&&!V4(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function bx(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class j4 extends Dw{get x(){return this[0]}set x(e){this[0]=rn(e)}get y(){return this[1]}set y(e){this[1]=rn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return rn(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return rn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bx(e>=0&&e<this.ELEMENTS,"index is out of range"),rn(this[e])}setComponent(e,n){return bx(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Su=1e-6;let bo=typeof Float32Array<"u"?Float32Array:Array;function H4(){const t=new bo(2);return bo!=Float32Array&&(t[0]=0,t[1]=0),t}function xg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function $4(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function W4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function X4(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function Y4(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Lw(t,e,n,i){const r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function q4(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}const K4=$4;(function(){const t=H4();return function(e,n,i,r,s,l){let c,f;for(n||(n=2),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,c=i;c<f;c+=n)t[0]=e[c],t[1]=e[c+1],s(t,t,l),e[c]=t[0],e[c+1]=t[1];return e}})();function Z4(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function Bw(t,e,n){const i=e[0],r=e[1],s=e[2],l=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/l,t[1]=(n[1]*i+n[5]*r+n[9]*s)/l,t[2]=(n[2]*i+n[6]*r+n[10]*s)/l,t}function G4(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function Q4(){const t=new bo(3);return bo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function J4(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function eN(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function tN(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nN(t,e,n){const i=e[0],r=e[1],s=e[2],l=n[0],c=n[1],f=n[2];return t[0]=r*f-s*c,t[1]=s*l-i*f,t[2]=i*c-r*l,t}function Uw(t,e,n){const i=e[0],r=e[1],s=e[2];let l=n[3]*i+n[7]*r+n[11]*s+n[15];return l=l||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/l,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/l,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/l,t}function iN(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function rN(t,e,n){const i=n[0],r=n[1],s=n[2],l=n[3],c=e[0],f=e[1],h=e[2];let p=r*h-s*f,m=s*c-i*h,y=i*f-r*c,v=r*y-s*m,x=s*p-i*y,T=i*m-r*p;const E=l*2;return p*=E,m*=E,y*=E,v*=2,x*=2,T*=2,t[0]=c+p+v,t[1]=f+m+x,t[2]=h+y+T,t}function sN(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function oN(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function aN(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function lN(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],l=e[1],c=e[2],f=Math.sqrt((n*n+i*i+r*r)*(s*s+l*l+c*c)),h=f&&tN(t,e)/f;return Math.acos(Math.min(Math.max(h,-1),1))}const cN=J4;(function(){const t=Q4();return function(e,n,i,r,s,l){let c,f;for(n||(n=3),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,c=i;c<f;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],s(t,t,l),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}})();const Mp=[0,0,0];let eu;class Zn extends j4{static get ZERO(){return eu||(eu=new Zn(0,0,0),Object.freeze(eu)),eu}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&vo(e)?this.copy(e):(yn.debug&&(rn(e),rn(n),rn(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return yn.debug&&(rn(e.x),rn(e.y),rn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=rn(e)}angle(e){return lN(this,e)}cross(e){return nN(this,this,e),this.check()}rotateX({radians:e,origin:n=Mp}){return sN(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Mp}){return oN(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Mp}){return aN(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Uw(this,this,e),this.check()}transformAsVector(e){return Bw(this,this,e),this.check()}transformByMatrix3(e){return iN(this,this,e),this.check()}transformByMatrix2(e){return G4(this,this,e),this.check()}transformByQuaternion(e){return rN(this,this,e),this.check()}}class uN extends Dw{toString(){let e="[";if(yn.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=rn(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function fN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hN(t,e){if(t===e){const n=e[1],i=e[2],r=e[3],s=e[6],l=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=l,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Tg(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],l=e[4],c=e[5],f=e[6],h=e[7],p=e[8],m=e[9],y=e[10],v=e[11],x=e[12],T=e[13],E=e[14],C=e[15],P=n*c-i*l,M=n*f-r*l,I=n*h-s*l,D=i*f-r*c,z=i*h-s*c,ae=r*h-s*f,he=p*T-m*x,le=p*E-y*x,ge=p*C-v*x,Z=m*E-y*T,ce=m*C-v*T,de=y*C-v*E;let pe=P*de-M*ce+I*Z+D*ge-z*le+ae*he;return pe?(pe=1/pe,t[0]=(c*de-f*ce+h*Z)*pe,t[1]=(r*ce-i*de-s*Z)*pe,t[2]=(T*ae-E*z+C*D)*pe,t[3]=(y*z-m*ae-v*D)*pe,t[4]=(f*ge-l*de-h*le)*pe,t[5]=(n*de-r*ge+s*le)*pe,t[6]=(E*I-x*ae-C*M)*pe,t[7]=(p*ae-y*I+v*M)*pe,t[8]=(l*ce-c*ge+h*he)*pe,t[9]=(i*ge-n*ce-s*he)*pe,t[10]=(x*z-T*I+C*P)*pe,t[11]=(m*I-p*z-v*P)*pe,t[12]=(c*le-l*Z-f*he)*pe,t[13]=(n*Z-i*le+r*he)*pe,t[14]=(T*M-x*D-E*P)*pe,t[15]=(p*D-m*M+y*P)*pe,t):null}function dN(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],l=t[5],c=t[6],f=t[7],h=t[8],p=t[9],m=t[10],y=t[11],v=t[12],x=t[13],T=t[14],E=t[15],C=e*l-n*s,P=e*c-i*s,M=n*c-i*l,I=h*x-p*v,D=h*T-m*v,z=p*T-m*x,ae=e*z-n*D+i*I,he=s*z-l*D+c*I,le=h*M-p*P+m*C,ge=v*M-x*P+T*C;return f*ae-r*he+E*le-y*ge}function Xr(t,e,n){const i=e[0],r=e[1],s=e[2],l=e[3],c=e[4],f=e[5],h=e[6],p=e[7],m=e[8],y=e[9],v=e[10],x=e[11],T=e[12],E=e[13],C=e[14],P=e[15];let M=n[0],I=n[1],D=n[2],z=n[3];return t[0]=M*i+I*c+D*m+z*T,t[1]=M*r+I*f+D*y+z*E,t[2]=M*s+I*h+D*v+z*C,t[3]=M*l+I*p+D*x+z*P,M=n[4],I=n[5],D=n[6],z=n[7],t[4]=M*i+I*c+D*m+z*T,t[5]=M*r+I*f+D*y+z*E,t[6]=M*s+I*h+D*v+z*C,t[7]=M*l+I*p+D*x+z*P,M=n[8],I=n[9],D=n[10],z=n[11],t[8]=M*i+I*c+D*m+z*T,t[9]=M*r+I*f+D*y+z*E,t[10]=M*s+I*h+D*v+z*C,t[11]=M*l+I*p+D*x+z*P,M=n[12],I=n[13],D=n[14],z=n[15],t[12]=M*i+I*c+D*m+z*T,t[13]=M*r+I*f+D*y+z*E,t[14]=M*s+I*h+D*v+z*C,t[15]=M*l+I*p+D*x+z*P,t}function Gu(t,e,n){const i=n[0],r=n[1],s=n[2];let l,c,f,h,p,m,y,v,x,T,E,C;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(l=e[0],c=e[1],f=e[2],h=e[3],p=e[4],m=e[5],y=e[6],v=e[7],x=e[8],T=e[9],E=e[10],C=e[11],t[0]=l,t[1]=c,t[2]=f,t[3]=h,t[4]=p,t[5]=m,t[6]=y,t[7]=v,t[8]=x,t[9]=T,t[10]=E,t[11]=C,t[12]=l*i+p*r+x*s+e[12],t[13]=c*i+m*r+T*s+e[13],t[14]=f*i+y*r+E*s+e[14],t[15]=h*i+v*r+C*s+e[15]),t}function Fm(t,e,n){const i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function pN(t,e,n,i){let r=i[0],s=i[1],l=i[2],c=Math.sqrt(r*r+s*s+l*l),f,h,p,m,y,v,x,T,E,C,P,M,I,D,z,ae,he,le,ge,Z,ce,de,pe,Ae;return c<Su?null:(c=1/c,r*=c,s*=c,l*=c,h=Math.sin(n),f=Math.cos(n),p=1-f,m=e[0],y=e[1],v=e[2],x=e[3],T=e[4],E=e[5],C=e[6],P=e[7],M=e[8],I=e[9],D=e[10],z=e[11],ae=r*r*p+f,he=s*r*p+l*h,le=l*r*p-s*h,ge=r*s*p-l*h,Z=s*s*p+f,ce=l*s*p+r*h,de=r*l*p+s*h,pe=s*l*p-r*h,Ae=l*l*p+f,t[0]=m*ae+T*he+M*le,t[1]=y*ae+E*he+I*le,t[2]=v*ae+C*he+D*le,t[3]=x*ae+P*he+z*le,t[4]=m*ge+T*Z+M*ce,t[5]=y*ge+E*Z+I*ce,t[6]=v*ge+C*Z+D*ce,t[7]=x*ge+P*Z+z*ce,t[8]=m*de+T*pe+M*Ae,t[9]=y*de+E*pe+I*Ae,t[10]=v*de+C*pe+D*Ae,t[11]=x*de+P*pe+z*Ae,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Fw(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[4],l=e[5],c=e[6],f=e[7],h=e[8],p=e[9],m=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+h*i,t[5]=l*r+p*i,t[6]=c*r+m*i,t[7]=f*r+y*i,t[8]=h*r-s*i,t[9]=p*r-l*i,t[10]=m*r-c*i,t[11]=y*r-f*i,t}function gN(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],l=e[1],c=e[2],f=e[3],h=e[8],p=e[9],m=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-h*i,t[1]=l*r-p*i,t[2]=c*r-m*i,t[3]=f*r-y*i,t[8]=s*i+h*r,t[9]=l*i+p*r,t[10]=c*i+m*r,t[11]=f*i+y*r,t}function zw(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],l=e[1],c=e[2],f=e[3],h=e[4],p=e[5],m=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+h*i,t[1]=l*r+p*i,t[2]=c*r+m*i,t[3]=f*r+y*i,t[4]=h*r-s*i,t[5]=p*r-l*i,t[6]=m*r-c*i,t[7]=y*r-f*i,t}function mN(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],l=n+n,c=i+i,f=r+r,h=n*l,p=i*l,m=i*c,y=r*l,v=r*c,x=r*f,T=s*l,E=s*c,C=s*f;return t[0]=1-m-x,t[1]=p+C,t[2]=y-E,t[3]=0,t[4]=p-C,t[5]=1-h-x,t[6]=v+T,t[7]=0,t[8]=y+E,t[9]=v-T,t[10]=1-h-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _N(t,e,n,i,r,s,l){const c=1/(n-e),f=1/(r-i),h=1/(s-l);return t[0]=s*2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*f,t[6]=0,t[7]=0,t[8]=(n+e)*c,t[9]=(r+i)*f,t[10]=(l+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*s*2*h,t[15]=0,t}function yN(t,e,n,i,r){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const l=1/(i-r);t[10]=(r+i)*l,t[14]=2*r*i*l}else t[10]=-1,t[14]=-2*i;return t}const vN=yN;function bN(t,e,n,i,r,s,l){const c=1/(e-n),f=1/(i-r),h=1/(s-l);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*c,t[13]=(r+i)*f,t[14]=(l+s)*h,t[15]=1,t}const xN=bN;function TN(t,e,n,i){let r,s,l,c,f,h,p,m,y,v;const x=e[0],T=e[1],E=e[2],C=i[0],P=i[1],M=i[2],I=n[0],D=n[1],z=n[2];return Math.abs(x-I)<Su&&Math.abs(T-D)<Su&&Math.abs(E-z)<Su?fN(t):(m=x-I,y=T-D,v=E-z,r=1/Math.sqrt(m*m+y*y+v*v),m*=r,y*=r,v*=r,s=P*v-M*y,l=M*m-C*v,c=C*y-P*m,r=Math.sqrt(s*s+l*l+c*c),r?(r=1/r,s*=r,l*=r,c*=r):(s=0,l=0,c=0),f=y*c-v*l,h=v*s-m*c,p=m*l-y*s,r=Math.sqrt(f*f+h*h+p*p),r?(r=1/r,f*=r,h*=r,p*=r):(f=0,h=0,p=0),t[0]=s,t[1]=f,t[2]=m,t[3]=0,t[4]=l,t[5]=h,t[6]=y,t[7]=0,t[8]=c,t[9]=p,t[10]=v,t[11]=0,t[12]=-(s*x+l*T+c*E),t[13]=-(f*x+h*T+p*E),t[14]=-(m*x+y*T+v*E),t[15]=1,t)}function wN(){const t=new bo(4);return bo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function SN(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Al(t,e,n){const i=e[0],r=e[1],s=e[2],l=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*l,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*l,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*l,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*l,t}(function(){const t=wN();return function(e,n,i,r,s,l){let c,f;for(n||(n=4),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,c=i;c<f;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],s(t,t,l),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}})();var wg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(wg||(wg={}));const AN=45*Math.PI/180,EN=1,Pp=.1,Op=500,RN=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gn extends uN{static get IDENTITY(){return MN()}static get ZERO(){return CN()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return wg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,l,c,f,h,p,m,y,v,x,T,E){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=l,this[6]=c,this[7]=f,this[8]=h,this[9]=p,this[10]=m,this[11]=y,this[12]=v,this[13]=x,this[14]=T,this[15]=E,this.check()}setRowMajor(e,n,i,r,s,l,c,f,h,p,m,y,v,x,T,E){return this[0]=e,this[1]=s,this[2]=h,this[3]=v,this[4]=n,this[5]=l,this[6]=p,this[7]=x,this[8]=i,this[9]=c,this[10]=m,this[11]=T,this[12]=r,this[13]=f,this[14]=y,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(RN)}fromObject(e){return this.check()}fromQuaternion(e){return mN(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:l=Pp,far:c=Op}=e;return c===1/0?PN(this,n,i,r,s,l):_N(this,n,i,r,s,l,c),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return TN(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:l=Pp,far:c=Op}=e;return xN(this,n,i,r,s,l,c),this.check()}orthographic(e){const{fovy:n=AN,aspect:i=EN,focalDistance:r=1,near:s=Pp,far:l=Op}=e;xx(n);const c=n/2,f=r*Math.tan(c),h=f*i;return this.ortho({left:-h,right:h,bottom:-f,top:f,near:s,far:l})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return xx(n),vN(this,n,i,r,s),this.check()}determinant(){return dN(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],l=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],l=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*l,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*l,e}transpose(){return hN(this,this),this.check()}invert(){return Tg(this,this),this.check()}multiplyLeft(e){return Xr(this,e,this),this.check()}multiplyRight(e){return Xr(this,this,e),this.check()}rotateX(e){return Fw(this,this,e),this.check()}rotateY(e){return gN(this,this,e),this.check()}rotateZ(e){return zw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return pN(this,this,e,n),this.check()}scale(e){return Fm(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Gu(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Al(n||[-0,-0,-0,-0],e,this),Cp(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=q4(n||[-0,-0],e,this);break;case 3:r=Uw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Cp(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=Z4(n||[-0,-0],e,this);break;case 3:i=Bw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Cp(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let tu,nu;function CN(){return tu||(tu=new Gn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(tu)),tu}function MN(){return nu||(nu=new Gn,Object.freeze(nu)),nu}function xx(t){if(t>Math.PI*2)throw Error("expected radians")}function PN(t,e,n,i,r,s){const l=2*s/(n-e),c=2*s/(r-i),f=(n+e)/(n-e),h=(r+i)/(r-i),p=-1,m=-1,y=-2*s;return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=f,t[9]=h,t[10]=p,t[11]=m,t[12]=0,t[13]=0,t[14]=y,t[15]=0,t}function Vw(t,e=[],n=0){const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function ON(t){return t-Math.fround(t)}function IN(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=n*4+i;Vw(t[i*4+n],e,r*2)}return e}const NN=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,kN={name:"fp32",vs:NN},DN=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,LN={ONE:1},BN={name:"fp64arithmetic",vs:DN,defaultUniforms:LN,uniformTypes:{ONE:"f32"},fp64ify:Vw,fp64LowPart:ON,fp64ifyMatrix4:IN},UN=[0,1,1,1],FN=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,zN=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Tx={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:UN},vs:FN,fs:zN,getUniforms:VN};function VN(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,r=>r/255);Number.isFinite(i[3])||(i[3]=1),n.highlightColor=i}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const wx=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,jN=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,jw=3,HN=255;var pl;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(pl||(pl={}));const Au={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:jw},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:pl.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:jN,vs:wx,fs:wx,getUniforms:$N};function $N(t,e={}){if(t=t&&{...t},!t)return{...Au.defaultUniforms};t.lights&&(t={...t,...XN(t.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=t||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...Au.defaultUniforms,enabled:0};const l={...Au.defaultUniforms,...e,...WN({ambientLight:n,pointLights:i,directionalLights:r})};return t.enabled!==void 0&&(l.enabled=t.enabled?1:0),l}function WN({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};i.ambientLightColor=Ip(t);let r=0;for(const s of e){i.lightType=pl.POINT;const l=r;i[`lightColor${l}`]=Ip(s),i[`lightPosition${l}`]=s.position,i[`lightAttenuation${l}`]=s.attenuation||[1,0,0],r++}for(const s of n){i.lightType=pl.DIRECTIONAL;const l=r;i[`lightColor${l}`]=Ip(s),i[`lightDirection${l}`]=s.direction,r++}return r>jw&&ue.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=e.length,i}function XN(t){const e={pointLights:[],directionalLights:[]};for(const n of t||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights?.push(n);break;case"point":e.pointLights?.push(n);break}return e}function Ip(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(i=>i*n/HN)}const YN=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,qN=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,KN=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Hw={props:{},name:"gouraudMaterial",vs:qN.replace("phongMaterial","gouraudMaterial"),fs:YN.replace("phongMaterial","gouraudMaterial"),source:KN.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Au],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...Hw.defaultUniforms,...e}}},Sx=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,ZN={name:"layer",vs:Sx,fs:Sx,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},GN=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,$w="#define SMOOTH_EDGE_RADIUS 0.5",QN=`${$w}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,JN=`${$w}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Ww={name:"geometry",source:GN,vs:QN,fs:JN},ek=25;var _t;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(_t||(_t={}));var xt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(xt||(xt={}));var Re;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Re||(Re={}));const tk="compute",nk="auto",Sg="manipulation",Eu="none",Ag="pan-x",Eg="pan-y";function ik(t){if(t.includes(Eu))return Eu;const e=t.includes(Ag),n=t.includes(Eg);return e&&n?Eu:e||n?e?Ag:Eg:t.includes(Sg)?Sg:nk}class rk{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===tk&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return ik(e.join(" "))}}function Qu(t){return t.trim().split(/\s+/g)}function Np(t,e,n){if(t)for(const i of Qu(e))t.addEventListener(i,n,!1)}function kp(t,e,n){if(t)for(const i of Qu(e))t.removeEventListener(i,n,!1)}function Ax(t){return(t.ownerDocument||t).defaultView}function sk(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function Xw(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,i=0,r=0;for(;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:Math.round(n/e),y:Math.round(i/e)}}function Ex(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:Xw(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Yw(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function Rx(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(n*n+i*i)}function ok(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)*180/Math.PI}function Cx(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,n)*180/Math.PI}function qw(t,e){return t===e?xt.None:Math.abs(t)>=Math.abs(e)?t<0?xt.Left:xt.Right:e<0?xt.Up:xt.Down}function ak(t,e){const n=e.center;let i=t.offsetDelta,r=t.prevDelta;const s=t.prevInput;return(e.eventType===_t.Start||s?.eventType===_t.End)&&(r=t.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}function Kw(t,e,n){return{x:e/t||0,y:n/t||0}}function lk(t,e){return Rx(e[0],e[1])/Rx(t[0],t[1])}function ck(t,e){return Cx(e[1],e[0])-Cx(t[1],t[0])}function uk(t,e){const n=t.lastInterval||e,i=e.timeStamp-n.timeStamp;let r,s,l,c;if(e.eventType!==_t.Cancel&&(i>ek||n.velocity===void 0)){const f=e.deltaX-n.deltaX,h=e.deltaY-n.deltaY,p=Kw(i,f,h);s=p.x,l=p.y,r=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,c=qw(f,h),t.lastInterval=e}else r=n.velocity,s=n.velocityX,l=n.velocityY,c=n.direction;e.velocity=r,e.velocityX=s,e.velocityY=l,e.direction=c}function fk(t,e){const{session:n}=t,{pointers:i}=e,{length:r}=i;n.firstInput||(n.firstInput=Ex(e)),r>1&&!n.firstMultiple?n.firstMultiple=Ex(e):r===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:l}=n,c=l?l.center:s.center,f=e.center=Xw(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=ok(c,f),e.distance=Yw(c,f);const{deltaX:h,deltaY:p}=ak(n,e);e.deltaX=h,e.deltaY=p,e.offsetDirection=qw(e.deltaX,e.deltaY);const m=Kw(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=l?lk(l.pointers,i):1,e.rotation=l?ck(l.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let y=t.element;return sk(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,uk(n,e),e}function hk(t,e,n){const i=n.pointers.length,r=n.changedPointers.length,s=e&_t.Start&&i-r===0,l=e&(_t.End|_t.Cancel)&&i-r===0;n.isFirst=!!s,n.isFinal=!!l,s&&(t.session={}),n.eventType=e;const c=fk(t,n);t.emit("hammer.input",c),t.recognize(c),t.session.prevInput=c}let dk=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){hk(this.manager,e,n)}init(){Np(this.element,this.evEl,this.domHandler),Np(this.target,this.evTarget,this.domHandler),Np(Ax(this.element),this.evWin,this.domHandler)}destroy(){kp(this.element,this.evEl,this.domHandler),kp(this.target,this.evTarget,this.domHandler),kp(Ax(this.element),this.evWin,this.domHandler)}};const pk={pointerdown:_t.Start,pointermove:_t.Move,pointerup:_t.End,pointercancel:_t.Cancel,pointerout:_t.Cancel},gk="pointerdown",mk="pointermove pointerup pointercancel";class _k extends dk{constructor(e){super(e),this.evEl=gk,this.evWin=mk,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let i=!1;const r=pk[e.type],s=e.pointerType,l=s==="touch";let c=n.findIndex(f=>f.pointerId===e.pointerId);r&_t.Start&&(e.buttons||l)?c<0&&(n.push(e),c=n.length-1):r&(_t.End|_t.Cancel)&&(i=!0),!(c<0)&&(n[c]=e,this.callback(r,{pointers:n,changedPointers:[e],eventType:r,pointerType:s,srcEvent:e}),i&&n.splice(c,1))}}const yk=["","webkit","Moz","MS","ms","o"];function vk(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const i of yk){const r=i?i+n:e;if(r in t)return r}}const bk=1,Mx=2,Px={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class xk{constructor(e,n){this.options={...Px,...n,cssProps:{...Px.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new _k(this),this.touchAction=new rk(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Mx:bk}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:r}=this;let{curRecognizer:s}=n;(!s||s&&s.state&Re.Recognized)&&(s=n.curRecognizer=null);let l=0;for(;l<r.length;)i=r[l],n.stopped!==Mx&&(!s||i===s||i.canRecognizeWith(s))?i.recognize(e):i.reset(),!s&&i.state&(Re.Began|Re.Changed|Re.Ended)&&(s=n.curRecognizer=i),l++}get(e){const{recognizers:n}=this;for(let i=0;i<n.length;i++)if(n[i].options.event===e)return n[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:i}=this,r=i.indexOf(n);r!==-1&&(i.splice(r,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:i}=this;for(const r of Qu(e))i[r]=i[r]||[],i[r].push(n)}off(e,n){if(!e)return;const{handlers:i}=this;for(const r of Qu(e))n?i[r]&&i[r].splice(i[r].indexOf(n),1):delete i[r]}emit(e,n){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const r=n;r.type=e,r.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<i.length;)i[s](r),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[i,r]of Object.entries(this.options.cssProps)){const s=vk(n.style,i);e?(this.oldCssProps[s]=n.style[s],n.style[s]=r):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let Tk=1;function wk(){return Tk++}function Ox(t){return t&Re.Cancelled?"cancel":t&Re.Ended?"end":t&Re.Changed?"move":t&Re.Began?"start":""}class Zw{constructor(e){this.options=e,this.id=wk(),this.state=Re.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const r of e)this.recognizeWith(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:i}=this;return i[n.id]||(i[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const r of e)this.requireFailure(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:i}=this;return i.indexOf(n)===-1&&(i.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const i=this.requireFail.indexOf(n);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<Re.Ended&&this.manager.emit(this.options.event+Ox(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=Re.Ended&&this.manager.emit(this.options.event+Ox(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Re.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Re.Failed|Re.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=Re.Failed;return}this.state&(Re.Recognized|Re.Cancelled|Re.Failed)&&(this.state=Re.Possible),this.state=this.process(n),this.state&(Re.Began|Re.Changed|Re.Ended|Re.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class Gw extends Zw{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:i}=e,r=n&(Re.Began|Re.Changed),s=this.attrTest(e);return r&&(i&_t.Cancel||!s)?n|Re.Cancelled:r||s?i&_t.End?n|Re.Ended:n&Re.Began?n|Re.Changed:Re.Began:Re.Failed}}class Ix extends Zw{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Sg]}process(e){const{options:n}=this,i=e.pointers.length===n.pointers,r=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&_t.Start&&this.count===0)return this.failTimeout();if(r&&s&&i){if(e.eventType!==_t.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<n.interval:!0,c=!this.pCenter||Yw(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!l?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Re.Recognized,this.tryEmit(this._input)},n.interval),Re.Began):Re.Recognized}return Re.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Re.Failed},this.options.interval),Re.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Re.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const Sk=["","start","move","end","cancel","up","down","left","right"];class Nx extends Gw{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:xt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&xt.Horizontal&&n.push(Eg),e&xt.Vertical&&n.push(Ag),n}getEventNames(){return Sk.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let i=!0,{distance:r}=e,{direction:s}=e;const l=e.deltaX,c=e.deltaY;return s&n.direction||(n.direction&xt.Horizontal?(s=l===0?xt.None:l<0?xt.Left:xt.Right,i=l!==this.pX,r=Math.abs(e.deltaX)):(s=c===0?xt.None:c<0?xt.Up:xt.Down,i=c!==this.pY,r=Math.abs(e.deltaY))),e.direction=s,i&&r>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Re.Began)||!(this.state&Re.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=xt[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const Ak=["","start","move","end","cancel","in","out"];class Ek extends Gw{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Eu]}getEventNames(){return Ak.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Re.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class If{constructor(e,n,i){this.element=e,this.callback=n,this.options=i}}const Rk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ck=Rk.indexOf("firefox")!==-1,kx=4.000244140625,Mk=40,Pk=.25;class Ok extends If{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;globalThis.WheelEvent&&(Ck&&r.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),r.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=Mk)),s!==0&&s%kx===0&&(s=Math.floor(s/kx)),r.shiftKey&&s&&(s=s*Pk),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const Dx=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Ik extends If{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,Dx.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Dx.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const Lx=["keydown","keyup"];class Nk extends If{constructor(e,n,i){super(e,n,{enable:!0,tabIndex:0,...i}),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:"keydown",srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Lx.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){Lx.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class kk extends If{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const Bx=1,Rg=2,Ux=4,Dk={pointerdown:Bx,pointermove:Rg,pointerup:Ux,mousedown:Bx,mousemove:Rg,mouseup:Ux},Lk=0,Bk=1,Uk=2,Fk=1,zk=2,Vk=4;function jk(t){const e=Dk[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i}=t.srcEvent;let r=!1,s=!1,l=!1;return e===Rg?(r=!!(n&Fk),s=!!(n&Vk),l=!!(n&zk)):(r=i===Lk,s=i===Bk,l=i===Uk),{leftButton:r,middleButton:s,rightButton:l}}function Hk(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,l={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:l}}const $k={srcElement:"root",priority:0};class Wk{constructor(e,n){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let s=i.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:l,handlersByElement:c}=this,f={...$k,...i};let h=c.get(f.srcElement);h||(h=[],c.set(f.srcElement,h));const p={type:e,handler:n,srcElement:f.srcElement,priority:f.priority};r&&(p.once=!0),s&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let m=h.length-1;for(;m>=0&&!(h[m].priority>=p.priority);)m--;h.splice(m+1,0,p)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const l=i[s];if(l.type===e&&l.handler===n){i.splice(s,1);const c=r.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&r.delete(l.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},l=()=>{e.handled=!0,r=!0},c=[];for(let f=0;f<i.length;f++){const{type:h,handler:p,once:m}=i[f];if(p({...e,type:h,stopPropagation:s,stopImmediatePropagation:l}),m&&c.push(i[f]),r)break}for(let f=0;f<c.length;f++){const{type:h,handler:p}=c[f];this.remove(h,p)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...jk(e),...Hk(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function Xk(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const i=n.shift(),r=n.shift()||{};e=new i(r)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class Yk{constructor(e=null,n={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new xk(e,this.options);for(const i of this.options.recognizers){const{recognizer:r,recognizeWith:s,requireFailure:l}=Xk(i);this.manager.add(r),s&&r.recognizeWith(s),l&&r.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Ok(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Ik(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Nk(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new kk(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);r&&(r.set({enable:n}),i.touchAction.update()),this.wheelInput?.enableEventType(e,n),this.moveInput?.enableEventType(e,n),this.keyInput?.enableEventType(e,n),this.contextmenuInput?.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const[h,p]of Object.entries(e))this._addEventHandler(h,p,i,r,s);return}const{manager:l,events:c}=this;if(!l)return;let f=c.get(e);if(!f){const h=this._getRecognizerName(e)||e;f=new Wk(this,h),c.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,n,i,r,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,l]of Object.entries(e))this._removeEventHandler(s,l);return}const{events:i}=this,r=i.get(e);if(r&&(r.remove(e,n),r.isEmpty())){const{recognizerName:s}=r;let l=!1;for(const c of i.values())if(c.recognizerName===s&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(n=>n.getEventNames().includes(e))?.options.event}}const Le={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Le,"IDENTITY",{get:()=>(Ne.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const mn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qn={common:0,meters:1,pixels:2},Cg={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Fx={multipan:[Nx,{threshold:10,direction:xt.Vertical,pointers:2}],pinch:[Ek,{},null,["multipan"]],pan:[Nx,{threshold:1},["pinch"],["multipan"]],dblclick:[Ix,{event:"dblclick",taps:2}],click:[Ix,{event:"click"},null,["dblclick"]]};function qk(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function El(t){let e={},n;return i=>{for(const r in i)if(!qk(i[r],e[r])){n=t(i),e=i;break}return n}}const zx=[0,0,0,0],Kk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Qw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Zk=[0,0,0],Jw=[0,0,0],Gk=El(eD);function e2(t,e,n=Jw){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===Le.LNGLAT_OFFSETS||e===Le.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case mn.WEB_MERCATOR:(e===Le.LNGLAT||e===Le.CARTESIAN)&&(r=[0,0,0],s=!1);break;case mn.WEB_MERCATOR_AUTO_OFFSET:e===Le.LNGLAT?i=r:e===Le.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case mn.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case mn.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function Qk(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:l}=t,c=zx,f=zx,h=t.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:m,offsetMode:y}=e2(t,e,n);return y&&(f=t.projectPosition(p||m),h=[h[0]-f[0],h[1]-f[1],h[2]-f[2]],f[3]=1,c=Al([],f,l),s=i||s,l=Xr([],r,s),l=Xr([],l,Kk)),{viewMatrix:s,viewProjectionMatrix:l,projectionCenter:c,originCommon:f,cameraPosCommon:h,shaderCoordinateOrigin:m,geospatialOrigin:p}}function Jk({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Le.DEFAULT,coordinateOrigin:r=Jw,autoWrapLongitude:s=!1}){i===Le.DEFAULT&&(i=t.isGeospatial?Le.LNGLAT:Le.CARTESIAN);const l=Gk({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return l.wrapLongitude=s,l.modelMatrix=n||Qw,l}function eD({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:h}=Qk(t,n,i),p=t.getDistanceScales(),m=[t.width*e,t.height*e],y=Al([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,v={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:r,pseudoMeters:!!t._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:Zk,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Qw,cameraPosition:c};if(h){const x=t.getDistanceScales(h);switch(n){case Le.METER_OFFSETS:v.commonUnitsPerWorldUnit=x.unitsPerMeter,v.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case Le.LNGLAT:case Le.LNGLAT_OFFSETS:t._pseudoMeters||(v.commonUnitsPerMeter=x.unitsPerMeter),v.commonUnitsPerWorldUnit=x.unitsPerDegree,v.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case Le.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return v}const tD=Object.keys(Le).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Le[t]};`).join(""),nD=Object.keys(mn).map(t=>`const PROJECTION_MODE_${t}: i32 = ${mn[t]};`).join(""),iD=Object.keys(Qn).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Qn[t]};`).join(""),rD=`${tD}
${nD}
${iD}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,sD=`${rD}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,oD=Object.keys(Le).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Le[t]};`).join(""),aD=Object.keys(mn).map(t=>`const int PROJECTION_MODE_${t} = ${mn[t]};`).join(""),lD=Object.keys(Qn).map(t=>`const int UNIT_${t.toUpperCase()} = ${Qn[t]};`).join(""),cD=`${oD}
${aD}
${lD}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,uD={};function fD(t=uD){return"viewport"in t?Jk(t):{}}const zm={name:"project",dependencies:[kN,Ww],source:sD,vs:cD,getUniforms:fD,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},hD=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,dD=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Do={name:"project32",dependencies:[zm],source:hD,vs:dD};function pD(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ho(t,e){const n=Al([],e,t);return SN(n,n,1/n[3]),n}function Vx(t,e){const n=t%e;return n<0?e+n:n}function gD(t,e,n){return n*e+(1-n)*t}function Mg(t,e,n){return t<e?e:t>n?n:t}function mD(t){return Math.log(t)*Math.LOG2E}const Vm=Math.log2||mD;function Ai(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Pn=Math.PI,t2=Pn/4,vn=Pn/180,Pg=180/Pn,xo=512,Ju=4003e4,iu=85.051129,_D=1.5;function jx(t){return Math.pow(2,t)}function n2(t){return Vm(t)}function To(t){const[e,n]=t;Ai(Number.isFinite(e)),Ai(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*vn,r=n*vn,s=xo*(i+Pn)/(2*Pn),l=xo*(Pn+Math.log(Math.tan(t2+r*.5)))/(2*Pn);return[s,l]}function Jr(t){const[e,n]=t,i=e/xo*(2*Pn)-Pn,r=2*(Math.atan(Math.exp(n/xo*(2*Pn)-Pn))-t2);return[i*Pg,r*Pg]}function yD(t){const{latitude:e}=t;Ai(Number.isFinite(e));const n=Math.cos(e*vn);return n2(Ju*n)-9}function Dp(t){const e=Math.cos(t*vn);return xo/Ju/e}function Og(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Ai(Number.isFinite(e)&&Number.isFinite(n));const r=xo,s=Math.cos(e*vn),l=r/360,c=l/s,f=r/Ju/s,h={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,c,f],degreesPerUnit:[1/l,1/c,1/f]};if(i){const p=vn*Math.tan(e*vn)/s,m=l*p/2,y=r/Ju*p,v=y/c*f;h.unitsPerDegree2=[0,m,y],h.unitsPerMeter2=[v,0,v]}return h}function i2(t,e){const[n,i,r]=t,[s,l,c]=e,{unitsPerMeter:f,unitsPerMeter2:h}=Og({longitude:n,latitude:i,highPrecision:!0}),p=To(t);p[0]+=s*(f[0]+h[0]*l),p[1]+=l*(f[1]+h[1]*l);const m=Jr(p),y=(r||0)+(c||0);return Number.isFinite(r)||Number.isFinite(c)?[m[0],m[1],y]:m}function vD(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:l}=t,c=pD();Gu(c,c,[0,0,-r]),Fw(c,c,-n*vn),zw(c,c,i*vn);const f=s/e;return Fm(c,c,[f,f,f]),l&&Gu(c,c,eN([],l)),c}function bD(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:l,scale:c,nearZMultiplier:f=1,farZMultiplier:h=1}=t;let{fovy:p=ef(_D)}=t;i!==void 0&&(p=ef(i));const m=p*vn,y=r*vn,v=r2(p);let x=v;l&&(x+=l[2]*c/Math.cos(y)/n);const T=m*(.5+(s?s[1]:0)/n),E=Math.sin(T)*x/Math.sin(Mg(Math.PI/2-y-T,.01,Math.PI-.01)),C=Math.sin(y)*E+x,P=x*10,M=Math.min(C*h,P);return{fov:m,aspect:e/n,focalDistance:v,near:f,far:M}}function ef(t){return 2*Math.atan(.5/t)*Pg}function r2(t){return .5/Math.tan(.5*t*vn)}function s2(t,e){const[n,i,r=0]=t;return Ai(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),ho(e,[n,i,r,1])}function jm(t,e,n=0){const[i,r,s]=t;if(Ai(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return ho(e,[i,r,s,1]);const l=ho(e,[i,r,0,1]),c=ho(e,[i,r,1,1]),f=l[2],h=c[2],p=f===h?0:((n||0)-f)/(h-f);return Lw([],l,c,p)}function xD(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:l=[0,0]}=t,[[c,f],[h,p]]=i,m=TD(t.padding),y=To([c,Mg(p,-iu,iu)]),v=To([h,Mg(f,-iu,iu)]),x=[Math.max(Math.abs(v[0]-y[0]),r),Math.max(Math.abs(v[1]-y[1]),r)],T=[e-m.left-m.right-Math.abs(l[0])*2,n-m.top-m.bottom-Math.abs(l[1])*2];Ai(T[0]>0&&T[1]>0);const E=T[0]/x[0],C=T[1]/x[1],P=(m.right-m.left)/2/E,M=(m.top-m.bottom)/2/C,I=[(v[0]+y[0])/2+P,(v[1]+y[1])/2+M],D=Jr(I),z=Math.min(s,Vm(Math.abs(Math.min(E,C))));return Ai(Number.isFinite(z)),{longitude:D[0],latitude:D[1],zoom:z}}function TD(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ai(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Hx=Math.PI/180;function wD(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},l=r([0,i],s),c=r([n,i],s);let f,h;const p=t.fovy?.5*t.fovy*Hx:Math.atan(.5/t.altitude),m=(90-t.pitch)*Hx;return p>m-.01?(f=$x(t,0,e),h=$x(t,n,e)):(f=r([0,0],s),h=r([n,0],s)),[l,c,h,f]}function $x(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=ho(i,[e,0,1,1]),s=ho(i,[e,t.height,1,1]),c=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),f=Lw([],r,s,c),h=Jr(f);return h.push(n),h}const Wx=512;function SD(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:l,bearing:c=0}=t;(r<-180||r>180)&&(r=Vx(r+180,360)-180),(c<-180||c>180)&&(c=Vx(c+180,360)-180);const f=Vm(n/Wx);if(l<=f)l=f,s=0;else{const h=n/2/Math.pow(2,l),p=Jr([0,h])[1];if(s<p)s=p;else{const m=Jr([0,Wx-h])[1];s>m&&(s=m)}}return{width:e,height:n,longitude:r,latitude:s,zoom:l,pitch:i,bearing:c}}const o2=.01,AD=["longitude","latitude","zoom"],a2={curve:1.414,speed:1.2};function ED(t,e,n,i){const{startZoom:r,startCenterXY:s,uDelta:l,w0:c,u1:f,S:h,rho:p,rho2:m,r0:y}=l2(t,e,i);if(f<o2){const I={};for(const D of AD){const z=t[D],ae=e[D];I[D]=gD(z,ae,n)}return I}const v=n*h,x=Math.cosh(y)/Math.cosh(y+p*v),T=c*((Math.cosh(y)*Math.tanh(y+p*v)-Math.sinh(y))/m)/f,E=1/x,C=r+n2(E),P=W4([],l,T);xg(P,P,s);const M=Jr(P);return{longitude:M[0],latitude:M[1],zoom:C}}function RD(t,e,n){const i={...a2,...n},{screenSpeed:r,speed:s,maxDuration:l}=i,{S:c,rho:f}=l2(t,e,i),h=1e3*c;let p;return Number.isFinite(r)?p=h/(r/f):p=h/s,Number.isFinite(l)&&p>l?0:p}function l2(t,e,n){n=Object.assign({},a2,n);const i=n.curve,r=t.zoom,s=[t.longitude,t.latitude],l=jx(r),c=e.zoom,f=[e.longitude,e.latitude],h=jx(c-r),p=To(s),m=To(f),y=K4([],m,p),v=Math.max(t.width,t.height),x=v/h,T=X4(y)*l,E=Math.max(T,o2),C=i*i,P=(x*x-v*v+C*C*E*E)/(2*v*C*E),M=(x*x-v*v-C*C*E*E)/(2*x*C*E),I=Math.log(Math.sqrt(P*P+1)-P),D=Math.log(Math.sqrt(M*M+1)-M),z=(D-I)/i;return{startZoom:r,startCenterXY:p,uDelta:y,w0:v,u1:T,S:z,rho:i,rho2:C,r0:I,r1:D}}const c2=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,CD=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MD=`
${c2}
${CD}
`,PD=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,OD=`
${c2}
${PD}
`,ID=El(BD),ND=El(UD),kD=[0,0,0,1],DD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function LD(t,e){const[n,i,r]=t,s=jm([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function BD({viewport:t,center:e}){return new Gn(t.viewProjectionMatrix).invert().transform(e)}function UD({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>LD(l,i));for(const l of e){const c=l.clone().translate(new Zn(t.center).negate()),f=s.map(p=>c.transform(p)),h=new Gn().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});n.push(h.multiplyRight(l))}return n}function FD(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i=zm.getUniforms(n),r=ID({viewport:n.viewport,center:i.center}),s=[],l=ND({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let f=0;f<t.shadowMatrices.length;f++){const h=l[f],p=h.clone().translate(new Zn(n.viewport.center).negate());i.coordinateSystem===Le.LNGLAT&&i.projectionMode===mn.WEB_MERCATOR?(l[f]=p,s[f]=r):(l[f]=h.clone().multiplyRight(DD),s[f]=p.transform(r))}const c={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||kD,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let f=0;f<l.length;f++)c[`viewProjectionMatrix${f}`]=l[f],c[`projectCenter${f}`]=s[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=t.shadowMaps&&t.shadowMaps[f]||t.dummyShadowMap;return c}const Xx={name:"shadow",dependencies:[zm],vs:MD,fs:OD,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:FD,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Lo={...Tx,defaultUniforms:{...Tx.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},zD=[Ww],VD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],jD=[];function HD(t){const e=jr.getDefaultShaderAssembler();for(const i of zD)e.addDefaultModule(i);const n=t==="glsl"?VD:jD;for(const i of n)e.addShaderHook(i);return e}const $D=[255,255,255],WD=1;let XD=0;class YD{constructor(e={}){this.type="ambient";const{color:n=$D}=e,{intensity:i=WD}=e;this.id=e.id||`ambient-${XD++}`,this.color=n,this.intensity=i}}const qD=[255,255,255],KD=1,ZD=[0,0,-1];let GD=0;class Yx{constructor(e={}){this.type="directional";const{color:n=qD}=e,{intensity:i=KD}=e,{direction:r=ZD}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${GD++}`,this.color=n,this.intensity=i,this.type="directional",this.direction=new Zn(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class QD{constructor(e,n={id:"pass"}){const{id:i}=n;this.id=i,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Hm extends QD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,s=e.clearColor??(r?[0,0,0,0]:!1),l=r?1:!1,c=r?0:!1,f=e.colorMask??15,h={viewport:[0,0,n,i]};e.colorMask&&(h.colorMask=f),e.scissorRect&&(h.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:l,clearStencil:c});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,n){const{target:i,shaderModuleProps:r,viewports:s,views:l,onViewportActive:c,clearStack:f=!0}=n;n.pass=n.pass||"unknown",f&&(this._lastRenderIndex=-1);const h=[];for(const p of s){const m=l&&l[p.id];c?.(p);const y=this._getDrawLayerParams(p,n),v=p.subViewports||[p];for(const x of v){const T=this._drawLayersInViewport(e,{target:i,shaderModuleProps:r,viewport:x,view:m,pass:n.pass,layers:n.layers},y);h.push(T)}}return h}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:s,cullRect:l,effects:c,shaderModuleProps:f},h=!1){const p=[],m=u2(this._lastRenderIndex+1),y={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:l},v={};for(let x=0;x<n.length;x++){const T=n[x],E=this._shouldDrawLayer(T,y,s,v),C={shouldDrawLayer:E};E&&!h&&(C.shouldDrawLayer=!0,C.layerRenderIndex=m(T,E),C.shaderModuleProps=this._getShaderModuleProps(T,c,i,f),C.layerParameters={...T.context.deck?.props.parameters,...this.getLayerParameters(T,x,e)}),p[x]=C}return p}_drawLayersInViewport(e,{layers:n,shaderModuleProps:i,pass:r,target:s,viewport:l,view:c},f){const h=JD(this.device,{shaderModuleProps:i,target:s,viewport:l});if(c&&c.props.clear){const m=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:m.color?[0,0,0,0]:!1,clearDepth:m.depth?1:!1}).end()}const p={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let m=0;m<n.length;m++){const y=n[m],v=f[m],{shouldDrawLayer:x}=v;if(x&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:T,shaderModuleProps:E,layerParameters:C}=v;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,T),E.project&&(E.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:E,uniforms:{layerIndex:T},parameters:C})}catch(P){y.raiseError(P,`drawing ${y} to ${r}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,i){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(n))return!1;n.layer=l,l=l.parent}if(i){const c=n.layer.id;if(c in r||(r[c]=i(n)),!r[c])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,i,r){const s=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,c={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const f of n)qx(c,f.getShaderModuleProps?.(e,c));return qx(c,this.getShaderModuleProps(e,n,c),r)}}function u2(t=0,e={}){const n={},i=(r,s)=>{const l=r.props._offset,c=r.id,f=r.parent&&r.parent.id;let h;if(f&&!(f in e)&&i(r.parent,!1),f in n){const p=n[f]=n[f]||u2(e[f],e);h=p(r,s),n[c]=p}else Number.isFinite(l)?(h=l+(e[f]||0),n[c]=null):h=t;return s&&h>=t&&(t=h+1),e[c]=h,h};return i}function JD(t,{shaderModuleProps:e,target:n,viewport:i}){const r=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),l=n?n.height:s,c=i;return[c.x*r,l-(c.y+c.height)*r,c.width*r,c.height*r]}function qx(t,...e){for(const n of e)if(n)for(const i in n)t[i]?Object.assign(t[i],n[i]):t[i]=n[i];return t}class e6 extends Hm{constructor(e,n){super(e,n);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],s=r.width*i,l=r.height*i,c=[1,1,1,1];(s!==n.width||l!==n.height)&&n.resize({width:s,height:l}),super.render({...e,clearColor:c,target:n,pass:"shadow"})}getLayerParameters(e,n,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const t6={color:[255,255,255],intensity:1},Kx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],n6=[0,0,0,200/255];class f2{constructor(e={}){this.id="lighting-effect",this.shadowColor=n6,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),i._addDefaultShaderModule(Xx),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const i=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:i,lighting:r,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Xx))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Gn().lookAt({eye:new Zn(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new e6(e);this.shadowPasses[n]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new YD(t6),this.directionalLights.push(new Yx(Kx[0]),new Yx(Kx[1])))}}class i6{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:l=!1,initialize:c=!1,maxCount:f}){const h=r||e&&e.constructor||Float32Array,p=n*i+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,p)}let m=1/0;f&&(m=f*i+s);const y=this._allocate(h,p,c,m);return e&&l?y.set(e):c||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const l=this._pool,c=e.BYTES_PER_ELEMENT*s,f=l.findIndex(h=>h.byteLength>=c);if(f>=0){const h=new e(l.splice(f,1)[0],0,s);return i&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(l=>l.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const wo=new i6;function Xa(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r6(t){return[t[12],t[13],t[14]]}function s6(t){return{left:Qs(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Qs(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Qs(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Qs(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Qs(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Qs(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Zx=new Zn;function Qs(t,e,n,i){Zx.set(t,e,n);const r=Zx.len();return{distance:i/r,normal:new Zn(-t/r,-e/r,-n/r)}}function o6(t){return t-Math.fround(t)}let Fa;function Lp(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;Fa=wo.allocate(Fa,s,{type:Float32Array,size:n*2});let l=i,c=0;for(;l<r;){for(let f=0;f<n;f++){const h=t[l++];Fa[c+f]=h,Fa[c+f+n]=o6(h)}c+=n*2}return Fa.subarray(0,s*n*2)}function a6(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const l6=Math.PI/180,c6=Xa(),Gx=[0,0,0],u6={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function f6({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:l,far:c}){const f=t/e,h=n?new Gn().orthographic({fovy:i,aspect:f,focalDistance:r,near:l,far:c}):new Gn().perspective({fovy:i,aspect:f,near:l,far:c});if(s){const{left:p=0,right:m=0,top:y=0,bottom:v=0}=s,x=ar((p+t-m)/2,0,t)-t/2,T=ar((y+e-v)/2,0,e)-e/2;h[8]-=x*2/t,h[9]+=T*2/e}return h}class Rl{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||u6,this.focalDistance=e.focalDistance||1,this.position=e.position||Gx,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?mn.WEB_MERCATOR:mn.WEB_MERCATOR_AUTO_OFFSET:mn.IDENTITY}equals(e){return e instanceof Rl?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&dl(e.projectionMatrix,this.projectionMatrix)&&dl(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=s2(i,this.pixelProjectionMatrix),[s,l]=r,c=n?l:this.height-l;return e.length===2?[s,c]:[s,c,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,l]=e,c=n?s:this.height-s,f=i&&i*this.distanceScales.unitsPerMeter[2],h=jm([r,c,l],this.pixelUnprojectionMatrix,f),[p,m,y]=this.unprojectPosition(h);return Number.isFinite(l)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=To(e);return n[1]=ar(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Jr(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),l=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],l[0]),Math.min(i[1],r[1],s[1],l[1]),Math.max(i[0],r[0],s[0],l[0]),Math.max(i[1],r[1],s[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?Og({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,s6(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=yD({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Og({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:l}=e;let c=Gx;if(s&&(c=l?new Gn(l).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([n,i,0]);this.center=new Zn(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:n=c6,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:l=75,near:c=.1,far:f=1e3,padding:h=null,focalDistance:p=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Gn().multiplyRight(n).translate(new Zn(this.center).negate()),this.projectionMatrix=i||f6({width:this.width,height:this.height,orthographic:r,fovyRadians:s||l*l6,focalDistance:p,padding:h,near:c,far:f});const m=Xa();Xr(m,m,this.projectionMatrix),Xr(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=Tg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=r6(this.viewMatrixInverse);const y=Xa(),v=Xa();Fm(y,y,[this.width/2,-this.height/2,1]),Gu(y,y,[1,-1,0]),Xr(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=Tg(Xa(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ne.warn("Pixel project matrix not invertible")()}}Rl.displayName="Viewport";class gr extends Rl{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:h,farZ:p,orthographic:m=!1,projectionMatrix:y,repeat:v=!1,worldOffset:x=0,position:T,padding:E,legacyMeterSizes:C=!1}=e;let{width:P,height:M,altitude:I=1.5}=e;const D=Math.pow(2,r);P=P||1,M=M||1;let z,ae=null;if(y)I=y[5]/2,z=ef(I);else{e.fovy?(z=e.fovy,I=r2(z)):z=ef(I);let le;if(E){const{top:ge=0,bottom:Z=0}=E;le=[0,ar((ge+M-Z)/2,0,M)-M/2]}ae=bD({width:P,height:M,scale:D,center:T&&[0,0,T[2]*Dp(n)],offset:le,pitch:s,fovy:z,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(h)&&(ae.near=h),Number.isFinite(p)&&(ae.far=p)}let he=vD({height:M,pitch:s,bearing:l,scale:D,altitude:I});x&&(he=new Gn().translate([512*x,0,0]).multiplyLeft(he)),super({...e,width:P,height:M,viewMatrix:he,longitude:i,latitude:n,zoom:r,...ae,fovy:z,focalDistance:I}),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=l,this.altitude=I,this.fovy=z,this.orthographic=m,this._subViewports=v?[]:null,this._pseudoMeters=C,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new gr({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Dp(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Dp(i);return[n,i,r]}addMetersToLngLat(e,n){return i2(e,n)}panByPosition(e,n){const i=jm(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=xg([],r,Y4([],i)),l=xg([],this.center,s),[c,f]=this.unprojectFlat(l);return{longitude:c,latitude:f}}getBounds(e={}){const n=wD(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:l,zoom:c}=xD({width:i,height:r,bounds:e,...n});return new gr({width:i,height:r,longitude:s,latitude:l,zoom:c})}}gr.displayName="WebMercatorViewport";const Qx=[0,0,0];function Bp(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof gr){const[r,s,l=0]=t,c=e.getDistanceScales([r,s]);i[2]=l*c.unitsPerMeter[2]}return i}function h6(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:l}=t;return r===Le.DEFAULT&&(r=e.isGeospatial?Le.LNGLAT:Le.CARTESIAN),s===void 0&&(s=r),l===void 0&&(l=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:l}}function h2(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[l,c,f=0]=t;switch(n&&([l,c,f]=Al([],[l,c,f,1],n)),i){case Le.LNGLAT:return Bp([l,c,f],e,s);case Le.LNGLAT_OFFSETS:return Bp([l+r[0],c+r[1],f+(r[2]||0)],e,s);case Le.METER_OFFSETS:return Bp(i2(r,[l,c,f]),e,s);case Le.CARTESIAN:default:return e.isGeospatial?[l+r[0],c+r[1],f+r[2]]:e.projectPosition([l,c,f])}}function d6(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:l,fromCoordinateOrigin:c}=h6(e),{autoOffset:f=!0}=e,{geospatialOrigin:h=Qx,shaderCoordinateOrigin:p=Qx,offsetMode:m=!1}=f?e2(n,i,r):{},y=h2(t,{viewport:n,modelMatrix:s,coordinateSystem:l,coordinateOrigin:c,offsetMode:m});if(m){const v=n.projectPosition(h||p);cN(y,y,v)}return y}let p6=1,g6=1;class d2{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,l=p6++,c={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:l}=r;s.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=g6++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function m6(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function _6(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let y6=0;const v6={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:_g.stats.get(`animation-loop-${y6++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class b6{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...v6,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Ef({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=m6(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(_6(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const r=this.device?.canvasContext?.canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Up={};function Nf(t="id"){Up[t]=Up[t]||1;const e=Up[t]++;return`${t}-${e}`}class Jx{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Nf("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&et.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function x6(t,e){if(e instanceof Jx)return e;const n=T6(t,e),{attributes:i,bufferLayout:r}=w6(t,e);return new Jx({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:n,attributes:i})}function T6(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:et.INDEX,data:n})}function w6(t,e){const n=[],i={};for(const[s,l]of Object.entries(e.attributes)){let c=s;switch(s){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){i[c]=t.createBuffer({data:l.value,id:`${s}-buffer`});const{value:f,size:h,normalized:p}=l;n.push({name:c,format:i4(f,h,p)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}class $m{static defaultProps={..._o.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new $m(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const n={..._o.defaultProps,...e},i=this._hashRenderPipeline(n);if(!this._renderPipelineCache[i]){const r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._renderPipelineCache[i]={pipeline:r,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const n={...$u.defaultProps,...e},i=this._hashComputePipeline(n);if(!this._computePipelineCache[i]){const r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._computePipelineCache[i]={pipeline:r,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const n=e.hash,i=e instanceof $u?this._computePipelineCache:this._renderPipelineCache;i[n].useCount--,i[n].useCount===0&&this.destroyPolicy==="unused"&&(i[n].pipeline.destroy(),delete i[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,r="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${i}V${r}BL${s}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${n}/${i}V${r}T${e.topology}P${l}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Wm{static defaultProps={...Pf.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Wm(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const n=this._hashShader(e);let i=this._cache[n];if(!i){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=i={shader:r,useCount:0}}return i.useCount++,i.shader}release(e){const n=this._hashShader(e),i=this._cache[n];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function S6(t,e){const n={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const r of t.attributes)if(r){const s=`${r.location} ${r.name}: ${r.type}`;n[`in ${s}`]={[i]:r.stepMode||"vertex"}}for(const r of t.varyings||[]){const s=`${r.location} ${r.name}`;n[`out ${s}`]={[i]:JSON.stringify(r)}}return n}let Et=null,Fp=null;function A6(t,{id:e,minimap:n,opaque:i,top:r="0",left:s="0",rgbaScale:l=1}){Et||(Et=document.createElement("canvas"),Et.id=e,Et.title=e,Et.style.zIndex="100",Et.style.position="absolute",Et.style.top=r,Et.style.left=s,Et.style.border="blue 5px solid",Et.style.transform="scaleY(-1)",document.body.appendChild(Et),Fp=Et.getContext("2d")),(Et.width!==t.width||Et.height!==t.height)&&(Et.width=t.width/2,Et.height=t.height/2,Et.style.width="400px",Et.style.height="400px");const c=t.device.readPixelsToArrayWebGL(t),f=Fp?.createImageData(t.width,t.height);if(f){for(let p=0;p<c.length;p+=4)f.data[0+p+0]=c[p+0]*l,f.data[0+p+1]=c[p+1]*l,f.data[0+p+2]=c[p+2]*l,f.data[0+p+3]=i?255:c[p+3]*l;Fp?.putImageData(f,0,0)}}function Ig(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ig(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Ig(t[s],e[s],n-1))return!1;return!0}return!1}function E6(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function R6(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function p2(t){return E6(t)||R6(t)}function C6(t){return p2(t)||typeof t=="number"||typeof t=="boolean"}function g2(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];C6(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}class M6{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,n){Object.assign(this.options,n);const i=Tm(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;ue.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e))this._addModule(s),s.name&&r!==s.name&&!this.options.disableWarnings&&ue.warn(`Module name: ${r} vs ${s.name}`)()}destroy(){}setProps(e){for(const n of Object.keys(e)){const i=n,r=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||ue.warn(`Module ${n} not found`)();continue}const l=this.moduleUniforms[i],c=this.moduleBindings[i],f=s.getUniforms?.(r,l)||r,{uniforms:h,bindings:p}=g2(f);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...c,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(i))e[`${n}.${r}`]={type:this.modules[n].uniformTypes?.[r],value:String(s)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let P6="";async function O6(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:P6+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class zp{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,n){this.device=e,this.id=n.id||Nf("async-texture"),typeof n?.data=="string"&&n.dimension==="2d"&&(n={...n,data:O6(n.data)}),this.ready=new Promise((i,r)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=r}),this.initAsync(n)}async initAsync(e){const n=e.data;let i;try{i=await m2(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const r={...e,data:i};this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function m2(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(m2));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),i=Object.keys(e),r={};for(let s=0;s<i.length;s++)r[i[s]]=n[s];return r}return t}const Lr=2,I6=1e4;class bn{static defaultProps={..._o.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:jr.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,n){this.props={...bn.defaultProps,...n},n=this.props,this.id=n.id||Nf("model"),this.device=e,Object.assign(this.userData,n.userData);const i=Object.fromEntries(this.props.modules?.map(f=>[f.name,f])||[]),r=n.shaderInputs||new M6(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const s=k6(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:f,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:l});this.source=f,this._getModuleUniforms=h,this.props.shaderLayout||=k4(this.source)}else{const{vs:f,fs:h,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:l});this.vs=f,this.fs=h,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||$m.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Wm.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return ue.info(Lr,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),Ng(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,l=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const n=e&&x6(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Ap(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Ap(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Ig(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new n4(this.shaderInputs.modules);for(const[n,i]of Object.entries(this.shaderInputs.modules))if(N6(i)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const i=n?.disableWarnings??this.props.disableWarnings;e.indices&&ue.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=r4(this.pipeline.shaderLayout,this.bufferLayout);const r=new Ap(this.bufferLayout);for(const[s,l]of Object.entries(e)){const c=r.getBufferLayout(s);if(!c){i||ue.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const f=r.getAttributeNamesForBuffer(c);let h=!1;for(const p of f){const m=this._attributeInfos[p];if(m){const y=this.device.type==="webgpu"?r.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(y,l),h=!0}}!h&&!i&&ue.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[i,r]of Object.entries(e)){const s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,r):(n?.disableWarnings??this.props.disableWarnings)||ue.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Ng(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:i}=g2(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof zp&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,i]of Object.entries(this.bindings))i instanceof zp?i.isReady&&(e[n]=i.texture):e[n]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Mf?e=Math.max(e,n.texture.updateTimestamp):n instanceof et||n instanceof Ge?e=Math.max(e,n.updateTimestamp):n instanceof zp?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof ul||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[i]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(r=>r.name===i)&&i!=="positions"&&delete n[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(ue.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:r}),this._attributeInfos=uw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=ue.level>3?0:I6;ue.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ue.group(Lr,`>>> DRAWING MODEL ${this.id}`,{collapsed:ue.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=S6(this.pipeline.shaderLayout,this.id);ue.table(Lr,e)();const n=this.shaderInputs.getDebugTable();for(const[r,s]of Object.entries(this.uniforms))n[r]={value:s};ue.table(Lr,n)();const i=this._getAttributeDebugTable();ue.table(Lr,this._attributeInfos)(),ue.table(Lr,i)(),ue.groupEnd(Lr)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const i=e.props.framebuffer;i&&A6(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,i]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[i.location];e[i.location]={name:n,type:i.shaderType,values:r?this._getBufferOrConstantValues(r,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,i=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,n){const i=dw(n);return(e instanceof et?new i(e.debugData):e).toString()}}function N6(t){return!!(t.uniformTypes&&!Ng(t.uniformTypes))}function k6(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Ng(t){for(const e in t)return!1;return!0}class So{device;model;transformFeedback;static defaultProps={...bn.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,n=So.defaultProps){if(!So.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new bn(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||sI(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof et)return n.readAsync();const{buffer:i,byteOffset:r=0,byteLength:s=i.byteLength}=n;return i.readAsync(r,s)}}class Ao{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:n={},indices:i=null,vertexCount:r=null}=e;this.id=e.id||Nf("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[s,l]of Object.entries(n)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!c.size&&(c.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[s]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r of Object.values(e)){const{value:s,size:l,constant:c}=r;!c&&s&&l!==void 0&&l>=1&&(i=Math.min(i,s.length/l))}return i}}const D6={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class _2 extends Hm{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:l,deviceRect:{x:c,y:f,width:h,height:p},cullRect:m,effects:y,pass:v="picking",pickZ:x,shaderModuleProps:T}){this.pickZ=x;const E=this._resetColorEncoder(x),C=[c,f,h,p],P=super.render({target:l,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:m,effects:y?.filter(I=>I.useInPicking),pass:v,isPicking:!0,shaderModuleProps:T,clearColor:[0,0,0,0],colorMask:15,scissorRect:C});return this._colorEncoderState=null,{decodePickingColor:E&&B6.bind(null,E),stats:P}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,n,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:s,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?r.blend=!1:s&&l.includes("draw")&&(Object.assign(r,D6),r.blend=!0,r.blendColor=L6(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function L6(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,l=i.get(e);return l?(l.viewports.push(n),s=l.a):(s=i.size+1,s<=255?(l={a:s,layer:e,viewports:[n]},i.set(e,l),r[s]=l):(Ne.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function B6(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const io={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},tf=Symbol.for("component"),dr=Symbol.for("propTypes"),Vp=Symbol.for("deprecatedProps"),po=Symbol.for("asyncPropDefaults"),es=Symbol.for("asyncPropOriginal"),lr=Symbol.for("asyncPropResolved");function Xm(t,e=()=>!0){return Array.isArray(t)?y2(t,e,[]):e(t)?[t]:[]}function y2(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?y2(r,e,n):e(r)&&n.push(r)}return n}function U6({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let l=0;for(let c=n;l<r;l++)t[c++]=e[l];for(;l<s;)l<s-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+s-l),l=s);return t}class F6{constructor(e,n,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=Vu(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class z6{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new F6(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=s[e];if(this._track(i,r,c,n),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,l=s[e]=s[e]||{};let c=l[n];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),i&&(c?(c.onChange=r,c.resourceId=i.id):c={onChange:r,resourceId:i.id},l[n]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const V6="layerManager.setLayers",j6="layerManager.activateViewport";class H6{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{Bt(j6,this,c),c&&(this.context.viewport=c)};const{deck:i,stats:r,viewport:s,timeline:l}=n||{};this.layers=[],this.resourceManager=new z6({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:HD(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[ZN],renderPass:void 0,stats:r||new Ef({id:"deck.gl"}),viewport:s||new Rl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new d2,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Bt(V6,this,n,e),this._lastRenderedLayers=e;const i=Xm(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(i=>i.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,i=n.findIndex(r=>r.name===e.name);i>=0&&(n.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,i){i.raiseError(n,`${e} of ${i}`)}_updateLayers(e,n){const i={};for(const l of e)i[l.id]?Ne.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const l of r)if(l.hasUniformTransition()){s=`Uniform transition in ${l}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&Ne.warn(`Multiple new layers with same id ${r.id}`)(),n[r.id]=null;let l=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),l=r.isComposite?r.getSubLayers():null}catch(c){this._handleError("matching",c,r)}l&&this._updateSublayersRecursively(l,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=io.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=io.MATCHED,n!==e&&(e.lifecycle=io.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=io.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=io.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function On(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!On(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!On(t[s],e[s],n-1))return!1;return!0}return!1}class $6{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const l=i[s];if(l.containsPixel(r)){const c=e.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Xm(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!On(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ne.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,n,i,r){const s=e.controller;if(s&&i){const l={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==s.type)&&(r=this._createController(e,l)),r&&r.setProps(l),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],l=this.getViewState(s),c=s.makeViewport({viewState:l,width:this.width,height:this.height});let f=n[s.id];const h=!!s.controller;h&&!f&&(i=!0),(i||!h)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,l,c,f),c&&this._viewports.unshift(c)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const W6=/([0-9]+\.?[0-9]*)(%|px)/;function Gi(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=W6.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Qi(t,e){return t.relative?Math.round(t.position*e):t.position}class Eo{constructor(e){const{id:n,x:i=0,y:r=0,width:s="100%",height:l="100%",padding:c=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Gi(i),this._y=Gi(r),this._width=Gi(s),this._height=Gi(l),this._padding=c&&{left:Gi(c.left||0),right:Gi(c.right||0),top:Gi(c.top||0),bottom:Gi(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&On(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});if(!r.height||!r.width)return null;const s=this.getViewportType(i);return new s({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Qi(this._x,e),y:Qi(this._y,n),width:Qi(this._width,e),height:Qi(this._height,n)};return this._padding&&(i.padding={left:Qi(this._padding.left,e),top:Qi(this._padding.top,n),right:Qi(this._padding.right,e),bottom:Qi(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}let kf=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:n}=this;this._handle=e.addChannel({delay:e.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};const e1=()=>{},kg={BREAK:1,SNAP_TO_END:2,IGNORE:3},X6=t=>t,Y6=kg.BREAK;class q6{constructor(e){this._onTransitionUpdate=n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:l,duration:c,easing:f}}=n,h=f(i/c),p=r.interpolateProps(s,l,h);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new kf(e.timeline),this.onViewStateChange=e.onViewStateChange||e1,this.onStateChange=e.onStateChange||e1}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:l}=this.transition.settings;r={...i,...s===kg.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===kg.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,l=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(l===0)return;const c=s.initializeProps(e,r);this.propsInTransition={};const f={duration:l,easing:n.transitionEasing||X6,interpolator:s,interruption:n.transitionInterruption||Y6,startProps:c.start,endProps:c.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(n)}}}function Pt(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class v2{constructor(e){const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!dl(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Pt(Number.isFinite(i)||Array.isArray(i),`${n} is required for transition`)})}}const K6=["longitude","latitude","zoom","bearing","pitch"],Z6=["longitude","latitude","zoom"];class b2 extends v2{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:K6,required:Z6},super(i.transitionProps),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const l=r(e),c=r(n),f=l.unproject(s);i.start.around=s,Object.assign(i.end,{around:c.project(f),aroundPosition:f,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=hl(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,hl(e.around,n.around,i)))}return r}}const Ji={transitionDuration:0},G6=300,ru=t=>1-(1-t)*(1-t),Js={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Br={};class Q6{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new q6({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?G6:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:h=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Js.WHEEL,p&&i),this.toggleEvents(Js.PAN,p),this.toggleEvents(Js.PINCH,p&&(c||f)),this.toggleEvents(Js.MULTI_PAN,p&&f),this.toggleEvents(Js.DOUBLE_CLICK,p&&l),this.toggleEvents(Js.KEYBOARD,p&&h),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=f,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Ji,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Ji,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ru},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ji,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ru},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let l=2/(1+Math.exp(-Math.abs(s*i)));s<0&&l!==0&&(l=1/l);const c=this.controllerState.zoom({pos:n,scale:l});return this.updateViewport(c,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Ji,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ji,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ru},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Br._startPinchRotation=e.rotation,Br._lastPinchEvent=e,this.updateViewport(i,Ji,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Br._startPinchRotation-i})}return this.updateViewport(n,Ji,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Br._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Br;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const l=Math.log2(e.scale),c=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,l+c*n/2);s=s.zoom({pos:r,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:ru},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Br._startPinchRotation=null,Br._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const h={};switch(e.srcEvent.code){case"Minus":f=n?c.zoomOut(i).zoomOut(i):c.zoomOut(i),h.isZooming=!0;break;case"Equal":f=n?c.zoomIn(i).zoomIn(i):c.zoomIn(i),h.isZooming=!0;break;case"ArrowLeft":n?(f=c.rotateLeft(s),h.isRotating=!0):(f=c.moveLeft(r),h.isPanning=!0);break;case"ArrowRight":n?(f=c.rotateRight(s),h.isRotating=!0):(f=c.moveRight(r),h.isPanning=!0);break;case"ArrowUp":n?(f=c.rotateUp(l),h.isRotating=!0):(f=c.moveUp(r),h.isPanning=!0);break;case"ArrowDown":n?(f=c.rotateDown(l),h.isRotating=!0):(f=c.moveDown(r),h.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Ji:e?{...n,transitionInterpolator:new b2({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class J6{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const t1=5,eL=1.2;class tL extends J6{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:l,bearing:c=0,pitch:f=0,altitude:h=1.5,position:p=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:v=60,minPitch:x=0,startPanLngLat:T,startZoomLngLat:E,startRotatePos:C,startBearing:P,startPitch:M,startZoom:I,normalize:D=!0}=e;Pt(Number.isFinite(s)),Pt(Number.isFinite(r)),Pt(Number.isFinite(l)),super({width:n,height:i,latitude:r,longitude:s,zoom:l,bearing:c,pitch:f,altitude:h,maxZoom:m,minZoom:y,maxPitch:v,minPitch:x,normalize:D,position:p},{startPanLngLat:T,startZoomLngLat:E,startRotatePos:C,startBearing:P,startPitch:M,startZoom:I}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:l}=this.getState();if(!r||s===void 0||l===void 0)return this;let c;return e?c=this._getNewRotation(e,r,l,s):c={bearing:s+n,pitch:l+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let f=r+Math.log2(i);f=ar(f,c,l);const h=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=ar(r,i,n);const{maxPitch:s,minPitch:l,pitch:c}=e;e.pitch=ar(c,l,s);const{normalize:f=!0}=e;return f&&Object.assign(e,SD(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],l=e[1]-n[1],c=e[1],f=n[1],{width:h,height:p}=this.getViewportProps(),m=s/h;let y=0;l>0?Math.abs(p-f)>t1&&(y=l/(f-p)*eL):l<0&&f>t1&&(y=1-c/f),y=ar(y,-1,1);const{minPitch:v,maxPitch:x}=this.getViewportProps(),T=r+180*m;let E=i;return y>0?E=i+y*(x-i):y<0&&(E=i-y*(v-i)),{pitch:E,bearing:T}}}class nL extends Q6{constructor(){super(...arguments),this.ControllerState=tL,this.transition={transitionDuration:300,transitionInterpolator:new b2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class x2 extends Eo{constructor(e={}){super(e)}getViewportType(){return gr}get ControllerType(){return nL}}x2.displayName="MapView";const iL=new f2;function rL(t,e){const n=t.order??1/0,i=e.order??1/0;return n-i}class sL{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>rL(r,e)>0);i<0?n.push(e):n.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(On(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const s=n[r.id];let l=r;s&&s!==r?s.setProps?(s.setProps(r.props),l=s):s.cleanup(this._context):s||r.setup(this._context),i.push(l),delete n[r.id]}for(const r in n)n[r].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof f2)||this._resolvedEffects.push(iL),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class oL extends Hm{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const aL="deckRenderer.renderLayers";class lL{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new oL(e),this.pickLayersPass=new _2(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const s=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Bt(aL,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[r]}))});for(const i of e)i.resize(n)}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1]};for(const s of e)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?n.target:void 0;const l=s.postRender(r);r.inputBuffer=l,r.swapBuffer=l===i[0]?i[1]:i[0]}}}const cL={pickedColor:null,pickedObjectIndex:-1};function uL({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:l,y:c,width:f,height:h}=s;let p=r*r,m=-1,y=0;for(let v=0;v<h;v++){const x=v+c-i,T=x*x;if(T>p)y+=4*f;else for(let E=0;E<f;E++){if(t[y+3]-1>=0){const P=E+l-n,M=P*P+T;M<=p&&(p=M,m=y)}y+=4}}if(m>=0){const v=t.slice(m,m+4),x=e(v);if(x){const T=Math.floor(m/4/f),E=m/4-T*f;return{...x,pickedColor:v,pickedX:l+E,pickedY:c+T}}Ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}return cL}function fL({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),l=s.join(",");if(!n.has(l)){const c=e(s);c?n.set(l,{...c,color:s}):Ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function T2({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let l=e[0];e.length>1&&(l=dL(t?.pickedViewports||e,{x:i,y:r}));let c;if(l){const f=[i-l.x,r-l.y];s!==void 0&&(f[2]=s),c=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:c,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function hL(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:l,pickedObjectIndex:c}=e,f=l?[l]:[];if(i==="hover"){const m=n.index,y=n.layerId,v=l?l.props.id:null;if(v!==y||c!==m){if(v!==y){const x=r.find(T=>T.props.id===y);x&&f.unshift(x)}n.layerId=v,n.index=c,n.info=null}}const h=T2(t),p=new Map;return p.set(null,h),f.forEach(m=>{let y={...h};m===l&&(y.color=s,y.index=c,y.picked=!0),y=w2({layer:m,info:y,mode:i});const v=y.layer;m===l&&i==="hover"&&(n.info=y),p.set(v.id,y),i==="hover"&&v.updateAutoHighlight(y)}),p}function w2({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function dL(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class pL{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new _2(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const l=s&&s.layer&&s.layer.id,c=s&&s.viewport&&s.viewport.id,f=l?i.find(y=>y.id===l):null,h=c&&r.find(y=>y.id===c)||r[0],p=h&&h.unproject([e-h.x,n-h.y]);return{...s,...{x:e,y:n,viewport:h,coordinate:p,layer:f}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:l=0,depth:c=1,mode:f="query",unproject3D:h,onViewportActive:p,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:T2({viewports:i,x:r,y:s,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([r,s],!0),T=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],E=Math.round(l*y),{width:C,height:P}=this.pickingFBO,M=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:E,deviceWidth:C,deviceHeight:P}),I={x:r-l,y:s-l,width:l*2+1,height:l*2+1};let D;const z=[],ae=new Set;for(let he=0;he<c;he++){let le;if(M){const Z=this._drawAndSample({layers:v,views:n,viewports:i,onViewportActive:p,deviceRect:M,cullRect:I,effects:m,pass:`picking:${f}`});le=uL({...Z,deviceX:T[0],deviceY:T[1],deviceRadius:E,deviceRect:M})}else le={pickedColor:null,pickedObjectIndex:-1};let ge;if(le.pickedLayer&&h&&this.depthFBO){const{pickedColors:Z}=this._drawAndSample({layers:[le.pickedLayer],views:n,viewports:i,onViewportActive:p,deviceRect:{x:le.pickedX,y:le.pickedY,width:1,height:1},cullRect:I,effects:m,pass:`picking:${f}:z`},!0);Z[3]&&(ge=Z[0])}le.pickedLayer&&he+1<c&&(ae.add(le.pickedLayer),le.pickedLayer.disablePickingIndex(le.pickedObjectIndex)),D=hL({pickInfo:le,lastPickedInfo:this.lastPickedInfo,mode:f,layers:v,viewports:i,x:r,y:s,z:ge,pixelRatio:y});for(const Z of D.values())Z.layer&&z.push(Z);if(!le.pickedColor)break}for(const he of ae)he.restorePickingColors();return{result:z,emptyInfo:D.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:l=1,height:c=1,mode:f="query",maxObjects:h=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([r,s],!0),T=x.x,E=x.y+x.height,C=this.device.canvasContext.cssToDevicePixels([r+l,s+c],!0),P=C.x+C.width,M=C.y,I={x:T,y:M,width:P-T,height:E-M},D=this._drawAndSample({layers:y,views:n,viewports:i,onViewportActive:p,deviceRect:I,cullRect:{x:r,y:s,width:l,height:c},effects:m,pass:`picking:${f}`}),z=fL(D),ae=new Map,he=[],le=Number.isFinite(h);for(let ge=0;ge<z.length&&!(le&&he.length>=h);ge++){const Z=z[ge];let ce={color:Z.pickedColor,layer:null,index:Z.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:v};ce=w2({layer:Z.pickedLayer,info:ce,mode:f});const de=ce.layer.id;ae.has(de)||ae.set(de,new Set);const pe=ae.get(de),Ae=ce.object??ce.index;pe.has(Ae)||(pe.add(Ae),he.push(ce))}return he}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:l,effects:c,pass:f},h=!1){const p=h?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:p,deviceRect:s,cullRect:l,effects:c,pass:f,pickZ:h,preRenderStats:{},isPicking:!0};for(const P of c)P.useInPicking&&(m.preRenderStats[P.id]=P.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:v,y:x,width:T,height:E}=s,C=new(h?Float32Array:Uint8Array)(T*E*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:x,sourceWidth:T,sourceHeight:E,target:C}),{pickedColors:C,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const l=Math.max(0,e-i),c=Math.max(0,n-i),f=Math.min(r,e+i+1)-l,h=Math.min(s,n+i+1)-c;return f<=0||h<=0?null:{x:l,y:c,width:f,height:h}}}const gL={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},mL="top-left",n1="__root";class _L{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!On(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const i of this.resolvedWidgets)n[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)n[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const r=n[i.id];r?r.viewId!==i.viewId||r.placement!==i.placement?(this._remove(r),this._add(i)):i!==r&&(r.setProps(i.props),i=r):this._add(i),n[i.id]=null,this.resolvedWidgets.push(i)}for(const i in n){const r=n[i];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:n=null,placement:i=mL}=e,r=e.onAdd({deck:this.deck,viewId:n});r&&this._getContainer(n,i).append(r),e._element=r}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){const i=e||n1;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[i]=r);let s=r.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,gL[n]),r.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const i in this.containers){const r=this.lastViewports[i]||null,s=i===n1||r,l=this.containers[i];s?(l.style.display="block",l.style.left=`${r?r.x:0}px`,l.style.top=`${r?r.y:0}px`,l.style.width=`${r?r.width:e}px`,l.style.height=`${r?r.height:n}px`):l.style.display="none"}}onRedraw({viewports:e,layers:n}){const i=e.reduce((r,s)=>(r[s.id]=s,r),{});for(const r of this.getWidgets()){const{viewId:s}=r;if(s){const l=i[s];l&&(r.onViewportChange&&r.onViewportChange(l),r.onRedraw?.({viewports:[l],layers:n}))}else{if(r.onViewportChange)for(const l of e)r.onViewportChange(l);r.onRedraw?.({viewports:e,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,n){for(const i of this.getWidgets()){const{viewId:r}=i;(!r||r===e.viewport?.id)&&i.onHover?.(e,n)}}onEvent(e,n){const i=Cg[n.type];if(i)for(const r of this.getWidgets()){const{viewId:s}=r;(!s||s===e.viewport?.id)&&r[i]?.(e,n)}}}const yL={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class vL{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,yL),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,i=n&&n.props.getTooltip;if(!i)return;const r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,n,i){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${n}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var oo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(oo||(oo={}));const Ym={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},gt=(t,e,n)=>e?t.enable(n):t.disable(n),i1=(t,e,n)=>t.hint(n,e),tn=(t,e,n)=>t.pixelStorei(n,e),r1=(t,e,n)=>{const i=n===36006?36009:36008;return t.bindFramebuffer(i,e)},za=(t,e,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(r,e)};function jp(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const bL={3042:gt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:gt,2885:(t,e)=>t.cullFace(e),2929:gt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:gt,35723:i1,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:r1,36010:r1,34964:za,36662:za,36663:za,35053:za,35055:za,2886:(t,e)=>t.frontFace(e),33170:i1,2849:(t,e)=>t.lineWidth(e),32823:gt,32824:"polygonOffset",10752:"polygonOffset",35977:gt,32926:gt,32928:gt,32938:"sampleCoverage",32939:"sampleCoverage",3089:gt,3088:(t,e)=>t.scissor(...e),2960:gt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:gt,10754:gt,12288:gt,12289:gt,12290:gt,12291:gt,12292:gt,12293:gt,12294:gt,12295:gt,3333:tn,3317:tn,37440:tn,37441:tn,37443:tn,3330:tn,3332:tn,3331:tn,3314:tn,32878:tn,3316:tn,3315:tn,32877:tn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=jp(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=jp(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,l,c]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,l,c)},stencilOp:(t,e)=>{e=jp(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,l,c]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,l,c)},viewport:(t,e)=>t.viewport(...e)};function ct(t,e,n){return e[t]!==void 0?e[t]:n[t]}const xL={blendEquation:(t,e,n)=>t.blendEquationSeparate(ct(32777,e,n),ct(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ct(32969,e,n),ct(32968,e,n),ct(32971,e,n),ct(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ct(32824,e,n),ct(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ct(32938,e,n),ct(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ct(2962,e,n),ct(2967,e,n),ct(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ct(34816,e,n),ct(36003,e,n),ct(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ct(2964,e,n),ct(2965,e,n),ct(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ct(34817,e,n),ct(34818,e,n),ct(34819,e,n))},s1={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:n}):{valueChanged:!0}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},Wn=(t,e)=>t.isEnabled(e),o1={3042:Wn,2884:Wn,2929:Wn,3024:Wn,32823:Wn,32926:Wn,32928:Wn,3089:Wn,2960:Wn,35977:Wn},TL=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Bo(t,e){if(SL(e))return;const n={};for(const r in e){const s=Number(r),l=bL[r];l&&(typeof l=="string"?n[l]=!0:l(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=xL[r];s(t,e,i)}}function S2(t,e=Ym){if(typeof e=="number"){const r=e,s=o1[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=o1[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function wL(t){Bo(t,Ym)}function SL(t){for(const e in t)return!1;return!0}function AL(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class Yr{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,n){this.gl=e,this.log=n?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Bo(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?S2(e):Object.assign({},Ym),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,RL(e);for(const i in s1){const r=s1[i];EL(e,i,r)}a1(e,"getParameter"),a1(e,"isEnabled")}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const l=e[s],c=this.cache[s];AL(l,c)||(n=!0,i=c,r&&!(s in r)&&(r[s]=c),this.cache[s]=l)}return{valueChanged:n,oldValue:i}}}function a1(t,e){const n=t[e].bind(t);t[e]=function(r){if(r===void 0||TL.has(r))return n(r);const s=Yr.get(t);return r in s.cache||(s.cache[r]=n(r)),s.enable?s.cache[r]:n(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function EL(t,e,n){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...s){const l=Yr.get(t),{valueChanged:c,oldValue:f}=n(l._updateCache,...s);return c&&i(...s),f},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function RL(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const r=Yr.get(t);r.program!==i&&(e(i),r.program=i)}}function CL(t,e,n){let i="";const r={preserveDrawingBuffer:!0,...n};let s=null;if(s||=t.getContext("webgl2",r),r.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!n.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",r),s.luma||={},s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,i||="Your browser only supports WebGL1")),!s)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:c}=e;return t.addEventListener("webglcontextlost",f=>l(f),!1),t.addEventListener("webglcontextrestored",f=>c(f),!1),s.luma||={},s}function Ro(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function ML(t,e){const n=t.getParameter(7936),i=t.getParameter(7937);Ro(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,s=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),l=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),c=s||n,f=l||i,h=t.getParameter(7938),p=A2(c,f),m=PL(c,f),y=OL(c,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:m,vendor:c,renderer:f,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function A2(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function PL(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function OL(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(A2(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function E2(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ya="WEBGL_compressed_texture_s3tc",qa="WEBGL_compressed_texture_s3tc_srgb",ao="EXT_texture_compression_rgtc",lo="EXT_texture_compression_bptc",IL="WEBGL_compressed_texture_etc",NL="WEBGL_compressed_texture_astc",kL="WEBGL_compressed_texture_etc1",DL="WEBGL_compressed_texture_pvrtc",LL="WEBGL_compressed_texture_atc",l1="EXT_texture_norm16",c1="EXT_render_snorm",BL="EXT_color_buffer_float",qm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[c1],"norm16-renderable-webgl":[l1],"snorm16-renderable-webgl":[l1,c1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ya,qa,ao,lo],"texture-compression-bc5-webgl":[ao],"texture-compression-bc7-webgl":[lo],"texture-compression-etc2":[IL],"texture-compression-astc":[NL],"texture-compression-etc1-webgl":[kL],"texture-compression-pvrtc-webgl":[DL],"texture-compression-atc-webgl":[LL]};function UL(t){return t in qm}function FL(t,e,n){return(qm[e]||[]).every(r=>Ro(t,r,n))}const Km={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:BL,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ya},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:qa},"bc1-rgba-unorm":{gl:33777,x:Ya},"bc1-rgba-unorm-srgb":{gl:35916,x:qa},"bc2-rgba-unorm":{gl:33778,x:Ya},"bc2-rgba-unorm-srgb":{gl:35918,x:qa},"bc3-rgba-unorm":{gl:33779,x:Ya},"bc3-rgba-unorm-srgb":{gl:35919,x:qa},"bc4-r-unorm":{gl:36283,x:ao},"bc4-r-snorm":{gl:36284,x:ao},"bc5-rg-unorm":{gl:36285,x:ao},"bc5-rg-snorm":{gl:36286,x:ao},"bc6h-rgb-ufloat":{gl:36495,x:lo},"bc6h-rgb-float":{gl:36494,x:lo},"bc7-rgba-unorm":{gl:36492,x:lo},"bc7-rgba-unorm-srgb":{gl:36493,x:lo},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function zL(t,e,n){let i=e.create;const r=Km[e.format];return r?.gl===void 0&&(i=!1),r?.x&&(i=i&&!!Ro(t,r.x,n)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function R2(t){const e=Km[t],n=HL(t),i=wm(t);return{internalFormat:n,format:e?.dataFormat||jL(i.channels,i.integer,i.normalized,n),type:i.dataType?E2(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function VL(t){switch(wm(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function jL(t,e,n,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function HL(t){const n=Km[t]?.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const u1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class $L extends xI{gl;extensions;testedFeatures=new Set;constructor(e,n,i){super([],i),this.gl=e,this.extensions=n,Ro(e,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const e=this.getFeatures();for(const n of e)this.has(n)&&(yield n);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),UL(e)&&FL(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of e)this.has(n)}getFeatures(){return[...Object.keys(u1),...Object.keys(qm)]}getWebGLFeature(e){const n=u1[e];return typeof n=="string"?!!Ro(this.gl,n,this.extensions):!!n}}class WL extends bI{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class sl extends Of{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,n){super(e,n);const i=n.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const r=36064+n;this._attachTextureView(r,i)}}if(this.depthStencilAttachment){const n=VL(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${YL(n)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,n){const{gl:i}=this.device,{texture:r}=n,s=n.props.baseMipLevel,l=n.props.baseArrayLayer;switch(i.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,r.handle,s,l);break;case 34067:const c=XL(l);i.framebufferTexture2D(36160,e,c,r.handle,s);break;case 3553:i.framebufferTexture2D(36160,e,3553,r.handle,s);break;default:throw new Error("Illegal texture type")}i.bindTexture(r.glTarget,null)}}function XL(t){return t<34069?t+34069:t}function YL(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class qL extends Sm{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,n){super(n),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new sl(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(n,e);return}}commit(){}}async function C2(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),new Promise((r,s)=>{i.onload=r,i.onerror=l=>s(new Error(`Unable to load script '${t}': ${l}`)),n.appendChild(i)})}const KL=1;let nn=null,f1=!1;const Zm={debugSpectorJS:ue.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function ZL(t){if(!globalThis.SPECTOR)try{await C2(t.debugSpectorJSUrl||Zm.debugSpectorJSUrl)}catch(e){ue.warn(String(e))}}function GL(t){if(t={...Zm,...t},!t.debugSpectorJS)return null;if(!nn&&globalThis.SPECTOR&&!globalThis.luma?.spector){ue.probe(KL,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;nn=new e,globalThis.luma&&(globalThis.luma.spector=nn)}if(!nn)return null;if(f1||(f1=!0,nn.spyCanvases(),nn?.onCaptureStarted.add(e=>ue.info("Spector capture started:",e)()),nn?.onCapture.add(e=>{ue.info("Spector capture complete:",e)(),nn?.getResultUI(),nn?.resultView.display(),nn?.resultView.addCapture(e)})),t.gl){const e=t.gl,n=e.device;nn?.startCapture(t.gl,500),e.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{ue.info("Spector capture stopped after 2 seconds")(),nn?.stopCapture()})}return nn}const QL="https://unpkg.com/webgl-debug@2.0.1/index.js";function M2(t){return t.luma=t.luma||{},t.luma}async function JL(){is()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await C2(QL))}function eB(t,e={}){return e.debugWebGL||e.traceWebGL?nB(t,e):tB(t)}function tB(t){const e=M2(t);return e.realContext?e.realContext:t}function nB(t,e){if(!globalThis.WebGLDebugUtils)return ue.warn("webgl-debug not loaded")(),t;const n=M2(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...oo,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,iB.bind(null,e),rB.bind(null,e));for(const l in oo)!(l in i)&&typeof oo[l]=="number"&&(i[l]=oo[l]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function h1(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function iB(t,e,n,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);const r=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i),l=`${r} in gl.${n}(${s})`;ue.error(l)();debugger}function rB(t,e,n){let i="";ue.level>=1&&(i=h1(e,n),t.traceWebGL&&ue.log(1,i)());for(const r of n)if(r===void 0){i=i||h1(e,n);debugger}}const Hp={};function sB(t="id"){Hp[t]=Hp[t]||1;const e=Hp[t]++;return`${t}-${e}`}class ol extends et{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,n={}){super(e,n),this.device=e,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=oB(this.props.usage),this.glUsage=aB(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(e,n=0,i=e.byteLength+n){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let n=e;e===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,n,e.byteLength)}async readAsync(e=0,n){return this.readSyncWebGL(e,n)}readSyncWebGL(e=0,n){n=n??this.byteLength-e;const i=new Uint8Array(n),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,r,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,n),i}}function oB(t){return t&et.INDEX?34963:t&et.VERTEX?34962:t&et.UNIFORM?35345:34962}function aB(t){return t&et.INDEX||t&et.VERTEX?35044:t&et.UNIFORM?35048:35044}function lB(t){const e=t.split(/\r?\n/),n=[];for(const i of e){if(i.length<=1)continue;const r=i.split(":");if(r.length===2){const[m,y]=r;n.push({message:y.trim(),type:d1(m),lineNum:0,linePos:0});continue}const[s,l,c,...f]=r;let h=parseInt(c,10);isNaN(h)&&(h=0);let p=parseInt(l,10);isNaN(p)&&(p=0),n.push({message:f.join(":").trim(),type:d1(s),lineNum:h,linePos:p})}return n}function d1(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class cB extends Pf{device;handle;constructor(e,n){switch(super(e,n),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?lB(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,e),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ue.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ue.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async r=>await new Promise(s=>setTimeout(s,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function uB(t,e,n,i){if(pB(e))return i(t);const r=t;r.pushState();try{return fB(t,e),Bo(r.gl,n),i(t)}finally{r.popState()}}function fB(t,e){const n=t,{gl:i}=n;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(qr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=qr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=qr("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,l),s?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(dB("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Dg("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;i.stencilMaskSeparate(1028,r),i.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&ue.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,s=Dg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,r),i.stencilFuncSeparate(1029,s,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=$p("stencilPassOperation",e.stencilPassOperation),s=$p("stencilFailOperation",e.stencilFailOperation),l=$p("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,l,r),i.stencilOpSeparate(1029,s,l,r)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const r=p1("blendColorOperation",e.blendColorOperation||"add"),s=p1("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(r,s);const l=su("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=su("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=su("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=su("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,c,f,h)}}function Dg(t,e){return qr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function $p(t,e){return qr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function p1(t,e){return qr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function su(t,e){return qr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function hB(t,e){return`Illegal parameter ${e} for ${t}`}function qr(t,e,n){if(!(e in n))throw new Error(hB(t,e));return n[e]}function dB(t,e){return e}function pB(t){let e=!0;for(const n in t){e=!1;break}return e}function P2(t){const e={};return t.addressModeU&&(e[10242]=Wp(t.addressModeU)),t.addressModeV&&(e[10243]=Wp(t.addressModeV)),t.addressModeW&&(e[32882]=Wp(t.addressModeW)),t.magFilter&&(e[10240]=Lg(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=gB(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Dg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Wp(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Lg(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function gB(t,e="none"){if(!e)return Lg(t);switch(e){case"none":return Lg(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Bg extends ul{device;handle;parameters;constructor(e,n){super(e,n),this.device=e,this.parameters=P2(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[n,i]of Object.entries(e)){const r=Number(n);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,i);break;default:this.device.gl.samplerParameteri(this.handle,r,i);break}}}}class co extends Mf{device;gl;handle;texture;constructor(e,n){super(e,{...Ge.defaultProps,...n}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const mB="Failed to deduce GL constant from typed array";function _B(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(mB)}}function yB(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function O2(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function vB(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function nf(t,e,n){if(bB(e))return n(t);const{nocatch:i=!0}=e,r=Yr.get(t);r.push(),Bo(t,e);let s;if(i)s=n(t),r.pop();else try{s=n(t)}finally{r.pop()}return s}function bB(t){for(const e in t)return!1;return!0}function xB(t,e,n){const{dimension:i,width:r,height:s,depth:l=0}=n,{glInternalFormat:c}=n,f=n.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(f,e,c,r,s,l);break;default:t.texStorage2D(f,e,c,r,s)}}function g1(t,e,n,i){const{width:r,height:s}=i,{dimension:l,depth:c=0,mipLevel:f=0}=i,{x:h=0,y:p=0,z:m=0}=i,{glFormat:y,glType:v}=i,x=I2(i.glTarget,l,c),T=i.flipY?{37440:!0}:{};nf(t,T,()=>{switch(l){case"2d-array":case"3d":t.bindTexture(x,e),t.texSubImage3D(x,f,h,p,m,r,s,c,y,v,n),t.bindTexture(x,null);break;case"2d":case"cube":t.bindTexture(x,e),t.texSubImage2D(x,f,h,p,r,s,y,v,n),t.bindTexture(x,null);break;default:throw new Error(l)}})}function m1(t,e,n){const{dimension:i,width:r,height:s,depth:l=0,mipLevel:c=0,byteOffset:f=0}=n,{x:h=0,y:p=0,z:m=0}=n,{glFormat:y,glType:v,compressed:x}=n,T=I2(n.glTarget,i,l);switch(i){case"2d-array":case"3d":x?t.compressedTexSubImage3D(T,c,h,p,m,r,s,l,y,e,f):t.texSubImage3D(T,c,h,p,m,r,s,l,y,v,e,f);break;case"2d":case"cube":x?t.compressedTexSubImage2D(T,c,h,p,r,s,y,e,f):t.texSubImage2D(T,c,h,p,r,s,y,v,e,f);break;default:throw new Error(i)}}function TB(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function I2(t,e,n){return e==="cube"?34069+n:t}function wB(t,e){const{sourceX:n=0,sourceY:i=0,sourceAttachment:r=0}=e||{};let{target:s=null,sourceWidth:l,sourceHeight:c,sourceDepth:f,sourceFormat:h,sourceType:p}=e||{};const{framebuffer:m,deleteFramebuffer:y}=N2(t),{gl:v,handle:x}=m;l||=m.width,c||=m.height;const T=m.colorAttachments[r]?.texture;if(!T)throw new Error(`Invalid framebuffer attachment ${r}`);f=T?.depth||1,h||=T?.glFormat||6408,p||=T?.glType||5121,s=EB(s,p,h,l,c),p=p||_B(s);const E=v.bindFramebuffer(36160,x);return v.readBuffer(36064+r),v.readPixels(n,i,l,c,h,p,s),v.readBuffer(36064),v.bindFramebuffer(36160,E||null),y&&m.destroy(),s}function SB(t,e){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:h}=e||{};const{framebuffer:p,deleteFramebuffer:m}=N2(t);c=c||p.width,f=f||p.height;const y=p;h=h||5121;let v=n;if(!v){const T=O2(s),E=vB(h),C=l+c*f*T*E;v=y.device.createBuffer({byteLength:C})}const x=t.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:t,width:c,height:f,origin:[i,r],destinationBuffer:v,byteOffset:l}),x.destroy(),m&&p.destroy(),v}function N2(t){return t instanceof Of?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:AB(t),deleteFramebuffer:!0}}function AB(t,e){const{device:n,width:i,height:r,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:r,colorAttachments:[t]})}function EB(t,e,n,i,r,s){if(t)return t;e||=5121;const l=yB(e,{clamped:!1}),c=O2(n);return new l(i*r*c)}class al extends Ge{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,n){super(e,n);const i={...this.props};i.data=n.data,this.device=e,this.gl=this.device.gl,this.glTarget=TB(this.props.dimension);const r=R2(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:n,height:i}=e;if(!n||!i){const r=Ge.getTextureDataSize(e.data);n=r?.width||1,i=r?.height||1}if(this.width=n,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new co(this.device,{...this.props,texture:this}),this.bind(),xB(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new co(this.device,{...e,texture:this})}setSampler(e={}){let n;e instanceof Bg?(this.sampler=e,n=e.props):(this.sampler=new Bg(this.device,e),n=e);const i=P2(n);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ue.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ue.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const n=Ge.getExternalImageSize(e.image),i={...Ge.defaultCopyExternalImageOptions,...n,...e},{image:r,depth:s,mipLevel:l,x:c,y:f,z:h,flipY:p}=i;let{width:m,height:y}=i;const{dimension:v,glTarget:x,glFormat:T,glInternalFormat:E,glType:C}=this;if(m=Math.min(m,this.width-c),y=Math.min(y,this.height-f),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return g1(this.device.gl,this.handle,r,{dimension:v,mipLevel:l,x:c,y:f,z:h,width:m,height:y,depth:s,glFormat:T,glType:C,glTarget:x,flipY:p}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,n=0){this.bind();const i=Ge.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&ue.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<i.length;r++){const s=i[r];this._setMipLevel(n,r,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),m1(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Ge.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,n,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&ue.warn(`${this.id} has mipmap and multiple LODs.`)();const r=Ge.CubeFaces.indexOf(n);this.setTexture2DData(e,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:l,format:c=6408,type:f=5121}=e,{gl:h}=this,p=s||l;this.bind(),p instanceof Promise?p.then(m=>this.setImageDataForFace(Object.assign({},e,{face:n,data:m,pixels:m}))):this.width||this.height?h.texImage2D(n,0,c,i,r,0,c,f,p):h.texImage2D(n,0,c,c,f,p)}_getImageDataMap(e){for(let n=0;n<Ge.CubeFaces.length;++n){const i=Ge.CubeFaces[n];e[i]&&(e[34069+n]=e[i],delete e[i])}return e}_setSamplerParameters(e){ue.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(e)){const r=Number(n),s=i;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,s);break;case 10241:this.gl.texParameteri(this.glTarget,r,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,s);break;default:this.gl.texParameteri(this.glTarget,r,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,n,i,r=this.glTarget){if(Ge.isExternalImage(i)){g1(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:n,glTarget:r,flipY:this.props.flipY});return}if(Ge.isTextureLevelData(i)){m1(this.device.gl,i.data,{...this,depth:e,mipLevel:n,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.glTarget,null),e}}const RB=[1,2,4,8];class CB extends Vr{device;glParameters;constructor(e,n){super(e,n),this.device=e;let i;if(!n?.parameters?.viewport)if(n?.framebuffer){const{width:s,height:l}=n.framebuffer;i=[0,0,s,l]}else{const[s,l]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,s,l]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const s=this.props.framebuffer.colorAttachments.map((l,c)=>36064+c);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(n.viewport=e.viewport.slice(0,4),n.depthRange=[e.viewport[4],e.viewport[5]]):n.viewport=e.viewport),e.scissorRect&&(n.scissorTest=!0,n.scissor=e.scissorRect),e.blendConstant&&(n.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(n.colorMask=RB.map(i=>!!(i&e.colorMask))),this.glParameters=n,Bo(this.device.gl,n)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,r)=>{i&&this.clearColorBuffer(r,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,e.clearStencil=this.props.clearStencil),n!==0&&nf(this.device.gl,e,()=>{this.device.gl.clear(n)})}clearColorBuffer(e=0,n=[0,0,0,0]){nf(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function MB(t){return PB.includes(t)}const PB=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],k2={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function D2(t){const e=k2[t];if(!e)throw new Error("uniform");const[n,i,,r]=e;return{format:r,components:i,glType:n}}function OB(t){const e=k2[t];if(!e)throw new Error("attribute");const[,n,,i,r]=e;return{attributeType:i,vertexFormat:r,components:n}}function IB(t,e){const n={attributes:[],bindings:[]};n.attributes=NB(t,e);const i=LB(t,e);for(const c of i){const f=c.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));n.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const r=DB(t,e);let s=0;for(const c of r)if(MB(c.type)){const{viewDimension:f,sampleType:h}=UB(c.type);n.bindings.push({type:"texture",name:c.name,group:0,location:s,viewDimension:f,sampleType:h}),c.textureUnit=s,s+=1}r.length&&(n.uniforms=r);const l=kB(t,e);return l?.length&&(n.varyings=l),n}function NB(t,e){const n=[],i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r);if(!s)throw new Error("activeInfo");const{name:l,type:c}=s,f=t.getAttribLocation(e,l);if(f>=0){const{attributeType:h}=OB(c),p=/instance/i.test(l)?"instance":"vertex";n.push({name:l,location:f,stepMode:p,type:h})}}return n.sort((r,s)=>r.location-s.location),n}function kB(t,e){const n=[],i=t.getProgramParameter(e,35971);for(let r=0;r<i;r++){const s=t.getTransformFeedbackVarying(e,r);if(!s)throw new Error("activeInfo");const{name:l,type:c,size:f}=s,{glType:h,components:p}=D2(c),m={location:r,name:l,type:h,size:f*p};n.push(m)}return n.sort((r,s)=>r.location-s.location),n}function DB(t,e){const n=[],i=t.getProgramParameter(e,35718);for(let r=0;r<i;r++){const s=t.getActiveUniform(e,r);if(!s)throw new Error("activeInfo");const{name:l,size:c,type:f}=s,{name:h,isArray:p}=FB(l);let m=t.getUniformLocation(e,h);const y={location:m,name:h,size:c,type:f,isArray:p};if(n.push(y),y.size>1)for(let v=0;v<y.size;v++){const x=`${h}[${v}]`;m=t.getUniformLocation(e,x);const T={...y,name:x,location:m};n.push(T)}}return n}function LB(t,e){const n=(s,l)=>t.getActiveUniformBlockParameter(e,s,l),i=[],r=t.getProgramParameter(e,35382);for(let s=0;s<r;s++){const l={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},c=n(s,35395)||[],f=t.getActiveUniforms(e,c,35383),h=t.getActiveUniforms(e,c,35384),p=t.getActiveUniforms(e,c,35387),m=t.getActiveUniforms(e,c,35388);for(let y=0;y<l.uniformCount;++y){const v=t.getActiveUniform(e,c[y]);if(!v)throw new Error("activeInfo");l.uniforms.push({name:v.name,format:D2(f[y]).format,type:f[y],arrayLength:h[y],byteOffset:p[y],byteStride:m[y]})}i.push(l)}return i.sort((s,l)=>s.location-l.location),i}const BB={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function UB(t){const e=BB[t];if(!e)throw new Error("sampler");const[n,i]=e;return{viewDimension:n,sampleType:i}}function FB(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function zB(t,e,n,i){const r=t;let s=i;s===!0&&(s=1),s===!1&&(s=0);const l=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,l);case 35664:return t.uniform2fv(e,l);case 35665:return t.uniform3fv(e,l);case 35666:return t.uniform4fv(e,l);case 5124:return t.uniform1iv(e,l);case 35667:return t.uniform2iv(e,l);case 35668:return t.uniform3iv(e,l);case 35669:return t.uniform4iv(e,l);case 35670:return t.uniform1iv(e,l);case 35671:return t.uniform2iv(e,l);case 35672:return t.uniform3iv(e,l);case 35673:return t.uniform4iv(e,l);case 5125:return r.uniform1uiv(e,l,1);case 36294:return r.uniform2uiv(e,l,2);case 36295:return r.uniform3uiv(e,l,3);case 36296:return r.uniform4uiv(e,l,4);case 35674:return t.uniformMatrix2fv(e,!1,l);case 35675:return t.uniformMatrix3fv(e,!1,l);case 35676:return t.uniformMatrix4fv(e,!1,l);case 35685:return r.uniformMatrix2x3fv(e,!1,l);case 35686:return r.uniformMatrix2x4fv(e,!1,l);case 35687:return r.uniformMatrix3x2fv(e,!1,l);case 35688:return r.uniformMatrix3x4fv(e,!1,l);case 35689:return r.uniformMatrix4x2fv(e,!1,l);case 35690:return r.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function VB(t){return p2(t)!==null||typeof t=="number"||typeof t=="boolean"}function jB(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];VB(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}function HB(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function $B(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const _1=4;class WB extends _o{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,n){super(e,n),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:r=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,r)),this._linkShaders(),ue.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=IB(this.device.gl,this.handle),ue.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=XB(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,n){for(const[i,r]of Object.entries(e)){const s=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!s){const l=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");n?.disableWarnings||ue.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,r)();continue}switch(r||ue.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(r instanceof ol)&&!(r.buffer instanceof ol))throw new Error("buffer value");break;case"texture":if(!(r instanceof co||r instanceof al||r instanceof sl))throw new Error("texture value");break;case"sampler":ue.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=r}}draw(e){const{renderPass:n,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:s,vertexCount:l,instanceCount:c,isInstanced:f=!1,firstVertex:h=0,transformFeedback:p}=e,m=HB(r),y=!!s.indexBuffer,v=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return ue.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ue.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(n),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=n;return uB(this.device,i,x.glParameters,()=>{y&&f?this.device.gl.drawElementsInstanced(m,l||0,v,h,c||0):y?this.device.gl.drawElements(m,l||0,v,h):f?this.device.gl.drawArraysInstanced(m,h,l||0,c||0):this.device.gl.drawArrays(m,h,l||0),p&&p.end()}),s.unbindAfterRender(n),!0}setUniformsWebGL(e){const{bindings:n}=jB(e);Object.keys(n).forEach(i=>{ue.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),ue.time(_1,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),ue.timeEnd(_1,`linkProgram for ${this.id}`)(),ue.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}ue.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ue.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const n=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${n}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async r=>await new Promise(s=>setTimeout(s,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(ue.warn(`Binding ${n.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let n=0,i=0;for(const r of this.shaderLayout.bindings){const s=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:l}=r,c=e.getUniformBlockIndex(this.handle,l);if(c===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,i,c),s instanceof ol?e.bindBufferBase(35345,i,s.handle):e.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof co||s instanceof al||s instanceof sl))throw new Error("texture");let f;if(s instanceof co)f=s.texture;else if(s instanceof al)f=s;else if(s instanceof sl&&s.colorAttachments[0]instanceof co)ue.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+n),e.bindTexture(f.glTarget,f.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:r,textureUnit:s}=e,l=this.uniforms[n]??s;l!==void 0&&zB(this.device.gl,i,r,l)}}}function XB(t,e){const n={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const r=n.attributes.find(s=>s.name===i.name);r?(r.type=i.type||r.type,r.stepMode=i.stepMode||r.stepMode):ue.warn(`shader layout attribute ${i.name} not present in shader`)}return n}class YB extends Em{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const n of e)switch(n.name){case"copy-buffer-to-buffer":qB(this.device,n.options);break;case"copy-buffer-to-texture":KB(this.device,n.options);break;case"copy-texture-to-buffer":ZB(this.device,n.options);break;case"copy-texture-to-texture":GB(this.device,n.options);break;default:throw new Error(n.name)}}}function qB(t,e){const n=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function KB(t,e){throw new Error("Not implemented")}function ZB(t,e){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:s=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:h,byteOffset:p=0,bytesPerRow:m,rowsPerImage:y}=e;if(r!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||m||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:x}=L2(n);let T;try{const E=h,C=s||v.width,P=l||v.height,M=R2(v.colorAttachments[0].texture.props.format),I=M.format,D=M.type;t.gl.bindBuffer(35051,E.handle),T=t.gl.bindFramebuffer(36160,v.handle),t.gl.readPixels(f[0],f[1],C,P,I,D,p)}finally{t.gl.bindBuffer(35051,null),T!==void 0&&t.gl.bindFramebuffer(36160,T),x&&v.destroy()}}function GB(t,e){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:l}=e;let{width:c=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:p}=L2(n),[m,y]=r,[v,x,T]=s,E=t.gl.bindFramebuffer(36160,h.handle);let C=null,P;if(l instanceof al)C=l,c=Number.isFinite(c)?c:C.width,f=Number.isFinite(f)?f:C.height,C.bind(0),P=C.glTarget;else throw new Error("invalid destination");switch(P){case 3553:case 34067:t.gl.copyTexSubImage2D(P,i,v,x,m,y,c,f);break;case 35866:case 32879:t.gl.copyTexSubImage3D(P,i,v,x,T,m,y,c,f);break}C&&C.unbind(),t.gl.bindFramebuffer(36160,E),p&&h.destroy()}function L2(t){if(t instanceof Ge){const{width:e,height:n,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class QB extends Am{device;commandBuffer;constructor(e,n){super(e,n),this.device=e,this.commandBuffer=new YB(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,n,i){}}function JB(t){const{target:e,source:n,start:i=0,count:r=1}=t,s=n.length,l=r*s;let c=0;for(let f=i;c<s;c++)e[f++]=n[c];for(;c<l;)c<l-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+l-c),c=l);return t.target}class Gm extends Rm{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return uM()==="Chrome"}constructor(e,n){super(e,n),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const n=e;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(e,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:s,stride:l,offset:c,normalized:f,integer:h,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(e,r,s,l,c):this.device.gl.vertexAttribPointer(e,r,s,f,l,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,n){this._enable(e,!1),this.attributes[e]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const n=this.attributes[e];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(e,n)}}_getAccessor(e){const n=this.attributeInfos[e];if(!n)throw new Error(`Unknown attribute location ${e}`);const i=E2(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(e,n=!0){const r=Gm.isConstantAttributeZeroSupported(this.device)||e!==0;(n||r)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,n){const i=eU(n),r=i.byteLength*e,s=i.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),l=l||!tU(i,this.bufferValue),l){const c=ZI(n.constructor,s);JB({target:c,source:i,start:0,count:s}),this.buffer.write(c),this.bufferValue=n}return this.buffer}}function eU(t){return Array.isArray(t)?new Float32Array(t):t}function tU(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class nU extends Cm{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,n){super(e,n),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback($B(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])})}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteLength:s,byteOffset:l}=this._getBufferRange(n);if(i<0){this.unusedBuffers[e]=r,ue.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:r,byteLength:s,byteOffset:l},this.bindOnUse||this._bindBuffer(i,r,l,s)}getBuffer(e){if(y1(e))return this.buffers[e]||null;const n=this._getVaryingIndex(e);return n>=0?this.buffers[n]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let n;return this._bound?n=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof ol)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:n,byteOffset:i=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:n,byteOffset:i,byteLength:r}}_getVaryingIndex(e){if(y1(e))return Number(e);for(const n of this.layout.varyings)if(e===n.name)return n.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:n,byteLength:i,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),n,r,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,n,i=0,r){const s=n&&n.handle;!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r)}}function y1(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class iU extends Mm{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,n){if(super(e,n),this.device=e,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class uo extends fr{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||sB("webgl-device")});const n=fr._getCanvasContextProps(e);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=n.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new qL(this,n),this.lost=new Promise(p=>{this._resolveContextLost=p});const r={...e.webgl};n.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),e.powerPreference!==void 0&&(r.powerPreference=e.powerPreference);const l=this.props._handle||CL(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},r);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(e._reuseDevices)return ue.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=GL({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=ML(this.gl,this._extensions),this.limits=new WL(this.gl),this.features=new $L(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Yr(this.gl,{log:(...p)=>ue.log(1,...p)()}).trackState(this.gl,{copyState:!1});const f=e.debugWebGL||e.debug,h=e.debugWebGL;f&&(this.gl=eB(this.gl,{debugWebGL:f,traceWebGL:h}),ue.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(ue.level=Math.max(ue.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const n=this._normalizeBufferProps(e);return new ol(this,n)}createTexture(e){return new al(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Bg(this,e)}createShader(e){return new cB(this,e)}createFramebuffer(e){return new sl(this,e)}createVertexArray(e){return new Gm(this,e)}createTransformFeedback(e){return new nU(this,e)}createQuerySet(e){return new iU(this,e)}createRenderPipeline(e){return new WB(this,e)}beginRenderPass(e){return new CB(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new QB(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,n){return wB(e,n)}readPixelsToBufferWebGL(e,n){return SB(e,n)}setParametersWebGL(e){Bo(this.gl,e)}getParametersWebGL(e){return S2(this.gl,e)}withParametersWebGL(e,n){return nf(this.gl,e,n)}resetWebGL(){ue.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),wL(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return zL(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Yr.get(this.gl).push()}popState(){Yr.get(this.gl).pop()}setSpectorMetadata(e,n){e.__SPECTOR_Metadata=n}getGLKey(e,n){const i=Number(e);for(const r in this.gl)if(this.gl[r]===i)return`GL.${r}`;return n?.emptyIfUnknown?"":String(e)}getGLKeys(e){const n={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[r,s])=>(i[`${r}:${this.getGLKey(r,n)}`]=`${s}:${this.getGLKey(s,n)}`,i),{})}_constants;setConstantAttributeWebGL(e,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const r=this._constants[e];switch(r&&aU(r,n)&&ue.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=n,n.constructor){case Float32Array:rU(this,e,n);break;case Int32Array:sU(this,e,n);break;case Uint32Array:oU(this,e,n);break;default:throw new Error("constant")}}getExtension(e){return Ro(this.gl,e,this._extensions),this._extensions}}function rU(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function sU(t,e,n){t.gl.vertexAttribI4iv(e,n)}function oU(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function aU(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const lU={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},cU=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),uU=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),fU=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function hU(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,i){if(n==="webgl"||n==="experimental-webgl"){const r=this.originalGetContext("webgl2",i);return r instanceof HTMLElement&&dU(r),r}return this.originalGetContext(n,i)}}function dU(t){t.getExtension("EXT_color_buffer_float");const e={...lU,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:cU(t),OES_vertex_array_object:uU(t),ANGLE_instanced_arrays:fU(t)},n=t.getExtension;t.getExtension=function(r){const s=n.call(t,r);return s||(r in e?e[r]:null)};const i=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(i.apply(t)||[])?.concat(Object.keys(e))}}const ou=1;class pU extends EI{type="webgl";constructor(){super(),fr.defaultProps={...fr.defaultProps,...Zm},uo.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){hU(e)}async attach(e){if(e instanceof uo)return e;if(e?.device instanceof fr)return e.device;if(!gU(e))throw new Error("Invalid WebGL2RenderingContext");return new uo({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){ue.groupCollapsed(ou,"WebGLDevice created")();const n=[];(e.debugWebGL||e.debug)&&n.push(JL()),e.debugSpectorJS&&n.push(ZL(e));const i=await Promise.allSettled(n);for(const l of i)l.status==="rejected"&&ue.error(`Failed to initialize debug libraries ${l.reason}`)();const r=new uo(e),s=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return ue.probe(ou,s)(),ue.table(ou,r.info)(),ue.groupEnd(ou)(),r}}function gU(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const v1=new pU;function er(){}const mU=({isDragging:t})=>t?"grabbing":"grab",B2={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:er,onWebGLInitialized:er,onResize:er,onViewStateChange:er,onInteractionStateChange:er,onBeforeRender:er,onAfterRender:er,onLoad:er,onError:t=>Ne.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:mU,getTooltip:null,debug:!1,drawPickingColors:!1};class Qm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ef({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:r}=this;if(i.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(i.leftButton||i.rightButton)return;{const s=i.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=i},this._onEvent=i=>{const r=Cg[i.type],s=i.offsetCenter;if(!r||!s||!this.layerManager)return;const l=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:l,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:f}=c,h=f&&(f[r]||f.props[r]),p=this.props[r];let m=!1;h&&(m=h.call(f,c,i)),m||(p?.(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const r=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...B2,...e},e=this.props,e.viewState&&e.initialViewState&&Ne.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Ne.error("WebGL1 context not supported.")(),n=v1.attach(e.gl)),n||(n=_g.createDevice({type:"best-available",_reuseDevices:!0,adapters:[v1],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&wo.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ne.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ne.removed("onLayerClick","onClick")(),e.initialViewState&&!On(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||l,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pt(this.viewManager),this.viewManager.views}getViewports(e){return Pt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,n,i){Pt(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pt(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=r}if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,i=e.clientHeight??e.height;(n!==this.width||i!==this.height)&&(this.width=n,this.height=i,this.viewManager?.setProps({width:n,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:i}))}_createAnimationLoop(e,n){const{gl:i,onError:r,useDevicePixels:s}=n;return new b6({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new x2({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=n.length>0;let r=i,s=!1;for(const l of n)r=l,s=l.layer?.onHover(l,e.event)||s;s||(this.props.onHover?.(r,e.event),this.widgetManager.onHover(r,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new d2;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new Yk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Fx).map(r=>{const[s,l,c,f]=Fx[r],h=this.props.eventRecognizerOptions?.[r],p={...l,...h,event:r};return{recognizer:new s(p),recognizeWith:c,requestFailure:f}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in Cg)this.eventManager.on(r,this._onEvent);this.viewManager=new $6({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new H6(this.device,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new sL({deck:this,device:this.device}),this.deckRenderer=new lL(this.device),this.deckPicker=new pL(this.device),this.widgetManager=new _L({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new vL),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ne.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=_g.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Qm.defaultProps=B2;Qm.VERSION=OO;function _U(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return dw(t)}}const yU=hw;function au(t,e,n){const i=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Hr(t){return t.stride||t.size*t.bytesPerElement}function vU(t,e){return t.type===e.type&&t.size===e.size&&Hr(t)===Hr(e)&&(t.offset||0)===(e.offset||0)}function Ug(t,e){e.offset&&Ne.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Hr(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function bU(t,e){const n=Ug(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class xU{constructor(e,n,i){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r==="float64";let{defaultValue:l}=n;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;s?c="float32":!r&&n.isIndexed?c="uint32":c=r||"float32";let f=_U(r||c);this.doublePrecision=s,s&&n.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...n,defaultType:f,defaultValue:l,logicalType:r,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Hr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),wo.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const i={};if(this.state.constant){const r=this.value;if(n){const s=Ug(this.getAccessor(),n),l=s.offset/r.BYTES_PER_ELEMENT,c=s.size||this.size;i[e]=r.subarray(l,l+c)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,n=null){const i=this.getAccessor(),r=[],s={name:this.id,byteStride:Hr(i),attributes:r};if(this.doublePrecision){const l=bU(i,n||{});r.push(au(e,{...i,...l.high},this.device.type),au(`${e}64Low`,{...i,...l.low},this.device.type))}else if(n){const l=Ug(i,n);r.push(au(e,{...i,...l},this.device.type))}else r.push(au(e,i,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const l=new Array(r).fill(1/0),c=new Array(r).fill(-1/0);for(let f=0;f<s;)for(let h=0;h<r;h++){const p=n[f++];p<l[h]&&(l[h]=p),p>c[h]&&(c[h]=p)}e=[l,c]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof et?i={buffer:e}:i=e;const r={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)r.type="float32";else{const l=yU(i.value);r.type=r.normalized?l.replace("int","norm"):l}r.bytesPerElement=i.value.BYTES_PER_ELEMENT,r.stride=Hr(r)}if(n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:l}=this;const c=Hr(r),f=(r.vertexOffset||0)*c;if(this.doublePrecision&&s instanceof Float64Array&&(s=Lp(s,r)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const h=s.byteLength+f+c*2;(!l||l.byteLength<h)&&(l=this._createBuffer(h)),l.write(s,f)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Lp(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),i*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=wo.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<s.byteLength+l)&&(c=this._createBuffer(s.byteLength+l),n&&r&&c.write(r instanceof Float64Array?Lp(r,this):r,l)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Ne.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let l=s;for(;--l>=0;)n[i+l]=r[l];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let l=s;for(;--l>=0;)n[i+l]=Number.isFinite(e[l])?e[l]:r[l]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(n?et.INDEX:et.VERTEX)|et.COPY_DST,indexType:n?i:void 0,byteLength:e}),this._buffer}}const b1=[],x1=[];function Df(t,e=0,n=1/0){let i=b1;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(x1.length=t.length,i=x1):i=b1,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function U2(t){return t&&t[Symbol.asyncIterator]}function F2(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:l}=e,c=t.BYTES_PER_ELEMENT,f=i?i/c:n,h=r?r/c:0,p=Math.floor((t.length-h)/f);return(m,{index:y,target:v})=>{if(!s){const C=y*f+h;for(let P=0;P<n;P++)v[P]=t[C+P];return v}const x=s[y],T=s[y+1]||p;let E;if(l){E=new Array(T-x);for(let C=x;C<T;C++){const P=C*f+h;v=new Array(n);for(let M=0;M<n;M++)v[M]=t[P+M];E[C-x]=v}}else if(f===n)E=t.subarray(x*n+h,T*n+h);else{E=new t.constructor((T-x)*n);let C=0;for(let P=x;P<T;P++){const M=P*f+h;for(let I=0;I<n;I++)E[C++]=t[M+I]}}return E}}const TU=[],Ru=[[0,1/0]];function wU(t,e){if(t===Ru||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const l=t[s];l[1]<e[0]?(n.push(l),r=s+1):l[0]>e[1]?n.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return n.splice(r,0,e),n}const SU={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function z2(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...SU[n],...e,...t,type:n}}class V2 extends xU{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ru}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!vU(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return z2(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=wU(this.state.updateRanges,[i,r])}else this.state.updateRanges=Ru}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=TU}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Ru),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:l,noAlloc:c}}=this;let f=!0;if(l){for(const[h,p]of s)l.call(r,this,{data:n,startRow:h,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,p]of s){const m=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(p)?this.getVertexOffset(p):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Pt(ArrayBuffer.isView(l.value),`invalid ${r.accessor}`);const c=!!l.size&&l.size!==this.size;return i.binaryAccessor=F2(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:n,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const i in e)Object.assign(n,super.getValue(i,e[i]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=r??"vertex",!n)return i;for(const s in n){const l=super._getBufferLayout(s,n[s]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:f,value:h,size:p,startIndices:m}=e,{accessor:y,transform:v}=c;let x=f.binaryAccessor||(typeof y=="function"?y:s[y]);typeof x!="function"&&(x=()=>x),Pt(typeof x=="function",`accessor "${y}" is not a function`);let T=e.getVertexOffset(i);const{iterable:E,objectInfo:C}=Df(n,i,r);for(const P of E){C.index++;let M=x(P,C);if(v&&(M=v.call(this,M)),m){const I=(C.index<m.length-1?m[C.index+1]:l)-m[C.index];if(M&&Array.isArray(M[0])){let D=T;for(const z of M)e._normalizeValue(z,h,D),D+=p}else M&&M.length>p?h.set(M,T):(e._normalizeValue(M,C.target,0),U6({target:h,source:C.target,start:T,count:I}));T+=I*p}else e._normalizeValue(M,h,T),T+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Xp(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,l=t.end||n.length,c=e.length,f=l-i;if(c>f){n.set(e.subarray(0,f),i);return}if(n.set(e,i),!s)return;let h=c;for(;h<f;){const p=s(h,e);for(let m=0;m<r;m++)n[i+h]=p[m]||0,h++}}function AU({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return Xp({source:t,target:e,size:n,getData:i}),e;let l=0,c=0;const f=i&&((p,m)=>i(p+c,m)),h=Math.min(r.length,s.length);for(let p=1;p<h;p++){const m=r[p]*n,y=s[p]*n;Xp({source:t.subarray(l,m),target:e,start:c,end:y,size:n,getData:f}),l=m,c=y}return c<e.length&&Xp({source:[],target:e,start:c,size:n,getData:f}),e}function EU(t){const{device:e,settings:n,value:i}=t,r=new V2(e,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}function j2(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function H2(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function $2(t){t.push(t.shift())}function RU(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,l=n&&r instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=t.settings;if(f)for(const h of Object.values(f))c=Math.max(c,h.vertexOffset??0);return(i.noAlloc?r.length:(e+c)*s)*l}function W2({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n?.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function X2({device:t,buffer:e,attribute:n,fromLength:i,toLength:r,fromStartIndices:s,getData:l=c=>c}){const c=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*c,h=n.byteOffset,p=n.settings.bytesPerElement<4?h/n.settings.bytesPerElement*4:h,m=n.startIndices,y=s&&m,v=n.isConstant;if(!y&&e&&i>=r)return e;const x=n.value instanceof Float64Array?Float32Array:n.value.constructor,T=v?n.value:new x(n.getBuffer().readSyncWebGL(h,r*x.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!v){const M=l;l=(I,D)=>n.normalizeConstant(M(I,D))}const E=v?(M,I)=>l(T,I):(M,I)=>l(T.subarray(M+h,M+h+f),I),C=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),P=new Float32Array(r);return AU({source:C,target:P,sourceStartIndices:s,targetStartIndices:m,size:f,getData:E}),(!e||e.byteLength<P.byteLength+p)&&(e?.destroy(),e=t.createBuffer({byteLength:P.byteLength+p,usage:35050})),e.write(P,p),e}class Y2{constructor({device:e,attribute:n,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new kf(i),this.attribute=n,this.attributeInTransition=EU(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=RU(this.attribute,n),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class CU extends Y2{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="interpolation",this.transform=IU(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:l}=this;$2(s),s[0]=X2({device:this.device,buffer:s[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),s[1]=W2({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:c}=this,f=c.model;let h=Math.floor(this.currentLength/l.size);q2(l)&&(h/=2),f.setVertexCount(h),l.isConstant?(f.setAttributes({aFrom:s[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:s[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let r=i/e;n&&(r=n(r));const{model:s}=this.transform,l={time:r};s.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const MU=`uniform interpolationUniforms {
  float time;
} interpolation;
`,T1={name:"interpolation",vs:MU,uniformTypes:{time:"f32"}},PU=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,OU=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function q2(t){return t.doublePrecision&&t.value instanceof Float64Array}function IU(t,e){const n=e.size,i=j2(n),r=H2(n),s=e.getBufferLayout();return q2(e)?new So(t,{vs:OU,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[BN,T1],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new So(t,{vs:PU,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[T1],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class NU extends Y2{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="spring",this.texture=FU(e),this.framebuffer=zU(e,this.texture),this.transform=UU(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:l}=this;for(let f=0;f<2;f++)s[f]=X2({device:this.device,buffer:s[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});s[2]=W2({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:l}),n.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),$2(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const kU=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,DU={name:"spring",vs:kU,uniformTypes:{damping:"f32",stiffness:"f32"}},LU=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,BU=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function UU(t,e){const n=j2(e.size),i=H2(e.size);return new So(t,{vs:LU,fs:BU,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[DU],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function FU(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function zU(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const VU={interpolation:CU,spring:NU};class jU{constructor(e,{id:n,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],l=s.getTransitionSetting(n);l&&this._updateAttribute(r,s,l)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){r&&this._removeTransition(e);const l=VU[i.type];l?this.transitions[e]=new l({attribute:n,timeline:this.timeline,device:this.device}):(Ne.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const w1="attributeManager.invalidate",HU="attributeManager.updateStart",$U="attributeManager.updateEnd",WU="attribute.updateStart",XU="attribute.allocate",YU="attribute.updateEnd";class qU{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=El(a6),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new jU(e,{id:`${n}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Bt(w1,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Bt(w1,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:l={},context:c={}}){let f=!1;Bt(HU,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const p=this.attributes[h],m=p.settings.accessor;p.startIndices=i,p.numInstances=n,s[h]&&Ne.removed(`props.${h}`,`data.attributes.${h}`)(),p.setExternalBuffer(l[h])||p.setBinaryValue(typeof m=="string"?l[m]:void 0,e.startIndices)||typeof m=="string"&&!l[m]&&p.setConstantValue(s[m])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:n,data:e,props:s,context:c})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&Bt($U,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const l=n[s];l.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=l)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const i in e){const r=e[i],s={...r,id:i,size:r.isIndexed&&1||r.size||1,...n};this.attributes[i]=new V2(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(l=>{const c=i[l];c&&c.setNeedsUpdate(c.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Bt(WU,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Bt(XU,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Bt(YU,n,i))}}class KU extends kf{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,l=s(e/r);this._value=hl(n,i,l)}}const S1=1e-5;function A1(t,e,n,i,r){const s=e-t,c=(n-e)*r,f=-s*i;return c+f+s+e}function ZU(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let l=0;l<n.length;l++)s[l]=A1(t[l],e[l],n[l],i,r);return s}return A1(t,e,n,i,r)}function E1(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class GU extends kf{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:l=e}=this;let c=ZU(s,l,n,i,r);const f=E1(c,n),h=E1(c,l);f<S1&&h<S1&&(c=n,this.end()),this._prevValue=l,this._currValue=c}}const QU={interpolation:KU,spring:GU};class JU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const f=s.get(e),{value:h=f.settings.fromValue}=f;n=h,this.remove(e)}if(r=z2(r),!r)return;const l=QU[r.type];if(!l){Ne.error(`unsupported transition type '${r.type}'`)();return}const c=new l(this.timeline);c.start({...r,fromValue:n,toValue:i}),s.set(e,c)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function eF(t){const e=t[dr];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function tF(t,e){const n=K2({newProps:t,oldProps:e,propTypes:t[dr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=iF(t,e);let r=!1;return i||(r=rF(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:sF(t,e),transitionsChanged:nF(t,e)}}function nF(t,e){if(!t.transitions)return!1;const n={},i=t[dr];let r=!1;for(const s in t.transitions){const l=i[s],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&Fg(t[s],e[s],l)&&(n[s]=!0,r=!0)}return r?n:!1}function K2({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${r}.${s} added`;const l=Fg(t[s],e[s],i[s]);if(l)return`${r}.${s} ${l}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const l=Fg(t[s],e[s],i[s]);if(l)return`${r}.${s} ${l}`}}return!1}function Fg(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function iF(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function rF(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&R1(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&R1(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function sF(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function R1(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},K2({oldProps:r,newProps:i,triggerName:n})}const oF="count(): argument not an object",aF="count(): argument not a container";function lF(t){if(!uF(t))throw new Error(oF);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(cF(t))return Object.keys(t).length;throw new Error(aF)}function cF(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function uF(t){return t!==null&&typeof t=="object"}function C1(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const fF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},zg={};function hF(t,e,n,i){if(n instanceof Ge)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...fF,...r,...i},mipmaps:!0});return zg[s.id]=t,s}function dF(t,e){!e||!(e instanceof Ge)||zg[e.id]===t&&(e.delete(),delete zg[e.id])}const pF={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Vg(t)&&(t.length===3||t.length===4)},equal(t,e,n){return On(t,e,1)}},accessor:{validate(t,e){const n=rf(t);return n==="function"||n===rf(e.value)},equal(t,e,n){return typeof e=="function"?!0:On(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Vg(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?On(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?On(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:i}=n.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.device?null:hF(n.id,i.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{dF(n.id,t)}}};function gF(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const l=s?.deprecatedFor;if(l)i[r]=Array.isArray(l)?l:[l];else{const c=mF(r,s);e[r]=c,n[r]=c.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function mF(t,e){switch(rf(e)){case"object":return Va(t,e);case"array":return Va(t,{type:"array",value:e,compare:!1});case"boolean":return Va(t,{type:"boolean",value:e});case"number":return Va(t,{type:"number",value:e});case"function":return Va(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Va(t,e){return"type"in e?{name:t,...pF[e.type],...e}:"value"in e?{name:t,type:rf(e.value),...e}:{name:t,type:"object",value:e}}function Vg(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function rf(t){return Vg(t)?"array":t===null?"null":typeof t}function _F(t,e){let n;for(let s=e.length-1;s>=0;s--){const l=e[s];"extensions"in l&&(n=l.extensions)}const i=jg(t.constructor,n),r=Object.create(i);r[tf]=t,r[es]={},r[lr]={};for(let s=0;s<e.length;++s){const l=e[s];for(const c in l)r[c]=l[c]}return Object.freeze(r),r}const yF="_mergedDefaultProps";function jg(t,e){if(!(t instanceof Lf.constructor))return{};let n=yF;if(e)for(const r of e){const s=r.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const i=Z2(t,n);return i||(t[n]=vF(t,e||[]))}function vF(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=jg(i),s=Z2(t,"defaultProps")||{},l=gF(s),c=Object.assign(Object.create(null),r,l.defaultProps),f=Object.assign(Object.create(null),r?.[dr],l.propTypes),h=Object.assign(Object.create(null),r?.[Vp],l.deprecatedProps);for(const p of e){const m=jg(p.constructor);m&&(Object.assign(c,m),Object.assign(f,m[dr]),Object.assign(h,m[Vp]))}return bF(c,t),TF(c,f),xF(c,h),c[dr]=f,c[Vp]=h,e.length===0&&!Jm(t,"_propTypes")&&(t._propTypes=f),c}function bF(t,e){const n=SF(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function xF(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r=`${this.id}: ${n}`;for(const s of e[n])Jm(this,s)||(this[s]=i);Ne.deprecated(r,e[n].join("/"))()}})}function TF(t,e){const n={},i={};for(const r in e){const s=e[r],{name:l,value:c}=s;s.async&&(n[l]=c,i[l]=wF(l))}t[po]=n,t[es]={},Object.defineProperties(t,i)}function wF(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||U2(e)?this[es][t]=e:this[lr][t]=e},get(){if(this[lr]){if(t in this[lr])return this[lr][t]||this[po][t];if(t in this[es]){const e=this[tf]&&this[tf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[po][t]}}return this[po][t]}}}function Jm(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Z2(t,e){return Jm(t,e)&&t[e]}function SF(t){const e=t.componentName;return e||Ne.warn(`${t.name}.componentName not specified`)(),e||t.name}let AF=0;class Lf{constructor(...e){this.props=_F(this,e),this.id=this.props.id,this.count=AF++}clone(e){const{props:n}=this,i={};for(const r in n[po])r in n[lr]?i[r]=n[lr][r]:r in n[es]&&(i[r]=n[es][r]);return new this.constructor({...n,...i,...e})}}Lf.componentName="Component";Lf.defaultProps={};const EF=Object.freeze({});class RF{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||EF}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[tf]||this.component;const n=e[lr]||{},i=e[es]||e,r=e[po]||{};for(const s in n){const l=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,l),n[s]=this.getAsyncProp(s)}for(const s in i){const l=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,l)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(U2(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],l=0;for await(const c of n){if(!this.component)return;const{dataTransform:f}=this.component.props;f?s=f(c,s):s=s.concat(c),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:l,endRow:s.length}]}),l=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[dr];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class CF extends RF{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i?.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,`loading ${e} of ${this.layer}`)}}const MF="layer.changeFlag",PF="layer.initialize",OF="layer.update",IF="layer.finalize",NF="layer.matched",M1=2**24-1,kF=Object.freeze([]),DF=El(({oldViewport:t,viewport:e})=>t.equals(e));let En=new Uint8ClampedArray(0);const LF={data:{type:"data",value:kF,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:l}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...r?.fetch,signal:s}});let c=l.contains(t);return!c&&!r&&(l.add({resourceId:t,data:Vu(t,i),persistent:!1}),c=!0),c?l.subscribe({resourceId:t,onChange:f=>n.internalState?.reloadAsyncProp(e,f),consumerId:n.id,requestId:e}):Vu(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Le.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ei extends Lf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=io.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Pt(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=h2(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,l]=s2(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,l]}unproject(e){return Pt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return d6(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Le.DEFAULT||e===Le.LNGLAT||e===Le.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pt(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:lF(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=C1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=C1(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,s=this.internalState.hasPickingBuffer,l=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(s!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:f}=n.attributes,h=c||f;h&&(l&&h.constant&&(h.constant=!1,n.invalidate(h.id)),!h.value&&!l&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!DF({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const i in e)e[i].layoutChanged()&&(n=!0);for(const i of this.getModels())this._setModelAttributes(i,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(En.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>M1&&Ne.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),En=wo.allocate(En,n,{size:4,copy:!0,maxCount:Math.max(n,M1)});const r=Math.floor(En.length/4),s=[0,0,0];for(let l=i;l<r;l++)this.encodePickingColor(l,s),En[l*4+0]=s[0],En[l*4+1]=s[1],En[l*4+2]=s[2],En[l*4+3]=0}e.value=En.subarray(0,n*4)}_setModelAttributes(e,n,i=!1){if(!Object.keys(n).length)return;if(i){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),n=c.getAttributes()}const r=e.userData?.excludeAttributes||{},s={},l={};for(const c in n){if(r[c])continue;const f=n[c].getValue();for(const h in f){const p=f[h];p instanceof et?n[c].settings.isIndexed?e.setIndexBuffer(p):s[h]=p:p&&(l[h]=p)}}e.setAttributes(s),e.setConstantAttributes(l)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,s=i||r,l=s&&n.attributes&&n.attributes[s.id];if(l&&l.value){const c=l.value,f=this.encodePickingColor(e);for(let h=0;h<n.length;h++){const p=s.getVertexOffset(h);c[p]===f[0]&&c[p+1]===f[1]&&c[p+2]===f[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),l=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(l-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==En.buffer&&(i.value=En.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Pt(!this.internalState),Pt(Number.isFinite(this.props.coordinateSystem)),Bt(PF,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new CF({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ne.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new JU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bt(NF,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bt(OF,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,l=this._updateUniformTransition();r.propsInTransition=l,i.viewport=r.viewport||s,this.props=l;try{const c=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const p of this.props.extensions)p.updateState.call(this,c,p);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==f[0];this._postUpdate(c,h)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Bt(IF,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,l=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:c}=this.props,f=c&&c(i)||[0,0];l.device instanceof uo&&l.device.setParametersWebGL({polygonOffset:f});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...r}):h.setParameters(r);if(l.device instanceof uo)l.device.withParametersWebGL(r,()=>{const h={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:l};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:l};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const l=e[r],c=n[r];l&&Array.isArray(c)&&(n.dataChanged=Array.isArray(l)?c.concat(l):l,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Bt(MF,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=tF(e,n);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,n[r],e[r],e.transitions?.[r]);return this.setChangeFlags(i)}validateProps(){eF(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.highlightColor=i(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new qU(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:f}=i;if(n||r.autoHighlight!==l||r.highlightedObjectIndex!==c||r.highlightColor!==f){const h={};Array.isArray(f)&&(h.highlightColor=f),(n||r.autoHighlight!==l||c!==r.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ei.defaultProps=LF;ei.layerName="Layer";const BF="compositeLayer.renderLayers";class e_ extends ei{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:h,coordinateSystem:p,coordinateOrigin:m,wrapLongitude:y,positionFormat:v,modelMatrix:x,extensions:T,fetch:E,operation:C,_subLayerProps:P}=this.props,M={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:l,highlightedObjectIndex:c,autoHighlight:f,highlightColor:h,coordinateSystem:p,coordinateOrigin:m,wrapLongitude:y,positionFormat:v,modelMatrix:x,extensions:T,fetch:E,operation:C},I=P&&e.id&&P[e.id],D=I&&I.updateTriggers,z=e.id||"sublayer";if(I){const ae=this.props[dr],he=e.type?e.type._propTypes:{};for(const le in I){const ge=he[le]||ae[le];ge&&ge.type==="accessor"&&(I[le]=this.getSubLayerAccessor(I[le]))}}Object.assign(M,e,I),M.id=`${this.props.id}-${z}`,M.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...D};for(const ae of T){const he=ae.getSubLayerProps.call(this,ae);he&&Object.assign(M,he,{updateTriggers:Object.assign(M.updateTriggers,he.updateTriggers)})}return M}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=Xm(s,Boolean),this.internalState.subLayers=i}Bt(BF,this,r,i);for(const s of i)s.parent=this}}e_.layerName="CompositeLayer";const Yp={bearing:0,pitch:0,position:[0,0,0]},UF={speed:1.2,curve:1.414};class G2 extends v2{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...UF,...e}}interpolateProps(e,n,i){const r=ED(e,n,i,this.opts);for(const s in Yp)r[s]=hl(e[s]||Yp[s],n[s]||Yp[s],i);return r}getDuration(e,n){let{transitionDuration:i}=n;return i==="auto"&&(i=RD(e,n,this.opts)),i}}class Q2{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=wo,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:l,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,s&&(Pt(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),f||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(const h of c)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?F2(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:l}=this;for(const c in s)if(c in r)l.release(i[c]),i[c]=null;else{const f=s[c];f.copy=n,i[c]=l.allocate(i[c],e,f)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:l,objectInfo:c}=Df(r,n,i);for(const f of l){c.index++;const h=s?s(f,c):null;e(h,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:l}=this,{startRow:c=0,endRow:f=1/0}=e||{},h={};if(e||(n=[0],i=[0]),this.normalize||!l)this._forEachGeometry((m,y)=>{const v=m&&this.normalizeGeometry(m);h[y]=v,i[y+1]=i[y]+(v?this.getGeometrySize(v):0)},c,f),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(l))r=r||l.length/this.positionSize;else if(l instanceof et){const m=this.positionSize*4;r=r||l.byteLength/m}else if(l.buffer){const m=l.stride||this.positionSize*4;r=r||l.buffer.byteLength/m}else if(l.value){const m=l.value,y=l.stride/m.BYTES_PER_ELEMENT||this.positionSize;r=r||m.length/y}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const p={};this._forEachGeometry((m,y)=>{const v=h[y]||m;p.vertexStart=i[y],p.indexStart=n[y];const x=y<i.length-1?i[y+1]:r;p.geometrySize=x-i[y],p.geometryIndex=y,this.updateGeometryAttributes(v,p)},c,f),this.vertexCount=n[n.length-1]}}const P1=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,FF={name:"arc",vs:P1,fs:P1,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},zF=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,VF=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,sf=[0,0,0,255],jF={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:sf},getTargetColor:{type:"accessor",value:sf},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class t_ extends ei{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:zF,fs:VF,modules:[Do,Lo,FF]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:sf},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:sf},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:l,wrapLongitude:c,numSegments:f}=this.props,h={numSegments:f,widthUnits:Qn[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:l,useShortestPath:c},p=this.state.model;p.shaderInputs.setProps({arc:h}),p.setVertexCount(f*2),p.draw(this.context.renderPass)}_getModel(){return new bn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}t_.layerName="ArcLayer";t_.defaultProps=jF;const O1=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,HF={name:"icon",vs:O1,fs:O1,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},$F=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,WF=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,XF=1024,YF=4,I1=()=>{},N1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},qF={x:0,y:0,width:0,height:0};function KF(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function ZF(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),l=Math.floor(e.height*r);return r===1?{image:e,width:s,height:l}:(t.canvas.height=l,t.canvas.width=s,t.clearRect(0,0,s,l),t.drawImage(e,0,0,e.width,e.height,0,0,s,l),{image:t.canvas,width:s,height:l})}function gl(t){return t&&(t.id||t.url)}function GF(t,e,n,i){const{width:r,height:s,device:l}=t,c=l.createTexture({format:"rgba8unorm",width:e,height:n,sampler:i,mipmaps:!0}),f=l.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:t,destinationTexture:c,width:r,height:s}),f.finish(),t.destroy(),c}function k1(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],l=gl(r);t[l]={...r,x:s,y:n}}}function QF({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:l}){let c=[];for(let f=0;f<t.length;f++){const h=t[f],p=gl(h);if(!n[p]){const{height:m,width:y}=h;i+y+e>l&&(k1(n,c,r),i=0,r=s+r+e,s=0,c=[]),c.push({icon:h,xOffset:i}),i=i+y+e,s=Math.max(s,m)}}return c.length>0&&k1(n,c,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:l,canvasHeight:KF(s+r+e)}}function JF(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Df(t);for(const l of r){s.index++;const c=e(l,s),f=gl(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[f]&&(!n[f]||c.url!==n[f].url)&&(i[f]={...c,source:l,sourceIndex:s.index})}return i}class e8{constructor(e,{onUpdate:n=I1,onError:i=I1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=YF,this._canvasWidth=XF,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?gl(e):e;return this._mapping[n]||qF}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(JF(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:l,rowHeight:c,canvasHeight:f}=QF({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=r,this._xOffset=s,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||N1,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=GF(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||N1)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Vu(i.url,this._loadOptions).then(r=>{const s=gl(i),l=this._mapping[s],{x:c,y:f,width:h,height:p}=l,{image:m,width:y,height:v}=ZF(n,r,h,p);this._texture?.copyExternalImage({image:m,x:c+(h-y)/2,y:f+(p-v)/2,width:y,height:v}),l.width=y,l.height=v,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const J2=[0,0,0,255],t8={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:J2},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Bf extends ei{getShaders(){return super.getShaders({vs:$F,fs:WF,modules:[Do,Lo,HF]})}initializeState(){this.state={iconManager:new e8(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:J2},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:l,iconMapping:c,data:f,getIcon:h,textureParameters:p}=n,{iconManager:m}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");m.setProps({loadOptions:n.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?c:null,textureParameters:p}),y?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&m.packIcons(f,h),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:l,alphaCutoff:c}=this.props,{iconManager:f}=this.state,h=f.getTexture();if(h){const p=this.state.model,m={iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:Qn[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:l,alphaCutoff:c};p.shaderInputs.setProps({icon:m}),p.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new bn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ao({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const n=this.getCurrentLayer()?.props.onIconError;n?n(e):Ne.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}Bf.defaultProps=t8;Bf.layerName="IconLayer";const D1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,n8={name:"scatterplot",vs:D1,fs:D1,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},i8=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,r8=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,s8=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,L1=[0,0,0,255],o8={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:L1},getLineColor:{type:"accessor",value:L1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class n_ extends ei{getShaders(){return super.getShaders({vs:i8,fs:r8,source:s8,modules:[Do,Lo,n8]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:l,filled:c,billboard:f,antialiasing:h,lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,x={stroked:l,filled:c,billboard:f,antialiasing:h,radiusUnits:Qn[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:Qn[p],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:v},T=this.state.model;T.shaderInputs.setProps({scatterplot:x}),T.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new bn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ao({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}n_.defaultProps=o8;n_.layerName="ScatterplotLayer";const eS={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function tS(t,e,n={}){return a8(t,n)!==e?(c8(t,n),!0):!1}function a8(t,e={}){return Math.sign(l8(t,e))}const B1={x:0,y:1,z:2};function l8(t,e={}){const{start:n=0,end:i=t.length,plane:r="xy"}=e,s=e.size||2;let l=0;const c=B1[r[0]],f=B1[r[1]];for(let h=n,p=i-s;h<i;h+=s)l+=(t[h+c]-t[p+c])*(t[h+f]+t[p+f]),p=h;return l/2}function c8(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,l=Math.floor(s/2);for(let c=0;c<l;++c){const f=n+c*r,h=n+(s-1-c)*r;for(let p=0;p<r;++p){const m=t[f+p];t[f+p]=t[h+p],t[h+p]=m}}}function In(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Hg(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function ml(t,e,n,i,r=[]){const s=i+e*n;for(let l=0;l<n;l++)r[l]=t[s+l];return r}function $g(t,e,n,i,r=[]){let s,l;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),l=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),l=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),l=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),l=0;else return null;for(let c=0;c<t.length;c++)r[c]=(l&1)===c?i[l]:s*(e[c]-t[c])+t[c];return r}function Cu(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function nS(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:l=0,endIndex:c=t.length}=e||{},f=(c-l)/n;let h=[];const p=[h],m=ml(t,0,n,l);let y,v;const x=rS(m,r,s,[]),T=[];In(h,m);for(let E=1;E<f;E++){for(y=ml(t,E,n,l,y),v=Cu(y,x);v;){$g(m,y,v,x,T);const C=Cu(T,x);C&&($g(m,T,C,x,T),v=C),In(h,T),Hg(m,T),f8(x,r,v),i&&h.length>n&&(h=[],p.push(h),In(h,m)),v=Cu(y,x)}In(h,y),Hg(m,y)}return i?p:p[0]}const U1=0,u8=1;function iS(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:l=!1}=n||{},c=[],f=[{pos:t,types:l?new Array(t.length/i).fill(u8):null,holes:e||[]}],h=[[],[]];let p=[];for(;f.length;){const{pos:m,types:y,holes:v}=f.shift();h8(m,i,v[0]||m.length,h),p=rS(h[0],r,s,p);const x=Cu(h[1],p);if(x){let T=F1(m,y,i,0,v[0]||m.length,p,x);const E={pos:T[0].pos,types:T[0].types,holes:[]},C={pos:T[1].pos,types:T[1].types,holes:[]};f.push(E,C);for(let P=0;P<v.length;P++)T=F1(m,y,i,v[P],v[P+1]||m.length,p,x),T[0]&&(E.holes.push(E.pos.length),E.pos=lu(E.pos,T[0].pos),l&&(E.types=lu(E.types,T[0].types))),T[1]&&(C.holes.push(C.pos.length),C.pos=lu(C.pos,T[1].pos),l&&(C.types=lu(C.types,T[1].types)))}else{const T={positions:m};l&&(T.edgeTypes=y),v.length&&(T.holeIndices=v),c.push(T)}}return c}function F1(t,e,n,i,r,s,l){const c=(r-i)/n,f=[],h=[],p=[],m=[],y=[];let v,x,T;const E=ml(t,c-1,n,i);let C=Math.sign(l&8?E[1]-s[3]:E[0]-s[2]),P=e&&e[c-1],M=0,I=0;for(let D=0;D<c;D++)v=ml(t,D,n,i,v),x=Math.sign(l&8?v[1]-s[3]:v[0]-s[2]),T=e&&e[i/n+D],x&&C&&C!==x&&($g(E,v,l,s,y),In(f,y)&&p.push(P),In(h,y)&&m.push(P)),x<=0?(In(f,v)&&p.push(T),M-=x):p.length&&(p[p.length-1]=U1),x>=0?(In(h,v)&&m.push(T),I+=x):m.length&&(m[m.length-1]=U1),Hg(E,v),C=x,P=T;return[M?{pos:f,types:e&&p}:null,I?{pos:h,types:e&&m}:null]}function rS(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function f8(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function h8(t,e,n,i){let r=1/0,s=-1/0,l=1/0,c=-1/0;for(let f=0;f<n;f+=e){const h=t[f],p=t[f+1];r=h<r?h:r,s=h>s?h:s,l=p<l?p:l,c=p>c?p:c}return i[0][0]=r,i[0][1]=l,i[1][0]=s,i[1][1]=c,i}function lu(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const d8=85.051129;function p8(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},l=t.slice(i,r);sS(l,n,0,r-i);const c=nS(l,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const f of c)oS(f,n);return c}function g8(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const l=[],c=[];let f=0,h=0;for(let m=0;m<=e.length;m++){const y=e[m]||t.length,v=h,x=m8(t,i,f,y);for(let T=x;T<y;T++)l[h++]=t[T];for(let T=f;T<x;T++)l[h++]=t[T];sS(l,i,v,h),_8(l,i,v,h,n?.maxLatitude),f=y,c[m]=h}c.pop();const p=iS(l,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const m of p)oS(m.positions,i);return p}function m8(t,e,n,i){let r=-1,s=-1;for(let l=n+1;l<i;l+=e){const c=Math.abs(t[l]);c>r&&(r=c,s=l-1)}return s}function _8(t,e,n,i,r=d8){const s=t[n],l=t[i-e];if(Math.abs(s-l)>180){const c=ml(t,0,e,n);c[0]+=Math.round((l-s)/360)*360,In(t,c),c[1]=Math.sign(c[1])*r,In(t,c),c[0]=s,In(t,c)}}function sS(t,e,n,i){let r=t[0],s;for(let l=n;l<i;l+=e){s=t[l];const c=s-r;(c>180||c<-180)&&(s-=Math.round(c/360)*360),t[l]=r=s}}function oS(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}function y8(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let l=0;l<t.length;l++)for(let c=0;c<e;c++)r[l*e+c]=t[l][c]||0}else r=t;return n?nS(r,{size:e,gridResolution:n}):i?p8(r,{size:e}):r}const v8=1,b8=2,qp=4;class x8 extends Q2{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?y8(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(z1(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&z1(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:l}=n;i.fill(0,s,s+l),r?(i[s]=qp,i[s+l-2]=qp):(i[s]+=v8,i[s+l-2]+=b8),i[s+l-1]=qp}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,l=new Array(3);for(let c=r,f=0;f<s;c++,f++)this.getPointOnPath(e,f,l),i[c*3]=l[0],i[c*3+1]=l[1],i[c*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function z1(t){return Array.isArray(t[0])}const V1=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,T8={name:"path",vs:V1,fs:V1,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},w8=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,S8=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,aS=[0,0,0,255],A8={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:aS},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Kp={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class i_ extends ei{getShaders(){return super.getShaders({vs:w8,fs:S8,modules:[Do,Lo,T8]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Kp,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Kp,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Kp,defaultValue:aS},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new x8({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,c=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:c.getPath,buffers:c,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:l,widthScale:c,widthMinPixels:f,widthMaxPixels:h}=this.props,p=this.state.model,m={jointType:Number(n),capType:Number(i),billboard:r,widthUnits:Qn[l],widthScale:c,miterLimit:s,widthMinPixels:f,widthMaxPixels:h};p.shaderInputs.setProps({path:m}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new bn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ao({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}i_.defaultProps=A8;i_.layerName="PathLayer";var cu={exports:{}},j1;function E8(){if(j1)return cu.exports;j1=1,cu.exports=t,cu.exports.default=t;function t(w,k,N){N=N||2;var G=k&&k.length,A=G?k[0]*N:w.length,U=e(w,0,A,N,!0),X=[];if(!U||U.next===U.prev)return X;var ee,ne,fe,me,Te,ve,je;if(G&&(U=f(w,k,U,N)),w.length>80*N){ee=fe=w[0],ne=me=w[1];for(var He=N;He<A;He+=N)Te=w[He],ve=w[He+1],Te<ee&&(ee=Te),ve<ne&&(ne=ve),Te>fe&&(fe=Te),ve>me&&(me=ve);je=Math.max(fe-ee,me-ne),je=je!==0?32767/je:0}return i(U,X,N,ee,ne,je,0),X}function e(w,k,N,G,A){var U,X;if(A===Ae(w,k,N,G)>0)for(U=k;U<N;U+=G)X=ce(U,w[U],w[U+1],X);else for(U=N-G;U>=k;U-=G)X=ce(U,w[U],w[U+1],X);return X&&I(X,X.next)&&(de(X),X=X.next),X}function n(w,k){if(!w)return w;k||(k=w);var N=w,G;do if(G=!1,!N.steiner&&(I(N,N.next)||M(N.prev,N,N.next)===0)){if(de(N),N=k=N.prev,N===N.next)break;G=!0}else N=N.next;while(G||N!==k);return k}function i(w,k,N,G,A,U,X){if(w){!X&&U&&v(w,G,A,U);for(var ee=w,ne,fe;w.prev!==w.next;){if(ne=w.prev,fe=w.next,U?s(w,G,A,U):r(w)){k.push(ne.i/N|0),k.push(w.i/N|0),k.push(fe.i/N|0),de(w),w=fe.next,ee=fe.next;continue}if(w=fe,w===ee){X?X===1?(w=l(n(w),k,N),i(w,k,N,G,A,U,2)):X===2&&c(w,k,N,G,A,U):i(n(w),k,N,G,A,U,1);break}}}}function r(w){var k=w.prev,N=w,G=w.next;if(M(k,N,G)>=0)return!1;for(var A=k.x,U=N.x,X=G.x,ee=k.y,ne=N.y,fe=G.y,me=A<U?A<X?A:X:U<X?U:X,Te=ee<ne?ee<fe?ee:fe:ne<fe?ne:fe,ve=A>U?A>X?A:X:U>X?U:X,je=ee>ne?ee>fe?ee:fe:ne>fe?ne:fe,He=G.next;He!==k;){if(He.x>=me&&He.x<=ve&&He.y>=Te&&He.y<=je&&C(A,ee,U,ne,X,fe,He.x,He.y)&&M(He.prev,He,He.next)>=0)return!1;He=He.next}return!0}function s(w,k,N,G){var A=w.prev,U=w,X=w.next;if(M(A,U,X)>=0)return!1;for(var ee=A.x,ne=U.x,fe=X.x,me=A.y,Te=U.y,ve=X.y,je=ee<ne?ee<fe?ee:fe:ne<fe?ne:fe,He=me<Te?me<ve?me:ve:Te<ve?Te:ve,Bn=ee>ne?ee>fe?ee:fe:ne>fe?ne:fe,ni=me>Te?me>ve?me:ve:Te>ve?Te:ve,as=T(je,He,k,N,G),ls=T(Bn,ni,k,N,G),Be=w.prevZ,Ue=w.nextZ;Be&&Be.z>=as&&Ue&&Ue.z<=ls;){if(Be.x>=je&&Be.x<=Bn&&Be.y>=He&&Be.y<=ni&&Be!==A&&Be!==X&&C(ee,me,ne,Te,fe,ve,Be.x,Be.y)&&M(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Ue.x>=je&&Ue.x<=Bn&&Ue.y>=He&&Ue.y<=ni&&Ue!==A&&Ue!==X&&C(ee,me,ne,Te,fe,ve,Ue.x,Ue.y)&&M(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Be&&Be.z>=as;){if(Be.x>=je&&Be.x<=Bn&&Be.y>=He&&Be.y<=ni&&Be!==A&&Be!==X&&C(ee,me,ne,Te,fe,ve,Be.x,Be.y)&&M(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Ue&&Ue.z<=ls;){if(Ue.x>=je&&Ue.x<=Bn&&Ue.y>=He&&Ue.y<=ni&&Ue!==A&&Ue!==X&&C(ee,me,ne,Te,fe,ve,Ue.x,Ue.y)&&M(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function l(w,k,N){var G=w;do{var A=G.prev,U=G.next.next;!I(A,U)&&D(A,G,G.next,U)&&le(A,U)&&le(U,A)&&(k.push(A.i/N|0),k.push(G.i/N|0),k.push(U.i/N|0),de(G),de(G.next),G=w=U),G=G.next}while(G!==w);return n(G)}function c(w,k,N,G,A,U){var X=w;do{for(var ee=X.next.next;ee!==X.prev;){if(X.i!==ee.i&&P(X,ee)){var ne=Z(X,ee);X=n(X,X.next),ne=n(ne,ne.next),i(X,k,N,G,A,U,0),i(ne,k,N,G,A,U,0);return}ee=ee.next}X=X.next}while(X!==w)}function f(w,k,N,G){var A=[],U,X,ee,ne,fe;for(U=0,X=k.length;U<X;U++)ee=k[U]*G,ne=U<X-1?k[U+1]*G:w.length,fe=e(w,ee,ne,G,!1),fe===fe.next&&(fe.steiner=!0),A.push(E(fe));for(A.sort(h),U=0;U<A.length;U++)N=p(A[U],N);return N}function h(w,k){return w.x-k.x}function p(w,k){var N=m(w,k);if(!N)return k;var G=Z(N,w);return n(G,G.next),n(N,N.next)}function m(w,k){var N=k,G=w.x,A=w.y,U=-1/0,X;do{if(A<=N.y&&A>=N.next.y&&N.next.y!==N.y){var ee=N.x+(A-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(ee<=G&&ee>U&&(U=ee,X=N.x<N.next.x?N:N.next,ee===G))return X}N=N.next}while(N!==k);if(!X)return null;var ne=X,fe=X.x,me=X.y,Te=1/0,ve;N=X;do G>=N.x&&N.x>=fe&&G!==N.x&&C(A<me?G:U,A,fe,me,A<me?U:G,A,N.x,N.y)&&(ve=Math.abs(A-N.y)/(G-N.x),le(N,w)&&(ve<Te||ve===Te&&(N.x>X.x||N.x===X.x&&y(X,N)))&&(X=N,Te=ve)),N=N.next;while(N!==ne);return X}function y(w,k){return M(w.prev,w,k.prev)<0&&M(k.next,w,w.next)<0}function v(w,k,N,G){var A=w;do A.z===0&&(A.z=T(A.x,A.y,k,N,G)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==w);A.prevZ.nextZ=null,A.prevZ=null,x(A)}function x(w){var k,N,G,A,U,X,ee,ne,fe=1;do{for(N=w,w=null,U=null,X=0;N;){for(X++,G=N,ee=0,k=0;k<fe&&(ee++,G=G.nextZ,!!G);k++);for(ne=fe;ee>0||ne>0&&G;)ee!==0&&(ne===0||!G||N.z<=G.z)?(A=N,N=N.nextZ,ee--):(A=G,G=G.nextZ,ne--),U?U.nextZ=A:w=A,A.prevZ=U,U=A;N=G}U.nextZ=null,fe*=2}while(X>1);return w}function T(w,k,N,G,A){return w=(w-N)*A|0,k=(k-G)*A|0,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,k=(k|k<<8)&16711935,k=(k|k<<4)&252645135,k=(k|k<<2)&858993459,k=(k|k<<1)&1431655765,w|k<<1}function E(w){var k=w,N=w;do(k.x<N.x||k.x===N.x&&k.y<N.y)&&(N=k),k=k.next;while(k!==w);return N}function C(w,k,N,G,A,U,X,ee){return(A-X)*(k-ee)>=(w-X)*(U-ee)&&(w-X)*(G-ee)>=(N-X)*(k-ee)&&(N-X)*(U-ee)>=(A-X)*(G-ee)}function P(w,k){return w.next.i!==k.i&&w.prev.i!==k.i&&!he(w,k)&&(le(w,k)&&le(k,w)&&ge(w,k)&&(M(w.prev,w,k.prev)||M(w,k.prev,k))||I(w,k)&&M(w.prev,w,w.next)>0&&M(k.prev,k,k.next)>0)}function M(w,k,N){return(k.y-w.y)*(N.x-k.x)-(k.x-w.x)*(N.y-k.y)}function I(w,k){return w.x===k.x&&w.y===k.y}function D(w,k,N,G){var A=ae(M(w,k,N)),U=ae(M(w,k,G)),X=ae(M(N,G,w)),ee=ae(M(N,G,k));return!!(A!==U&&X!==ee||A===0&&z(w,N,k)||U===0&&z(w,G,k)||X===0&&z(N,w,G)||ee===0&&z(N,k,G))}function z(w,k,N){return k.x<=Math.max(w.x,N.x)&&k.x>=Math.min(w.x,N.x)&&k.y<=Math.max(w.y,N.y)&&k.y>=Math.min(w.y,N.y)}function ae(w){return w>0?1:w<0?-1:0}function he(w,k){var N=w;do{if(N.i!==w.i&&N.next.i!==w.i&&N.i!==k.i&&N.next.i!==k.i&&D(N,N.next,w,k))return!0;N=N.next}while(N!==w);return!1}function le(w,k){return M(w.prev,w,w.next)<0?M(w,k,w.next)>=0&&M(w,w.prev,k)>=0:M(w,k,w.prev)<0||M(w,w.next,k)<0}function ge(w,k){var N=w,G=!1,A=(w.x+k.x)/2,U=(w.y+k.y)/2;do N.y>U!=N.next.y>U&&N.next.y!==N.y&&A<(N.next.x-N.x)*(U-N.y)/(N.next.y-N.y)+N.x&&(G=!G),N=N.next;while(N!==w);return G}function Z(w,k){var N=new pe(w.i,w.x,w.y),G=new pe(k.i,k.x,k.y),A=w.next,U=k.prev;return w.next=k,k.prev=w,N.next=A,A.prev=N,G.next=N,N.prev=G,U.next=G,G.prev=U,G}function ce(w,k,N,G){var A=new pe(w,k,N);return G?(A.next=G.next,A.prev=G,G.next.prev=A,G.next=A):(A.prev=A,A.next=A),A}function de(w){w.next.prev=w.prev,w.prev.next=w.next,w.prevZ&&(w.prevZ.nextZ=w.nextZ),w.nextZ&&(w.nextZ.prevZ=w.prevZ)}function pe(w,k,N){this.i=w,this.x=k,this.y=N,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(w,k,N,G){var A=k&&k.length,U=A?k[0]*N:w.length,X=Math.abs(Ae(w,0,U,N));if(A)for(var ee=0,ne=k.length;ee<ne;ee++){var fe=k[ee]*N,me=ee<ne-1?k[ee+1]*N:w.length;X-=Math.abs(Ae(w,fe,me,N))}var Te=0;for(ee=0;ee<G.length;ee+=3){var ve=G[ee]*N,je=G[ee+1]*N,He=G[ee+2]*N;Te+=Math.abs((w[ve]-w[He])*(w[je+1]-w[ve+1])-(w[ve]-w[je])*(w[He+1]-w[ve+1]))}return X===0&&Te===0?0:Math.abs((Te-X)/X)};function Ae(w,k,N,G){for(var A=0,U=k,X=N-G;U<N;U+=G)A+=(w[X]-w[U])*(w[U+1]+w[X+1]),X=U;return A}return t.flatten=function(w){for(var k=w[0][0].length,N={vertices:[],holes:[],dimensions:k},G=0,A=0;A<w.length;A++){for(var U=0;U<w[A].length;U++)for(var X=0;X<k;X++)N.vertices.push(w[A][U][X]);A>0&&(G+=w[A-1].length,N.holes.push(G))}return N},cu.exports}var R8=E8();const C8=a3(R8),uu=eS.CLOCKWISE,H1=eS.COUNTER_CLOCKWISE,cr={};function M8(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Ka(t){return"positions"in t?t.positions:t}function Mu(t){return"holeIndices"in t?t.holeIndices:null}function P8(t){return Array.isArray(t[0])}function O8(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function I8(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function N8(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function $1(t,e,n,i,r){let s=e;const l=n.length;for(let c=0;c<l;c++)for(let f=0;f<i;f++)t[s++]=n[c][f]||0;if(!I8(n))for(let c=0;c<i;c++)t[s++]=n[0][c]||0;return cr.start=e,cr.end=s,cr.size=i,tS(t,r,cr),s}function W1(t,e,n,i,r=0,s,l){s=s||n.length;const c=s-r;if(c<=0)return e;let f=e;for(let h=0;h<c;h++)t[f++]=n[r+h];if(!N8(n,i,r,s))for(let h=0;h<i;h++)t[f++]=n[r+h];return cr.start=e,cr.end=f,cr.size=i,tS(t,l,cr),f}function k8(t,e){M8(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let l=0;for(let c=0;c<=s.length;c++)l=W1(n,l,r,e,s[c-1],s[c],c===0?uu:H1),i.push(l);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!P8(t))return W1(n,0,t,e,0,n.length,uu),n;if(!O8(t)){let r=0;for(const[s,l]of t.entries())r=$1(n,r,l,e,s===0?uu:H1),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return $1(n,0,t,e,uu),n}function Zp(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const l=(s+1)%i;r+=t[s*3+e]*t[l*3+n],r-=t[l*3+e]*t[s*3+n]}return Math.abs(r/2)}function X1(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const l=s*3,c=t[l+0],f=t[l+1],h=t[l+2];t[l+e]=c,t[l+n]=f,t[l+i]=h}}function D8(t,e,n,i){let r=Mu(t);r&&(r=r.map(c=>c/e));let s=Ka(t);const l=i&&e===3;if(n){const c=s.length;s=s.slice();const f=[];for(let h=0;h<c;h+=e){f[0]=s[h],f[1]=s[h+1],l&&(f[2]=s[h+2]);const p=n(f);s[h]=p[0],s[h+1]=p[1],l&&(s[h+2]=p[2])}}if(l){const c=Zp(s,0,1),f=Zp(s,0,2),h=Zp(s,1,2);if(!c&&!f&&!h)return[];c>f&&c>h||(f>h?(n||(s=s.slice()),X1(s,0,2,1)):(n||(s=s.slice()),X1(s,2,0,1)))}return C8(s,r,e)}class L8 extends Q2{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=k8(e,this.positionSize);return this.opts.resolution?iS(Ka(n),Mu(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?g8(Ka(n),Mu(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Y1(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Ka(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Y1(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const i=e;this._updateIndices(i,n),this._updatePositions(i,n),this._updateVertexValid(i,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:l,typedArrayManager:c}=this;let f=s.indices;if(!f||!e)return;let h=r;const p=D8(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=c.allocate(f,r+p.length,{copy:!0});for(let m=0;m<p.length;m++)f[h++]=p[m]+i;l[n+1]=r+p.length,s.indices=f}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const l=Ka(e);for(let c=n,f=0;f<i;c++,f++){const h=l[f*s],p=l[f*s+1],m=s>2?l[f*s+2]:0;r[c*3]=h,r[c*3+1]=p,r[c*3+2]=m}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,l=e&&Mu(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),l)for(let c=0;c<l.length;c++)s[n+l[c]/r-1]=0;s[n+i-1]=0}}function Y1(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const q1=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,B8={name:"solidPolygon",vs:q1,fs:q1,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},lS=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,U8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${lS}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,F8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${lS}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,z8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,of=[0,0,0,255],V8={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:of},getLineColor:{type:"accessor",value:of},material:!0},fu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class r_ extends ei{getShaders(e){return super.getShaders({vs:e==="top"?U8:F8,fs:z8,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Do,Hw,Lo,B8]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&n===Le.DEFAULT&&(n=Le.LNGLAT);let r;n===Le.LNGLAT&&(i?r=e.projectPosition.bind(e):r=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new L8({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),l=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:fu,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:fu,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:fu,accessor:"getFillColor",defaultValue:of},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:fu,accessor:"getLineColor",defaultValue:of},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:f,target:h})=>this.encodePickingColor(c&&c.__source?c.__source.index:f,h)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:l,sideModel:c,wireframeModel:f,polygonTesselator:h}=this.state,p={extruded:!!n,elevationScale:s,isWireframe:!1};f&&r&&(f.setInstanceCount(h.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),f.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(h.instanceCount-1),c.shaderInputs.setProps({solidPolygon:p}),c.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(h.vertexCount),l.shaderInputs.setProps({solidPolygon:p}),l.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,l=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:i}=this.props;let r,s,l;if(n){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new bn(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new bn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Ao({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new bn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Ao({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,l,r].filter(Boolean),topModel:r,sideModel:s,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}r_.defaultProps=V8;r_.layerName="SolidPolygonLayer";function j8({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,l=t.length;let c=l,f=l;for(let y=0;y<l;y++){const v=e(t[y]);if(c>y&&v>=r&&(c=y),v>=s){f=y;break}}let h=c;const m=f-c!==i.length?t.slice(f):void 0;for(let y=0;y<i.length;y++)t[h++]=i[y];if(m){for(let y=0;y<m.length;y++)t[h++]=m[y];t.length=h}return{startRow:c,endRow:c+i.length}}function H8(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?$8(t,i,n):null}function $8(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function W8(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*4);const s=[];for(let l=0;l<r.length;l++)e(r[l],s),n[i][l*4+0]=s[0],n[i][l*4+1]=s[1],n[i][l*4+2]=s[2],n[i][l*4+3]=255}return n}const K1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,X8={name:"sdf",vs:K1,fs:K1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Y8=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Gp=192/256,Z1=[],q8={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class s_ extends Bf{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,X8],fs:Y8}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&Ne.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state,l=r?Math.max(i,Gp*(1-r)):-1,c=this.state.model,f={buffer:Gp,outlineBuffer:l,gamma:i,enabled:!!n,outlineColor:s};if(c.shaderInputs.setProps({sdf:f}),super.draw(e),n&&r){const{iconManager:h}=this.state;h.getTexture()&&(c.shaderInputs.setProps({sdf:{...f,outlineBuffer:Gp}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Z1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Z1}}s_.defaultProps=q8;s_.layerName="MultiIconLayer";const ll=1e20;class K8{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:l="normal",fontStyle:c="normal",lang:f=null}={}){this.buffer=n,this.cutoff=r,this.radius=i,this.lang=f;const h=this.size=e+n*4,p=this._createCanvas(h),m=this.ctx=p.getContext("2d",{willReadFrequently:!0});m.font=`${c} ${l} ${e}px ${s}`,m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:l}=this.ctx.measureText(e),c=Math.ceil(i),f=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-s))),p=Math.min(this.size-this.buffer,c+Math.ceil(r)),m=h+2*this.buffer,y=p+2*this.buffer,v=Math.max(m*y,0),x=new Uint8ClampedArray(v),T={data:x,width:m,height:y,glyphWidth:h,glyphHeight:p,glyphTop:c,glyphLeft:f,glyphAdvance:n};if(h===0||p===0)return T;const{ctx:E,buffer:C,gridInner:P,gridOuter:M}=this;this.lang&&(E.lang=this.lang),E.clearRect(C,C,h,p),E.fillText(e,C,C+c);const I=E.getImageData(C,C,h,p);M.fill(ll,0,v),P.fill(0,0,v);for(let D=0;D<p;D++)for(let z=0;z<h;z++){const ae=I.data[4*(D*h+z)+3]/255;if(ae===0)continue;const he=(D+C)*m+z+C;if(ae===1)M[he]=0,P[he]=ll;else{const le=.5-ae;M[he]=le>0?le*le:0,P[he]=le<0?le*le:0}}G1(M,0,0,m,y,m,this.f,this.v,this.z),G1(P,C,C,h,p,m,this.f,this.v,this.z);for(let D=0;D<v;D++){const z=Math.sqrt(M[D])-Math.sqrt(P[D]);x[D]=Math.round(255-255*(z/this.radius+this.cutoff))}return T}}function G1(t,e,n,i,r,s,l,c,f){for(let h=e;h<e+i;h++)Q1(t,n*s+h,s,r,l,c,f);for(let h=n;h<n+r;h++)Q1(t,h*s+e,1,i,l,c,f)}function Q1(t,e,n,i,r,s,l){s[0]=0,l[0]=-ll,l[1]=ll,r[0]=t[e];for(let c=1,f=0,h=0;c<i;c++){r[c]=t[e+c*n];const p=c*c;do{const m=s[f];h=(r[c]-r[m]+p-m*m)/(c-m)/2}while(h<=l[f]&&--f>-1);f++,s[f]=c,l[f]=h,l[f+1]=ll}for(let c=0,f=0;c<i;c++){for(;l[f+1]<c;)f++;const h=s[f],p=c-h;t[e+c*n]=r[h]+p*p}}const Z8=32,G8=[];function Q8(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function J8({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:l=0,yOffset:c=0}){let f=0,h=l;const p=n+i*2;for(const m of t)if(!s[m]){const y=e(m);h+y+i*2>r&&(h=0,f++),s[m]={x:h+i,y:c+f*p+i,width:y,height:p,layoutWidth:y,layoutHeight:n},h+=y+i*2}return{mapping:s,xOffset:h,yOffset:c+f*p,canvasHeight:Q8(c+(f+1)*p)}}function cS(t,e,n,i){let r=0;for(let s=e;s<n;s++){const l=t[s];r+=i[l]?.layoutWidth||0}return r}function uS(t,e,n,i,r,s){let l=e,c=0;for(let f=e;f<n;f++){const h=cS(t,f,f+1,r);c+h>i&&(l<f&&s.push(f),l=f,c=0),c+=h}return c}function e5(t,e,n,i,r,s){let l=e,c=e,f=e,h=0;for(let p=e;p<n;p++)if((t[p]===" "||t[p+1]===" "||p+1===n)&&(f=p+1),f>c){let m=cS(t,c,f,r);h+m>i&&(l<c&&(s.push(c),l=c,h=0),m>i&&(m=uS(t,c,f,i,r,s),l=s[s.length-1])),c=f,h+=m}return h}function t5(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const l=[];return e==="break-all"?uS(t,r,s,n,i,l):e5(t,r,s,n,i,l),l}function n5(t,e,n,i,r,s){let l=0,c=0;for(let f=e;f<n;f++){const h=t[f],p=i[h];p?(c||(c=p.layoutHeight),r[f]=l+p.layoutWidth/2,l+=p.layoutWidth):(Ne.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),r[f]=l,l+=Z8)}s[0]=l,s[1]=c}function i5(t,e,n,i,r){const s=Array.from(t),l=s.length,c=new Array(l),f=new Array(l),h=new Array(l),p=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,m=[0,0],y=[0,0];let v=0,x=0,T=0;for(let E=0;E<=l;E++){const C=s[E];if((C===`
`||E===l)&&(T=E),T>x){const P=p?t5(s,n,i,r,x,T):G8;for(let M=0;M<=P.length;M++){const I=M===0?x:P[M-1],D=M<P.length?P[M]:T;n5(s,I,D,r,c,y);for(let z=I;z<D;z++){c[z]-y[0]/2;const ae=s[z],he=r[ae]?.layoutOffsetY||0;f[z]=v+y[1]/2+he,h[z]=y[0]}v=v+y[1]*e,m[0]=Math.max(m[0],y[0])}x=T}C===`
`&&(c[x]=0,f[x]=0,h[x]=0,x++)}return m[1]=v,{x:c,y:f,rowWidth:h,size:m}}function r5({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const l=t.BYTES_PER_ELEMENT,c=n?n/l:1,f=i?i/l:0,h=r[e]||Math.ceil((t.length-f)/c),p=s&&new Set,m=new Array(e);let y=t;if(c>1||f>0){const v=t.constructor;y=new v(h);for(let x=0;x<h;x++)y[x]=t[x*c+f]}for(let v=0;v<e;v++){const x=r[v],T=r[v+1]||h,E=y.subarray(x,T);m[v]=String.fromCodePoint.apply(null,E),p&&E.forEach(p.add,p)}if(p)for(const v of p)s.add(String.fromCodePoint(v));return{texts:m,characterCount:h}}class fS{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function s5(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const go={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:s5(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},J1=1024,eT=.9,tT=1.2,hS=3;let af=new fS(hS);function o5(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=af.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function a5(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function nT(t,e,n,i){t.font=`${i} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function l5(t){Ne.assert(Number.isFinite(t)&&t>=hS,"Invalid cache limit"),af=new fS(t)}class c5{constructor(){this.props={...go}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*tT+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=o5(this._key,this.props.characterSet),i=af.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const r=this._generateFontAtlas(n,i);this._atlas=r,af.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:l,sdf:c,radius:f,cutoff:h}=this.props;let p=n&&n.data;p||(p=document.createElement("canvas"),p.width=J1);const m=p.getContext("2d",{willReadFrequently:!0});nT(m,i,s,r);const{mapping:y,canvasHeight:v,xOffset:x,yOffset:T}=J8({getFontWidth:E=>m.measureText(E).width,fontHeight:s*tT,buffer:l,characterSet:e,maxCanvasWidth:J1,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(p.height!==v){const E=m.getImageData(0,0,p.width,p.height);p.height=v,m.putImageData(E,0,0)}if(nT(m,i,s,r),c){const E=new K8({fontSize:s,buffer:l,radius:f,cutoff:h,fontFamily:i,fontWeight:`${r}`});for(const C of e){const{data:P,width:M,height:I,glyphTop:D}=E.draw(C);y[C].width=M,y[C].layoutOffsetY=s*eT-D;const z=m.createImageData(M,I);a5(P,z),m.putImageData(z,y[C].x,y[C].y)}}else for(const E of e)m.fillText(E,y[E].x,y[E].y+l+s*eT);return{xOffset:x,yOffset:T,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:l,cutoff:c}=this.props;return s?`${e} ${n} ${i} ${r} ${l} ${c}`:`${e} ${n} ${i} ${r}`}}const iT=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,u5={name:"textBackground",vs:iT,fs:iT,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},f5=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,h5=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,d5={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class o_ extends ei{getShaders(){return super.getShaders({vs:f5,fs:h5,modules:[Do,Lo,u5]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:l,getLineWidth:c}=this.props;let{padding:f,borderRadius:h}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]),Array.isArray(h)||(h=[h,h,h,h]);const p=this.state.model,m={billboard:n,stroked:!!c,borderRadius:h,padding:f,sizeUnits:Qn[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:l};p.shaderInputs.setProps({textBackground:m}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new bn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ao({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}o_.defaultProps=d5;o_.layerName="TextBackgroundLayer";const rT={start:1,middle:0,end:-1},sT={top:1,center:0,bottom:-1},Qp=[0,0,0,255],p5=1,g5={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Qp},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:go.characterSet},fontFamily:go.fontFamily,fontWeight:go.fontWeight,lineHeight:p5,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Qp},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Qp},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class a_ extends e_{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[i,r]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;i/=s,r/=s;const{getTextAnchor:l,getAlignmentBaseline:c}=this.props,f=rT[typeof l=="function"?l(e,n):l],h=sT[typeof c=="function"?c(e,n):c];return[(f-1)*i/2,(h-1)*r/2,i,r]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:i,getAlignmentBaseline:r}=this.props,{x:s,y:l,rowWidth:c,size:[f,h]}=this.transformParagraph(e,n),p=rT[typeof i=="function"?i(e,n):i],m=sT[typeof r=="function"?r(e,n):r],y=s.length,v=new Array(y*2);let x=0;for(let T=0;T<y;T++){const E=(1-p)*(f-c[T])/2;v[x++]=(p-1)*f/2+E+s[T],v[x++]=(m-1)*h/2+l[T]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new c5},this.props.maxWidth>0&&Ne.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,l={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(l),!0;for(const c in l)if(l[c]!==r.props[c])return r.setProps(l),!0;return!1}_updateText(){const{data:e,characterSet:n}=this.props,i=e.attributes?.getText;let{getText:r}=this.props,s=e.startIndices,l;const c=n==="auto"&&new Set;if(i&&s){const{texts:f,characterCount:h}=r5({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:c});l=h,r=(p,{index:m})=>f[m]}else{const{iterable:f,objectInfo:h}=Df(e);s=[0],l=0;for(const p of f){h.index++;const m=Array.from(r(p,h)||"");c&&m.forEach(c.add,c),l+=m.length,s.push(l)}}this.setState({getText:r,startIndices:s,numInstances:l,characterSet:c||n})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,r=i.mapping,s=this.state.getText,{wordBreak:l,lineHeight:c,maxWidth:f}=this.props,h=s(e,n)||"";return i5(h,c,l,f*i.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,atlas:s,mapping:l},styleVersion:c}=this.state,{data:f,_dataDiff:h,getPosition:p,getColor:m,getSize:y,getAngle:v,getPixelOffset:x,getBackgroundColor:T,getBorderColor:E,getBorderWidth:C,backgroundBorderRadius:P,backgroundPadding:M,background:I,billboard:D,fontSettings:z,outlineWidth:ae,outlineColor:he,sizeScale:le,sizeUnits:ge,sizeMinPixels:Z,sizeMaxPixels:ce,transitions:de,updateTriggers:pe}=this.props,Ae=this.getSubLayerClass("characters",s_),w=this.getSubLayerClass("background",o_);return[I&&new w({getFillColor:T,getLineColor:E,getLineWidth:C,borderRadius:P,padding:M,getPosition:p,getSize:y,getAngle:v,getPixelOffset:x,billboard:D,sizeScale:le,sizeUnits:ge,sizeMinPixels:Z,sizeMaxPixels:ce,transitions:de&&{getPosition:de.getPosition,getAngle:de.getAngle,getSize:de.getSize,getFillColor:de.getBackgroundColor,getLineColor:de.getBorderColor,getLineWidth:de.getBorderWidth,getPixelOffset:de.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:pe.getPosition,getAngle:pe.getAngle,getSize:pe.getSize,getFillColor:pe.getBackgroundColor,getLineColor:pe.getBorderColor,getLineWidth:pe.getBorderWidth,getPixelOffset:pe.getPixelOffset,getBoundingRect:{getText:pe.getText,getTextAnchor:pe.getTextAnchor,getAlignmentBaseline:pe.getAlignmentBaseline,styleVersion:c}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Ae({sdf:z.sdf,smoothing:Number.isFinite(z.smoothing)?z.smoothing:go.smoothing,outlineWidth:ae/(z.radius||go.radius),outlineColor:he,iconAtlas:s,iconMapping:l,getPosition:p,getColor:m,getSize:y,getAngle:v,getPixelOffset:x,billboard:D,sizeScale:le*r,sizeUnits:ge,sizeMinPixels:Z*r,sizeMaxPixels:ce*r,transitions:de&&{getPosition:de.getPosition,getAngle:de.getAngle,getColor:de.getColor,getSize:de.getSize,getPixelOffset:de.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:pe.getText,getPosition:pe.getPosition,getAngle:pe.getAngle,getColor:pe.getColor,getSize:pe.getSize,getPixelOffset:pe.getPixelOffset,getIconOffsets:{getTextAnchor:pe.getTextAnchor,getAlignmentBaseline:pe.getAlignmentBaseline,styleVersion:c}}}),{data:f,_dataDiff:h,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){l5(e)}}a_.defaultProps=g5;a_.layerName="TextLayer";const Pu={circle:{type:n_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Bf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:a_,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ou={type:i_,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Wg={type:r_,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ja({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function Jp(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const l=e[s];let c=t.props[s];s.startsWith("get")&&(c=t.getSubLayerAccessor(c),r.updateTriggers[l]=i[s],n&&(r.transitions[l]=n[s])),r[l]=c}return r}function m5(t){if(Array.isArray(t))return t;switch(Ne.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Ne.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function oT(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let l=r;l<s;l++){const c=t[l],{geometry:f}=c;if(f)if(f.type==="GeometryCollection"){Ne.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:h}=f;for(let p=0;p<h.length;p++){const m=h[p];aT(m,i,e,c,l)}}else aT(f,i,e,c,l)}return i}function aT(t,e,n,i,r){const{type:s,coordinates:l}=t,{pointFeatures:c,lineFeatures:f,polygonFeatures:h,polygonOutlineFeatures:p}=e;if(!y5(s,l)){Ne.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":c.push(n({geometry:t},i,r));break;case"MultiPoint":l.forEach(m=>{c.push(n({geometry:{type:"Point",coordinates:m}},i,r))});break;case"LineString":f.push(n({geometry:t},i,r));break;case"MultiLineString":l.forEach(m=>{f.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"Polygon":h.push(n({geometry:t},i,r)),l.forEach(m=>{p.push(n({geometry:{type:"LineString",coordinates:m}},i,r))});break;case"MultiPolygon":l.forEach(m=>{h.push(n({geometry:{type:"Polygon",coordinates:m}},i,r)),m.forEach(y=>{p.push(n({geometry:{type:"LineString",coordinates:y}},i,r))})});break}}const _5={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function y5(t,e){let n=_5[t];for(Ne.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function dS(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function hu(t){return t.geometry.coordinates}function v5(t,e){const n=dS(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:l}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=hu,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=hu,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=hu,n.polygonsOutline.data=l,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=hu,n}function b5(t,e){const n=dS(),{points:i,lines:r,polygons:s}=t,l=W8(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:l.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:l.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const x5=["points","linestrings","polygons"],T5={...ja(Pu.circle),...ja(Pu.icon),...ja(Pu.text),...ja(Ou),...ja(Wg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ts extends e_{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=b5(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=m5(e.data),r=this.getSubLayerRow.bind(this);let s={};const l={};if(Array.isArray(n.dataChanged)){const f=this.state.features;for(const h in f)s[h]=f[h].slice(),l[h]=[];for(const h of n.dataChanged){const p=oT(i,r,h);for(const m in f)l[m].push(j8({data:s[m],getIndex:y=>y.__source.index,dataRange:h,replace:p[m]}))}}else s=oT(i,r);const c=v5(s,l);this.setState({features:s,featuresDiff:l,layerProps:c})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=x5.find(s=>r.id.startsWith(`${this.id}-${s}-`)),i>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons?.data)&&this.getSubLayerClass(r,Wg.type);if(s){const l=Jp(this,Wg.props),c=e&&n;return c||delete l.getLineColor,l.updateTriggers.lineColors=c,new s(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",l=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline?.data)&&this.getSubLayerClass(r,Ou.type),c=this.shouldRenderSubLayer(s,i.lines?.data)&&this.getSubLayerClass(s,Ou.type);if(l||c){const f=Jp(this,Ou.props);return[l&&new l(f,this.getSubLayerProps({id:r,updateTriggers:f.updateTriggers}),i.polygonsOutline),c&&new c(f,this.getSubLayerProps({id:s,updateTriggers:f.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(c=>c.__source.index===r));const s=new Set(e.split("+")),l=[];for(const c of s){const f=`points-${c}`,h=Pu[c],p=h&&this.shouldRenderSubLayer(f,n.points?.data)&&this.getSubLayerClass(f,h.type);if(p){const m=Jp(this,h.props);let y=n.points;if(c==="text"&&i){const{instancePickingColors:v,...x}=y.data.attributes;y={...y,data:{...y.data,attributes:x}}}l.push(new p(m,this.getSubLayerProps({id:f,updateTriggers:m.updateTriggers,highlightedObjectIndex:r}),y))}}return l}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:l}=r,c=H8(s,l);return e(c,r)}}}ts.layerName="GeoJsonLayer";ts.defaultProps=T5;const w5=typeof window<"u"?L.useLayoutEffect:L.useEffect;function lf(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const S5={position:"absolute",zIndex:-1};function pS(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>pS(n,e));if(Uf(t)){if(A5(t))return e.style=S5,L.cloneElement(t,e);if(E5(t))return L.cloneElement(t,e)}return t}function Uf(t){return t&&typeof t=="object"&&"type"in t||!1}function A5(t){return t.props?.mapStyle}function E5(t){const e=t.type;return e&&e.deckGLViewProps}function Xg(t){if(typeof t=="function")return L.createElement(Eo,{},t);if(Array.isArray(t))return t.map(Xg);if(Uf(t)){if(t.type===L.Fragment)return Xg(t.props.children);if(lf(t.type,Eo))return t}return t}function R5({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return L.Children.forEach(Xg(t),l=>{if(Uf(l)){const c=l.type;if(lf(c,ei)){const f=C5(c,l.props);r.push(f)}else i.push(l);if(lf(c,Eo)&&c!==Eo&&l.props.id){const f=new c(l.props);s[f.id]=f}}else l&&i.push(l)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(l=>{s[l.id]=l}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function C5(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}const M5=L.createContext();function P5({children:t,deck:e,ContextProvider:n=M5.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const l of t){let c=s,f=l;Uf(l)&&lf(l.type,Eo)&&(c=l.props.id||s,f=l.props.children);const h=i.getViewport(c),p=i.getViewState(c);if(h){p.padding=h.padding;const{x:m,y,width:v,height:x}=h;f=pS(f,{x:m,y,width:v,height:x,viewport:h,viewState:p}),r[c]||(r[c]={viewport:h,children:[]}),r[c].children.push(f)}}return Object.keys(r).map(l=>{const{viewport:c,children:f}=r[l],{x:h,y:p,width:m,height:y}=c,v={position:"absolute",left:h,top:p,width:m,height:y},x=`view-${l}`,T=L.createElement("div",{key:x,id:x,style:v},...f),E={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:P=>{P.viewId=l,e._onViewStateChange(P)},widgets:[]},C=`view-${l}-context`;return L.createElement(n,{key:C,value:E},T)})}const O5={mixBlendMode:null};function I5({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in O5?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function N5(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function gS(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function k5(t,e,n){const i=new e({...n,_customRender:n.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():gS(t)}});return i}function D5(t,e){const[n,i]=L.useState(0),s=L.useRef({control:null,version:n,forceUpdate:()=>i(D=>D+1)}).current,l=L.useRef(null),c=L.useRef(null),f=L.useMemo(()=>R5(t),[t.layers,t.views,t.children]);let h=!0;const p=D=>h&&t.viewState?(s.viewStateUpdateRequested=D,null):(s.viewStateUpdateRequested=null,t.onViewStateChange?.(D)),m=D=>{h?s.interactionStateUpdateRequested=D:(s.interactionStateUpdateRequested=null,t.onInteractionStateChange?.(D))},y=L.useMemo(()=>{const D={widgets:[],...t,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:m};return delete D._customRender,s.deck&&s.deck.setProps(D),D},[t]);L.useEffect(()=>{const D=t.Deck||Qm;return s.deck=k5(s,D,{...y,parent:l.current,canvas:c.current}),()=>s.deck?.finalize()},[]),w5(()=>{gS(s);const{viewStateUpdateRequested:D,interactionStateUpdateRequested:z}=s;D&&p(D),z&&m(z)}),L.useImperativeHandle(e,()=>N5(s),[]);const v=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:x,width:T="100%",height:E="100%",id:C,style:P}=t,{containerStyle:M,canvasStyle:I}=L.useMemo(()=>I5({width:T,height:E,style:P}),[T,E,P]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===v||s.version!==n){s.lastRenderedViewports=v,s.version=n;const D=P5({children:f.children,deck:s.deck,ContextProvider:x}),z=L.createElement("canvas",{key:"canvas",id:C||"deckgl-overlay",ref:c,style:I});s.control=L.createElement("div",{id:`${C||"deckgl"}-wrapper`,ref:l,style:M},[z,D])}return h=!1,s.control}const l_=L.forwardRef(D5),L5="modulepreload",B5=function(t){return"/acs-dashboard/"+t},lT={},Fr=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){let f=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");r=f(n.map(h=>{if(h=B5(h),h in lT)return;lT[h]=!0;const p=h.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":L5,p||(y.as="script"),y.crossOrigin="",y.href=h,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((v,x)=>{y.addEventListener("load",v),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return r.then(l=>{for(const c of l||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},U5=L.createContext(null);function F5(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function cT(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function uT(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const z5=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fT(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let s=null;if("interactive"in i&&(s={...i},delete s.interactive),r){s=s||{...i},delete s.ref;for(const l of z5)l in r&&(s[l]=r[l])}return s||i});return{...t,layers:n}}function V5(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function sr(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!sr(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!sr(t[r],e[r]))return!1;return!0}return!1}var hT={};const dT={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},eg={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},pT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},j5=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],H5=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Co{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[pT[r.type]];s&&s(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[dT[r.type]];if(s){if(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"){const l=this._hoveredFeatures||this._map.queryRenderedFeatures(r.point,{layers:this.props.interactiveLayerIds});r.features=l}s(r),delete r.features}},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[eg[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Co.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n,i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:l}=e;return l&&(l.bounds?r.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||$5()||null,container:e,style:fT(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,n.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),this._createShadowTransform(s);const l=s._render;s._render=h=>{this._inRender=!0,l.call(s,h),this._inRender=!1};const c=s._renderTaskQueue.run;s._renderTaskQueue.run=h=>{c.call(s._renderTaskQueue,h),this._onBeforeRepaint()},s.on("render",()=>this._onAfterRepaint());const f=s.fire;s.fire=this._fireEvent.bind(this,f),s.on("resize",()=>{this._renderTransform.resize(s.transform.width,s.transform.height)}),s.on("styledata",()=>this._updateStyleComponents(this.props,{})),s.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const h in dT)s.on(h,this._onPointerEvent);for(const h in eg)s.on(h,this._onCameraEvent);for(const h in pT)s.on(h,this._onEvent);this._map=s}recycle(){Co.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=F5(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:l,bearing:c}=r,f=i.isMoving();f&&(r.cameraElevationReference="sea");const h=uT(r,{...cT(i.transform),...e});if(f&&(r.cameraElevationReference="ground"),h&&n){const p=this._deferredEvents;p.move=!0,p.zoom||(p.zoom=s!==r.zoom),p.rotate||(p.rotate=c!==r.bearing),p.pitch||(p.pitch=l!==r.pitch)}return f||uT(i.transform,e),h}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of j5)s in e&&!sr(e[s],n[s])&&(r=!0,i[`set${s[0].toUpperCase()}${s.slice(1)}`](e[s]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(fT(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!sr(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!sr(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!sr(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const s of H5){const l=e[s];sr(l,n[s])||(r=!0,l?i[s].enable(l):i[s].disable())}return r}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,l=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let c;if(s==="mousemove")try{c=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{c=[]}else c=[];const f=c.length>0;!f&&l&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=c,f&&!l&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,l=typeof n=="string"?n:n.type;return l==="move"&&this._updateViewState(this.props,!1),l in eg&&(typeof n=="object"&&(n.viewState=cT(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}Co.savedMaps=[];function $5(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||hT.MapboxAccessToken}catch{}try{t=t||hT.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const W5=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function X5(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,s)=>{const l=n.transform;n.transform=t.transform;const c=n.queryTerrainElevation(r,s);return n.transform=l,c}};for(const r of Y5(n))!(r in i)&&!W5.includes(r)&&(i[r]=n[r].bind(n));return i}function Y5(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const q5=typeof document<"u"?L.useLayoutEffect:L.useEffect,K5=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Z5(t,e){for(const n of K5)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Ff=L.createContext(null),G5={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Cl=L.forwardRef((t,e)=>{const n=L.useContext(U5),[i,r]=L.useState(null),s=L.useRef(),{current:l}=L.useRef({mapLib:null,map:null});L.useEffect(()=>{const f=t.mapLib;let h=!0,p;return Promise.resolve(f||Fr(()=>import("./mapbox-gl-CrkWZirH.js").then(m=>m.m),[])).then(m=>{if(h){if(m.Map||(m=m.default),!m||!m.Map)throw new Error("Invalid mapLib");if(m.supported(t))Z5(m,t),t.reuseMaps&&(p=Co.reuse(t,s.current)),p||(p=new Co(m.Map,t,s.current)),l.map=X5(p,m),l.mapLib=m,r(p),n?.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(m=>{t.onError({type:"error",target:null,originalEvent:null,error:m})}),()=>{h=!1,p&&(n?.onMapUnmount(t.id),t.reuseMaps?p.recycle():p.destroy())}},[]),q5(()=>{i&&i.setProps(t)}),L.useImperativeHandle(e,()=>l.map,[i]);const c=L.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return L.createElement("div",{id:t.id,ref:s,style:c},i&&L.createElement(Ff.Provider,{value:l},t.children))});Cl.displayName="Map";Cl.defaultProps=G5;const Q5=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function os(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!Q5.test(i)?n[i]=`${r}px`:n[i]=r}}const J5={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function mS(t){const{map:e,mapLib:n}=L.useContext(Ff),i=L.useRef({props:t});i.current.props=t;const r=L.useMemo(()=>{let s=!1;L.Children.forEach(t.children,f=>{f&&(s=!0)});const l={...t,element:s?document.createElement("div"):null},c=new n.Marker(l).setLngLat([t.longitude,t.latitude]);return c.getElement().addEventListener("click",f=>{var h,p;(p=(h=i.current.props).onClick)===null||p===void 0||p.call(h,{type:"click",target:c,originalEvent:f})}),c.on("dragstart",f=>{var h,p;const m=f;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDragStart)===null||p===void 0||p.call(h,m)}),c.on("drag",f=>{var h,p;const m=f;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDrag)===null||p===void 0||p.call(h,m)}),c.on("dragend",f=>{var h,p;const m=f;m.lngLat=r.getLngLat(),(p=(h=i.current.props).onDragEnd)===null||p===void 0||p.call(h,m)}),c},[]);return L.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),L.useEffect(()=>{os(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!V5(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),A3.createPortal(t.children,r.getElement())}mS.defaultProps=J5;L.memo(mS);function gT(t){return new Set(t?t.trim().split(/\s+/):[])}function ez(t){const{map:e,mapLib:n}=L.useContext(Ff),i=L.useMemo(()=>document.createElement("div"),[]),r=L.useRef({props:t});r.current.props=t;const s=L.useMemo(()=>{const l={...t},c=new n.Popup(l).setLngLat([t.longitude,t.latitude]);return c.once("open",f=>{var h,p;(p=(h=r.current.props).onOpen)===null||p===void 0||p.call(h,f)}),c},[]);if(L.useEffect(()=>{const l=c=>{var f,h;(h=(f=r.current.props).onClose)===null||h===void 0||h.call(f,c)};return s.on("close",l),s.setDOMContent(i).addTo(e.getMap()),()=>{s.off("close",l),s.isOpen()&&s.remove()}},[]),L.useEffect(()=>{os(s.getElement(),t.style)},[t.style]),s.isOpen()&&((s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!sr(s.options.offset,t.offset)&&s.setOffset(t.offset),(s.options.anchor!==t.anchor||s.options.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth)),s.options.className!==t.className)){const l=gT(s.options.className),c=gT(t.className);for(const f of l)c.has(f)||s.removeClassName(f);for(const f of c)l.has(f)||s.addClassName(f);s.options.className=t.className}return A3.createPortal(t.children,i)}const tz=L.memo(ez);function Ml(t,e,n){const i=L.useContext(Ff),r=L.useMemo(()=>t(i),[]);return L.useEffect(()=>{var s;const{map:l}=i;return l.hasControl(r)||l.addControl(r,(s=e)===null||s===void 0?void 0:s.position),()=>{typeof e=="function"&&e(i),l.hasControl(r)&&l.removeControl(r)}},[]),r}function nz(t){const e=Ml(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return L.useEffect(()=>{os(e._container,t.style)},[t.style]),null}L.memo(nz);function iz(t){const e=Ml(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return L.useEffect(()=>{os(e._controlContainer,t.style)},[t.style]),null}L.memo(iz);const _S=L.forwardRef((t,e)=>{const n=L.useRef({props:t}),i=Ml(({mapLib:r})=>{const s=new r.GeolocateControl(t),l=s._setupUI;return s._setupUI=c=>{s._container.hasChildNodes()||l(c)},s.on("geolocate",c=>{var f,h;(h=(f=n.current.props).onGeolocate)===null||h===void 0||h.call(f,c)}),s.on("error",c=>{var f,h;(h=(f=n.current.props).onError)===null||h===void 0||h.call(f,c)}),s.on("outofmaxbounds",c=>{var f,h;(h=(f=n.current.props).onOutOfMaxBounds)===null||h===void 0||h.call(f,c)}),s.on("trackuserlocationstart",c=>{var f,h;(h=(f=n.current.props).onTrackUserLocationStart)===null||h===void 0||h.call(f,c)}),s.on("trackuserlocationend",c=>{var f,h;(h=(f=n.current.props).onTrackUserLocationEnd)===null||h===void 0||h.call(f,c)}),s},{position:t.position});return n.current.props=t,L.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),L.useEffect(()=>{os(i._container,t.style)},[t.style]),null});_S.displayName="GeolocateControl";L.memo(_S);function rz(t){const e=Ml(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return L.useEffect(()=>{os(e._container,t.style)},[t.style]),null}L.memo(rz);const sz={unit:"metric",maxWidth:100};function yS(t){const e=Ml(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),L.useEffect(()=>{os(e._container,t.style)},[t.style]),null}yS.defaultProps=sz;L.memo(yS);function Iu(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function cf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function vS(t){let e,n,i;t.length!==2?(e=Iu,n=(c,f)=>Iu(t(c),f),i=(c,f)=>t(c)-f):(e=t===Iu||t===cf?t:oz,n=t,i=t);function r(c,f,h=0,p=c.length){if(h<p){if(e(f,f)!==0)return p;do{const m=h+p>>>1;n(c[m],f)<0?h=m+1:p=m}while(h<p)}return h}function s(c,f,h=0,p=c.length){if(h<p){if(e(f,f)!==0)return p;do{const m=h+p>>>1;n(c[m],f)<=0?h=m+1:p=m}while(h<p)}return h}function l(c,f,h=0,p=c.length){const m=r(c,f,h,p-1);return m>h&&i(c[m-1],f)>-i(c[m],f)?m-1:m}return{left:r,center:l,right:s}}function oz(){return 0}function az(t){return t===null?NaN:+t}const lz=vS(Iu),cz=lz.right;vS(az).center;function uz(t,e){let n,i;if(e===void 0)for(const r of t)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(n===void 0?s>=s&&(n=i=s):(n>s&&(n=s),i<s&&(i=s)))}return[n,i]}class mT extends Map{constructor(e,n=dz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(_T(this,e))}has(e){return super.has(_T(this,e))}set(e,n){return super.set(fz(this,e),n)}delete(e){return super.delete(hz(this,e))}}function _T({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function fz({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function hz({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function dz(t){return t!==null&&typeof t=="object"?t.valueOf():t}const pz=Math.sqrt(50),gz=Math.sqrt(10),mz=Math.sqrt(2);function uf(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),l=s>=pz?10:s>=gz?5:s>=mz?2:1;let c,f,h;return r<0?(h=Math.pow(10,-r)/l,c=Math.round(t*h),f=Math.round(e*h),c/h<t&&++c,f/h>e&&--f,h=-h):(h=Math.pow(10,r)*l,c=Math.round(t/h),f=Math.round(e/h),c*h<t&&++c,f*h>e&&--f),f<c&&.5<=n&&n<2?uf(t,e,n*2):[c,f,h]}function _z(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,l]=i?uf(e,t,n):uf(t,e,n);if(!(s>=r))return[];const c=s-r+1,f=new Array(c);if(i)if(l<0)for(let h=0;h<c;++h)f[h]=(s-h)/-l;else for(let h=0;h<c;++h)f[h]=(s-h)*l;else if(l<0)for(let h=0;h<c;++h)f[h]=(r+h)/-l;else for(let h=0;h<c;++h)f[h]=(r+h)*l;return f}function Yg(t,e,n){return e=+e,t=+t,n=+n,uf(t,e,n)[2]}function yz(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Yg(e,t,n):Yg(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function qg(t,e){let n;if(e===void 0)for(const i of t)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function vz(t,e){let n;if(e===void 0)for(const i of t)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function bz(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function c_(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function xz(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const yT=Symbol("implicit");function bS(){var t=new mT,e=[],n=[],i=yT;function r(s){let l=t.get(s);if(l===void 0){if(i!==yT)return i;t.set(s,l=e.push(s)-1)}return n[l%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new mT;for(const l of s)t.has(l)||t.set(l,e.push(l)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return bS(e,n).unknown(i)},c_.apply(r,arguments),r}function zf(){var t=bS().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,l,c=!1,f=0,h=0,p=.5;delete t.unknown;function m(){var y=e().length,v=r<i,x=v?r:i,T=v?i:r;s=(T-x)/Math.max(1,y-f+h*2),c&&(s=Math.floor(s)),x+=(T-x-s*(y-f))*p,l=s*(1-f),c&&(x=Math.round(x),l=Math.round(l));var E=bz(y).map(function(C){return x+s*C});return n(v?E.reverse():E)}return t.domain=function(y){return arguments.length?(e(y),m()):e()},t.range=function(y){return arguments.length?([i,r]=y,i=+i,r=+r,m()):[i,r]},t.rangeRound=function(y){return[i,r]=y,i=+i,r=+r,c=!0,m()},t.bandwidth=function(){return l},t.step=function(){return s},t.round=function(y){return arguments.length?(c=!!y,m()):c},t.padding=function(y){return arguments.length?(f=Math.min(1,h=+y),m()):f},t.paddingInner=function(y){return arguments.length?(f=Math.min(1,y),m()):f},t.paddingOuter=function(y){return arguments.length?(h=+y,m()):h},t.align=function(y){return arguments.length?(p=Math.max(0,Math.min(1,y)),m()):p},t.copy=function(){return zf(e(),[i,r]).round(c).paddingInner(f).paddingOuter(h).align(p)},c_.apply(m(),arguments)}function xS(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return xS(e())},t}function Tz(){return xS(zf.apply(null,arguments).paddingInner(1))}function u_(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function TS(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Pl(){}var _l=.7,ff=1/_l,mo="\\s*([+-]?\\d+)\\s*",yl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Kn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wz=/^#([0-9a-f]{3,8})$/,Sz=new RegExp(`^rgb\\(${mo},${mo},${mo}\\)$`),Az=new RegExp(`^rgb\\(${Kn},${Kn},${Kn}\\)$`),Ez=new RegExp(`^rgba\\(${mo},${mo},${mo},${yl}\\)$`),Rz=new RegExp(`^rgba\\(${Kn},${Kn},${Kn},${yl}\\)$`),Cz=new RegExp(`^hsl\\(${yl},${Kn},${Kn}\\)$`),Mz=new RegExp(`^hsla\\(${yl},${Kn},${Kn},${yl}\\)$`),vT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};u_(Pl,mr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:bT,formatHex:bT,formatHex8:Pz,formatHsl:Oz,formatRgb:xT,toString:xT});function bT(){return this.rgb().formatHex()}function Pz(){return this.rgb().formatHex8()}function Oz(){return wS(this).formatHsl()}function xT(){return this.rgb().formatRgb()}function mr(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=wz.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?TT(e):n===3?new Wt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?du(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?du(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Sz.exec(t))?new Wt(e[1],e[2],e[3],1):(e=Az.exec(t))?new Wt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ez.exec(t))?du(e[1],e[2],e[3],e[4]):(e=Rz.exec(t))?du(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Cz.exec(t))?AT(e[1],e[2]/100,e[3]/100,1):(e=Mz.exec(t))?AT(e[1],e[2]/100,e[3]/100,e[4]):vT.hasOwnProperty(t)?TT(vT[t]):t==="transparent"?new Wt(NaN,NaN,NaN,0):null}function TT(t){return new Wt(t>>16&255,t>>8&255,t&255,1)}function du(t,e,n,i){return i<=0&&(t=e=n=NaN),new Wt(t,e,n,i)}function Iz(t){return t instanceof Pl||(t=mr(t)),t?(t=t.rgb(),new Wt(t.r,t.g,t.b,t.opacity)):new Wt}function hf(t,e,n,i){return arguments.length===1?Iz(t):new Wt(t,e,n,i??1)}function Wt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}u_(Wt,hf,TS(Pl,{brighter(t){return t=t==null?ff:Math.pow(ff,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?_l:Math.pow(_l,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Wt(Kr(this.r),Kr(this.g),Kr(this.b),df(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wT,formatHex:wT,formatHex8:Nz,formatRgb:ST,toString:ST}));function wT(){return`#${$r(this.r)}${$r(this.g)}${$r(this.b)}`}function Nz(){return`#${$r(this.r)}${$r(this.g)}${$r(this.b)}${$r((isNaN(this.opacity)?1:this.opacity)*255)}`}function ST(){const t=df(this.opacity);return`${t===1?"rgb(":"rgba("}${Kr(this.r)}, ${Kr(this.g)}, ${Kr(this.b)}${t===1?")":`, ${t})`}`}function df(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Kr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function $r(t){return t=Kr(t),(t<16?"0":"")+t.toString(16)}function AT(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Mn(t,e,n,i)}function wS(t){if(t instanceof Mn)return new Mn(t.h,t.s,t.l,t.opacity);if(t instanceof Pl||(t=mr(t)),!t)return new Mn;if(t instanceof Mn)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),l=NaN,c=s-r,f=(s+r)/2;return c?(e===s?l=(n-i)/c+(n<i)*6:n===s?l=(i-e)/c+2:l=(e-n)/c+4,c/=f<.5?s+r:2-s-r,l*=60):c=f>0&&f<1?0:l,new Mn(l,c,f,t.opacity)}function kz(t,e,n,i){return arguments.length===1?wS(t):new Mn(t,e,n,i??1)}function Mn(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}u_(Mn,kz,TS(Pl,{brighter(t){return t=t==null?ff:Math.pow(ff,t),new Mn(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?_l:Math.pow(_l,t),new Mn(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Wt(tg(t>=240?t-240:t+120,r,i),tg(t,r,i),tg(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Mn(ET(this.h),pu(this.s),pu(this.l),df(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=df(this.opacity);return`${t===1?"hsl(":"hsla("}${ET(this.h)}, ${pu(this.s)*100}%, ${pu(this.l)*100}%${t===1?")":`, ${t})`}`}}));function ET(t){return t=(t||0)%360,t<0?t+360:t}function pu(t){return Math.max(0,Math.min(1,t||0))}function tg(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function Dz(t,e,n,i,r){var s=t*t,l=s*t;return((1-3*t+3*s-l)*e+(4-6*s+3*l)*n+(1+3*t+3*s-3*l)*i+l*r)/6}function Lz(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],s=t[i+1],l=i>0?t[i-1]:2*r-s,c=i<e-1?t[i+2]:2*s-r;return Dz((n-i/e)*e,l,r,s,c)}}const f_=t=>()=>t;function Bz(t,e){return function(n){return t+n*e}}function Uz(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Fz(t){return(t=+t)==1?SS:function(e,n){return n-e?Uz(e,n,t):f_(isNaN(e)?n:e)}}function SS(t,e){var n=e-t;return n?Bz(t,n):f_(isNaN(t)?e:t)}const pf=(function t(e){var n=Fz(e);function i(r,s){var l=n((r=hf(r)).r,(s=hf(s)).r),c=n(r.g,s.g),f=n(r.b,s.b),h=SS(r.opacity,s.opacity);return function(p){return r.r=l(p),r.g=c(p),r.b=f(p),r.opacity=h(p),r+""}}return i.gamma=t,i})(1);function zz(t){return function(e){var n=e.length,i=new Array(n),r=new Array(n),s=new Array(n),l,c;for(l=0;l<n;++l)c=hf(e[l]),i[l]=c.r||0,r[l]=c.g||0,s[l]=c.b||0;return i=t(i),r=t(r),s=t(s),c.opacity=1,function(f){return c.r=i(f),c.g=r(f),c.b=s(f),c+""}}}var Vz=zz(Lz);function jz(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function Hz(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $z(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),l;for(l=0;l<i;++l)r[l]=Vf(t[l],e[l]);for(;l<n;++l)s[l]=e[l];return function(c){for(l=0;l<i;++l)s[l]=r[l](c);return s}}function Wz(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Cn(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Xz(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Vf(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Kg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ng=new RegExp(Kg.source,"g");function Yz(t){return function(){return t}}function qz(t){return function(e){return t(e)+""}}function AS(t,e){var n=Kg.lastIndex=ng.lastIndex=0,i,r,s,l=-1,c=[],f=[];for(t=t+"",e=e+"";(i=Kg.exec(t))&&(r=ng.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),c[l]?c[l]+=s:c[++l]=s),(i=i[0])===(r=r[0])?c[l]?c[l]+=r:c[++l]=r:(c[++l]=null,f.push({i:l,x:Cn(i,r)})),n=ng.lastIndex;return n<e.length&&(s=e.slice(n),c[l]?c[l]+=s:c[++l]=s),c.length<2?f[0]?qz(f[0].x):Yz(e):(e=f.length,function(h){for(var p=0,m;p<e;++p)c[(m=f[p]).i]=m.x(h);return c.join("")})}function Vf(t,e){var n=typeof e,i;return e==null||n==="boolean"?f_(e):(n==="number"?Cn:n==="string"?(i=mr(e))?(e=i,pf):AS:e instanceof mr?pf:e instanceof Date?Wz:Hz(e)?jz:Array.isArray(e)?$z:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Xz:Cn)(t,e)}function ES(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var RT=180/Math.PI,Zg={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function RS(t,e,n,i,r,s){var l,c,f;return(l=Math.sqrt(t*t+e*e))&&(t/=l,e/=l),(f=t*n+e*i)&&(n-=t*f,i-=e*f),(c=Math.sqrt(n*n+i*i))&&(n/=c,i/=c,f/=c),t*i<e*n&&(t=-t,e=-e,f=-f,l=-l),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*RT,skewX:Math.atan(f)*RT,scaleX:l,scaleY:c}}var gu;function Kz(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Zg:RS(e.a,e.b,e.c,e.d,e.e,e.f)}function Zz(t){return t==null||(gu||(gu=document.createElementNS("http://www.w3.org/2000/svg","g")),gu.setAttribute("transform",t),!(t=gu.transform.baseVal.consolidate()))?Zg:(t=t.matrix,RS(t.a,t.b,t.c,t.d,t.e,t.f))}function CS(t,e,n,i){function r(h){return h.length?h.pop()+" ":""}function s(h,p,m,y,v,x){if(h!==m||p!==y){var T=v.push("translate(",null,e,null,n);x.push({i:T-4,x:Cn(h,m)},{i:T-2,x:Cn(p,y)})}else(m||y)&&v.push("translate("+m+e+y+n)}function l(h,p,m,y){h!==p?(h-p>180?p+=360:p-h>180&&(h+=360),y.push({i:m.push(r(m)+"rotate(",null,i)-2,x:Cn(h,p)})):p&&m.push(r(m)+"rotate("+p+i)}function c(h,p,m,y){h!==p?y.push({i:m.push(r(m)+"skewX(",null,i)-2,x:Cn(h,p)}):p&&m.push(r(m)+"skewX("+p+i)}function f(h,p,m,y,v,x){if(h!==m||p!==y){var T=v.push(r(v)+"scale(",null,",",null,")");x.push({i:T-4,x:Cn(h,m)},{i:T-2,x:Cn(p,y)})}else(m!==1||y!==1)&&v.push(r(v)+"scale("+m+","+y+")")}return function(h,p){var m=[],y=[];return h=t(h),p=t(p),s(h.translateX,h.translateY,p.translateX,p.translateY,m,y),l(h.rotate,p.rotate,m,y),c(h.skewX,p.skewX,m,y),f(h.scaleX,h.scaleY,p.scaleX,p.scaleY,m,y),h=p=null,function(v){for(var x=-1,T=y.length,E;++x<T;)m[(E=y[x]).i]=E.x(v);return m.join("")}}}var Gz=CS(Kz,"px, ","px)","deg)"),Qz=CS(Zz,", ",")",")");function Jz(t){return function(){return t}}function eV(t){return+t}var CT=[0,1];function ur(t){return t}function Gg(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Jz(isNaN(e)?NaN:.5)}function tV(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function nV(t,e,n){var i=t[0],r=t[1],s=e[0],l=e[1];return r<i?(i=Gg(r,i),s=n(l,s)):(i=Gg(i,r),s=n(s,l)),function(c){return s(i(c))}}function iV(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),l=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++l<i;)r[l]=Gg(t[l],t[l+1]),s[l]=n(e[l],e[l+1]);return function(c){var f=cz(t,c,1,i)-1;return s[f](r[f](c))}}function rV(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function sV(){var t=CT,e=CT,n=Vf,i,r,s,l=ur,c,f,h;function p(){var y=Math.min(t.length,e.length);return l!==ur&&(l=tV(t[0],t[y-1])),c=y>2?iV:nV,f=h=null,m}function m(y){return y==null||isNaN(y=+y)?s:(f||(f=c(t.map(i),e,n)))(i(l(y)))}return m.invert=function(y){return l(r((h||(h=c(e,t.map(i),Cn)))(y)))},m.domain=function(y){return arguments.length?(t=Array.from(y,eV),p()):t.slice()},m.range=function(y){return arguments.length?(e=Array.from(y),p()):e.slice()},m.rangeRound=function(y){return e=Array.from(y),n=ES,p()},m.clamp=function(y){return arguments.length?(l=y?!0:ur,p()):l!==ur},m.interpolate=function(y){return arguments.length?(n=y,p()):n},m.unknown=function(y){return arguments.length?(s=y,m):s},function(y,v){return i=y,r=v,p()}}function oV(){return sV()(ur,ur)}function aV(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function gf(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Mo(t){return t=gf(Math.abs(t)),t?t[1]:NaN}function lV(t,e){return function(n,i){for(var r=n.length,s=[],l=0,c=t[0],f=0;r>0&&c>0&&(f+c+1>i&&(c=Math.max(1,i-f)),s.push(n.substring(r-=c,r+c)),!((f+=c+1)>i));)c=t[l=(l+1)%t.length];return s.reverse().join(e)}}function cV(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var uV=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mf(t){if(!(e=uV.exec(t)))throw new Error("invalid format: "+t);var e;return new h_({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}mf.prototype=h_.prototype;function h_(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}h_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fV(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var MS;function hV(t,e){var n=gf(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(MS=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,l=i.length;return s===l?i:s>l?i+new Array(s-l+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+gf(t,Math.max(0,e+s-1))[0]}function MT(t,e){var n=gf(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const PT={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:aV,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>MT(t*100,e),r:MT,s:hV,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function OT(t){return t}var IT=Array.prototype.map,NT=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function dV(t){var e=t.grouping===void 0||t.thousands===void 0?OT:lV(IT.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?OT:cV(IT.call(t.numerals,String)),l=t.percent===void 0?"%":t.percent+"",c=t.minus===void 0?"−":t.minus+"",f=t.nan===void 0?"NaN":t.nan+"";function h(m){m=mf(m);var y=m.fill,v=m.align,x=m.sign,T=m.symbol,E=m.zero,C=m.width,P=m.comma,M=m.precision,I=m.trim,D=m.type;D==="n"?(P=!0,D="g"):PT[D]||(M===void 0&&(M=12),I=!0,D="g"),(E||y==="0"&&v==="=")&&(E=!0,y="0",v="=");var z=T==="$"?n:T==="#"&&/[boxX]/.test(D)?"0"+D.toLowerCase():"",ae=T==="$"?i:/[%p]/.test(D)?l:"",he=PT[D],le=/[defgprs%]/.test(D);M=M===void 0?6:/[gprs]/.test(D)?Math.max(1,Math.min(21,M)):Math.max(0,Math.min(20,M));function ge(Z){var ce=z,de=ae,pe,Ae,w;if(D==="c")de=he(Z)+de,Z="";else{Z=+Z;var k=Z<0||1/Z<0;if(Z=isNaN(Z)?f:he(Math.abs(Z),M),I&&(Z=fV(Z)),k&&+Z==0&&x!=="+"&&(k=!1),ce=(k?x==="("?x:c:x==="-"||x==="("?"":x)+ce,de=(D==="s"?NT[8+MS/3]:"")+de+(k&&x==="("?")":""),le){for(pe=-1,Ae=Z.length;++pe<Ae;)if(w=Z.charCodeAt(pe),48>w||w>57){de=(w===46?r+Z.slice(pe+1):Z.slice(pe))+de,Z=Z.slice(0,pe);break}}}P&&!E&&(Z=e(Z,1/0));var N=ce.length+Z.length+de.length,G=N<C?new Array(C-N+1).join(y):"";switch(P&&E&&(Z=e(G+Z,G.length?C-de.length:1/0),G=""),v){case"<":Z=ce+Z+de+G;break;case"=":Z=ce+G+Z+de;break;case"^":Z=G.slice(0,N=G.length>>1)+ce+Z+de+G.slice(N);break;default:Z=G+ce+Z+de;break}return s(Z)}return ge.toString=function(){return m+""},ge}function p(m,y){var v=h((m=mf(m),m.type="f",m)),x=Math.max(-8,Math.min(8,Math.floor(Mo(y)/3)))*3,T=Math.pow(10,-x),E=NT[8+x/3];return function(C){return v(T*C)+E}}return{format:h,formatPrefix:p}}var mu,_f,PS;pV({thousands:",",grouping:[3],currency:["$",""]});function pV(t){return mu=dV(t),_f=mu.format,PS=mu.formatPrefix,mu}function gV(t){return Math.max(0,-Mo(Math.abs(t)))}function mV(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Mo(e)/3)))*3-Mo(Math.abs(t)))}function _V(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Mo(e)-Mo(t))+1}function yV(t,e,n,i){var r=yz(t,e,n),s;switch(i=mf(i??",f"),i.type){case"s":{var l=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=mV(r,l))&&(i.precision=s),PS(i,l)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=_V(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=gV(r))&&(i.precision=s-(i.type==="%")*2);break}}return _f(i)}function OS(t){var e=t.domain;return t.ticks=function(n){var i=e();return _z(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return yV(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,l=i[r],c=i[s],f,h,p=10;for(c<l&&(h=l,l=c,c=h,h=r,r=s,s=h);p-- >0;){if(h=Yg(l,c,n),h===f)return i[r]=l,i[s]=c,e(i);if(h>0)l=Math.floor(l/h)*h,c=Math.ceil(c/h)*h;else if(h<0)l=Math.ceil(l*h)/h,c=Math.floor(c*h)/h;else break;f=h}return t},t}function jf(){var t=oV();return t.copy=function(){return rV(t,jf())},c_.apply(t,arguments),OS(t)}function vV(){var t=0,e=1,n,i,r,s,l=ur,c=!1,f;function h(m){return m==null||isNaN(m=+m)?f:l(r===0?.5:(m=(s(m)-n)*r,c?Math.max(0,Math.min(1,m)):m))}h.domain=function(m){return arguments.length?([t,e]=m,n=s(t=+t),i=s(e=+e),r=n===i?0:1/(i-n),h):[t,e]},h.clamp=function(m){return arguments.length?(c=!!m,h):c},h.interpolator=function(m){return arguments.length?(l=m,h):l};function p(m){return function(y){var v,x;return arguments.length?([v,x]=y,l=m(v,x),h):[l(0),l(1)]}}return h.range=p(Vf),h.rangeRound=p(ES),h.unknown=function(m){return arguments.length?(f=m,h):f},function(m){return s=m,n=m(t),i=m(e),r=n===i?0:1/(i-n),h}}function bV(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function IS(){var t=OS(vV()(ur));return t.copy=function(){return bV(t,IS())},xz.apply(t,arguments)}function xV(t){for(var e=t.length/6|0,n=new Array(e),i=0;i<e;)n[i]="#"+t.slice(i*6,++i*6);return n}const TV=t=>Vz(t[t.length-1]);var wV=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(xV);const SV=TV(wV);function AV(t,e={}){const{offset:n=[10,10]}=e;if(!t)return null;const i=t.object||t;if(!i)return null;if(t.coordinate){const[r,s]=t.coordinate;return{type:"popup",longitude:r,latitude:s,content:i}}return t.x!=null&&t.y!=null?{type:"tooltip",x:t.x+n[0],y:t.y+n[1],content:i}:null}function EV(t,e){return e?.find(n=>String(n.PUMA)===String(t))}function RV(){return{longitude:-95,latitude:37,zoom:3,pitch:0,bearing:0}}function CV(t){return t}var ig=1,rg=2,Qg=3,Za=4,kT=1e-6;function MV(t){return"translate("+t+",0)"}function PV(t){return"translate(0,"+t+")"}function OV(t){return e=>+t(e)}function IV(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function NV(){return!this.__axis}function NS(t,e){var n=[],i=null,r=null,s=6,l=6,c=3,f=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=t===ig||t===Za?-1:1,p=t===Za||t===rg?"x":"y",m=t===ig||t===Qg?MV:PV;function y(v){var x=i??(e.ticks?e.ticks.apply(e,n):e.domain()),T=r??(e.tickFormat?e.tickFormat.apply(e,n):CV),E=Math.max(s,0)+c,C=e.range(),P=+C[0]+f,M=+C[C.length-1]+f,I=(e.bandwidth?IV:OV)(e.copy(),f),D=v.selection?v.selection():v,z=D.selectAll(".domain").data([null]),ae=D.selectAll(".tick").data(x,e).order(),he=ae.exit(),le=ae.enter().append("g").attr("class","tick"),ge=ae.select("line"),Z=ae.select("text");z=z.merge(z.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),ae=ae.merge(le),ge=ge.merge(le.append("line").attr("stroke","currentColor").attr(p+"2",h*s)),Z=Z.merge(le.append("text").attr("fill","currentColor").attr(p,h*E).attr("dy",t===ig?"0em":t===Qg?"0.71em":"0.32em")),v!==D&&(z=z.transition(v),ae=ae.transition(v),ge=ge.transition(v),Z=Z.transition(v),he=he.transition(v).attr("opacity",kT).attr("transform",function(ce){return isFinite(ce=I(ce))?m(ce+f):this.getAttribute("transform")}),le.attr("opacity",kT).attr("transform",function(ce){var de=this.parentNode.__axis;return m((de&&isFinite(de=de(ce))?de:I(ce))+f)})),he.remove(),z.attr("d",t===Za||t===rg?l?"M"+h*l+","+P+"H"+f+"V"+M+"H"+h*l:"M"+f+","+P+"V"+M:l?"M"+P+","+h*l+"V"+f+"H"+M+"V"+h*l:"M"+P+","+f+"H"+M),ae.attr("opacity",1).attr("transform",function(ce){return m(I(ce)+f)}),ge.attr(p+"2",h*s),Z.attr(p,h*E).text(T),D.filter(NV).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===rg?"start":t===Za?"end":"middle"),D.each(function(){this.__axis=I})}return y.scale=function(v){return arguments.length?(e=v,y):e},y.ticks=function(){return n=Array.from(arguments),y},y.tickArguments=function(v){return arguments.length?(n=v==null?[]:Array.from(v),y):n.slice()},y.tickValues=function(v){return arguments.length?(i=v==null?null:Array.from(v),y):i&&i.slice()},y.tickFormat=function(v){return arguments.length?(r=v,y):r},y.tickSize=function(v){return arguments.length?(s=l=+v,y):s},y.tickSizeInner=function(v){return arguments.length?(s=+v,y):s},y.tickSizeOuter=function(v){return arguments.length?(l=+v,y):l},y.tickPadding=function(v){return arguments.length?(c=+v,y):c},y.offset=function(v){return arguments.length?(f=+v,y):f},y}function d_(t){return NS(Qg,t)}function p_(t){return NS(Za,t)}var kV={value:()=>{}};function kS(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Nu(n)}function Nu(t){this._=t}function DV(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Nu.prototype=kS.prototype={constructor:Nu,on:function(t,e){var n=this._,i=DV(t+"",n),r,s=-1,l=i.length;if(arguments.length<2){for(;++s<l;)if((r=(t=i[s]).type)&&(r=LV(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<l;)if(r=(t=i[s]).type)n[r]=DT(n[r],t.name,e);else if(e==null)for(r in n)n[r]=DT(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Nu(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function LV(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function DT(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=kV,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Jg="http://www.w3.org/1999/xhtml";const LT={svg:"http://www.w3.org/2000/svg",xhtml:Jg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Hf(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),LT.hasOwnProperty(e)?{space:LT[e],local:t}:t}function BV(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Jg&&e.documentElement.namespaceURI===Jg?e.createElement(t):e.createElementNS(n,t)}}function UV(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function DS(t){var e=Hf(t);return(e.local?UV:BV)(e)}function FV(){}function g_(t){return t==null?FV:function(){return this.querySelector(t)}}function zV(t){typeof t!="function"&&(t=g_(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],l=s.length,c=i[r]=new Array(l),f,h,p=0;p<l;++p)(f=s[p])&&(h=t.call(f,f.__data__,p,s))&&("__data__"in f&&(h.__data__=f.__data__),c[p]=h);return new on(i,this._parents)}function VV(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function jV(){return[]}function LS(t){return t==null?jV:function(){return this.querySelectorAll(t)}}function HV(t){return function(){return VV(t.apply(this,arguments))}}function $V(t){typeof t=="function"?t=HV(t):t=LS(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var l=e[s],c=l.length,f,h=0;h<c;++h)(f=l[h])&&(i.push(t.call(f,f.__data__,h,l)),r.push(f));return new on(i,r)}function BS(t){return function(){return this.matches(t)}}function US(t){return function(e){return e.matches(t)}}var WV=Array.prototype.find;function XV(t){return function(){return WV.call(this.children,t)}}function YV(){return this.firstElementChild}function qV(t){return this.select(t==null?YV:XV(typeof t=="function"?t:US(t)))}var KV=Array.prototype.filter;function ZV(){return Array.from(this.children)}function GV(t){return function(){return KV.call(this.children,t)}}function QV(t){return this.selectAll(t==null?ZV:GV(typeof t=="function"?t:US(t)))}function JV(t){typeof t!="function"&&(t=BS(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],l=s.length,c=i[r]=[],f,h=0;h<l;++h)(f=s[h])&&t.call(f,f.__data__,h,s)&&c.push(f);return new on(i,this._parents)}function FS(t){return new Array(t.length)}function ej(){return new on(this._enter||this._groups.map(FS),this._parents)}function yf(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}yf.prototype={constructor:yf,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function tj(t){return function(){return t}}function nj(t,e,n,i,r,s){for(var l=0,c,f=e.length,h=s.length;l<h;++l)(c=e[l])?(c.__data__=s[l],i[l]=c):n[l]=new yf(t,s[l]);for(;l<f;++l)(c=e[l])&&(r[l]=c)}function ij(t,e,n,i,r,s,l){var c,f,h=new Map,p=e.length,m=s.length,y=new Array(p),v;for(c=0;c<p;++c)(f=e[c])&&(y[c]=v=l.call(f,f.__data__,c,e)+"",h.has(v)?r[c]=f:h.set(v,f));for(c=0;c<m;++c)v=l.call(t,s[c],c,s)+"",(f=h.get(v))?(i[c]=f,f.__data__=s[c],h.delete(v)):n[c]=new yf(t,s[c]);for(c=0;c<p;++c)(f=e[c])&&h.get(y[c])===f&&(r[c]=f)}function rj(t){return t.__data__}function sj(t,e){if(!arguments.length)return Array.from(this,rj);var n=e?ij:nj,i=this._parents,r=this._groups;typeof t!="function"&&(t=tj(t));for(var s=r.length,l=new Array(s),c=new Array(s),f=new Array(s),h=0;h<s;++h){var p=i[h],m=r[h],y=m.length,v=oj(t.call(p,p&&p.__data__,h,i)),x=v.length,T=c[h]=new Array(x),E=l[h]=new Array(x),C=f[h]=new Array(y);n(p,m,T,E,C,v,e);for(var P=0,M=0,I,D;P<x;++P)if(I=T[P]){for(P>=M&&(M=P+1);!(D=E[M])&&++M<x;);I._next=D||null}}return l=new on(l,i),l._enter=c,l._exit=f,l}function oj(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function aj(){return new on(this._exit||this._groups.map(FS),this._parents)}function lj(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function cj(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,l=Math.min(r,s),c=new Array(r),f=0;f<l;++f)for(var h=n[f],p=i[f],m=h.length,y=c[f]=new Array(m),v,x=0;x<m;++x)(v=h[x]||p[x])&&(y[x]=v);for(;f<r;++f)c[f]=n[f];return new on(c,this._parents)}function uj(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],l;--r>=0;)(l=i[r])&&(s&&l.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(l,s),s=l);return this}function fj(t){t||(t=hj);function e(m,y){return m&&y?t(m.__data__,y.__data__):!m-!y}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var l=n[s],c=l.length,f=r[s]=new Array(c),h,p=0;p<c;++p)(h=l[p])&&(f[p]=h);f.sort(e)}return new on(r,this._parents).order()}function hj(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function dj(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function pj(){return Array.from(this)}function gj(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var l=i[r];if(l)return l}return null}function mj(){let t=0;for(const e of this)++t;return t}function _j(){return!this.node()}function yj(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,l=r.length,c;s<l;++s)(c=r[s])&&t.call(c,c.__data__,s,r);return this}function vj(t){return function(){this.removeAttribute(t)}}function bj(t){return function(){this.removeAttributeNS(t.space,t.local)}}function xj(t,e){return function(){this.setAttribute(t,e)}}function Tj(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function wj(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Sj(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Aj(t,e){var n=Hf(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?bj:vj:typeof e=="function"?n.local?Sj:wj:n.local?Tj:xj)(n,e))}function zS(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ej(t){return function(){this.style.removeProperty(t)}}function Rj(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Cj(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Mj(t,e,n){return arguments.length>1?this.each((e==null?Ej:typeof e=="function"?Cj:Rj)(t,e,n??"")):Po(this.node(),t)}function Po(t,e){return t.style.getPropertyValue(e)||zS(t).getComputedStyle(t,null).getPropertyValue(e)}function Pj(t){return function(){delete this[t]}}function Oj(t,e){return function(){this[t]=e}}function Ij(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Nj(t,e){return arguments.length>1?this.each((e==null?Pj:typeof e=="function"?Ij:Oj)(t,e)):this.node()[t]}function VS(t){return t.trim().split(/^|\s+/)}function m_(t){return t.classList||new jS(t)}function jS(t){this._node=t,this._names=VS(t.getAttribute("class")||"")}jS.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function HS(t,e){for(var n=m_(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function $S(t,e){for(var n=m_(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function kj(t){return function(){HS(this,t)}}function Dj(t){return function(){$S(this,t)}}function Lj(t,e){return function(){(e.apply(this,arguments)?HS:$S)(this,t)}}function Bj(t,e){var n=VS(t+"");if(arguments.length<2){for(var i=m_(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Lj:e?kj:Dj)(n,e))}function Uj(){this.textContent=""}function Fj(t){return function(){this.textContent=t}}function zj(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Vj(t){return arguments.length?this.each(t==null?Uj:(typeof t=="function"?zj:Fj)(t)):this.node().textContent}function jj(){this.innerHTML=""}function Hj(t){return function(){this.innerHTML=t}}function $j(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Wj(t){return arguments.length?this.each(t==null?jj:(typeof t=="function"?$j:Hj)(t)):this.node().innerHTML}function Xj(){this.nextSibling&&this.parentNode.appendChild(this)}function Yj(){return this.each(Xj)}function qj(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Kj(){return this.each(qj)}function Zj(t){var e=typeof t=="function"?t:DS(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Gj(){return null}function Qj(t,e){var n=typeof t=="function"?t:DS(t),i=e==null?Gj:typeof e=="function"?e:g_(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Jj(){var t=this.parentNode;t&&t.removeChild(this)}function eH(){return this.each(Jj)}function tH(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function nH(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function iH(t){return this.select(t?nH:tH)}function rH(t){return arguments.length?this.property("__data__",t):this.node().__data__}function sH(t){return function(e){t.call(this,e,this.__data__)}}function oH(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function aH(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function lH(t,e,n){return function(){var i=this.__on,r,s=sH(e);if(i){for(var l=0,c=i.length;l<c;++l)if((r=i[l]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function cH(t,e,n){var i=oH(t+""),r,s=i.length,l;if(arguments.length<2){var c=this.node().__on;if(c){for(var f=0,h=c.length,p;f<h;++f)for(r=0,p=c[f];r<s;++r)if((l=i[r]).type===p.type&&l.name===p.name)return p.value}return}for(c=e?lH:aH,r=0;r<s;++r)this.each(c(i[r],e,n));return this}function WS(t,e,n){var i=zS(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function uH(t,e){return function(){return WS(this,t,e)}}function fH(t,e){return function(){return WS(this,t,e.apply(this,arguments))}}function hH(t,e){return this.each((typeof e=="function"?fH:uH)(t,e))}function*dH(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,l;r<s;++r)(l=i[r])&&(yield l)}var XS=[null];function on(t,e){this._groups=t,this._parents=e}function Ol(){return new on([[document.documentElement]],XS)}function pH(){return this}on.prototype=Ol.prototype={constructor:on,select:zV,selectAll:$V,selectChild:qV,selectChildren:QV,filter:JV,data:sj,enter:ej,exit:aj,join:lj,merge:cj,selection:pH,order:uj,sort:fj,call:dj,nodes:pj,node:gj,size:mj,empty:_j,each:yj,attr:Aj,style:Mj,property:Nj,classed:Bj,text:Vj,html:Wj,raise:Yj,lower:Kj,append:Zj,insert:Qj,remove:eH,clone:iH,datum:rH,on:cH,dispatch:hH,[Symbol.iterator]:dH};function __(t){return typeof t=="string"?new on([[document.querySelector(t)]],[document.documentElement]):new on([[t]],XS)}var Oo=0,Ga=0,Ha=0,YS=1e3,vf,Qa,bf=0,ns=0,$f=0,vl=typeof performance=="object"&&performance.now?performance:Date,qS=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function y_(){return ns||(qS(gH),ns=vl.now()+$f)}function gH(){ns=0}function xf(){this._call=this._time=this._next=null}xf.prototype=KS.prototype={constructor:xf,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?y_():+n)+(e==null?0:+e),!this._next&&Qa!==this&&(Qa?Qa._next=this:vf=this,Qa=this),this._call=t,this._time=n,em()},stop:function(){this._call&&(this._call=null,this._time=1/0,em())}};function KS(t,e,n){var i=new xf;return i.restart(t,e,n),i}function mH(){y_(),++Oo;for(var t=vf,e;t;)(e=ns-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Oo}function BT(){ns=(bf=vl.now())+$f,Oo=Ga=0;try{mH()}finally{Oo=0,yH(),ns=0}}function _H(){var t=vl.now(),e=t-bf;e>YS&&($f-=e,bf=t)}function yH(){for(var t,e=vf,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:vf=n);Qa=t,em(i)}function em(t){if(!Oo){Ga&&(Ga=clearTimeout(Ga));var e=t-ns;e>24?(t<1/0&&(Ga=setTimeout(BT,t-vl.now()-$f)),Ha&&(Ha=clearInterval(Ha))):(Ha||(bf=vl.now(),Ha=setInterval(_H,YS)),Oo=1,qS(BT))}}function UT(t,e,n){var i=new xf;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var vH=kS("start","end","cancel","interrupt"),bH=[],ZS=0,FT=1,tm=2,ku=3,zT=4,nm=5,Du=6;function Wf(t,e,n,i,r,s){var l=t.__transition;if(!l)t.__transition={};else if(n in l)return;xH(t,n,{name:e,index:i,group:r,on:vH,tween:bH,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ZS})}function v_(t,e){var n=Ln(t,e);if(n.state>ZS)throw new Error("too late; already scheduled");return n}function ti(t,e){var n=Ln(t,e);if(n.state>ku)throw new Error("too late; already running");return n}function Ln(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function xH(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=KS(s,0,n.time);function s(h){n.state=FT,n.timer.restart(l,n.delay,n.time),n.delay<=h&&l(h-n.delay)}function l(h){var p,m,y,v;if(n.state!==FT)return f();for(p in i)if(v=i[p],v.name===n.name){if(v.state===ku)return UT(l);v.state===zT?(v.state=Du,v.timer.stop(),v.on.call("interrupt",t,t.__data__,v.index,v.group),delete i[p]):+p<e&&(v.state=Du,v.timer.stop(),v.on.call("cancel",t,t.__data__,v.index,v.group),delete i[p])}if(UT(function(){n.state===ku&&(n.state=zT,n.timer.restart(c,n.delay,n.time),c(h))}),n.state=tm,n.on.call("start",t,t.__data__,n.index,n.group),n.state===tm){for(n.state=ku,r=new Array(y=n.tween.length),p=0,m=-1;p<y;++p)(v=n.tween[p].value.call(t,t.__data__,n.index,n.group))&&(r[++m]=v);r.length=m+1}}function c(h){for(var p=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(f),n.state=nm,1),m=-1,y=r.length;++m<y;)r[m].call(t,p);n.state===nm&&(n.on.call("end",t,t.__data__,n.index,n.group),f())}function f(){n.state=Du,n.timer.stop(),delete i[e];for(var h in i)return;delete t.__transition}}function TH(t,e){var n=t.__transition,i,r,s=!0,l;if(n){e=e==null?null:e+"";for(l in n){if((i=n[l]).name!==e){s=!1;continue}r=i.state>tm&&i.state<nm,i.state=Du,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[l]}s&&delete t.__transition}}function wH(t){return this.each(function(){TH(this,t)})}function SH(t,e){var n,i;return function(){var r=ti(this,t),s=r.tween;if(s!==n){i=n=s;for(var l=0,c=i.length;l<c;++l)if(i[l].name===e){i=i.slice(),i.splice(l,1);break}}r.tween=i}}function AH(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=ti(this,t),l=s.tween;if(l!==i){r=(i=l).slice();for(var c={name:e,value:n},f=0,h=r.length;f<h;++f)if(r[f].name===e){r[f]=c;break}f===h&&r.push(c)}s.tween=r}}function EH(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Ln(this.node(),n).tween,r=0,s=i.length,l;r<s;++r)if((l=i[r]).name===t)return l.value;return null}return this.each((e==null?SH:AH)(n,t,e))}function b_(t,e,n){var i=t._id;return t.each(function(){var r=ti(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Ln(r,i).value[e]}}function GS(t,e){var n;return(typeof e=="number"?Cn:e instanceof mr?pf:(n=mr(e))?(e=n,pf):AS)(t,e)}function RH(t){return function(){this.removeAttribute(t)}}function CH(t){return function(){this.removeAttributeNS(t.space,t.local)}}function MH(t,e,n){var i,r=n+"",s;return function(){var l=this.getAttribute(t);return l===r?null:l===i?s:s=e(i=l,n)}}function PH(t,e,n){var i,r=n+"",s;return function(){var l=this.getAttributeNS(t.space,t.local);return l===r?null:l===i?s:s=e(i=l,n)}}function OH(t,e,n){var i,r,s;return function(){var l,c=n(this),f;return c==null?void this.removeAttribute(t):(l=this.getAttribute(t),f=c+"",l===f?null:l===i&&f===r?s:(r=f,s=e(i=l,c)))}}function IH(t,e,n){var i,r,s;return function(){var l,c=n(this),f;return c==null?void this.removeAttributeNS(t.space,t.local):(l=this.getAttributeNS(t.space,t.local),f=c+"",l===f?null:l===i&&f===r?s:(r=f,s=e(i=l,c)))}}function NH(t,e){var n=Hf(t),i=n==="transform"?Qz:GS;return this.attrTween(t,typeof e=="function"?(n.local?IH:OH)(n,i,b_(this,"attr."+t,e)):e==null?(n.local?CH:RH)(n):(n.local?PH:MH)(n,i,e))}function kH(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function DH(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function LH(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&DH(t,s)),n}return r._value=e,r}function BH(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&kH(t,s)),n}return r._value=e,r}function UH(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Hf(t);return this.tween(n,(i.local?LH:BH)(i,e))}function FH(t,e){return function(){v_(this,t).delay=+e.apply(this,arguments)}}function zH(t,e){return e=+e,function(){v_(this,t).delay=e}}function VH(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?FH:zH)(e,t)):Ln(this.node(),e).delay}function jH(t,e){return function(){ti(this,t).duration=+e.apply(this,arguments)}}function HH(t,e){return e=+e,function(){ti(this,t).duration=e}}function $H(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?jH:HH)(e,t)):Ln(this.node(),e).duration}function WH(t,e){if(typeof e!="function")throw new Error;return function(){ti(this,t).ease=e}}function XH(t){var e=this._id;return arguments.length?this.each(WH(e,t)):Ln(this.node(),e).ease}function YH(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ti(this,t).ease=n}}function qH(t){if(typeof t!="function")throw new Error;return this.each(YH(this._id,t))}function KH(t){typeof t!="function"&&(t=BS(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],l=s.length,c=i[r]=[],f,h=0;h<l;++h)(f=s[h])&&t.call(f,f.__data__,h,s)&&c.push(f);return new Ei(i,this._parents,this._name,this._id)}function ZH(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),l=new Array(i),c=0;c<s;++c)for(var f=e[c],h=n[c],p=f.length,m=l[c]=new Array(p),y,v=0;v<p;++v)(y=f[v]||h[v])&&(m[v]=y);for(;c<i;++c)l[c]=e[c];return new Ei(l,this._parents,this._name,this._id)}function GH(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function QH(t,e,n){var i,r,s=GH(e)?v_:ti;return function(){var l=s(this,t),c=l.on;c!==i&&(r=(i=c).copy()).on(e,n),l.on=r}}function JH(t,e){var n=this._id;return arguments.length<2?Ln(this.node(),n).on.on(t):this.each(QH(n,t,e))}function e9(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function t9(){return this.on("end.remove",e9(this._id))}function n9(t){var e=this._name,n=this._id;typeof t!="function"&&(t=g_(t));for(var i=this._groups,r=i.length,s=new Array(r),l=0;l<r;++l)for(var c=i[l],f=c.length,h=s[l]=new Array(f),p,m,y=0;y<f;++y)(p=c[y])&&(m=t.call(p,p.__data__,y,c))&&("__data__"in p&&(m.__data__=p.__data__),h[y]=m,Wf(h[y],e,n,y,h,Ln(p,n)));return new Ei(s,this._parents,e,n)}function i9(t){var e=this._name,n=this._id;typeof t!="function"&&(t=LS(t));for(var i=this._groups,r=i.length,s=[],l=[],c=0;c<r;++c)for(var f=i[c],h=f.length,p,m=0;m<h;++m)if(p=f[m]){for(var y=t.call(p,p.__data__,m,f),v,x=Ln(p,n),T=0,E=y.length;T<E;++T)(v=y[T])&&Wf(v,e,n,T,y,x);s.push(y),l.push(p)}return new Ei(s,l,e,n)}var r9=Ol.prototype.constructor;function s9(){return new r9(this._groups,this._parents)}function o9(t,e){var n,i,r;return function(){var s=Po(this,t),l=(this.style.removeProperty(t),Po(this,t));return s===l?null:s===n&&l===i?r:r=e(n=s,i=l)}}function QS(t){return function(){this.style.removeProperty(t)}}function a9(t,e,n){var i,r=n+"",s;return function(){var l=Po(this,t);return l===r?null:l===i?s:s=e(i=l,n)}}function l9(t,e,n){var i,r,s;return function(){var l=Po(this,t),c=n(this),f=c+"";return c==null&&(f=c=(this.style.removeProperty(t),Po(this,t))),l===f?null:l===i&&f===r?s:(r=f,s=e(i=l,c))}}function c9(t,e){var n,i,r,s="style."+e,l="end."+s,c;return function(){var f=ti(this,t),h=f.on,p=f.value[s]==null?c||(c=QS(e)):void 0;(h!==n||r!==p)&&(i=(n=h).copy()).on(l,r=p),f.on=i}}function u9(t,e,n){var i=(t+="")=="transform"?Gz:GS;return e==null?this.styleTween(t,o9(t,i)).on("end.style."+t,QS(t)):typeof e=="function"?this.styleTween(t,l9(t,i,b_(this,"style."+t,e))).each(c9(this._id,t)):this.styleTween(t,a9(t,i,e),n).on("end.style."+t,null)}function f9(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function h9(t,e,n){var i,r;function s(){var l=e.apply(this,arguments);return l!==r&&(i=(r=l)&&f9(t,l,n)),i}return s._value=e,s}function d9(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,h9(t,e,n??""))}function p9(t){return function(){this.textContent=t}}function g9(t){return function(){var e=t(this);this.textContent=e??""}}function m9(t){return this.tween("text",typeof t=="function"?g9(b_(this,"text",t)):p9(t==null?"":t+""))}function _9(t){return function(e){this.textContent=t.call(this,e)}}function y9(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&_9(r)),e}return i._value=t,i}function v9(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,y9(t))}function b9(){for(var t=this._name,e=this._id,n=JS(),i=this._groups,r=i.length,s=0;s<r;++s)for(var l=i[s],c=l.length,f,h=0;h<c;++h)if(f=l[h]){var p=Ln(f,e);Wf(f,t,n,h,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Ei(i,this._parents,t,n)}function x9(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,l){var c={value:l},f={value:function(){--r===0&&s()}};n.each(function(){var h=ti(this,i),p=h.on;p!==t&&(e=(t=p).copy(),e._.cancel.push(c),e._.interrupt.push(c),e._.end.push(f)),h.on=e}),r===0&&s()})}var T9=0;function Ei(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function JS(){return++T9}var yi=Ol.prototype;Ei.prototype={constructor:Ei,select:n9,selectAll:i9,selectChild:yi.selectChild,selectChildren:yi.selectChildren,filter:KH,merge:ZH,selection:s9,transition:b9,call:yi.call,nodes:yi.nodes,node:yi.node,size:yi.size,empty:yi.empty,each:yi.each,on:JH,attr:NH,attrTween:UH,style:u9,styleTween:d9,text:m9,textTween:v9,remove:t9,tween:EH,delay:VH,duration:$H,ease:XH,easeVarying:qH,end:x9,[Symbol.iterator]:yi[Symbol.iterator]};function w9(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var S9={time:null,delay:0,duration:250,ease:w9};function A9(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function E9(t){var e,n;t instanceof Ei?(e=t._id,t=t._name):(e=JS(),(n=S9).time=y_(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var l=i[s],c=l.length,f,h=0;h<c;++h)(f=l[h])&&Wf(f,t,e,h,l,n||A9(f,e));return new Ei(i,this._parents,t,e)}Ol.prototype.interrupt=wH;Ol.prototype.transition=E9;const im=Math.PI,rm=2*im,zr=1e-6,R9=rm-zr;function eA(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function C9(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return eA;const n=10**e;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class M9{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?eA:C9(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,i,r){this._append`Q${+e},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,n,i,r,s,l){this._append`C${+e},${+n},${+i},${+r},${this._x1=+s},${this._y1=+l}`}arcTo(e,n,i,r,s){if(e=+e,n=+n,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let l=this._x1,c=this._y1,f=i-e,h=r-n,p=l-e,m=c-n,y=p*p+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(y>zr)if(!(Math.abs(m*f-h*p)>zr)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let v=i-l,x=r-c,T=f*f+h*h,E=v*v+x*x,C=Math.sqrt(T),P=Math.sqrt(y),M=s*Math.tan((im-Math.acos((T+y-E)/(2*C*P)))/2),I=M/P,D=M/C;Math.abs(I-1)>zr&&this._append`L${e+I*p},${n+I*m}`,this._append`A${s},${s},0,0,${+(m*v>p*x)},${this._x1=e+D*f},${this._y1=n+D*h}`}}arc(e,n,i,r,s,l){if(e=+e,n=+n,i=+i,l=!!l,i<0)throw new Error(`negative radius: ${i}`);let c=i*Math.cos(r),f=i*Math.sin(r),h=e+c,p=n+f,m=1^l,y=l?r-s:s-r;this._x1===null?this._append`M${h},${p}`:(Math.abs(this._x1-h)>zr||Math.abs(this._y1-p)>zr)&&this._append`L${h},${p}`,i&&(y<0&&(y=y%rm+rm),y>R9?this._append`A${i},${i},0,1,${m},${e-c},${n-f}A${i},${i},0,1,${m},${this._x1=h},${this._y1=p}`:y>zr&&this._append`A${i},${i},0,${+(y>=im)},${m},${this._x1=e+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(e,n,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function eo(t){return function(){return t}}function P9(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);e=i}return t},()=>new M9(e)}function O9(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function tA(t){this._context=t}tA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function I9(t){return new tA(t)}function N9(t){return t[0]}function k9(t){return t[1]}function D9(t,e){var n=eo(!0),i=null,r=I9,s=null,l=P9(c);t=typeof t=="function"?t:t===void 0?N9:eo(t),e=typeof e=="function"?e:e===void 0?k9:eo(e);function c(f){var h,p=(f=O9(f)).length,m,y=!1,v;for(i==null&&(s=r(v=l())),h=0;h<=p;++h)!(h<p&&n(m=f[h],h,f))===y&&((y=!y)?s.lineStart():s.lineEnd()),y&&s.point(+t(m,h,f),+e(m,h,f));if(v)return s=null,v+""||null}return c.x=function(f){return arguments.length?(t=typeof f=="function"?f:eo(+f),c):t},c.y=function(f){return arguments.length?(e=typeof f=="function"?f:eo(+f),c):e},c.defined=function(f){return arguments.length?(n=typeof f=="function"?f:eo(!!f),c):n},c.curve=function(f){return arguments.length?(r=f,i!=null&&(s=r(i)),c):r},c.context=function(f){return arguments.length?(f==null?i=s=null:s=r(i=f),c):i},c}function VT(t){return t<0?-1:1}function jT(t,e,n){var i=t._x1-t._x0,r=e-t._x1,s=(t._y1-t._y0)/(i||r<0&&-0),l=(n-t._y1)/(r||i<0&&-0),c=(s*r+l*i)/(i+r);return(VT(s)+VT(l))*Math.min(Math.abs(s),Math.abs(l),.5*Math.abs(c))||0}function HT(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function sg(t,e,n){var i=t._x0,r=t._y0,s=t._x1,l=t._y1,c=(s-i)/3;t._context.bezierCurveTo(i+c,r+c*e,s-c,l-c*n,s,l)}function Tf(t){this._context=t}Tf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:sg(this,this._t0,HT(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,sg(this,HT(this,n=jT(this,t,e)),n);break;default:sg(this,this._t0,n=jT(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};Object.create(Tf.prototype).point=function(t,e){Tf.prototype.point.call(this,e,t)};function L9(t){return new Tf(t)}function Ja(t,e,n){this.k=t,this.x=e,this.y=n}Ja.prototype={constructor:Ja,scale:function(t){return t===1?this:new Ja(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ja(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ja.prototype;function wf({stats:t,width:e=220,height:n=120,mode:i="distribution"}){const r=L.useRef();return L.useEffect(()=>{if(!t||!r.current)return;let s=Object.entries(t).filter(([v,x])=>v!=="PUMA"&&typeof x=="number").map(([v,x])=>({label:B9(v),value:i==="distribution"&&x<=1?x*100:x}));i==="distribution"?s.sort((v,x)=>cf(v.value,x.value)):i==="coefficients"&&s.sort((v,x)=>cf(v.value,x.value));const l=__(r.current);l.selectAll("*").remove();const c={top:10,right:20,bottom:20,left:80},f=e-c.left-c.right,h=n-c.top-c.bottom,p=l.append("g").attr("transform",`translate(${c.left},${c.top})`),m=jf().domain([i==="coefficients"?Math.min(0,vz(s,v=>v.value)):0,qg(s,v=>v.value)]).nice().range([0,f]),y=zf().domain(s.map(v=>v.label)).range([0,h]).padding(.1);p.append("g").attr("transform",`translate(0,${h})`).call(d_(m).ticks(4).tickFormat(v=>i==="distribution"?v+"%":v)).selectAll("text").style("font-size","10px"),p.append("g").call(p_(y)).selectAll("text").style("font-size","10px"),i==="coefficients"&&p.append("line").attr("x1",m(0)).attr("x2",m(0)).attr("y1",0).attr("y2",h).attr("stroke","#000").attr("stroke-width",1),p.selectAll("rect").data(s).join("rect").attr("y",v=>y(v.label)).attr("x",v=>v.value<0?m(v.value):m(0)).attr("width",v=>Math.abs(m(v.value)-m(0))).attr("height",y.bandwidth()).attr("fill",v=>i==="coefficients"?v.value>0?"#2ca02c":v.value<0?"#d62728":"#999":"#1f77b4"),p.selectAll("text.value").data(s).join("text").attr("class","value").attr("x",v=>v.value>=0?m(v.value)+4:m(v.value)-4).attr("y",v=>y(v.label)+y.bandwidth()/2).attr("dy","0.35em").attr("text-anchor",v=>v.value>=0?"start":"end").style("font-size","10px").text(v=>i==="distribution"?`${v.value.toFixed(1)}%`:v.value.toFixed(2))},[t,e,n,i]),Y.jsx("svg",{ref:r,width:e,height:n})}function B9(t){switch(t){case"ba_or_higher":return"BA or higher";case"hs_or_higher":return"HS or higher";case"less_than_hs":return"Less than HS";default:return t}}const $T="/acs-dashboard/",U9=IS(SV).domain([0,1]),F9="pk.eyJ1Ijoid2h6ZW11Y2giLCJhIjoiY21mNW1veXJuMDNzYzJsb21jOXZkb3Y5cyJ9.hP6BD6HV9rrR4NlzWt3DVA";function z9(){const[t,e]=L.useState(null),[n,i]=L.useState(null),[r,s]=L.useState(null);L.useEffect(()=>{fetch(`${$T}data/geo/puma_shapes.json`).then(h=>h.json()).then(e),fetch(`${$T}data/education_by_puma_2023.json`).then(h=>h.json()).then(h=>i(h.map(p=>({...p,PUMA:Number(p.PUMA)}))))},[]);const l=h=>{const p=EV(h.properties.PUMA,n);if(!p)return[200,200,200,100];const m=mr(U9(p.ba_or_higher));return[m.r,m.g,m.b,200]},c=L.useMemo(()=>new ts({id:"puma-layer",data:t,filled:!0,getFillColor:l,stroked:!0,getLineColor:[255,255,255],lineWidthMinPixels:1,pickable:!0,onHover:h=>s(h&&h.object?h:null)}),[t,n]);if(!t||!n)return Y.jsx("div",{children:"Loading map data..."});const f=AV(r);return Y.jsxs(l_,{style:{position:"absolute",width:"100%",height:"100%"},initialViewState:RV(),controller:!0,layers:[c],children:[Y.jsx(Cl,{mapStyle:"mapbox://styles/mapbox/light-v9",mapboxAccessToken:F9,children:f?.type==="popup"&&Y.jsx(tz,{longitude:f.longitude,latitude:f.latitude,closeButton:!1,closeOnClick:!1,anchor:"top",children:WT(f.content,n)})}),f?.type==="tooltip"&&Y.jsx("div",{style:{position:"absolute",left:f.x,top:f.y,backgroundColor:"white",padding:"8px",borderRadius:"6px",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",pointerEvents:"none",zIndex:1e3,width:"320px"},children:WT(f.content,n)})]})}function WT(t,e){const n=t.properties.PUMA,i=t.properties.name,r=e.find(s=>s.PUMA===Number(n));return r?Y.jsxs("div",{children:[Y.jsx("b",{children:i}),Y.jsxs("div",{style:{fontSize:"11px",color:"#777",marginBottom:"6px"},children:["PUMA ",n]}),Y.jsx(wf,{stats:r,mode:"distribution",width:200,height:120}),Y.jsx(wf,{stats:r.coefficients,mode:"coefficients",width:200,height:120})]}):Y.jsxs("div",{style:{color:"#777"},children:["No education data for PUMA ",n]})}function V9(t,e,n,i,r={}){const{marginTop:s=10,marginRight:l=20,marginBottom:c=20,marginLeft:f=80,color:h="#4a90e2"}=r,p=__(t);p.selectAll("*").remove();const m=n-f-l,y=i-s-c,v=e.map((C,P)=>typeof C=="number"?{label:String(P),value:C}:{label:C.label,value:+C.value||0}).sort((C,P)=>cf(C.value,P.value));qg(v,C=>C.value);const x=jf().domain([0,qg(v,C=>C.value)||0]).nice().range([0,m]),T=zf().domain(v.map(C=>C.label)).range([0,y]).padding(.1),E=p.append("g").attr("transform",`translate(${f},${s})`);E.append("g").attr("transform",`translate(0,${y})`).call(d_(x).ticks(4).tickFormat(C=>C+"%")).selectAll("text").style("font-size","10px"),E.append("g").call(p_(T)).selectAll("text").style("font-size","10px"),E.selectAll("rect").data(e).join("rect").attr("y",C=>T(C.label)).attr("x",C=>C.value<0?x(C.value):x(0)).attr("width",C=>Math.abs(x(C.value)-x(0))).attr("height",T.bandwidth()).attr("fill",C=>typeof h=="function"?h(C):h),E.selectAll("text.value").data(v).join("text").attr("class","value").attr("x",C=>x(C.value)+4).attr("y",C=>T(C.label)+T.bandwidth()/2).attr("dy","0.35em").style("font-size","10px").text(C=>`${C.value.toFixed(1)}%`)}function j9({data:t,width:e=300,height:n=150}){const i=L.useRef();return L.useEffect(()=>{t&&i.current&&V9(i.current,t,e,n,{color:"#2ca02c"})},[t,e,n]),Y.jsx("svg",{ref:i,width:e,height:n})}function H9(){const t=[5,10,8,15,12];return Y.jsxs("div",{style:{padding:"20px"},children:[Y.jsx("h2",{children:"Test BarChart"}),Y.jsx(j9,{data:t,width:200,height:100})]})}function $9(){const t={ba_or_higher:.275,hs_or_higher:.865,less_than_hs:.135,coefficients:{ba_or_higher:.12,hs_or_higher:.07,less_than_hs:-.15}};return Y.jsxs("div",{style:{padding:"20px"},children:[Y.jsx("h2",{children:"Test CoeffChart"}),Y.jsxs("div",{style:{display:"flex",gap:"30px",alignItems:"flex-start"},children:[Y.jsxs("div",{children:[Y.jsx("h4",{children:"Education Distribution"}),Y.jsx(wf,{stats:t,mode:"distribution",width:260,height:140})]}),Y.jsxs("div",{children:[Y.jsx("h4",{children:"Wage Premiums"}),Y.jsx(wf,{stats:t.coefficients,mode:"coefficients",width:260,height:140})]})]})]})}const XT=t=>{let e;const n=new Set,i=(h,p)=>{const m=typeof h=="function"?h(e):h;if(!Object.is(m,e)){const y=e;e=p??(typeof m!="object"||m===null)?m:Object.assign({},e,m),n.forEach(v=>v(e,y))}},r=()=>e,c={setState:i,getState:r,getInitialState:()=>f,subscribe:h=>(n.add(h),()=>n.delete(h))},f=e=t(i,r,c);return c},W9=(t=>t?XT(t):XT),X9=t=>t;function Y9(t,e=X9){const n=Xc.useSyncExternalStore(t.subscribe,Xc.useCallback(()=>e(t.getState()),[t,e]),Xc.useCallback(()=>e(t.getInitialState()),[t,e]));return Xc.useDebugValue(n),n}const YT=t=>{const e=W9(t),n=i=>Y9(e,i);return Object.assign(n,e),n},q9=(t=>t?YT(t):YT),K9={BASE_URL:"/acs-dashboard/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_MAPBOX_TOKEN:"pk.eyJ1Ijoid2h6ZW11Y2giLCJhIjoiY21mNW1veXJuMDNzYzJsb21jOXZkb3Y5cyJ9.hP6BD6HV9rrR4NlzWt3DVA"},_u=typeof import.meta<"u"&&K9&&"/acs-dashboard/"||"/",Z9={countyMetaUrl:`${_u}data/cache/county-metadata.json`,yearsUrl:`${_u}data/cache/years.json`,flowUrl:t=>`${_u}data/cache/flows/${t}.json`,dimensionsUrl:`${_u}data/cache/dimensions.json`,maxArcs:200},ke={config:{...Z9},initPromise:null,years:[],dimensions:null,countyMetadata:[],countyById:new Map,countiesByState:new Map,flowsByYear:new Map,memoizedSelectors:new Map};async function Xf(){return ke.initPromise||(ke.initPromise=(async()=>{const[t,e,n]=await Promise.all([Lu(ke.config.yearsUrl),Lu(ke.config.countyMetaUrl),Lu(ke.config.dimensionsUrl).catch(()=>null)]);ke.years=t,ke.countyMetadata=e,ke.dimensions=n,e.forEach(i=>{ke.countyById.set(i.geoid,i),ke.countiesByState.has(i.state)||ke.countiesByState.set(i.state,[]),ke.countiesByState.get(i.state).push(i.geoid)})})()),ke.initPromise}async function nA(t){if(await Xf(),ke.flowsByYear.has(t))return;const e=typeof ke.config.flowUrl=="function"?ke.config.flowUrl(t):ke.config.flowUrl,n=await Lu(e);ke.flowsByYear.set(t,n);for(const i of ke.memoizedSelectors.keys())i.includes(`"${t}"`)&&ke.memoizedSelectors.delete(i)}function G9(){return ke.years.slice()}function Q9(){return ke.dimensions}function Yf(){return ke.countyMetadata.slice()}async function sm(t={}){const e=await J9(t),n=JSON.stringify(e);if(ke.memoizedSelectors.has(n))return ke.memoizedSelectors.get(n);const{year:i}=e,r=ke.flowsByYear.get(i);if(!r)return[];const s=e7(r,e);return ke.memoizedSelectors.set(n,s),s}async function x_(t){await Xf();const e=t??ke.years[ke.years.length-1];return await nA(e),ke.flowsByYear.get(e)}async function J9(t){await Xf();const{year:e=ke.years[ke.years.length-1],metric:n="net",minFlow:i=0,topN:r=ke.config.maxArcs,threshold:s=null,state:l=null,county:c=null,age:f=null,income:h=null,education:p=null}=t;return await nA(e),{year:e,metric:n,minFlow:i,topN:r,threshold:s,state:l,county:c,age:f,income:h,education:p}}function e7(t,e){const{metric:n,minFlow:i,topN:r,state:s,county:l,age:c,income:f,education:h}=e;let m=t.rows??[];if(c&&c!=="all"&&(m=m.filter(v=>v.age===c)),f&&f!=="all"&&(m=m.filter(v=>v.income===f)),h&&h!=="all"&&(m=m.filter(v=>v.education===h)),s){const v=new Set(ke.countiesByState.get(s)??[]);m=m.filter(x=>v.has(x.origin)||v.has(x.dest))}if(l){const v=String(l).padStart(5,"0");if(n==="in")m=t.inAdjacency?.[v]??[];else if(n==="out")m=t.outAdjacency?.[v]??[];else{const x=t.inAdjacency?.[v]??[],T=t.outAdjacency?.[v]??[];m=[...x,...T]}}let y=m.filter(v=>v.flow>=i);return y.sort((v,x)=>x.flow-v.flow),typeof r=="number"&&r>0&&(y=y.slice(0,r)),y.map(v=>({id:`${v.year}-${v.origin}-${v.dest}-${v.age??"any"}-${v.income??"any"}-${v.education??"any"}`,year:v.year,origin:v.origin,dest:v.dest,flow:v.flow,originPosition:[v.originLon,v.originLat],destPosition:[v.destLon,v.destLat],age:v.age,income:v.income,education:v.education}))}async function Lu(t){const e=/^https?:/i.test(t),n=typeof process<"u"&&typeof process.cwd=="function";if(typeof window>"u"&&!e&&n){const{readFile:i}=await Fr(async()=>{const{readFile:f}=await import("./__vite-browser-external-FmFgRqLi.js");return{readFile:f}},[]),r=await Fr(()=>import("./__vite-browser-external-FmFgRqLi.js"),[]),s=t.startsWith("/")?t.slice(1):t,l=r.join(process.cwd(),"public",s),c=await i(l,"utf8");return JSON.parse(c)}if(typeof fetch=="function")try{const i=await fetch(t);if(!i.ok)throw new Error(`Failed to fetch ${t}: ${i.status}`);return await i.json()}catch(i){if(!e&&n){const{readFile:r}=await Fr(async()=>{const{readFile:h}=await import("./__vite-browser-external-FmFgRqLi.js");return{readFile:h}},[]),s=await Fr(()=>import("./__vite-browser-external-FmFgRqLi.js"),[]),l=t.startsWith("/")?t.slice(1):t,c=s.join(process.cwd(),"public",l),f=await r(c,"utf8");return JSON.parse(f)}throw i}if(n){const{readFile:i}=await Fr(async()=>{const{readFile:f}=await import("./__vite-browser-external-FmFgRqLi.js");return{readFile:f}},[]),r=await Fr(()=>import("./__vite-browser-external-FmFgRqLi.js"),[]),s=t.startsWith("/")?t.slice(1):t,l=r.join(process.cwd(),"public",s),c=await i(l,"utf8");return JSON.parse(c)}throw new Error(`No fetch implementation available for ${t}`)}const qT={year:null,metric:"net",state:null,county:null,minFlow:0,topN:200,age:"all",income:"all",education:"all",viewMode:"choropleth"};function KT(t){return{...qT,year:t??qT.year}}const t7=t=>{const e=new Map;return t.forEach(n=>{n.state&&(e.has(n.state)||e.set(n.state,{id:n.state,label:n.stateName??n.state}))}),Array.from(e.values()).sort((n,i)=>n.label.localeCompare(i.label))},n7=t=>{const e={};return t.forEach(n=>{n.state&&(e[n.state]||(e[n.state]=[]),e[n.state].push({id:n.geoid,label:`${n.name}, ${n.stateName??n.state}`}))}),Object.values(e).forEach(n=>n.sort((i,r)=>i.label.localeCompare(r.label))),e},ot=q9((t,e)=>({ready:!1,filters:{},availableYears:[],states:[],countiesByState:{},init:async()=>{if(e().ready)return;await Xf();const n=G9(),i=n[n.length-1],r=Yf();t({ready:!0,availableYears:n,filters:KT(i),states:t7(r),countiesByState:n7(r)})},setFilter:(n,i)=>t(r=>{const s={...r.filters,[n]:i};return n==="state"&&(s.county=null),{filters:s}}),resetFilters:()=>t(n=>({filters:KT(n.availableYears[n.availableYears.length-1])}))})),i7=[{id:"net",label:"Net"},{id:"in",label:"Inbound"},{id:"out",label:"Outbound"}],r7=[{id:"flow",label:"Flow"},{id:"choropleth",label:"Choropleth"}];function iA(){const t=ot(T=>T.init),e=ot(T=>T.ready),n=ot(T=>T.filters),i=ot(T=>T.setFilter),r=ot(T=>T.resetFilters),s=ot(T=>T.availableYears),l=ot(T=>T.states),c=ot(T=>T.countiesByState),[f,h]=L.useState(null);L.useEffect(()=>{t()},[t]),L.useEffect(()=>{if(!e)return;const T=Q9();h(T??null)},[e]);const p=L.useMemo(()=>og(f?.age??[]),[f?.age]),m=L.useMemo(()=>og(f?.income??[]),[f?.income]),y=L.useMemo(()=>og(f?.education??[]),[f?.education]);if(!e)return Y.jsx("div",{style:ZT,children:Y.jsx("div",{style:vi,children:"Loading filters…"})});const v=n.state,x=v?c[v]??[]:[];return Y.jsxs("div",{style:ZT,children:[Y.jsxs("div",{style:l7,children:[Y.jsx("span",{children:"Filters"}),Y.jsx("button",{type:"button",onClick:r,style:c7,children:"Reset"})]}),Y.jsx(GT,{label:"Map View",options:r7,value:n.viewMode??"choropleth",onSelect:T=>i("viewMode",T)}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"year-select",children:"Year"}),Y.jsx("select",{id:"year-select",value:n.year??s[s.length-1],onChange:T=>i("year",Number(T.target.value)),style:to,children:s.map(T=>Y.jsx("option",{value:T,children:T},T))})]}),Y.jsx(GT,{label:"Metric",options:i7,value:n.metric??"net",onSelect:T=>i("metric",T)}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"state-select",children:"State"}),Y.jsxs("select",{id:"state-select",value:n.state??"",onChange:T=>i("state",T.target.value?T.target.value:null),style:to,children:[Y.jsx("option",{value:"",children:"All States"}),l.map(T=>Y.jsx("option",{value:T.id,children:T.label},T.id))]})]}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"county-select",children:"County"}),Y.jsxs("select",{id:"county-select",value:n.county??"",onChange:T=>i("county",T.target.value?T.target.value:null),style:to,disabled:!v||x.length===0,children:[Y.jsx("option",{value:"",children:v?"All Counties":"Select state first"}),x.map(T=>Y.jsx("option",{value:T.id,children:T.label},T.id))]})]}),Y.jsxs("div",{style:vi,children:[Y.jsxs("label",{style:nr,htmlFor:"min-flow",children:["Min Flow (",n.minFlow,")"]}),Y.jsx("input",{id:"min-flow",type:"range",min:0,max:1e3,step:10,value:n.minFlow??0,onChange:T=>i("minFlow",Number(T.target.value)),style:{width:"100%"}})]}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"age-select",children:"Age"}),Y.jsx("select",{id:"age-select",value:n.age??"all",onChange:T=>i("age",T.target.value),style:to,children:p.map(T=>Y.jsx("option",{value:T.id,children:T.label},T.id))})]}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"income-select",children:"Income"}),Y.jsx("select",{id:"income-select",value:n.income??"all",onChange:T=>i("income",T.target.value),style:to,children:m.map(T=>Y.jsx("option",{value:T.id,children:T.label},T.id))})]}),Y.jsxs("div",{style:vi,children:[Y.jsx("label",{style:nr,htmlFor:"education-select",children:"Education"}),Y.jsx("select",{id:"education-select",value:n.education??"all",onChange:T=>i("education",T.target.value),style:to,children:y.map(T=>Y.jsx("option",{value:T.id,children:T.label},T.id))})]})]})}function og(t){return[{id:"all",label:"All"},...t.map(e=>({id:e.id,label:e.label}))]}const ZT={width:"260px",minWidth:"220px",background:"#f9fafc",border:"1px solid #e0e3eb",borderRadius:"10px",padding:"16px",display:"flex",flexDirection:"column",gap:"14px"},vi={display:"flex",flexDirection:"column",gap:"6px"},nr={fontSize:"13px",fontWeight:600,color:"#1f2933"},to={padding:"6px 8px",borderRadius:"6px",border:"1px solid #cbd2d9",fontSize:"13px"},s7={display:"flex",gap:"6px"},rA={flex:1,padding:"6px 8px",borderRadius:"6px",fontSize:"13px",cursor:"pointer",borderWidth:"1px",borderStyle:"solid",borderColor:"#cbd2d9",background:"white"},o7={...rA},a7={...rA,background:"#2563eb",color:"white",borderColor:"#1d4ed8"},l7={display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:600,color:"#111827"},c7={background:"none",border:"none",color:"#2563eb",cursor:"pointer",fontSize:"12px",padding:0};function GT({label:t,options:e,value:n,onSelect:i}){return Y.jsxs("div",{style:vi,children:[Y.jsx("span",{style:nr,children:t}),Y.jsx("div",{style:s7,children:e.map(r=>Y.jsx("button",{type:"button",onClick:()=>i(r.id),style:n===r.id?a7:o7,children:r.label},r.id))})]})}const T_={background:"white",border:"1px solid #e2e8f0",borderRadius:10,padding:"14px 16px",display:"flex",flexDirection:"column",gap:10,fontSize:13,minWidth:200},u7={display:"flex",alignItems:"center",gap:8},f7={display:"flex",flexWrap:"nowrap",gap:12,alignItems:"center"};function sA({layout:t="split"}){return t==="flow"?Y.jsx(QT,{}):t==="choropleth"?Y.jsx(JT,{}):t==="stack"?Y.jsxs("div",{style:T_,children:[Y.jsx("strong",{style:{fontSize:14},children:"Legend"}),Y.jsx(oA,{}),Y.jsx(aA,{})]}):Y.jsxs("div",{style:f7,children:[Y.jsx(QT,{}),Y.jsx(JT,{})]})}function QT(){return Y.jsxs("div",{style:T_,children:[Y.jsx("strong",{style:{fontSize:14},children:"Flow View"}),Y.jsx(oA,{})]})}function JT(){return Y.jsxs("div",{style:T_,children:[Y.jsx("strong",{style:{fontSize:14},children:"Choropleth View"}),Y.jsx(aA,{})]})}function oA(){const e=ot(n=>n.filters.metric??"net")==="net";return Y.jsxs(Y.Fragment,{children:[e?Y.jsxs(Y.Fragment,{children:[Y.jsx(fo,{color:"rgba(115, 96, 210, 1)",label:"Net gain"}),Y.jsx(fo,{color:"rgba(166, 54, 98, 1)",label:"Net loss"})]}):Y.jsxs(Y.Fragment,{children:[Y.jsx(fo,{color:"rgba(130, 202, 250, 1)",label:"Inbound flow"}),Y.jsx(fo,{color:"rgba(255, 140, 0, 1)",label:"Outbound flow"})]}),Y.jsx("div",{style:{fontSize:12,color:"#4a5568"},children:"Arc thickness scales with √(flow); Min Flow slider hides small values."})]})}function aA(){return Y.jsxs(Y.Fragment,{children:[Y.jsx(fo,{color:"linear-gradient(90deg, rgba(255,165,0,0.8), rgba(255,115,0,0.8))",label:"Higher net in"}),Y.jsx(fo,{color:"linear-gradient(90deg, rgba(70,130,180,0.8), rgba(30,90,160,0.8))",label:"Higher net out"}),Y.jsx("div",{style:{fontSize:12,color:"#4a5568"},children:"Colors scale relative to the active metric and filters."})]})}function fo({color:t,label:e}){const n={...u7};return Y.jsxs("div",{style:n,children:[Y.jsx("span",{style:{width:28,height:8,borderRadius:4,background:t,display:"inline-block",backgroundImage:t.startsWith("linear-gradient")?t:void 0,backgroundColor:t.startsWith("linear-gradient")?void 0:t}}),Y.jsx("span",{children:e})]})}const h7="pk.eyJ1Ijoid2h6ZW11Y2giLCJhIjoiY21mNW1veXJuMDNzYzJsb21jOXZkb3Y5cyJ9.hP6BD6HV9rrR4NlzWt3DVA",d7="/acs-dashboard/data/geo/cb_2018_us_county_5m_boundaries.geojson",p7="/acs-dashboard/data/geo/cb_2018_us_state_5m_boundaries.geojson",e3={longitude:-98,latitude:39,zoom:3.4};function lA(){const t=ot(I=>I.init),e=ot(I=>I.ready),n=ot(I=>I.filters),[i,r]=L.useState(null),[s,l]=L.useState(null),[c,f]=L.useState(null),[h,p]=L.useState(null),[m,y]=L.useState(e3);L.useEffect(()=>{t()},[t]),L.useEffect(()=>{fetch(d7).then(I=>I.json()).then(r).catch(I=>console.error("Failed to load county geojson",I))},[]),L.useEffect(()=>{fetch(p7).then(I=>I.json()).then(l).catch(I=>console.error("Failed to load state geojson",I))},[]),L.useEffect(()=>{if(!e)return;let I=!1;return(async()=>{try{const D=await x_(n.year);I||p(D)}catch(D){console.error("Failed to build choropleth data",D),I||p(null)}})(),()=>{I=!0}},[e,n.year,n.viewMode]);const v=L.useMemo(()=>g7(h,n.metric??"net",n.state??null),[h,n.metric,n.state]),x=L.useMemo(()=>{const I=new Map;return e&&Yf().forEach(D=>I.set(D.geoid,D)),I},[e]),T=L.useMemo(()=>{if(!i?.features)return new Map;const I=new Map;return i.features.forEach(D=>{const z=D.properties?.GEOID;z&&I.set(z,D)}),I},[i]),E=L.useMemo(()=>{if(!s?.features)return new Map;const I=new Map;return s.features.forEach(D=>{const z=D.properties?.STATEFP;z&&I.set(z,D)}),I},[s]),C=L.useMemo(()=>i?new ts({id:`counties-${n.year}-${n.state??"all"}`,data:i,filled:!0,stroked:!0,getFillColor:I=>{const D=I.properties.GEOID,z=v.map[D]??0,ae=m7(z,v.max,n.metric);return n.state&&I.properties.STATEFP!==n.state?[230,230,230,40]:ae},getLineColor:[100,100,100,150],lineWidthMinPixels:.5,pickable:!0,autoHighlight:!0,onHover:I=>{if(!I.object){f(null);return}const{GEOID:D,NAME:z,STATEFP:ae}=I.object.properties,le=x.get(D)?.stateName??ae,ge=v.map[D]??0,Z=h?.inboundTotals??{},ce=h?.outboundTotals??{},de=Z[D]??0,pe=ce[D]??0,Ae=de-pe,w=[`${z}, ${le} (GEOID: ${D})`],k=_7(n.metric);w.push(`${k}: ${ge.toLocaleString(void 0,{maximumFractionDigits:1})}`),n.metric!=="in"&&w.push(`Inbound: ${de.toLocaleString(void 0,{maximumFractionDigits:1})}`),n.metric!=="out"&&w.push(`Outbound: ${pe.toLocaleString(void 0,{maximumFractionDigits:1})}`),n.metric!=="net"&&w.push(`Net: ${Ae.toLocaleString(void 0,{maximumFractionDigits:1})}`),n.age&&n.age!=="all"&&w.push(`Age: ${n.age}`),n.income&&n.income!=="all"&&w.push(`Income: ${n.income}`),n.education&&n.education!=="all"&&w.push(`Education: ${n.education}`),f({x:I.x,y:I.y,text:w.join(`
`)})}}):null,[i,v,n,x,h]),P=L.useMemo(()=>s?new ts({id:"state-outline",data:s,filled:!1,stroked:!0,getLineColor:[60,60,60,220],lineWidthMinPixels:1}):null,[s]),M=L.useMemo(()=>[P,C].filter(Boolean),[P,C]);return L.useEffect(()=>{if(!e)return;let I=null;if(n.county&&T.has(n.county)?I=T.get(n.county):n.state&&E.has(n.state)&&(I=E.get(n.state)),!I){y(z=>t3(z,e3));return}const D=y7(I);D&&y(z=>{const ae=new gr({width:1200,height:800,longitude:z.longitude,latitude:z.latitude,zoom:z.zoom}),he=n.county?60:140;let{longitude:le,latitude:ge,zoom:Z}=ae.fitBounds(D,{padding:he});return Z=Math.min(Z,n.county?8:6),t3(z,{longitude:le,latitude:ge,zoom:Z})})},[e,n.county,n.state,T,E]),Y.jsxs("div",{style:{position:"relative",height:"100%",width:"100%",minWidth:0},children:[Y.jsx(l_,{viewState:m,controller:!0,onViewStateChange:({viewState:I})=>y(I),layers:M,children:Y.jsx(Cl,{mapboxAccessToken:h7,mapStyle:"mapbox://styles/mapbox/light-v11"})}),c&&Y.jsx("div",{style:{position:"absolute",pointerEvents:"none",left:c.x+12,top:c.y+12,background:"rgba(0,0,0,0.75)",color:"white",padding:"6px 8px",borderRadius:6,fontSize:12,whiteSpace:"pre-line"},children:c.text})]})}function g7(t,e,n){if(!t)return{map:{},max:0};const i=t.inboundTotals??{},r=t.outboundTotals??{},s={};let l=0;return new Set([...Object.keys(i),...Object.keys(r)]).forEach(f=>{const h=f.slice(0,2);if(n&&h!==n)return;const p=i[f]??0,m=r[f]??0;let y=0;e==="in"?y=p:e==="out"?y=m:y=p-m,s[f]=y;const v=e==="net"?Math.abs(y):y;v>l&&(l=v)}),{map:s,max:l}}function m7(t,e,n){if(!e)return[240,240,240,120];if(n==="net"){if(t===0)return[240,240,240,120];const r=Math.min(1,Math.abs(t)/e);return t>0?[255,180-r*120,0,200]:[50,120+r*60,220,200]}return[255,180-Math.min(1,t/e)*120,0,200]}function _7(t){return t==="in"?"Inbound":t==="out"?"Outbound":"Net"}function y7(t){const e=t?.geometry;if(!e)return null;let n=1/0,i=1/0,r=-1/0,s=-1/0;const l=f=>{f.forEach(([h,p])=>{h<n&&(n=h),h>r&&(r=h),p<i&&(i=p),p>s&&(s=p)})},c=f=>{f.forEach(h=>l(h))};if(e.type==="Polygon")c(e.coordinates);else if(e.type==="MultiPolygon")e.coordinates.forEach(f=>c(f));else return null;return!Number.isFinite(n)||!Number.isFinite(i)?null:[[n,i],[r,s]]}function t3(t,e){return Math.abs(t.longitude-(e.longitude??t.longitude))+Math.abs(t.latitude-(e.latitude??t.latitude))+Math.abs(t.zoom-(e.zoom??t.zoom))+Math.abs(t.pitch-(e.pitch??t.pitch))+Math.abs(t.bearing-(e.bearing??t.bearing))<1e-4?t:{...t,...e,transitionDuration:800,transitionInterpolator:new G2}}let tr=null,v7=0;const el=new Map;function b7(){return typeof window<"u"&&typeof Worker<"u"}function x7(){if(!b7())return null;if(!tr)try{tr=new Worker(new URL("/acs-dashboard/assets/flowWorker-Dcthfklg.js",import.meta.url),{type:"module"}),tr.onmessage=({data:t})=>{const{id:e,success:n,result:i,error:r}=t||{},s=el.get(e);s&&(el.delete(e),n?s.resolve(i):s.reject(new Error(r||"Unknown worker error")))},tr.onerror=t=>{console.error("Flow worker error",t),el.forEach(({reject:e})=>{e(new Error("Flow worker crashed"))}),el.clear(),tr?.terminate(),tr=null}}catch(t){console.warn("Flow worker initialization failed, falling back",t),tr=null}return tr}async function T7(t,e){const n=x7();if(!n)return sm(e);const i=++v7;return new Promise((r,s)=>{el.set(i,{resolve:r,reject:s}),n.postMessage({id:i,type:t,payload:e})})}function w7(t){return T7("getFlows",t)}async function S7(t){if(typeof window>"u")return sm(t);try{return await w7(t)}catch(e){return console.warn("Flow worker failed, falling back to main thread",e),sm(t)}}const A7="pk.eyJ1Ijoid2h6ZW11Y2giLCJhIjoiY21mNW1veXJuMDNzYzJsb21jOXZkb3Y5cyJ9.hP6BD6HV9rrR4NlzWt3DVA",E7="/acs-dashboard/data/geo/cb_2018_us_county_5m_boundaries.geojson",R7="/acs-dashboard/data/geo/cb_2018_us_state_5m_boundaries.geojson",n3={longitude:-98,latitude:39,zoom:3.4,pitch:50,bearing:-20},C7=[130,202,250,200],M7=[255,140,0,200],P7=[30,90,160,200],O7=[115,96,210,200],I7=[166,54,98,200],N7=[128,128,128,200],k7=[0,150,136,160],D7=[0,120,110,220],L7=[168,208,255,90],B7=[205,225,255,110],U7=[30,90,160,220];function cA({forceEnabled:t=!1}){const e=ot(Z=>Z.init),n=ot(Z=>Z.ready),i=ot(Z=>Z.filters),r=i.viewMode??"choropleth",s=t||r==="flow",[l,c]=L.useState(n3),[f,h]=L.useState(null),[p,m]=L.useState(null),[y,v]=L.useState([]),[x,T]=L.useState(null),[E,C]=L.useState(null);L.useEffect(()=>{e()},[e]),L.useEffect(()=>{fetch(E7).then(Z=>Z.json()).then(h).catch(Z=>console.error("Failed to load county geojson",Z))},[]),L.useEffect(()=>{fetch(R7).then(Z=>Z.json()).then(m).catch(Z=>console.error("Failed to load state geojson",Z))},[]),L.useEffect(()=>{if(!n||!s){v([]);return}let Z=!1;return(async()=>{try{const ce=await S7(i);Z||v(ce)}catch(ce){console.error("Failed to load flows",ce),Z||v([])}})(),()=>{Z=!0}},[n,i,s]),L.useEffect(()=>{if(!n)return;let Z=!1;return(async()=>{try{const ce=await x_(i.year);Z||C(ce)}catch(ce){console.error("Failed to load yearly summary",ce),Z||C(null)}})(),()=>{Z=!0}},[n,i.year]);const P=L.useMemo(()=>{const Z=new Map;return n&&Yf().forEach(ce=>Z.set(ce.geoid,ce)),Z},[n]),M=L.useMemo(()=>{if(!f?.features)return new Map;const Z=new Map;return f.features.forEach(ce=>{const de=ce.properties?.GEOID;de&&Z.set(de,ce)}),Z},[f]),I=L.useMemo(()=>{if(!p?.features)return new Map;const Z=new Map;return p.features.forEach(ce=>{const de=ce.properties?.STATEFP;de&&Z.set(de,ce)}),Z},[p]),D=i.county?r3(i.county):null,z=i.state?V7(i.state):null,ae=L.useMemo(()=>{if(!y.length)return null;const{metric:Z}=i,ce=E?.inboundTotals??{},de=E?.outboundTotals??{},pe=w=>{const k=ce[w]??0,N=de[w]??0,G=k-N;return G>.01?O7:G<-.01?I7:N7},Ae=w=>Z!=="net"?()=>F7(Z):k=>{const N=w==="origin"?k.origin:k.dest;return pe(N)};return new t_({id:"migration-arcs",data:y,pickable:!0,getSourcePosition:w=>w.originPosition,getTargetPosition:w=>w.destPosition,getWidth:w=>Math.max(.4,Math.sqrt(w.flow)*.15),getSourceColor:Ae("origin"),getTargetColor:Ae("dest"),onHover:({x:w,y:k,object:N})=>{if(!N){T(null);return}const G=P.get(N.origin),A=P.get(N.dest),U=E?.inboundTotals??{},X=E?.outboundTotals??{},ee=U[N.dest]??0,ne=X[N.dest]??0,fe=ee-ne,me=U[N.origin]??0,Te=X[N.origin]??0,ve=me-Te,je=[`${G?.name??N.origin}, ${G?.stateName??G?.state??""} → ${A?.name??N.dest}, ${A?.stateName??A?.state??""}`,`Slice Flow: ${N.flow.toFixed(1)}`,`Destination In: ${ee.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Destination Out: ${ne.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Destination Net: ${fe.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Origin In: ${me.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Origin Out: ${Te.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Origin Net: ${ve.toLocaleString(void 0,{maximumFractionDigits:1})}`];N.age&&N.age!=="all"&&je.push(`Age: ${N.age}`),N.income&&N.income!=="all"&&je.push(`Income: ${N.income}`),N.education&&N.education!=="all"&&je.push(`Education: ${N.education}`),T({x:w,y:k,text:je.join(`
`)})}})},[y,i,P,E]),he=L.useMemo(()=>{if(!f)return null;const Z=D;return new ts({id:"county-boundaries",data:f,filled:!0,stroked:!0,getFillColor:ce=>{const de=ce.properties.GEOID;return Z&&de===Z?k7:z&&ce.properties.STATEFP!==z?[230,230,230,40]:z&&ce.properties.STATEFP===z?B7:[230,230,230,80]},getLineColor:ce=>{const de=ce.properties.GEOID;return Z&&de===Z?D7:z&&ce.properties.STATEFP===z?[120,120,120,200]:[120,120,120,160]},lineWidthUnits:"pixels",getLineWidth:ce=>{const de=ce.properties.GEOID;return Z&&de===Z?2.4:z&&ce.properties.STATEFP===z?1.4:.75},pickable:!0,updateTriggers:{getFillColor:[Z,z],getLineColor:[Z,z],getLineWidth:[Z,z]},onHover:ce=>{if(!ce.object){T(null);return}const de=j7(ce.object.properties.GEOID,P,E,i);T({x:ce.x,y:ce.y,text:de})}})},[f,D,z,P,E]),le=L.useMemo(()=>p?new ts({id:"state-boundaries",data:p,filled:!0,stroked:!0,getFillColor:Z=>z&&Z.properties.STATEFP===z?L7:[0,0,0,0],getLineColor:Z=>z&&Z.properties.STATEFP===z?U7:[60,60,60,200],lineWidthUnits:"pixels",getLineWidth:Z=>z&&Z.properties.STATEFP===z?2.5:1.2,updateTriggers:{getFillColor:[z],getLineColor:[z],getLineWidth:[z]}}):null,[p,z]),ge=L.useMemo(()=>[le,he,ae].filter(Boolean),[le,he,ae]);return L.useEffect(()=>{if(!n)return;let Z=null;const ce=i.county?r3(i.county):null;if(ce&&M.has(ce)?Z=M.get(ce):z&&I.has(z)&&(Z=I.get(z)),!Z){c(pe=>i3(pe,n3));return}const de=z7(Z);de&&c(pe=>{const Ae=new gr({width:1200,height:800,longitude:pe.longitude,latitude:pe.latitude,zoom:pe.zoom}),w=ce?60:140;let{longitude:k,latitude:N,zoom:G}=Ae.fitBounds(de,{padding:w});return G=Math.min(G,ce?8:6),i3(pe,{longitude:k,latitude:N,zoom:G})})},[n,i.county,z,M,I]),Y.jsxs("div",{style:{position:"relative",height:"100%",width:"100%",minWidth:0},children:[Y.jsx(l_,{viewState:l,controller:!0,onViewStateChange:({viewState:Z})=>c(Z),layers:ge,children:Y.jsx(Cl,{mapboxAccessToken:A7,mapStyle:"mapbox://styles/mapbox/light-v11"})}),x&&Y.jsx("div",{style:{position:"absolute",pointerEvents:"none",left:x.x+12,top:x.y+12,background:"rgba(0,0,0,0.75)",color:"white",padding:"6px 8px",borderRadius:6,fontSize:12,whiteSpace:"pre-line"},children:x.text})]})}function F7(t){return t==="in"?C7:t==="out"?M7:P7}function z7(t){const e=t?.geometry;if(!e)return null;let n=1/0,i=1/0,r=-1/0,s=-1/0;const l=f=>{f.forEach(([h,p])=>{h<n&&(n=h),h>r&&(r=h),p<i&&(i=p),p>s&&(s=p)})},c=f=>{f.forEach(h=>l(h))};if(e.type==="Polygon")c(e.coordinates);else if(e.type==="MultiPolygon")e.coordinates.forEach(f=>c(f));else return null;return!Number.isFinite(n)||!Number.isFinite(i)?null:[[n,i],[r,s]]}function i3(t,e){return Math.abs(t.longitude-(e.longitude??t.longitude))+Math.abs(t.latitude-(e.latitude??t.latitude))+Math.abs(t.zoom-(e.zoom??t.zoom))+Math.abs(t.pitch-(e.pitch??t.pitch))+Math.abs(t.bearing-(e.bearing??t.bearing))<1e-4?t:{...t,...e,transitionDuration:800,transitionInterpolator:new G2}}function r3(t){return t?(typeof t=="number"?t.toString():String(t)).padStart(5,"0"):""}function V7(t){return t?(typeof t=="number"?t.toString():String(t)).padStart(2,"0"):""}function j7(t,e,n,i){const r=e.get(t)||{},s=r.name??t,l=r.stateName??r.state??"",c=n?.inboundTotals??{},f=n?.outboundTotals??{},h=c[t]??0,p=f[t]??0,m=h-p,y=[`${s}, ${l} (GEOID: ${t})`,`Inbound: ${h.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Outbound: ${p.toLocaleString(void 0,{maximumFractionDigits:1})}`,`Net: ${m.toLocaleString(void 0,{maximumFractionDigits:1})}`];return i.age&&i.age!=="all"&&y.push(`Age: ${i.age}`),i.income&&i.income!=="all"&&y.push(`Income: ${i.income}`),i.education&&i.education!=="all"&&y.push(`Education: ${i.education}`),y.join(`
`)}const no={net:"#1e5aa0",inbound:"#82cafa",outbound:"#ff8c00"};function uA(){const t=ot(P=>P.ready),e=ot(P=>P.filters),n=ot(P=>P.availableYears),i=ot(P=>P.states),r=ot(P=>P.countiesByState),[s,l]=L.useState([]),[c,f]=L.useState(!1),[h,p]=L.useState(null),[m,y]=L.useState(e.metric!=="net"),v=L.useRef(null),x=L.useMemo(()=>{if(!t)return new Map;const P=new Map;return Yf().forEach(M=>P.set(M.geoid,M)),P},[t]),T=L.useMemo(()=>{const P=e.county;if(P){const I=x.get(P);return{type:"county",ids:[Zr(P)],label:I?`${I.name}, ${I.stateName??I.state??""}`:P}}const M=e.state;if(M){const I=i.find(z=>z.id===M);return{type:"state",ids:(r[M]??[]).map(z=>Zr(z.id)),label:I?I.label:M}}return{type:"national",ids:[],label:"United States"}},[e.county,e.state,x,i,r]);L.useEffect(()=>{e.metric!=="net"&&y(!0)},[e.metric]),L.useEffect(()=>{if(!t||!n.length)return;let P=!1;f(!0),p(null);const M=[...new Set(n)].sort((I,D)=>I-D);return(async()=>{try{const D=(await Promise.all(M.map(z=>x_(z)))).map(z=>H7(z,T,e));P||(l(D.filter(Boolean)),f(!1))}catch(I){P||(console.error("Failed to build trend series",I),p(I instanceof Error?I.message:String(I)),l([]),f(!1))}})(),()=>{P=!0}},[t,n,e.county,e.state,e.age,e.income,e.education,T]),L.useEffect(()=>{if(!s.length||!v.current)return;const P=__(v.current);P.selectAll("*").remove();const M=v.current.clientWidth||680,I=v.current.clientHeight||260;P.attr("viewBox",`0 0 ${M} ${I}`);const D={top:18,right:28,bottom:32,left:56},z=M-D.left-D.right,ae=I-D.top-D.bottom,he=Array.from(new Set(s.map(ne=>ne.year))).sort((ne,fe)=>ne-fe),le=Tz().domain(he).range([0,z]).padding(.25),ge=new Set(["net"]);(m||e.metric!=="net")&&(ge.add("inbound"),ge.add("outbound"));const Z=e.metric==="in"?"inbound":e.metric==="out"?"outbound":"net";ge.add(Z);const ce=[];ge.forEach(ne=>{s.forEach(fe=>{const me=ne==="net"?fe.net:ne==="inbound"?fe.inbound:fe.outbound;ce.push(me)})});const[de,pe]=uz(ce.length?ce:[0],ne=>ne);let Ae=Number.isFinite(de)?de:0,w=Number.isFinite(pe)?pe:0;if(Ae===w){const ne=Math.max(1,Math.abs(Ae)*.1||1);Ae-=ne,w+=ne}else Ae-=Math.abs(Ae)*.05,w+=Math.abs(w)*.05;const k=jf().domain([Ae,w]).nice().range([ae,0]),N=P.append("g").attr("transform",`translate(${D.left},${D.top})`),G=d_(le).tickValues(he).tickFormat(_f("d"));N.append("g").attr("transform",`translate(0,${ae})`).call(G).selectAll("text").style("font-size","11px");const A=p_(k).ticks(6).tickFormat(ne=>_f(",.0f")(ne));N.append("g").call(A).selectAll("text").style("font-size","11px");const U=D9().x(ne=>le(ne.year)).y(ne=>k(ne.value)).curve(L9);[{key:"net",label:"Net",color:no.net,enabled:!0},{key:"inbound",label:"Inbound",color:no.inbound,enabled:m||e.metric!=="net"},{key:"outbound",label:"Outbound",color:no.outbound,enabled:m||e.metric!=="net"}].filter(ne=>ne.enabled).forEach(ne=>{const fe=s.map(Te=>({year:Te.year,value:Te[ne.key]})),me=ne.key===Z;N.append("path").datum(fe).attr("fill","none").attr("stroke",ne.color).attr("stroke-width",me?3:1.75).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("opacity",me?.95:.75).attr("d",U),N.selectAll(`circle.point-${ne.key}`).data(fe).enter().append("circle").attr("class",`point-${ne.key}`).attr("cx",Te=>le(Te.year)).attr("cy",Te=>k(Te.value)).attr("r",me?3.6:2.5).attr("fill",ne.color).attr("opacity",me?.95:.7)});const ee=s.find(ne=>ne.year===e.year);if(ee){const ne=le(ee.year);N.append("line").attr("x1",ne).attr("x2",ne).attr("y1",0).attr("y2",ae).attr("stroke","#9ca3af").attr("stroke-dasharray","4 4")}},[s,e.year,e.metric,m]);const E=s.find(P=>P.year===e.year),C=e.metric==="in"?"inbound":e.metric==="out"?"outbound":"net";return Y.jsxs("div",{style:{background:"white",border:"1px solid #e2e8f0",borderRadius:10,padding:"16px",display:"flex",flexDirection:"column",gap:"12px",width:"100%"},children:[Y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[Y.jsxs("div",{style:{textAlign:"center"},children:[Y.jsx("h3",{style:{margin:0,fontSize:18},children:"Trends"}),Y.jsx("div",{style:{fontSize:13,color:"#4b5563"},children:T.label})]}),Y.jsxs("label",{style:{fontSize:12,color:"#4b5563"},children:[Y.jsx("input",{type:"checkbox",checked:m||e.metric!=="net",disabled:e.metric!=="net",onChange:P=>y(P.target.checked),style:{marginRight:6}}),"Show inbound/outbound"]})]}),Y.jsx("div",{style:{width:"100%",height:260},children:c?Y.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"Loading trend…"}):h?Y.jsxs("div",{style:{color:"#b91c1c",fontSize:13},children:["Failed to load trend data. ",h]}):s.length?Y.jsx("svg",{ref:v,width:"100%",height:"100%",role:"img","aria-label":"Trend chart"}):Y.jsx("div",{style:{fontSize:13,color:"#6b7280"},children:"No trend data available for the current selection."})}),E&&Y.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:13,borderTop:"1px solid #e5e7eb",paddingTop:12,flexWrap:"wrap",alignItems:"center"},children:[Y.jsxs("div",{style:{fontSize:12,color:"#4b5563",fontWeight:600},children:["Year ",E.year]}),Y.jsx(ag,{label:"Net",value:E.net,color:no.net,bold:C==="net"}),Y.jsx(ag,{label:"Inbound",value:E.inbound,color:no.inbound,muted:!m&&e.metric==="net",bold:C==="inbound"}),Y.jsx(ag,{label:"Outbound",value:E.outbound,color:no.outbound,muted:!m&&e.metric==="net",bold:C==="outbound"})]})]})}function ag({label:t,value:e,color:n,muted:i,bold:r}){const s=Number.isFinite(e)?e.toLocaleString(void 0,{maximumFractionDigits:0}):"–",l=i?"#9ca3af":n;return Y.jsxs("div",{style:{color:i?"#9ca3af":"#111827"},children:[Y.jsx("div",{style:{fontSize:12},children:t}),Y.jsx("div",{style:{fontWeight:r?600:500,color:l},children:s})]})}function H7(t,e,n){if(!t)return null;const i=n.age&&n.age!=="all"?n.age:null,r=n.income&&n.income!=="all"?n.income:null,s=n.education&&n.education!=="all"?n.education:null;if(!!!(i||r||s)){if(!t.inboundTotals||!t.outboundTotals)return o3(t,e,{ageFilter:null,incomeFilter:null,educationFilter:null});const c=s3(t.inboundTotals,e),f=s3(t.outboundTotals,e);return{year:t.year,inbound:c,outbound:f,net:c-f}}return o3(t,e,{ageFilter:i,incomeFilter:r,educationFilter:s})}function s3(t={},e){const n=Object.entries(t);if(!n.length)return 0;if(e.type==="national"||!e.ids?.length)return n.reduce((s,[,l])=>s+l,0);const i=new Set(e.ids.map(Zr));let r=0;for(const[s,l]of n)i.has(Zr(s))&&(r+=l);return r}function o3(t,e,n){const i=t.rows??[],{ageFilter:r,incomeFilter:s,educationFilter:l}=n,c=new Set(e.ids.map(Zr));let f=0,h=0;for(const p of i){if(r&&p.age!==r||s&&p.income!==s||l&&p.education!==l)continue;const m=Zr(p.origin),y=Zr(p.dest);if(e.type==="national"){f+=p.flow,h+=p.flow;continue}c.has(y)&&(f+=p.flow),c.has(m)&&(h+=p.flow)}return{year:t.year,inbound:f,outbound:h,net:f-h}}function Zr(t){return typeof t=="number"?t.toString().padStart(5,"0"):typeof t=="string"?t.padStart(5,"0"):String(t??"").padStart(5,"0")}function $7(){const e=ot(s=>s.filters.viewMode??"choropleth")==="flow",n=e?"Flow View":"Choropleth View",i=e?Y.jsx(cA,{}):Y.jsx(lA,{}),r=e?"flow":"choropleth";return Y.jsxs("div",{style:{display:"flex",gap:"24px",alignItems:"flex-start",padding:"16px"},children:[Y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px",width:260,flexShrink:0},children:Y.jsx(iA,{})}),Y.jsxs("div",{style:{flex:1,minWidth:600,display:"flex",flexDirection:"column",gap:"20px",maxWidth:"70vw"},children:[Y.jsxs("div",{style:{display:"flex",gap:"24px",alignItems:"center"},children:[Y.jsxs("div",{style:{flexShrink:0,width:"70vw",height:"60vh"},children:[Y.jsx("h2",{style:{margin:"0 0 12px",fontSize:18,textAlign:"center"},children:n}),Y.jsx("div",{style:{width:"100%",height:"55vh"},children:i})]}),Y.jsx("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:Y.jsx(sA,{layout:r})})]}),Y.jsx(uA,{})]})]})}function W7(){const t=ot(e=>e.filters.viewMode??"choropleth");return Y.jsxs("div",{style:{display:"flex",gap:"24px",alignItems:"flex-start",padding:"16px"},children:[Y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",width:260,flexShrink:0},children:[Y.jsx(iA,{}),Y.jsx(sA,{layout:"stack"})]}),Y.jsxs("div",{style:{flex:1,minWidth:600,maxWidth:"70vw",display:"flex",flexDirection:"column",gap:"16px"},children:[Y.jsx("div",{style:{flex:1,minHeight:"55vh"},children:t==="flow"?Y.jsx(cA,{}):Y.jsx(lA,{})}),Y.jsx(uA,{})]})]})}function X7(){const t=ot(e=>e.init);return L.useEffect(()=>{t()},[t]),Y.jsx("div",{children:Y.jsxs(PC,{children:[Y.jsx(Ur,{path:"/",element:Y.jsx(CC,{to:"/test-map",replace:!0})}),Y.jsx(Ur,{path:"/test-map",element:Y.jsx($7,{})}),Y.jsx(Ur,{path:"/puma",element:Y.jsx(z9,{})}),Y.jsx(Ur,{path:"/test",element:Y.jsx(H9,{})}),Y.jsx(Ur,{path:"/test-coeff",element:Y.jsx($9,{})}),Y.jsx(Ur,{path:"/choropleth",element:Y.jsx(W7,{})})]})})}const Y7="/acs-dashboard/",q7=Y7.replace(/\/$/,"");FR.createRoot(document.getElementById("root")).render(Y.jsx(L.StrictMode,{children:Y.jsx(JC,{basename:q7,children:Y.jsx(X7,{})})}));export{a3 as g};
